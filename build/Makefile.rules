# bbgen main Makefile
#
# This file is included from the Makefile created by the "configure" script



#####################
# Build targets
#####################

CFLAGS += -DMAXMSG=$(MAXMSG) -DBBDPORTNUMBER=$(BBPORT) -I. -I$(BUILDTOPDIR)/include

all: lib-build common-build bbdisplay-build bbnet-build bbproxy-build bbgend-build
	@echo ""
	@echo "Build complete"
	@echo ""

lib-build:
	CC="$(CC)" CFLAGS="$(CFLAGS)" SSLFLAGS="$(SSLFLAGS)" SSLINCDIR="$(SSLINCDIR)" SSLLIBS="$(SSLLIBS)" NETLIBS="$(NETLIBS)" make -C lib all

common-build: lib-build
	CC="$(CC)" CFLAGS="$(CFLAGS)" SSLFLAGS="$(SSLFLAGS)" SSLINCDIR="$(SSLINCDIR)" SSLLIBS="$(SSLLIBS)" NETLIBS="$(NETLIBS)" BBHOME="$(BBHOME)" make -C common all

bbdisplay-build: lib-build
	CC="$(CC)" CFLAGS="$(CFLAGS)" SSLFLAGS="$(SSLFLAGS)" SSLINCDIR="$(SSLINCDIR)" SSLLIBS="$(SSLLIBS)" NETLIBS="$(NETLIBS)" BBHOME="$(BBHOME)" HISTGRAPHDEF="$(HISTGRAPHDEF)" make -C bbdisplay all

bbnet-build: lib-build
	CC="$(CC)" CFLAGS="$(CFLAGS)" SSLFLAGS="$(SSLFLAGS)" SSLINCDIR="$(SSLINCDIR)" SSLLIBS="$(SSLLIBS)" LDAPFLAGS="$(LDAPFLAGS)" LDAPINCDIR="$(LDAPINCDIR)" LDAPLIBS="$(LDAPLIBS)" NETLIBS="$(NETLIBS)" BBHOME="$(BBHOME)" make -C bbnet all

bbproxy-build: lib-build
	CC="$(CC)" CFLAGS="$(CFLAGS)" NETLIBS="$(NETLIBS)" BBHOME="$(BBHOME)" make -C bbproxy all

bbgend-build: lib-build
	CC="$(CC)" CFLAGS="$(CFLAGS)" NETLIBS="$(NETLIBS)" BBHOME="$(BBHOME)" make -C bbgend  all


#####################
# Cleanup targets
#####################
distclean: allclean
	rm -f Makefile
	cd bbnet/c-ares-1.2.0 && (make distclean || /bin/true)

allclean: clean
	cd bbnet/c-ares-1.2.0 && (make clean || /bin/true)

clean:
	make -C lib clean
	make -C common clean
	make -C bbdisplay clean
	make -C bbnet clean
	make -C bbproxy clean
	make -C bbgend clean
	rm -f {.,build,include}/*~


####################
# Install targets
####################

install: install-bbdisplay install-bbnet install-bbproxy install-bbgend

install-common:
	BBHOME="$(BBHOME)" MANROOT="$(MANROOT)" make -C common install

install-bbdisplay: install-common
	BBHOME="$(BBHOME)" MANROOT="$(MANROOT)" CGIDIR="$(CGIDIR)" make -C bbdisplay install

install-bbnet: install-common
	BBHOME="$(BBHOME)" MANROOT="$(MANROOT)" make -C bbnet install

install-bbproxy: install-common
	BBHOME="$(BBHOME)" MANROOT="$(MANROOT)" make -C bbproxy install

install-bbgend: install-common
	BBHOME="$(BBHOME)" MANROOT="$(MANROOT)" make -C bbgend install

