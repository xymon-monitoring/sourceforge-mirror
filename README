README file for bbgen version 1.1
=================================

bbgen is a drop-in replacement for the bb-display.sh script that 
ships with the Big Brother monitoring tool.

It can also replace part of the LARRD tool that is often used
with Big Brother.

bbgen is Copyright (C) 2002, Henrik Storner <henrik@storner.dk>
It is released under the GNU General Public License, version 2.


Features
--------

The main feature of bbgen is speed. My BB installation currently
has about 250 hosts, spread over 50 pages and subpages. The time
to generate the pages with bb-display.sh was about 12 minutes;
bbgen does it in less than 5 seconds.

The pages generated by bbgen should be similar to what you get
with bb-display.sh from BB version 1.9c.

bbgen also supports the generation of files for the LARRD
graphics plugin for Big Brother (http://www.packetpushers.com/larrd).
LARRD uses a Perl script to generate stub HTML pages on the
Big Brother display - bbgen can generate these pages, so you 
do not need to run the larrd-html.pl script. This gives the
other LARRD scripts more time to handle the import of data
for your trend graphs, instead of wasting it with generation
of the web pages. See the "LARRD support" section below.


Requirements
------------

A working Big Brother installation. Get BB up and running first,
then you can drop in bbgen to speed up things.


Installation
------------

Compile bbgen. It has been compiled with gcc 2.95.3 on both
Solaris (2.8) and Linux (Red Hat 7.3, Mandrake 9). Other 
compilers may require some tweaking - I don't know. Normally, 
it should be as simple as running "make".

Put the bbgen executable in $BBHOME/bin/

To test bbgen, su to the account that you run bb as on your
BB display server. Make sure to setup ALL of the environment
variables that BB uses:

	BBHOME=/path/to/BB/home
	export BBHOME
	. $BBHOME/etc/bbdef.sh

Then you can run bbgen and have a look at the webpages it generates.

If you want bbgen to put the pages it generates into a different
directory than your production pages, you can run it like this:

	BBWEB=/bbtest $BBHOME/bin/bbgen /path/to/webroot/bbtest

This puts the webpages into "bbtest/" below your webservers'
webroot. The "BBWEB=/bbtest" is needed to have the proper 
URL's generated that link to "/bbtest".

For testing, you may also want to use the "--nopurple" option;
this disables the update of a status log that bbgen transmits 
when it sees a status logfile that is too old.

When you feel confident that bbgen works, change $BBHOME/runbb.sh
to run "bbgen" instead of "bb-display.sh".


Special display for newly changed items
---------------------------------------

bbgen supports the use of an alternate set of BB red/yellow/green
icons for status items, that have changed within the past 24 
hours.

To enable this, put the extra set of icons into the $BBHOME/www/gifs/
directory as "red-recent.gif", "green-recent.gif" etc, and run
bbgen with the "--recentgifs" option.

I find it quite handy to see what systems have had any problems
recently.


LARRD support
-------------

bbgen has built-in support for handling some of the trivial tasks
that the LARRD trend-graphing package has: Generation of the
pseudo BB log-files for the "larrd" column that link to the 
LARRD page for each host, and generation of those webpages
with links to the various trend-graphs that LARRD provides.

This is disabled by default - to enable it, you must run bbgen
with the "--larrd" option. If you prefer to have your LARRD
columns named something other than "larrd" - mine is called
"graphs" - you can specify the column name as "--larrd=graphs".

bbgen needs to know where you keep the LARRD RRD-files. By
default it uses $BBVAR/rrd/ - if this does not match your
installation, specify the directory with "--rrddir=/path/to/rrdfiles"

When enabling this, you can safely shut off LARRD's html-file
generation, by commenting out this line in larrd.pl:

# `$ENV{'LARRDHOME'}/larrd-html.pl >> $ENV{'LARRDLOG'} 2>&1`;
# Disabled - bbgen does this.

Enabling the LARRD support does increase the run-time of bbgen.
On my system, it approximately doubles the time to run bbgen,
compared to the time it takes without LARRD support. It is still
much faster than the standard bb-display.sh and larrd-html.pl
scripts, though.


Limitations
-----------

The following features in bb-display.sh are not currently implemented
in bbgen:

* "group" directives in bb-hosts are handled as "group-compress".
  I currently have no plans to support the simple "group"
  directive.

* Modem banks are not handled at all by bbgen. This directive
  is simply ignored.

* The bb2.html page does not currently include the acknowledgement
  log.


Bugs
----

bbgen is very new. It is currently in use on two systems I run:
One very large installation, and one very small installation.
It works for me, and I think I have taken care of all the 
little details, but do not be surprised if it crashes when you
try to run it.

The first thing you should check is, if you have all of the BB
environment variables setup (see "Installation") - if any of 
these are not defined, you will most likely see bbgen crash
with a segfault.

Also check that you have write access to the directory, where
you try to store the generated webpages.

If it still fails, feel free to debug the problem and send me
patches :-) Or if your C coding is a bit rusty, e-mail we and
I'll see if I can help you track down the problem. I will 
probably need a copy of the contents of your bb-hosts file,
and the contents of the bbvar/logs/ directory:

	tar cvf /tmp/bbgendata.tar $BBHOSTS $BBLOGS/
	gzip /tmp/bbgendata.tar


Planned improvements
--------------------

See the "TODO" file.



Henrik Storner <henrik@storner.dk>
Dec 31, 2002

