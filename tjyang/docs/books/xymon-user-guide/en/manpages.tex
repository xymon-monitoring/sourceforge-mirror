%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Hobbit Overview}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Hobbit - Introduction to the Hobbit Monitor}

 Hobbit is a tool for monitoring the health of your networked servers
 and the applications running on them. It provides a simple, intuitive
 way of checking the health of your systems from a webbrowser, and can
 also alert you to any problems that arise through alarms sent as
 e-mail, SMS messages, via a pager or by other means. 


 Hobbit is Open Source software, licensed under the GNU GPL. This
 means that you are free to use Hobbit as much as you like, and you
 are free to re-distribute it and change it to suit your specific
 needs. However, if you change it then you must make your changes
 available to others on the same terms that you received Hobbit
 originally. See the file COPYING in the Hobbit source-archive for
 details. 

 Hobbit initially began life as an enhancement to Big Brother called
 ``bbgen''. Over a period of 5 years, Hobbit has evolved from a small
 add-on to a full-fledged monitoring system with capabilities far
 exceeding what was in the original Big Brother package. Hobbit does
 still maintain some compatibility with Big Brother, so it is
 possible to migrate from Big Brother to Hobbit without too much
 trouble. 

 Migrating to Hobbit will give you a significant performance boost,
 and provide you with much more advanced monitoring. The Hobbit tools
 are designed for installations that need to monitor a large number
 of hosts, with very little overhead on the monitoring
 server. Monitoring of thousands of hosts with a single Hobbit server
 is possible - it was developed to handle just this task. 

\section{FEATURES}
 These are some of the core features in Hobbit: 

\begin{description}

\item[Monitoring of hosts and networks] Hobbit collects information
  about your systems in two ways: From querying network services (Web,
  LDAP, DNS, Mail etc.), or from scripts that run either on the Hobbit
  server or on the systems you monitor. The Hobbit package includes a
  Hobbit client which you can install on the servers you monitor; it
  collects data about the CPU-load, disk- and memory-utilisation,
  logfiles, network ports in use, file- and directory-information and
  more. All of the information is stored inside Hobbit, and you can
  define conditions that result in alerts, e.g. if a network service
  stops responding, or a disk fills up. 

\item[Centralized configuration] All configuration of Hobbit is done
  on the Hobbit server. Even when monitoring hundreds or thousands of
  hosts, you can control their configuration centrally on the Hobbit
  server - so there is no need for you to login to a system just to
  change e.g. which processes are monitored. 

\item[Works on all major platforms] The Hobbit server works on all
  Unix-like systems, including Linux, Solaris, FreeBSD, AIX, HP-UX and
  others. The Hobbit client supports all major Unix platforms, and
  there are other Open Source projects - e.g. BBWin, see
  \url{http://bbwin.sourceforge.net/} - providing support for
  Microsoft Windows based systems. 

\item[A simple, intuitive web-based front-end] ``Green is good, red is
  bad''. Using the Hobbit webpages is as simple as that. The hosts you
  monitor can be grouped together in a way that makes sense in your
  organisation and presented in a tree-structure. The webpages use
  many techniques to convey information about the monitored systems,
  e.g. different icons can be used for recently changed statuses;
  links to subpages can be listed in multiple columns; different icons
  can be used for dialup-tests or reverse-tests; selected columns can
  be dropped or unconditionally included on the webpages to eliminate
  unwanted information, or always include certain information;
  user-friendly names can be shown for hosts regardless of their true
  hostname. You can also have automatic links to on-line
  documentation, so information about your critical systems is just a
  click away. 

\item[Integrated trend analysis, historical data and SLA reporting]
  Hobbit stores trend- and availability-information about everything
  it monitors. So if you need to look at how your systems behave over
  time, Hobbit has all of the information you need: Whether is is
  response times of your webpages during peak hours, the CPU
  utilisation over the past 4 weeks, or what the availability of a
  site was compared to the SLA - it's all there inside Hobbit. All
  measurements are tracked and made available in time-based graphs. 


  When you need to drill down into events that have occurred, Hobbit
  provides a powerful tool for viewing the event history for each
  statuslog, with overviews of when problems have occurred during the
  past and easy-to-use zoom-in on the event. 

  For SLA reporting, You can configure planned downtime, agreed
  service availability level, service availability time and have
  Hobbit generate availability reports directly showing the actual
  availability measured against the agreed SLA. Such reports of
  service availability can be generated on-the-fly, or pre-generated
  e.g. for monthly reporting. 

\item[Role-based views] You can have multiple different views of the
  same hosts for different parts of the organisation, e.g. one view
  for the hardware group, and another view for the webmasters - all of
  them fed by the same test tools. 


  If you have a dedicated Network Operations Centre, you can configure
  precisely which alerts will appear on their monitors - e.g. a simple
  anomaly in the system logfile need not trigger a call to 3rd-level
  support at 2 AM, but if the on-line shop goes down you do want
  someone to respond immediately. So you put the webcheck for the
  on-line shop on the NOC monitor page, and leave out the log-file
  check. 
 

\item[Also for the techies] The Hobbit user-interface is simple, but
  engineers will also find lots of relevant information. E.g. the data
  that clients report to Hobbit contain the raw output from a number
  of system commands. That information is available directly in
  Hobbit, so an administrator no longer needs to login to a server to
  get an overview of how it is behaving - the very commands they would
  normally run have alredy been performed, and the results are on-line
  in Hobbit. 


\item[Easy to adapt to your needs] Hobbit includes a lot of tests in
  the core package, but there will always be something specific to
  your setup that you would like to watch. Hobbit allows you to write
  test scripts in your favourite scripting language and have the
  results show up as regular status columns in Hobbit. You can trigger
  alerts from these, and even track trends in graphs just by a simple
  configuration setting. 


\item[Real network service tests] The network test tool knows how to
  test most commonly used protocols, including HTTP, SMTP (e-mail),
  DNS, LDAP (directory services), and many more. When checking
  websites, it is possible to not only check that the webserver is
  responding, but also that the response looks correct by matching the
  response against a pre-defined pattern or a checksum. So you can
  test that a network service is really working and supplying the data
  you expect - not just that the service is running. 

  Protocols that use SSL encryption such as https-websites are fully
  supported, and while checking such services the network tester will
  automatically run a check of the validity of the SSL server
  certificate, and warn about certificates that are about to expire. 

\item[Highly configurable alerts] You want to know when something
  breaks. But you don't want to get flooded with alerts all the
  time. Hobbit lets you define several criteria for when to send out
  an alert, so you only get alerts when there is really something that
  needs your attention right away. While you are handling an incident,
  you can tell Hobbit about it so it stops sending more alerts, and so
  that everyone else can check with Hobbit and know that the problem
  is being taken care of. 


\item[Combined super-tests and test interdependencies] If a single
  test is not enough, combination tests can be defined that combine
  the result of several tests to a single status-report. So if you
  need to monitor that at least 3 out of 5 servers are running at any
  time, Hobbit can do that for you and generate the necessary
  availability report. 

  Tests can also be configured to depend on each other, so that when a
  critical router goes down you will get alerts only for the router -
  and not from the 200 hosts behind the router. 

 
\end{description}

\section{SECURITY}
 All of the Hobbit server tools run under an unprivileged user
 account. A single program - the \emph{hobbitping(1)} network
 connectivity tester - must be installed setuid-root, but has been
 written so that it drops all root privileges immediately after
 performing the operation that requires root privileges. 

 It is recommended that you setup a dedicated account for Hobbit. 

 Communications between the Hobbit server and Hobbit clients use the
 Big Brother TCP port 1984. If the Hobbit server is located behind a
 firewall, it must allow for inbound connections to the Hobbit server
 on tcp port 1984. Normally, Hobbit clients - i.e. the servers you
 are monitoring - must be permitted to connect to the Hobbit server
 on this port. However, if that is not possible due to firewall
 policies, then Hobbit includes the \emph{hobbitfetch(8)} and
 \emph{msgcache(8)} tools to allows for a pull-style way of
 collecting data, where it is the Hobbit server that initiates
 connections to the clients. 


 The Hobbit webpages are dynamically generated through CGI programs. 


 Access to the Hobbit webpages is controlled through your webserver
 access controls, e.g. you can require a login through some form of
 HTTP authentication. 

 
\section{DEMONSTRATION SITE}
 A site running this software can be seen at \url{http://www.hswn.dk/hobbit/}

 
\section{PREREQUISITES}

 You will need a Unix-like system (Linux, Solaris, HP-UX, AIX,
 FreeBSD, Mac OS X or similar) with a webserver installed. You will
 also need a C compiler and some additional libraries, but many
 systems come with the required development tools and libraries
 pre-installed. The required libraries are: 


\begin{enumerate}

 \item \textbf{RRDtool}
 This library is used to store and present trend-data. It is required. 

 \item \textbf{libpcre}
 This library is used for advanced pattern-matching of text strings in
 configuration files. This library is required. 

 \item \textbf{OpenSSL}
 This library is used for communication with SSL-enabled network
 services. Although optional, it is recommended that you install this
 for Hobbit since many network tests do use SSL. 

 \item \textbf{OpenLDAP}
 This library is used for testing LDAP servers. Use of this is optional. 

\end{enumerate}

\section{INSTALLATION}
  For more detailed information about Hobbit system requirements and
  how to install Hobbit, refer to the online documentation
  ``Installing Hobbit'' available from the Hobbit webserver (via the
  ``Help'' menu), or from the ``docs/install.html'' file in the Hobbit
  source archive. 


\section{SUPPORT and MAILING LISTS}
hobbit@hswn.dk is an open mailing list for discussions about
Hobbit. If you would like to participate, send an e-mail to
\textbf{hobbit-subscribe@hswn.dk} to join the list. 


An archive of the mailing list is available at \url{http://www.hswn.dk/hobbiton/}


If you just want to be notified of new releases of Hobbit, please
subscribe to the hobbit-announce mailing list. This is a moderated
list, used only for announcing new Hobbit releases. To be added to
the list, send an e-mail to \textbf{hobbit-announce-subscribe@hswn.dk}. 

\section{Hobbit Wiki Book}

~\cite{wikibook:wikibooktjyang} System Monitoring with Hobbit wiki book.

It is a community effort for hobbit documentation.

\begin{enumerate}

\item User Guide  \url{http://en.wikibooks.org/wiki/System_Monitoring_with_Hobbit/User_Guide}

\item User Guide Administration Guide
  \url{http://en.wikibooks.org/wiki/System_Monitoring_with_Hobbit/Administration_Guide}

\item Developer Guide \url{http://en.wikibooks.org/wiki/System_Monitoring_with_Hobbit/Developer_Guide}

\item Other Docs
\url{http://en.wikibooks.org/wiki/System_Monitoring_with_Hobbit/Other_Docs}

\end{enumerate}

\section{HOBBIT SERVER DAEMONS}
 These daemons implement the core functionality of the Hobbit server: 

\begin{enumerate}

 \item \emph{hobbitd(8)} is the core daemon that collects all reports about
 the status of your hosts. It uses a number of helper modules to
 implement certain tasks such as updating logfiles and sending out
 alerts: hobbitd\_client, hobbitd\_history, hobbitd\_alert and
 hobbitd\_rrd. There is also a hobbitd\_filestore module for
 compatibility with Big Brother. 



 \item \emph{hobbitd\_channel(8)}
 Implements the communication between the Hobbit daemon and the other Hobbit server modules. 


 \item \emph{hobbitd\_history(8)}
 Stores historical data about the things that Hobbit monitors. 


 \item \emph{hobbitd\_rrd(8)}
 Stores trend data, which is used to generate graphs of the data monitored by Hobbit. 


 \item \emph{hobbitd\_alert(8)}
 handles alerts. When a status changes to a critical state, this module decides if an alert should be sent out, and to whom. 


 \item \emph{hobbitd\_client(8)}
 handles data collected by the Hobbit clients, analyzes the data and feeds back several status updates to Hobbit to build the view of the client status. 


 \item \emph{hobbitd\_hostdata(8)}
 stores historical client data when something breaks. E.g. when a
 webpage stops responding hobbitd\_hostdata will save the latest
 client data, so that you can use this to view a snapshot of how the
 system state was just prior to it failing. 


\end{enumerate}
 
\section{HOBBIT NETWORK TEST TOOLS}

These tools are used on servers that execute tests of network
services. 

\begin{enumerate}

 \item \emph{hobbitping(1)}
 performs network connectivity (ping) tests. 


 \item \emph{bbtest-net(1)}
 runs the network service tests. 


 \item \emph{bbretest-net.sh(1)} is an extension script for re-doing failed
 network tests with a higher frequency than the normal network
 tests. This allows Hobbit to pick up the recovery of a network
 service as soon as it happens, resulting in less downtime being
 recorded. 

\end{enumerate}



 
\section{HOBBIT TOOLS HANDLING THE WEB USER-INTERFACE}
 These tools take care of generating and updating the various Hobbit web-pages. 

\begin{enumerate}
 \item \emph{bbgen(1)}
 takes care of updating the Hobbit webpages. 


 \item \emph{hobbitsvc.cgi(1)}
 This CGI program generates an HTML view of a single status log. It is used to present the Hobbit status-logs. 


 \item \emph{hobbitgraph.cgi(1)}
 This CGI program generates graphs of the trend-data collected by Hobbit. 


 \item \emph{hobbit-hostgraphs.cgi(1)}
 When you want to combine multiple graphs into one, this CGI lets you
 combine graphs so you can e.g. compare the load on all of the nodes
 in your server farm. 



 \item \emph{hobbit-nkview.cgi(1)}
 Generates the Critical Systems view, based on the currently critical
 systems and the configuration of what systems and services you want
 to monitor when. 



 \item \emph{bb-hist.cgi(1)}
 This CGI program generates a webpage with the most recent history of
 a particular host+service combination. 



 \item \emph{bb-eventlog.cgi(1)}
 This CGI lets you view a log of events that have happened over a
 period of time, for a single host or test, or for multiple systems. 



 \item \emph{bb-ack.cgi(1)}
 This CGI program allows a user to acknowledge an alert he received
 from Hobbit about a host that is in a critical state. Acknowledging
 an alert serves two purposes: First, it stops more alerts from being
 sent so the technicians are not bothered wit more alerts, and
 secondly it provides feedback to those looking at the Hobbit webpages
 that the problem is being handled. 



 \item \emph{hobbit-mailack(8)}
 is a tool for processing acknowledgements sent via e-mail, e.g. as a response to an e-mail alert. 


 \item \emph{hobbit-enadis.cgi(8)}
 is a CGI program to disable or re-enable hosts or individual
 tests. When disabling a host or test, you stop alarms from being sent
 and also any outages do not affect the SLA calculations. So this tool
 is useful when systems are being brought down for maintenance. 



 \item \emph{bb-findhost.cgi(1)}
 is a CGI program that finds a given host in the Hobbit webpages. As
 your Hobbit installation grows, it can become difficult to remember
 exactly which page a host is on; this CGI script lets you find hosts
 easily. 



 \item \emph{bb-rep.cgi(1)} This CGI program triggers the generation of Hobbit availability reports, using \emph{bbgen(1)}
 as the reporting back-end engine. 


 \item \emph{bb-replog.cgi(1)} This CGI program generates the detailed availability report for a particular host+service combination. 


 \item \emph{bb-snapshot.cgi(1)} is a CGI program to build the Hobbit
 webpages in a ``snapshot'' mode, showing the look of the webpages at
 a particular point in time. It uses \emph{bbgen(1)} as the back-end
 engine. 



 \item \emph{hobbit-statusreport.cgi(1)} is a CGI program reporting test
 results for a single status but for several hosts. It is used to
 e.g. see which SSL certificates are about to expire, across all of
 the Hobbit webpages. 



 \item \emph{bb-csvinfo.cgi(1)}
 is a CGI program to present information about a host. The information
 is pulled from a CSV (Comma Separated Values) file, which is easily
 exported from any spreadsheet or database program. 

\end{enumerate}

 
 
\section{CLIENT-SIDE TOOLS}
\begin{enumerate}

 \item \emph{logfetch(1)}
 is a utility used by the Hobbit Unix client to collect information
 from logfiles on the client. It can also monitor various other
 file-related data, e.g. file metadata or directory sizes. 

 \item \emph{clientupdate(1)}
 Is used on Hobbit clients, to automatically update the client
 software with new versions. Through this tool, updates of the client
 software can happen without an administrator having to logon to the
 server. 

 \item \emph{msgcache(8)}
 This tool acts as a mini Hobbit server to the client. It stores
 client data internally, so that the \emph{hobbitfetch(8)} utility can
 pick it up later and send it to the Hobbit server. It is typically
 used on hosts that cannot contact the Hobbit server directly due to
 network- or firewall-restrictions. 

\end{enumerate}

\section{HOBBIT COMMUNICATION TOOLS}

 These tools are used for communications between the Hobbit server and
 the Hobbit clients. If there are no firewalls then they are not
 needed, but it may be necessary due to network or firewall issues to
 make use of them. 

\begin{enumerate}
\item \emph{bbproxy(8)}
 is a proxy-server that forwards Hobbit messages between clients and
 the Hobbit server. The clients must be able to talk to the proxy, and
 the proxy must be able to talk to the Hobbit server. 



\item \emph{hobbitfetch(8)}
 is used when the client is not able to make outbound connections to
 neither bbproxy nor the Hobbit server (typically, for clients located
 in a DMZ network zone). Together with the \emph{msgcache(8)} utility
 running on the client, the Hobbit server can contact the clients and
 pick up their data. 

\end{enumerate}
 
\section{OTHER TOOLS}

\begin{enumerate}

\item \emph{hobbitlaunch(8)}
 is a program scheduler for Hobbit. It acts as a master program for
 running all of the Hobbit tools on a system. On the Hobbit server, it
 controls running all of the server tasks. On a Hobbit client, it
 periodically launches the client to collect data and send them to the
 Hobbit server. 


\item  \emph{bb(1)}
 is the tool used to communicate with the Hobbit server. It is used to
 send status reports to the Hobbit server, through the custom
 Hobbit/BB protocol, or via HTTP. It can be used to query the state of
 tests on the central Hobbit server and retrieve Hobbit configuration
 files. The server-side script \emph{bbmessage.cgi(1) } used to
 receive messages sent via HTTP is also included. 


\item  \emph{bbcmd(1)}
 is a wrapper for the other Hobbit tools which sets up all of the
 environment variables used by Hobbit tools. 



\item  \emph{bbhostgrep(1)}
 is a utility for use by Hobbit extension scripts. It allows an
 extension script to easily pick out the hosts that are relevant to a
 script, so it need not parse a huge bb-hosts file with lots of
 unwanted test-specifications. 



\item  \emph{bbhostshow(1)}
 is a utility to dump the full \emph{bb-hosts(5)}
 file following any ``include'' statements. 


\item  \emph{bbdigest(1)}
 is a utility to compute message digest values for use in content checks that use digests. 


\item  \emph{bbcombotest(1)}
 is an extension script for the Hobbit server, allowing you to build
 complicated tests from simpler Hobbit test results. E.g. you can
 define a test that uses the results from testing your webserver,
 database server and router to have a single test showing the
 availability of your enterprise web application. 



\item  \emph{trimhistory(8)}
 is a tool to trim the Hobbit history logs. It will remove all log
 entries and optionally also the individual status-logs for events
 that happened before a given time. 

\end{enumerate}

\section{VERSIONS}

\begin{enumerate}

 \item \emph{Version 1} of bbgen was relased in November 2002, and optimized the
 webpage generation on Big Brother servers. 

 \item \emph{Version 2} of bbgen was released in April 2003, and added a tool for performing network tests. 

 \item \emph{Version 3} of bbgen was released in September 2004, and eliminated
 the use of several external libraries for network tests, resulting
 in a significant performance improvement. 

 \item \emph{Version 4.0 }released on March 30 2005, the project was
 de-coupled from Big Brother, and the name changed to Hobbit. This
 version was the first full implementation of the Hobbit server, but
 it still used the data collected by Big Brother clients for
 monitoring host metrics. 

 \item \emph{Version 4.1} was released in July 2005 included a simple Hobbit client for Unix. Logfile monitoring was not implemented. 


 \item \emph{Version 4.2} was released in July 2006, and includes a fully functional Hobbit client for Unix. 

\end{enumerate}
 
 
\section{COPYRIGHT}

Hobbit is Copyright(C)2002-2007,HenrikStorner$<$henrik@storner.dk$>$   
Parts of the Hobbit sources are from public-domain or other freely available
sources. These are the the Red-Black tree implementation, and the
MD5-, SHA1-, SHA2- and RIPEMD160-implementations. Details of the
license for these is in the README file included with the Hobbit
sources. All other files are released under the GNU General Public
License version 2, with the additional exemption that compiling,
linking, and/or using OpenSSL is allowed. See the file COPYING for
details. 


 

\section{SEE ALSO}

\begin{enumerate}
\item hobbitd(8) 
\item hobbitd\_channel(8) 
\item hobbitd\_history(8) 
\item hobbitd\_rrd(8)
\item hobbitd\_alert(8)
\item hobbitd\_client(8)
\item hobbitd\_hostdata(8)
\item hobbitping(1)
\item bbtest-net(1)
\item bbretest-net.sh(1)
\item bbgen(1)
\item hobbitsvc.cgi(1)
\item hobbitgraph.cgi(1)
\item hobbit-hostgraphs.cgi(1)
\item hobbit-nkview.cgi(1)
\item bb-hist.cgi(1)
\item bb-eventlog.cgi(1)
\item bb-ack.cgi(1)
\item hobbit-mailack(8)
\item hobbit-enadis.cgi(8)
\item bb-findhost.cgi(1)
\item bb-rep.cgi(1)
\item bb-replog.cgi(1)
\item bb-snapshot.cgi(1)
\item hobbit-statusreport.cgi(1)
\item bb-csvinfo.cgi(1)
\item logfetch(1)
\item clientupdate(1)
\item msgcache(8)
\item bbproxy(8)
\item hobbitfetch(8)
\item hobbitlaunch(8)
\item bb(1)
\item bbmessage.cgi(1)
\item bbcmd(1)
\item bbhostgrep(1)
\item bbhostshow(1)
\item bbdigest(1)
\item bbcombotest(1)
\item trimhistory(8)
\item bb-hosts(5)
\item hobbitlaunch.cfg(5)
\item hobbitserver.cfg(5)
\item hobbit-alerts.cfg(5)
\item hobbit-clients.cfg(5)
\item client-local.cfg(5) 
\end{enumerate}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Server Configuration files}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\newpage
\section{ hobbitserver.cfg - Hobbit environment variables }
 
\subsection{DESCRIPTION}
 Hobbit programs use multiple environment variables beside the normal set of variables. The environment definitions are stored in the ~hobbit/server/etc/hobbitserver.cfg file. Each line in this file is of the form \textbf{NAME=VALUE}
 and defines one environment variable NAME with the value VALUE. 

 
\subsection{ENVIRONMENT AREAS}
 In some cases it may be useful to have different values for an environment variable, depending on where it is used. This is possible by defining variables with an associated ``area''. Such definitions have the form \textbf{AREA/NAME=VALUE}
. 

  E.g. to define a special setup of the BBDISPLAY variable when it is used by an application in the ``management'' area, you would do this: \begin{description}
\item[]\begin{verbatim}

  BBDISP="127.0.0.1"            # Default definition
  management/BBDISP="10.1.0.5"  # Definition in the "management" area

\end{verbatim}


\end{description}



  Areas are invoked by using the ``--area'' option for all tools, or via the ENVAREA setting in the \emph{hobbitlaunch.cfg(5)}
 file. 


 
\subsection{GENERAL SETTINGS}


 \begin{description}
\item[BBSERVERHOSTNAME] The fully-qualified hostname of the server that is running Hobbit. 

 

\item[BBSERVERWWWNAME] The hostname used to access this servers' web-pages, used to construct URL's in the Hobbit webpages. Default is the BBSERVERHOSTNAME. 

 

\item[BBSERVERIP] The public IP-address of the server that is running Hobbit. 

 

\item[BBSERVEROS] A name identifying the operating system of the Hobbit server. The known names are currently ``linux'', ``freebsd'', ``solaris'', ``hpux'', ``aix'' and ``osf''. 

 

\item[FQDN] If set to TRUE, Hobbit will use fully-qualified hostnames throughout. If set to FALSE, hostnames are stripped of their domain-part before being processed. It is \textbf{highly recommended}
 that you keep this set to TRUE. Default: TRUE. 

 

\item[BBLOGSTATUS] Controls how the HTML page for a status log is generated. If set to DYNAMIC, the HTML logs are generated on-demand by the \emph{bb-hostsvc.cgi(1)}
 script. If set to STATIC, you must activate the \emph{hobbitd\_filestore(8)}
 module (through an entry in the \emph{hobbitlaunch.cfg(5)}
 file) to create and store the HTML logs whenever a status update is received. Setting ``BBLOGSTATUS=STATIC'' is \textbf{discouraged}
 since the I/O load on the Hobbit server will increase significantly. 

 

\item[PINGCOLUMN] Defines the name of the column for ``ping'' test status. The data from the ``ping'' test is used internally by Hobbit, so it must be defined here so all of the Hobbit tools know which column to watch for this data. The default setting is PINGCOLUMN=conn. 

 

\item[INFOCOLUMN] Defines the name of the column for the ``info'' pages. 

 

\item[TRENDSCOLUMN] Defines the name of the column for the RRD graph pages. 

 

\item[RRDHEIGHT] The default height (in pixels) of the RRD graph images. Default: 120 pixels. 

 

\item[RRDWIDTH] The default width (in pixels) of the RRD graph images. Default: 576 pixels. 

 

\item[TRENDSECONDS] The graphs on the ``trends'' page show data for the past TRENDSECONDS seconds. Default: 172800 seconds, i.e. 48 hours. 

 

\item[HTMLCONTENTTYPE] The Content-type reported by the CGI scripts that generate web pages. By default, this it ``text/html''. If you have on-line help texts in character sets other than the ISO-8859-1 (western european) character set, it may be necessary to modify this to include a character set. E.g.  
 
HTMLCONTENTTYPE=''text/html;charset=euc-jp''  
 for a Japanese character sets. Note: Some webservers will automatically add this, if configured to do so. 

 

\item[HOLIDAYS] Defines the default set of holidays used if there is no ``holidays'' tag for a host in the bb-hosts file. Holiday sets are defined in the \emph{hobbit-holidays.cfg(5)}
 file. If not defined, only the default holidays (those defined outside a named holiday set) will be considered as holidays. 

 

\item[WEEKSTART] Defines which day is the first day of the week. Set to ``0'' for Sunday, ``1'' for Monday. Default: 1 (Monday). 

 


 


\end{description}

\subsection{DIRECTORIES}


 \begin{description}
\item[BBSERVERROOT] The top-level directory for the Hobbit installation. The default is the home-directory for the user running Hobbit. 

 

\item[BBSERVERLOGS] The directory for the Hobbit's own logfiles (NOT the status-logs from the monitored hosts). 

 

\item[BBHOME] The Hobbit server directory, where programs and configurations are kept. Default: \$BBSERVERROOT/server/ . 

 

\item[BBTMP] Directory used for temporary files. Default: \$BBHOME/tmp/ 

 

\item[BBWWW] Directory for Hobbit webfiles. The \$BBWEB URL must map to this directory. Default: \$BBHOME/www/ 

 

\item[BBNOTES] Directory for Hobbit notes-files. The \$BBNOTESSKIN URL must map to this directory. Default: \$BBHOME/www/notes/ 

 

\item[BBREP] Directory for Hobbit availability reports. The \$BBREPURL URL must map to this directory. Note also that your webserver must have write-access to this directory, if you want to use the \emph{bb-rep.cgi(1)}
 CGI script to generate reports on-demand. Default: \$BBHOME/www/rep/ 

 

\item[BBSNAP] Directory for Hobbit snapshots. The \$BBSNAPURL URL must map to this directory. Note also that your webserver must have write-access to this directory, if you want to use the \emph{bb-snapshot.cgi(1)}
 CGI script to generate snapshots on-demand. Default: \$BBHOME/www/snap/ 

 

\item[BBVAR] Directory for all data stored about the monitored items. Default: \$BBSERVERROOT/data/ 

 

\item[BBLOGS] Directory for storing the raw status-logs. Not used unless ``hobbitd\_filestore --status'' is running, which is \textbf{discouraged}
 since it increases the load on the Hobbit server significantly. Default: \$BBVAR/logs/ 

 

\item[BBHTML] Directory for storing HTML status-logs. Not used unless ``hobbitd\_filestore --status --html'' is running, which is \textbf{discouraged}
 since it increases the load on the Hobbit server significantly. Default: \$BBHOME/www/html/ 

 

\item[BBHIST] Directory for storing the history of monitored items. Default: \$BBVAR/hist/ 

 

\item[BBHISTLOGS] Directory for storing the detailed status-log of historical events. Default: \$BBVAR/histlogs/ 

 

\item[BBACKS] Directory for storing information about alerts that have been acknowledged. Default: \$BBVAR/acks/ 

 

\item[BBDISABLED] Directory for storing information about tests that have been disabled. Default: \$BBVAR/disabled/ 

 

\item[BBDATA] Directory for storing incoming ``data'' messages. Default: \$BBVAR/data/ 

 

\item[BBRRDS] Top-level directory for storing RRD files (the databases with trend-information used to generate graphs). Default: \$BBVAR/rrd/ 

 

\item[CLIENTLOGS] Directory for storing the data sent by a Hobbit client around the time a status changes to a warning (yellow) or critical (red) state. Used by the \emph{hobbitd\_hostdata(8)}
 module. Default: \$BBVAR/hostdata/ 

 


 


\end{description}

\subsection{SYSTEM FILES}


 \begin{description}
\item[BBHOSTS] Full path to the Hobbit \emph{bb-hosts(5)}
 configuration file. Default: \$BBHOME/etc/bb-hosts. 

 

\item[BB] Full path to the \emph{bb(1)}
 client program. Default: \$BBHOME/bin/bb. 

 

\item[BBGEN] Full path to the \emph{bbgen(1)}
 webpage generator program. Default: \$BBHOME/bin/bbgen. 

 


 


\end{description}

\subsection{URLS}
\begin{description}
\item[BBSERVERWWWURL] The root URL for the Hobbit webpages, without the hostname. This URL must be mapped to the ~/server/www/ directory in your webserver configuration. See the sample Apache configuration in ~/server/etc/hobbit-apache.conf. 

 

\item[BBSERVERCGIURL] The root URL for the Hobbit CGI-scripts, without the hostname. This directory must be mapped to the ~/cgi-bin/ directory in your webserver configuration, and must be flagged as holding executable scripts. See the sample Apache configuration in ~/server/etc/hobbit-apache.conf. 

 

\item[BBWEBHOST] Initial part of the Hobbit URL, including just the protocol and the hostname, e.g. ``\url{http://www.foo.com}`` 

 

\item[BBWEBHOSTURL] Prefix for all of the static Hobbit webpages, e.g. ``\url{http://www.foo.com/hobbit}`` 

 

\item[BBWEBHTMLLOGS] URL prefix for the static HTML status-logs generated when BBLOGSTATUS=STATIC. Note that this setting is \textbf{discouraged}
 so this setting should not be used. 

 

\item[BBWEB] URL prefix (without hostname) of the Hobbit webpages. E.g. ``/hobbit''. 

 

\item[BBSKIN] URL prefix (without hostname) of the Hobbit graphics. E.g. ``/hobbit/gifs''. 

 

\item[BBHELPSKIN] URL prefix (without hostname) of the Hobbit on-line help files. E.g ``/hobbit/help''. 

 

\item[BBMENUSKIN] URL prefix (without hostname) of the Hobbit menu files. E.g ``/hobbit/menu''. 

 

\item[BBNOTESSKIN] URL prefix (without hostname) of the Hobbit on-line notes files. E.g ``/hobbit/notes''. 

 

\item[BBREPURL] URL prefix (without hostname) of the Hobbit availability reports. E.g. ``/hobbit/rep''. 

 

\item[BBSNAPURL] URL prefix (without hostname) of the Hobbit snapshots. E.g. ``/hobbit/snap''. 

 

\item[BBWAP] URL prefix (without hostname) of the Hobbit WAP/WML files. E.g. ``/hobbit/wml''. 

 

\item[CGIBINURL] URL prefix (without hostname) of the Hobbit CGI-scripts. Default: \$BBSERVERCGIURL . 

 

\item[COLUMNDOCURL] Format string used to build a link to the documentation for a column heading. Default: ``\$CGIBINURL/hobbitcolumn.sh?\%s'', which causes links to use the \emph{hobbitcolumn.sh(1)}
 script to document a column. 

 


 


\end{description}
\subsection{SETTINGS FOR SENDING MESSAGES TO HOBBIT}
\begin{description}
\item[BBDISP] The IP-address used to contact the \emph{hobbitd(8)}
 service. Used by clients and the tools that perform network tests. Default: \$BBSERVERIP 

 

\item[BBDISPLAYS] List of IP-adresses. Clients and network test tools will try to send status reports to a Hobbit server running on each of these adresses. This setting is only used if BBDISP=0.0.0.0. 

 

\item[PAGELEVELS] Compatibility setting for Big Brother: List of colors that are considered ``critical'' and therefore will trigger an alert. Not used by Hobbit. 

 

\item[BBPAGE] Compatibility setting for Big Brother: This is the IP-address of the server where a BBPAGER service is running. It is not used by Hobbit. 

 

\item[BBPAGERS] Compatibility setting for Big Brother: List of servers running the BBPAGER service, used if BBPAGE=0.0.0.0. It is not used by Hobbit. 

 

\item[BBPORT] The portnumber for used to contact the \emph{hobbitd(8)}
 service. Used by clients and the tools that perform network tests. Default: 1984. 

 

\item[DOCOMBO] Compatibility setting for Big Brother. Controls whether so send combo-messages or not. Ignored by Hobbit. 

 

\item[BBMAXMSGSPERCOMBO] The maximum number of status messages to combine into one combo message. You may need to lower this number of your BBDISPLAY server has trouble keeping up with the incoming status messages from bbtest-net. Default: 100. 

 

\item[BBSLEEPBETWEENMSGS] Length of a pause introduced between each successive transmission of a combo-message by bbtest-net. You may have to increase this value to give your BBDISPLAY server time to process one combo message before the next one arrives. This number defines how many microseconds to wait between the messages. Default: 0 (send messages as quickly as possible). 

 


 


\end{description}
\subsection{HOBBITD SETTINGS}


 \begin{description}
\item[ALERTCOLORS] Comma-separated list of the colors that may trigger an alert-message. The default is ``red,yellow,purple''. Note that alerts may further be generated or suppresed based on the configuration in the \emph{hobbit-alerts.cfg(5)}
 file. 

 

\item[OKCOLORS] Comma-separated list of the colors that may trigger a recovery-message. The default is ``green,clear,blue''. 

 

\item[ALERTREPEAT] How often alerts get repeated while a status is in an alert state. This is the default setting, which may be changed in the \emph{hobbit-alerts.cfg(5)}
 file. 

 

\item[BBGHOSTS] Controls how status messages from unknown hosts (i.e. hosts not listed in the bb-hosts file) are handled. 

 \textbf{BBGHOSTS=1:}
 Causes the status report to be silently discarded. This is the default behaviour in Hobbit. 


 \textbf{BBGHOSTS=2:}
 Discards the status report, but keep track of the hostname and report it on the hobbitd status page. 


  When BBGHOSTS is set to 1 or 2, the hostnames in incoming status-messages is matched without any case-sensitivity, unlike normal Big Brother which is case-sensitive in hostnames. So with BBGHOSTS set to 1 or 2, ``WWW.FOO.COM'' and ``www.foo.com`` are considered to be the same host. If necessary, the incoming hostname will be changed to match the way it is written in the bb-hosts file, changing case as needed. 


 

\item[MAXMSG\_STATUS] The maximum size of a ``status'' message in kB, default: 256. Status messages are the ones that end up as columns on the web display. The default size should be adequate in most cases, but some extension scripts can generate very large status messages - close to 1024 kB. You should only change this if you see messages in the hobbitd log file about status messages being truncated. 

 

\item[MAXMSG\_CLIENT] The maximum size of a ``client'' message in kB, default: 512. ``client'' messages are generated by the Hobbit client, and often include large process-listings. You should only change this if you see messages in the hobbitd log file about client messages being truncated. 

 

\item[MAXMSG\_DATA] The maximum size of a ``data'' message in kB, default: 256. ``data'' messages are typically used for client reports of e.g. netstat or vmstat data. You should only change this setting if you see messages in the hobbitd log file about data messages being truncated. 

 

\item[MAXMSG\_NOTES] The maximum size of a ``notes'' message in kB, default: 256. ``notes'' messages provide a way for uploading documentation about a host to Hobbit; it is not enabled by default. If you want to upload large documents, you may need to change this setting. 

 

\item[MAXMSG\_STACHG] The maximum size of a ``status change'' message in kB, default: Current value of the MAXMSG\_STATUS setting. Status-change messages occur when a status changes color. There is no reason to change this setting. 

 

\item[MAXMSG\_PAGE] The maximum size of a ``page'' message in kB, default: Current value of the MAXMSG\_STATUS setting. ``page'' messages are alerts, and include the status message that triggers the alert. There is no reason to change this setting. 

 

\item[MAXMSG\_ENADIS] The maximum size of an ``enadis'' message in kB, default: 32. ``enadis'' are small messages used when enabling or disabling hosts and tests, so the default size should be adequate. 

 

\item[MAXMSG\_CLICHG] The maximum size of a ``client change'' message in kB, default: Current value of the MAXMSG\_CLIENT setting. Client-change messages occur when a status changes color to one of the alert-colors, usually red, yellow and purple. There is no reason to change this setting. 

 


 


\end{description}

\subsection{HOBBITD\_HISTORY SETTINGS}


 \begin{description}
\item[BBALLHISTLOG] If set to TRUE, \emph{hobbitd\_history(8)}
 will update the \$BBHIST/allevents file logging all changes to a status. The allevents file is used by the \emph{bb-eventlog.cgi(1)}
 tool to show the list of recent events on the BB2 webpage. 

 

\item[BBHOSTHISTLOG] If set to TRUE, \emph{hobbitd\_history(8)}
 will update the host-specific eventlog that keeps record of all status changes for a host. This logfile is not used by any Hobbit tool. 

 

\item[SAVESTATUSLOG] If set to TRUE, \emph{hobbitd\_history(8)}
 will save historical detailed status-logs to the \$BBHISTLOGS directory. 

 


 


\end{description}

\subsection{HOBBITD\_ALERT SETTINGS}


 \begin{description}
\item[MAIL] Command used to send alerts via e-mail, including a ``Subject:'' header in the mail. Default: ``mail -s'' 

 

\item[MAILC] Command used to send alerts via e-mail in a form that does not have a ``Subject'' in the mail. Default: ``mail'' 

 

\item[SVCCODES] Maps status-columns to numeric service-codes. The numeric codes are used when sending an alert using a script, where the numeric code of the service is provided in the BBSVCNUM variable. 

 


 


\end{description}

\subsection{HOBBITD\_RRD SETTINGS}


 \begin{description}
\item[TEST2RRD] List of ``COLUMNNAME[=RRDSERVICE]'' settings, that define which status- and data-messages have a corresponding RRD graph. You will normally not need to modify this, unless you have added a custom TCP-based test to the bb-services file, and want to collect data about the response-time, OR if you are using the \emph{hobbitd\_rrd(8)}
 external script mechanism to collect data from custom tests. Note: All TCP tests are automatically added. 

  This is also used by the \emph{bb-hostsvc.cgi(1) }
 script to determine if the detailed status view of a test should include a graph. 


 

\item[GRAPHS] List of the RRD databases, that should be shown as a graph on the ``trends'' column. 

 

\item[NORRDDISKS] This is used to disable the tracking of certain filesystems. By default all filesystems reported by a client are tracked. In some cases you may want to disable this for certain filesystems, e.g. database filesystems since they are always completely full. This setting is a regular expression that is matched against the filesystem name (the Unix mount-point, or the Windows disk-letter) - if the filesystem name matches this expression, then it will not be tracked by Hobbit.  
 Note: Setting this does not affect filesystems that are already being tracked by Hobbit - to remove them, you must remove the RRD files for the unwanted filesystems from the ~hobbit/data/rrd/HOSTNAME/ directory. 

 

\item[RRDDISKS] This is used to enable tracking of only selected filesystems (see the NORRDDISKS setting above). By default all filesystems are being tracked, setting this changes that default so that only those filesystems that match this pattern will be tracked. 

 


 


\end{description}

\subsection{BBTEST-NET NETWORK TEST SETTINGS}


 \begin{description}
\item[BBLOCATION] If this variable is defined, then only the hosts that have been tagged with ``NET:\$BBLOCATION'' will be tested by the bbtest-net tool. 

 

\item[CONNTEST] If set to TRUE, the connectivity (ping) test will be performed. 

 

\item[IPTEST\_2\_CLEAR\_ON\_FAILED\_CONN] If set to TRUE, then failing network tests go CLEAR if the conn-test fails. 

 

\item[NONETPAGE] List of network services (separated with $<$space$>$) that should go yellow upon failure instead of red. 

 

\item[BBROUTERTEXT] When using the ``router'' or ``depends'' tags for a host, a failure status will include text that an ``Intermediate router is down''. With todays network topologies, the router could be a switch or another network device; if you define this environment variable the word ``router'' will be replaced with whatever you put into the variable. So to inform the users that an intermediate switch or router is down, use BBROUTERTEXT=''switch or router''. This can also be set on a per-host basis using the ``DESCR:hosttype:description'' tag in the \emph{bb-hosts(5)}
 file. 

 

\item[NETFAILTEXT] When a network test fails, the status message reports ``SERVICENAME not OK''. The ``not OK'' message can be changed via this variable, e.g. you can change it to ``FAILED'' or customize it as you like. 

 

\item[FPING] The command used to run the \emph{hobbitping(1)}
 tool for the connectivity test. (The name FPING is due to the fact that the ``fping'' utility was used until Hobbit version 4.2). This may include suid-root wrappers and hobbitping options. Default: ``hobbitping'' 

 

\item[TRACEROUTE] Defines the location of the ``traceroute'' tool and any options needed to run it. traceroute it used by the connectivity test when the ping test fails; if requested via the ``trace'' tag, the TRACEROUTE command is executed to try to determine the point in the network that is causing the problem. By default the command executed is ``traceroute -n -q 2 -w 2 -m 15'' (no DNS lookup, max. 2 probes, wait 2 seconds per hop, max 15 hops). 

  If you have the \emph{mtr(8)}
 tool installed - available from \url{http://www.bitwizard.nl/mtr/} - I strongly recommend using this instead. The recommended setting for mtr is ``/usr/sbin/mtr -c 2 -n --report'' (the exact path to the mtr utility may be different on your system). Note that mtr needs to be installed suid-root on most systems. 


 

\item[NTPDATE] Defines the \emph{ntpdate(1)}
 program used for the ``ntp'' test. Default: ``ntpdate'' 

 

\item[RPCINFO] Defines the \emph{rpcinfo(8)}
 program used for ``rpc'' tests. Default: ``rpcinfo'' 

 


 


\end{description}

\subsection{BBGEN WEBPAGE GENERATOR SETTINGS}


 \begin{description}
\item[HOBBITLOGO] HTML code that is inserted on all standard headers. The default is to add the text ``Hobbit'' in the upper-left corner of the page, but you can easily replace this with e.g. a company logo. If you do, I suggest that you keep it at about 30-35 pixels high, and 100-150 pixels wide. 

 

\item[MKBBLOCAL] The string ``Pages hosted locally'' that appears above all of the pages linked from the main Hobbit webpage. 

 

\item[MKBBSUBLOCAL] The string ``Subpages hosted locally'' that appears above all of the sub-pages linked from pages below the main Hobbit webpage. 

 

\item[MKBBREMOTE] The string ``Remote status display'' that appears about the summary statuses displayed on the min Hobbit webpage. 

 

\item[MKBBTITLE] HTML tags designed to go in a $<$FONT$>$ tag, to choose the font for titles of the webpages. 

 

\item[MKBBROWFONT] HTML tags designed to go in a $<$FONT$>$ tag, to choose the font for row headings (hostnames) on the webpages. 

 

\item[MKBBCOLFONT] HTML tags designed to go in a $<$FONT$>$ tag, to chose the font for column headings (test names) on the webpages. 

 

\item[MKBBACKFONT] HTML tags designed to go in a $<$FONT$>$ tag, to chose the font for the acknowledgement text displayed on the status-log HTML page for an acknowledged status. 

 

\item[ACKUNTILMSG] When displaying the detailed status of an acknowledged test, Hobbit will include the time that the acknowledge expires using the print-format defined in this setting. You can define the timeformat using the controls in your systems \emph{strftime(3)}
 routine, and add the text suitable for your setup. 

 

\item[BBDATEFORMAT] On webpages generated by bbgen, the default header includes the current date and time. Normally this looks like ``Tue Aug 24 21:59:47 2004''. The BBDATEFORMAT controls the format of this timestamp - you can define the format using the controls in the \emph{strftime(3)}
 routine. E.g. to have it show up as ``2004-08-24 21:59:47 +0200'' you would set BBDATEFORMAT=''\%Y-\%m-\%d \%H:\%M:\%S \%z'' 

 

\item[HOLIDAYFORMAT] How holiday dates are displayed. The default is ``\%d/\%m'' which show the day and month. American users may want to change this to ``\%m/\%d'' to suit their preferred date-display style. This is a formatting string for the system \emph{strftime(3)}
 routine, so any controls available for this routine may be used. 

 

\item[MKBB2COLREPEAT] Inspired by Jeff Stoner's col\_repeat\_patch.tgz patch, this defines the maximum number of rows before repeating the column headings on a webpage. This sets the default value for the \emph{bbgen(1)}
 ``--maxrows'' option; if the command-line option is also specifed, then it overrides this environment variable. Note that unlike Jeff's patch, bbgen implements this for both the bb2.html page and all other pages (bb.html, subpages, bbnk.html). 

 

\item[SUMMARY\_SET\_BKG] If set to TRUE, then summaries will affect the color of the main Hobbit webpage. Default: FALSE. 

 

\item[DOTHEIGHT] The height (in pixels) of the icons showing the color of a status. Default: 16, which matches the default icons. 

 

\item[DOTWIDTH] The width (in pixels) of the icons showing the color of a status. Default: 16, which matches the default icons. 

 

\item[CLIENTSVCS] List of the status logs fed by data from the Hobbit client. These status logs will - if there are Hobbit client data available for the host - include a link to the raw data sent by the client. Default: cpu,disk,memory,procs,svcs. 

 

\item[BBRSSTITLE] If defined, this is the title of the RSS/RDF documents generated when \emph{bbgen(1)}
 is invoked with the ``--rss'' option. The default value is ``Hobbit Alerts''. 

 

\item[WMLMAXCHARS] Maximum size of a WAP/WML output ``card'' when generating these. Default: 1500. 

 

\item[BBMKBB2EXT] List of scripts to run as extensions to the BB2 page. Note that two scripts, ``eventlog.sh'' and ``acklog.sh'' are handled specially: They are handled internally by bbgen, but the script names must be listed in this variable for this function to be enabled. 

 

\item[BBHISTEXT] List of scripts to run as extensions to a history page. 

 

\item[BBREPWARN] Default threshold for listing the availability as ``critical'' (red) when generating the availability report. This can be set on a per-host basis with the WARNPCT setting in \emph{bb-hosts(5).}
 Default: 97 (percent) 

 

\item[BBGENREPOPTS] Default bbgen options used for reports. This will typically include such options as ``--subpagecolumns'', and also ``--ignorecolumns'' if you wish to exclude certain tests from reports by default. 

 

\item[BBGENSNAPOPTS] Default bbgen options used by snapshots. This should be identical to the options you normally used when building Hobbit webpages. 

 


\end{description}

\subsection{FILES}
\textbf{~hobbit/server/etc/hobbitserver.cfg}


 
\subsection{SEE ALSO}
hobbit(7) 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{bb-hosts - Main Hobbit configuration file}
 
\subsection{SYNOPSIS}
\begin{description}
\item[bb-hosts]


\end{description}
\subsection{DESCRIPTION}
 The \emph{bb-hosts(5)}
 file is the most important configuration file for all of the Hobbit
 programs. This file contains the full list of all the systems
 monitored by Hobbit, including the set of tests and other
 configuration items stored for each host. 
 
\subsection{FILE FORMAT}
 Each line of the file defines a host. Blank lines and lines starting
 with a hash mark (\#) are treated as comments and ignored. Long lines
 can be broken up by putting a backslash at the end of the line and
 continuing the entry on the next line. 


  The format of an entry in the bb-hosts file is as follows:  
 
IP-addresshostname\#tag1tag2... 


  The IP-address and hostname are mandatory; all of the tags are
  optional. Listing a host with only IP-address and hostname will
  cause a network test to be executed for the host - the connectivity
  test is enabled by default, but no other tests. 



  The optional tags are then used to define which tests are relevant
  for the host, and also to set e.g. the time-interval used for
  availability reporting by \emph{bbgen(1)}




  An example of setting up the bb-hosts file is in the Hobbit on-line
  documentation (from the Help menu, choose ``Configuring
  Monitoring''). The following describes the possible settings in a
  bb-hosts file supported by Hobbit. 



 


 
\subsection{TAGS RECOGNIZED BY ALL TOOLS}


 \begin{description}
\item[include filename] This tag is used to include another file into
  the bb-hosts file at run-time, allowing for a large bb-hosts file to
  be split up into more manageable pieces. 


  The ``filename'' argument should point to a file that uses the same
  syntax as bb-hosts. The filename can be an absolute filename (if it
  begins with a '/'), or a relative filename - relative filenames are
  prefixed with the directory where the main bb-hosts file is located
  (usually \$BBHOME/etc/). 



  You can nest include tags, i.e. a file that is included from the
  main bb-hosts file can itself include other files. 



 

\item[dispinclude filename] Acts like the ``include'' tag, but only on
  the BBDISPLAY server. Can be used e.g. to put a group of hosts on
  multiple subpages, without having to repeat the host definitions. 


 

\item[netinclude filename] Acts like the ``include'' tag, but only on the BBNET server. 

 


 


\end{description}

\subsection{GENERAL PER-HOST OPTIONS }
\begin{description}
\item[noclear] Controls whether stale status messages go purple or
  clear when a host is down. Normally, when a host is down the client
  statuses (``cpu'', ``disk'', ``memory'' etc) will stop updating -
  this would usually make them go ``purple'' which can trigger
  alerts. To avoid that, Hobbit checks if the ``conn'' test has
  failed, and if that is true then the other tests will go ``clear''
  instead of purple so you only get alerts for the ``conn'' test. If
  you do want the stale statuses to go purple, you can use the
  ``noclear'' tag to override this behaviour. 


  Note that ``noclear'' also affects the behaviour of network tests; see below. 


 

\item[prefer] When a single host is defined multiple time in the
  bb-hosts file, bbgen tries to guess which definition is the best to
  use for the information used on the ``info'' column, or for the
  NOPROPRED and other bbgen-specific settings. Host definitions that
  have a ``noconn'' tag or an IP of 0.0.0.0 get lower priority. 


  By using the ``prefer'' tag you tell bbgen that this host definition should be used. 


  Note: This only applies to hosts that are defined multiple times in
  the bb-hosts file, although it will not hurt to add it on other
  hosts as well. 



 
\end{description}
\subsection{BBGEN DISPLAY OPTIONS}
 These tags are processed by the \emph{bbgen(1)}
 tool when generating the Hobbit webpages or reports. 

 \begin{description}
\item[page NAME [Page-title]] This defines a page at the level below
  the entry page. All hosts following the ``page'' directive appear on
  this page, until a new ``page'', ``subpage'' or ``subparent'' line
  is found. 


 

\item[subpage NAME [Page-title]] This defines a subpage in the second
  level below the entry page. You must have a previous ``page'' line
  to hook this subpage to. 


 

\item[subparent parentpage newpage [Page-title]] This is used to
  define subpages in whatever levels you may wish. Just like the
  standard ``subpage'' tag, ``subparent'' defines a new Hobbit
  webpage; however with ``subparent'' you explicitly list which page
  it should go as a subpage to. You can pick any page as the parent -
  pages, subpages or even other subparent pages. So this allows you to
  define any tree structure of pages that you like. 


  E.g. with this in bb-hosts: 


  
pageUSAUnitedStates  
subpageNYNewYork  
subparentNYmanhattanManhattandatacenters  
subparentmanhattanwallstreetWallStreetcenter 


  you get this hierarchy of pages: 


  
USA(UnitedStates)  
NY(NewYork)  
manhattan(Manhattandatacenters)  
wallstreet(WallStreetcenter) 


  Note: The parent page must be defined before you define the
  subparent. If not, the page will not be generated, and you get a
  message in the log file. 



  Note: bbgen is case-sensitive, when trying to match the name of the parent page. 


  The inspiration for this came from Craig Cook's mkbb.pl script, and
  I am grateful to Craig for suggesting that I implement it in
  bbgen. The idea to explicitly list the parent page in the
  ``subparent'' tag was what made it easy to implement. 



 

\item[group [group-title]]
\item[group-compress [group-title]] Defines a group of hosts, that
  appear together on the webpage, with a single header-line listing
  all of the columns. Hosts following the ``group'' line appear inside
  the group, until a new ``group'' or page-line is found. The two
  group-directives are handled identically by Hobbit and bbgen, but
  both forms are allowed for backwards compatibility. 


 

\item[group-sorted [group-title]] Same as the ``group'' line, but will
  sort the hosts inside the group so they appear in strict
  lexicographic order. 


 

\item[group-only COLUMN1|COLUMN2|COLUMN3 [group-title]] Same as the
  ``group'' and ``group-compress'' lines, but includes only the
  columns explicitly listed in the group. Any columns not listed will
  be ignored for these hosts. 


 

\item[group-except COLUMN1|COLUMN2|COLUMN3 [group-title]] Same as the
  ``group-only'' lines, but includes all columns EXCEPT those
  explicitly listed in the group. Any columns listed will be ignored
  for these hosts - all other columns are shown. 


 

\item[title Page, group or host title text] The ``title'' tag is used
  to put custom headings into the pages generated by bbgen, in front
  of page/subpage links, groups or hosts. 


  The title tag operates on the next item in the bb-hosts file following the title tag. 


  If a title tag precedes a host entry, the title is shown just before
  the host is listed on the status page. The column headings present
  for the host will be repeated just after the heading. 



  If a title tag precedes a group entry, the title is show just before the group on the status page. 


  If a title tag precedes a page/subpage/subparent entry, the title
  text replaces the normal ``Pages hosted locally'' heading normally
  inserted by Hobbit. This appears on the page that links to the
  subpages, not on the subpage itself. To get a custom heading on the
  subpage, you may want to use the ``--pagetext-heading'' when running
  \emph{bbgen(1)}




 

\item[NAME:hostname] Overrides the default hostname used on the
  overview web pages. If ``hostname'' contains spaces, it must be
  enclosed in double quotes, e.g. NAME:''R\&D Oracle Server'' 


 

\item[CLIENT:hostname] Defines an alias for a host, which will be used
  when identifying status messages. This is typically used to
  accomodate a local client that sends in status reports with a
  different hostname, e.g. if you use hostnames with domains in your
  Hobbit configuration, but the client is a silly Window box that does
  not include the hostname. Or vice versa. Whatever the reason, this
  can be used to match status reports with the hosts you define in
  your bb-hosts file. It causes incoming status reports with the
  specified hostname to be filed using the hostname defined in
  bb-hosts. 


 

\item[NOCOLUMNS:column[,column]] Used to drop certain of the status columns generated by the Hobbit client. \textbf{column}
 is one of \textbf{cpu}
, \textbf{disk}
, \textbf{files}
, \textbf{memory}
, \textbf{msgs}
, \textbf{ports}
, \textbf{procs}
. This setting stops these columns from being updated for the host. Note: If the columns already exist, you must use the \emph{bb(1)}
 utility to \textbf{drop}
 them, or they will go purple. 

 

\item[COMMENT:Host comment] Adds a small text after the hostname on
  the webpage. This can be used to describe the host, without
  completely changing its display-name as the NAME: tag does. If the
  comment includes whitespace, it must be in double-quotes,
  e.g. COMMENT:''Sun webserver'' 


 

\item[DESCR:Hosttype:Description] Define some informational text about
  the host. The ``Hosttype'' is a text describing the type of this
  device - ``router'', ``switch'', ``hub'', ``server'' etc. The
  ``Description'' is an informational text that will be shown on the
  ``Info'' column page; this can e.g. be used to store information
  about the physical location of the device, contact persons etc. If
  the text contain whitespace, you must enclose it in double-quotes,
  e.g. DESCR:''switch:4th floor Marketing switch'' 


 

\item[CLASS:Classname] Force the host to belong to a specific
  class. Class-names are used when configuring log-file monitoring
  (they can be used as references in \emph{client-local.cfg(5)} and
  \emph{hobbit-clients.cfg(5)} to group logfile checks). Normally,
  class-names are controlled on the client by starting the Hobbit
  client with the ``--class=Classname'' option. If you specify it in
  the bb-hosts file on the Hobbit server, it overrides any classname
  that the client reports. 


 

\item[dialup] The keyword ``dialup'' for a host means that it is OK
  for it to be off-line - this should not trigger an alert. All
  network tests will go ``clear'' upon failure, and any missing
  reports from e.g. cpu- and disk-status will not go purple when they
  are not updated. 


 

\item[nobb2] Ignore this host on the BB2 page. Even if it has an
  active alert, it will not be included in the BB2 page. This also
  removes the host from the event-log display. 


 

\item[nodisp] Ignore this host completely when generating the Hobbit
  webpages. Can be useful for monitoring a host without having it show
  up on the webpages, e.g. because it is not yet in production use. Or
  for hiding a host that is shown only on a second pageset. 


 

\item[TRENDS:[*,][![graph,...]]] Defines the RRD graphs to include in the ``trends'' column generated by bbgen. This option syntax is complex.  
 If this option is not present, bbgen provides graphs matching the
 standard set of RRD files: la, disk, memory, users, vmstat, iostat,
 netstat, tcp, bind, apache, sendmail  

 * If this option is specified, the list of graphs to include start out as being empty (no graphs).  
 * To include all default graphs, use an asterisk. E.g. ``TRENDS:*''  
 * To exclude a certain graph, speficy it prefixed with '!'. E.g. to see all graphs except users: ``TRENDS:*,!users''  
 * The netstat, vmstat and tcp graphs have many ``subgraphs''. Which
 * of these are shown can be speficied like this:
 * ``TRENDS:*,netstat:netstat2|netstat3,tcp:http|smtp|conn'' This will
 * show all graphs, but instead of the normal netstat graph, there
 * will be two: The netstat2 and netstat3 graphs. Instead of the
 * combined tcp graphs showing all services, there will be three: One
 * for each of the http, conn and smtp services. 


 

\item[DOWNTIME=[columns:]day:starttime:endtime:cause[,day:starttime:endtime:cause]]
  This tag can be used to ignore failed checks during specific times
  of the day - e.g. if you run services that are only monitored
  e.g. Mon-Fri 8am-5pm, or you always reboot a server every Monday
  between 5 and 6 pm. 


  The timespecification consists of 


 \textbf{day:}
 \textbf{W}
 means Mon-Fri (``weekdays''), \textbf{*}
 means all days, \textbf{0}
 .. \textbf{6}
 = Sunday .. Saturday. Listing multiple days is possible, e.g. ``60'' is valid meaning ``Saturday and Sunday''. 


 \textbf{starttime:}
 Time to start showing errors, must be in 24-hour clock format as HHMM
 hours/minutes. E.g. for 8 am enter ``0800'', for 9.30 pm enter
 ``2130'' 



 \textbf{endtime:}
 Time to stop showing errors. 


  If necessary, multiple periods can be specified. E.g. to monitor a site 24x7, except between noon and 1 pm, use DOWNTIME=*:0000:1159,*:1300:2359 


  The interval between starttime and endtime may cross midnight, e.g. \textbf{*:2330:0200}
 would be valid and have the same effect as \textbf{*:2330:2400,*:0000:0200}
. 


  What happens is that if a test fails during the specified time, it
  is reported with status BLUE instead of yellow or red. Thus you can
  still see when the service was unavailable, but alarms will not be
  triggered and the downtime is not counted in the availability
  calculations generated by the Hobbit reports. 



  The ``columns'' setting is optional - it may be a comma-separated list of status columns in which case the DOWNTIME setting only applies to these columns. 


  The ``cause'' string (optional) is a text that will be displayed on the status web page to explain thy the system is down. 


 

\item[SLA=day:starttime:endtime[,day:starttime:endtime]] This tag is now deprecated. Use the DOWNTIME tag instead. 

  This tag works the opposite of the DOWNTIME tag - you use it to
  specify the periods of the day that the service should be
  green. Failures OUTSIDE the SLA interval are reported as blue. 



 

\item[holidays=HOLIDAYSETNAME] Define which set of holidays to use for
  a host. Holiday sets are defined in the
  \emph{hobbit-holidays.cfg(5)} configuration file. If omitted, the
  set given in the HOLIDAYS setting in the \emph{hobbitserver.cfg(5)}
  file is used. 



\end{description}

\subsection{HOBBIT TAGS FOR THE CRITICAL SYSTEMS OVERVIEW PAGE}
\textbf{NOTE:}
 The ``NK'' set of tags is deprecated. They will be supported for
 Hobbit 4.x, but will be dropped in version 5. It is recommended that
 you move your critical systems view to the
 \emph{hobbit-nkview.cgi(1)} viewer, which has a separate
 configuration tool, \emph{hobbit-nkedit.cgi(1)} with more facilities
 than the NK tags in bb-hosts. 


  bbgen will create three sets of pages: The main page bb.html, the
  all-non-green-statuses page (bb2.html), and a specially reduced
  version of bb2.html with only selected tests (bbnk.html). This page
  includes selected tests that currently have a red or yellow status. 



 \begin{description}
\item[NK:testname[,testname]] Define the tests that you want included
  on the bbnk page. E.g. if you have a host where you only want to see
  the http tests on bbnk.html, you specify it as 


  
12.34.56.78www.acme.com\#\url{http://www.acme.com/}NK:http 


  If you want multiple tests for a host to show up on the bbnk.html
  page, specify all the tests separated by commas. The test names
  correspond to the column names (e.g. https tests are covered by an
  ``NK:http'' tag). 



 

\item[NKTIME=day:starttime:endtime[,day:starttime:endtime]] This tag limits the time when an active alert is presented on the NK webpage. 

  By default, tests with a red or yellow status that are listed in the
  ``NK:testname'' tag will appear on the NK page. However, you may not
  want the test to be shown outside of normal working hours - if, for
  example, the host is not being serviced during week-ends. 



  You can then use the NKTIME tag to define the time periods where the
  alert will show up on the NK page. The NKTIME syntax is identical to
  the one used for DOWNTIME specification. 


\end{description}

\subsection{HOBBIT TAGS FOR THE WML (WAP) CARDS}
 If bbgen is run with the ``--wml'' option, it will generate a set of
 WAP-format output ``cards'' that can be viewed with a WAP-capable
 device, e.g. a PDA or cell-phone. 


 \begin{description}
\item[WML:[+|-]testname[,[+|-]testname]] This tag determines which
  tests for this hosts are included in the WML (WAP) page. Syntax is
  identical to the NK: tag. 


  The default set of WML tests are taken from the --wml commandline
  option. If no ``WML:'' tag is specified, the ``NK:'' tag is used if
  present. 




\end{description}

\subsection{HOBBIT STATUS PROPAGATION OPTIONS}
 These tags affect how a status propagates upwards from a single test
 to the page and higher. This can also be done with the command-line
 options --nopropyellow and --nopropred, but the tags apply to
 individual hosts, whereas the command line options are global. 


 \begin{description}
\item[NOPROPRED:[+|-]testname[,[+|-]testname]] This tag is used to
  inhibit a yellow or red status from propagating upwards - i.e. from
  a test status color to the (sub)page status color, and further on to
  bb.html or bb2.html 


  If a host-specific tag begins with a '-' or a '+', the host-specific
  tags are removed/added to the default setting from the command-line
  option. If the host-specific tag does not begin with a '+' or a '-',
  the default setting is ignored for this host and the NOPROPRED
  applies to the tests given with this tag. 



  E.g.: bbgen runs with
  ``--nopropred=ftp,smtp''. ``NOPROPRED:+dns,-smtp'' gives a NOPROPRED
  setting of ``ftp,dns'' (dns is added to the default, ftp is
  removed). ``NOPROPRED:dns'' gives a setting of ``dns'' only (the
  default is ignored). 



  Note: If you set use the ``--nopropred=*'' commandline option to
  disable propagation of all alerts, you cannot use the ``+'' and
  ``-'' methods to add or remove from the wildcard setting. In that
  case, do not use the ``+'' or ``-'' setting, but simply list the
  required tests that you want to keep from propagating. 



 

\item[NOPROPYELLOW:[+|-]testname[,[+|-]testname]] Similar to
  NOPROPRED: tag, but applies to propagating a yellow status upwards. 


 

\item[NOPROPPURPLE:[+|-]testname[,[+|-]testname]] Similar to
  NOPROPRED: tag, but applies to propagating a purple status upwards. 


 

\item[NOPROPACK:[+|-]testname[,[+|-]testname]] Similar to NOPROPRED:
  tag, but applies to propagating an acknowledged status upwards. 


 


 


\end{description}

\subsection{HOBBIT AVAILABILITY REPORT OPTIONS}
 These options affect the way the Hobbit availability reports are processed (see \emph{bb-rep.cgi(1)}
 for details about availability reports). 

 \begin{description}
\item[REPORTTIME=day:starttime:endtime[,day:starttime:endtime]] This
  tag defines the time interval where you measure uptime of a service
  for reporting purposes. 


  When bbgen generates a report, it computes the availability of each
  service - i.e. the percentage of time that the service is reported
  as available (meaning: not red). 



  By default, this calculation is done on a 24x7 basis, so no matter
  when an outage occurs, it counts as downtime. 



  The REPORTTIME tag allows you to specify a period of time other than
  24x7 for the service availability calculation. If you have systems
  where you only guarantee availability from e.g. 7 AM to 8 PM on
  weekdays, you can use  

 
REPORTTIME=W:0700:2000  
 and the availability calculation will only be performed for the
 service with measurements from this time interval. 



  The syntax for REPORTTIME is the same as the one used by the DOWNTIME parameter. 


  When REPORTTIME is specified, the availability calculation happens like this: 


  * Only measurements done during the given time period is used for the calculation.  
 * ``blue'' time reduces the length of the report interval, so if you
 are generating a report for a 10-hour period and there are 20 minutes
 of ``blue'' time, then the availability calculation will consider the
 reporting period to be 580 minutes (10 hours minus 20 minutes). This
 allows you to have scheduled downtime during the REPORTTIME interval
 without hurting your availability; this is (I believe) the whole idea
 of the downtime being ``planned''.  

 * ``red'' and ``clear'' status counts as downtime; ``yellow'' and
   ``green'' count as uptime. ``purple'' time is ignored. 



  The availability calculation correctly handles status changes that cross into/out of a REPORTTIME interval. 


  If no REPORTTIME is given, the standard 24x7 calculation is used. 


 

\item[WARNPCT:percentage] BB's reporting facility uses a computed
  availability threshold to color services green (100\% available),
  yellow (above threshold, but less than 100\%), or red (below
  threshold) in the reports. 


  This option allows you to set the threshold value on a host-by-host
  basis, instead of using a global setting for all hosts. The
  threshold is defined as the percentage of the time that the host
  must be available, e.g. ``WARNPCT:98.5'' if you want the threshold
  to be at 98.5\% 



 

\end{description}

\subsection{NETWORK TEST SETTINGS}
\begin{description}
\item[testip] By default, Hobbit will perform a name lookup of the
  hostname to get the IP address it will use for network tests. This
  tag causes Hobbit to use the IP listed in the bb-hosts file. 


 

\item[NET:location] This tag defines the host as being tested from a
  specific location. If bbtest-net sees that the environment variable
  BBLOCATION is set, it will only test the hosts that have a matching
  ``NET:location'' tag in the bb-hosts file. So this tag is useful if
  you have more than one BBNET system, but you still want to keep a
  consolidated bb-hosts file for all your systems. 


  Note: The ``--test-untagged'' option modifies this behaviour, see \emph{bbtest-net(1)}



 

\item[noclear] Some network tests depend on others. E.g. if the host
  does not respond to ping, then there's a good chance that the entire
  host is down and all network tests will fail. Or if the http server
  is down, then any web content checks are also likely to fail. To
  avoid floods of alerts, the default behaviour is for bbtest-net to
  change the status of these tests that fail because of another
  problem to ``clear'' instead of ``red''. The ``noclear'' tag
  disables this behaviour and causes all failing tests to be reported
  with their true color. 


  This behaviour can also be implemented on a per-test basis by putting the ``~`` flag on any network test. 


  Note that ``noclear'' also affects whether stale status messages
  from e.g. a client on the host go purple or clear when the host is
  down; see the ``noclear'' description in the ``GENERAL PER-HOST
  OPTIONS'' section above. 

\item[nosslcert] Disables the standard check of any SSL certificates
  for this host. By default, if an SSL-enabled service is tested, a
  second test result is generated with information about the SSL
  certificate - this tag disables the SSL certificate checks for the
  host. 


 

\item[ssldays=WARNDAYS:ALARMDAYS] Define the number of days before an
  SSL certificate expires, in which the sslcert status shows a warning
  (yellow) or alarm (red) status. These default to the values from the
  ``--sslwarndays'' and ``--sslalarmdays'' options for the
  \emph{bbtest-net(1)} tool; the values specified in the ``ssldays''
  tag overrides the default. 


 

\item[depends=(testA:host1/test1,host2/test2),(testB:host3/test3),[...]]
  This tag allows you to define dependencies betweeen tests. If
  ``testA'' for the current host depends on ``test1'' for host
  ``host1'' and test ``test2'' for ``host2'', this can be defined with 


  
depends=(testA:host1/test1,host2/test2) 


  When deciding the color to report for testA, if either host1/test1
  failed or host2/test2 failed, if testA has failed also then the
  color of testA will be ``clear'' instead of red or yellow. 



  Since all tests are actually run before the dependencies are
  evaluated, you can use any host/test in the dependency - regardless
  of the actual sequence that the hosts are listed, or the tests
  run. It is also valid to use tests from the same host that the
  dependency is for. E.g. 



  
1.2.3.4foo\#\url{http://foo/}webmindepends=(webmin:foo/http) 


  is valid; if both the http and the webmin tests fail, then webmin will be reported as clear. 


  Note: The ``depends'' tag is evaluated on the BBNET server while
  running the network tests. It can therefore only refer to other
  network tests that are handled by the same BBNET server - there is
  currently no way to use the e.g. the status of locally run tests
  (disk, cpu, msgs) or network tests from other BBNET servers in a
  dependency definition. Such dependencies are silently ignored. 



\item[badTEST[-weekdays-starttime-endtime]:x:y:z] Normally when a
  network test fails, the status changes to red immediately. With a
  ``badTEST:x:y:z'' tag this behaviour changes:  

 * While ``z'' or more successive tests fail, the column goes RED.  
 * While ``y'' or more successive tests fail, but fewer than ``z'', the column goes YELLOW.  
 * While ``x'' or more successive tests fail, but fewer than ``y'', the column goes CLEAR.  
 * While fewer than ``x'' successive tests fail, the column stays GREEN. 

  The optional timespecification can be used to limit this ``badTEST''
  setting to a particular time of day, e.g. to require a longer period
  of downtime before raising an alarm during out-of-office hours. The
  time-specification uses:  

 * Weekdays: The weekdays this badTEST tag applies, from 0 (Sunday)
   through 6 (Saturday). Putting ``W'' here counts as ``12345'',
   i.e. all working days. Putting ``*'' here counts as all days of the
   week, equivalent to ``0123456''.  

 * starttime and endtime are specified using 24-hour clocks,
   e.g. ``badTEST-W-0900-2000'' is valid for working days between 9 AM
   (09:00) and 8 PM (20:00). 



  When using multiple badTEST tags, the LAST one specified with a matching time-spec is used. 


  Note: The ``TEST'' is replaced by the name of the test, e.g. 


  
12.34.56.78www.foo.com\#\url{http://www.foo.com/}badhttp:1:2:4 


  defines a http test that goes ``clear'' after the first failure,
  ``yellow'' after two successive failures, and ``red'' after four
  successive failures. 



  For the other network tests, use ``badftp'', ``badssh'' etc. 


 



\end{description}
\subsection{CONNECTIVITY (PING) TEST}
 These tags affect the behaviour of the bbtest-net connectivity test. 

 \begin{description}
\item[noping] Disables the ping-test, but will keep the ``conn'' column on the web display with a notice that it has been disabled. 

 

\item[noconn] Disables the ping-test, and does not put a ``conn'' column on the web display. 

 

\item[conn] The ``conn'' test (which does a ping of the host) is
  enabled for all hosts by default, and normally you just want to
  disable it using ``noconn'' or ``noping''. However, on the rare
  occasion where you may want to check that a host is NOT up, you can
  specify it as an explicit test, and use the normal test modifiers,
  e.g. ``!conn'' will be green when the host is NOT up, and red if it
  does appear on the network. 


  The actual name of the tag - ``conn'' by default - depends on the ``--ping=TESTNAME'' option for bbtest-net, as that decides the testname for the connectivity test. 


 

\item[conn=\\{best,|worst,\\}IP1[,IP2...]] This adds additional
  IP-adresses that are pinged during the normal ``conn'' test. So the
  normal ``conn'' test must be enabled (the default) before this tag
  has any effect. The IP-adresses listed here are pinged in addition
  to the main IP-address. 


  When multiple IP's are pinged, you can choose if ALL IP's must
  respond (the ``worst'' method), or AT LEAST one IP must respond (the
  ``best'' setting). All of the IP's are reported in a single ``conn''
  status, whose color is determined from the result of pinging the
  IP's and the best/worst setting. The default method is ``best'' - so
  it will report green if just one of the IP's respond to ping. 



 

\item[badconn[-weekdays-starttime-endtime]:x:y:z] This is taken
  directly from the ``fping.sh'' connectivity- testing script, and is
  used by bbtest-net when it runs with ping testing enabled (the
  default). See the description of the ``badTEST'' tag. 


 

\item[route:router1,router2,....] This tag is taken from the ``fping.sh'' script, and is used by bbtest-net when run with the ``--ping'' option to enable ping testing. 

  The router1,router2,... is a comma-separated list of hosts elsewhere in the bb-hosts file. You cannot have any spaces in the list - separate hosts with commas. 


  This tag changes the color reported for a ping check that fails,
  when one or more of the hosts in the ``route'' list is also down. A
  ``red'' status becomes ``yellow'' - other colors are unchanged. The
  status message will include information about the hosts in the
  router-list that are down, to aid tracking down which router is the
  root cause of the problem. 



  Note: Internally, the ping test will still be handled as ``failed'',
  and therefore any other tests run for this host will report a status
  of ``clear''. 



 

\item[route\_LOCATION:router1,router2,...] If the BBLOCATION
  environment variable is defined, a tag of ``route\_BBLOCATION:'' is
  recognized by bbtest-net with the same effect as the normal
  ``route:'' tag (see above). This allows you to have different route:
  tags for each BBNET server. The actual text for the tag then must
  match the value you have for the BBLOCATION setting. E.g. with
  BBLOCATION=dmz, the tag becomes ``route\_dmz:'' 


 

\item[trace] If the connectivity test fails, run a ``traceroute'' and
  include the output from this in the status message from the failed
  connectivity test. Note: For this to work, you may have to define
  the TRACEROUTE environment variable, see \emph{hobbitserver.cfg(5)}



 

\item[notrace] Similar to the ``trace'' option, this disables the
  running of a traceroute for the host after a failed connectivity
  test. It is only used if running traceroute is made the default via
  the --trace option. 


 


\end{description}

\subsection{SIMPLE NETWORK TESTS}
 These tests perform a simple network test of a service by connecting
 to the port and possibly checking that a banner is shown by the
 server. 


  How these tests operate are configured in the \emph{bb-services(5)}
  configuration file, which controls which port to use for the
  service, whether to send any data to the service, whether to check
  for a response from the service etc. 



  You can modify the behaviour of these tests on a per-test basis by
  adding one or more modifiers to the test: \textbf{:NUMBER} changes
  the port number from the default to the one you specify for this
  test. E.g. to test ssh running on port 8022, specify the test as
  \textbf{ssh:8022}. 


 \textbf{:s}
 makes the test silent, i.e. it does not send any data to the
 service. E.g. to do a silent test of an smtp server, enter
 \textbf{smtp:s}. 



  You can combine these two: \textbf{\url{ftp:8021:s}}
 is valid. 


  If you must test a service from a multi-homed host (i.e. using a
  specific source IP-address instead of the one your operating system
  provides), you can use the modifier ``@IPADDRESS'' at the end of the
  test specification, \textbf{after} any other modifiers or port
  number. ``IPADDRESS'' must be a valid dotted IP-address (not
  hostname) which is assigned to the host running the network tests. 



  The name of the test also determines the columnname that the test
  result will appear with in the Hobbit webpages. 



  By prefixing a test with ``!'' it becomes a reverse test: Hobbit
  will expect the service NOT to be available, and send a green status
  if it does NOT respond. If a connection to the service succeeds, the
  status will go red. 



  By prefixing a test with ``?'' errors will be reported with a
  ``clear'' status instead of red. This is known as a test for a
  ``dialup'' service, and allows you to run tests of hosts that are
  not always online, without getting alarms while they are off-line. 



 \begin{description}
\item[ftp ssh telnet smtp pop3 imap nntp rsync clamd oratns qmtp qmqp]
  These tags are for testing services offering the FTP, Secure Shell
  (ssh), SMTP, POP3, IMAP, NNTP, rsync, CLAM antivirus daemon (clamd),
  Oracle TNS listener (oratns), qmail QMTP and QMQP protocols. 


 

\item[ftps telnets smtps pop3s imaps nntps] These tags are for testing
  of the SSL-tunneled versions of the standard ftp, telnet, smtp,
  pop3, imap and nntp protocols. If Hobbit was configured with support
  for SSL, you can test these services like any other network service
  - bbtest-net will setup an SSL-encrypted session while testing the
  service. The server certificate is validated and information about
  it sent in the ``sslcert'' column. Note that smtps does not have a
  standard portnumber assignment, so you will need to enter this into
  the bb-services file or your /etc/services file. 


 

\item[bbd] Test that a Big Brother compatible daemon is running. This
  check works both for the Hobbit \emph{hobbitd(8)} daemon, and the
  original Big Brother bbd daemon. 


 


 


\end{description}

\subsection{DNS SERVER TESTS}
 These tags are used to setup monitoring of DNS servers. 

 \begin{description}
\item[dns] Simple DNS test. It will attempt to lookup the A record for the hostname of the DNS server. 

 

\item[dig] This is an alias for the ``dns'' test. In bbtest-net, the
  ``dns'' and ``dig'' tests are handled identically, so all of the
  facilities for testing described for the ``dns'' test are also
  available for the ``dig'' test. 


 

\item[dns=hostname]
\item[dns=TYPE:lookup[,TYPE:lookup...]] The default DNS tests will
  attempt a DNS lookup of the DNS' servers own hostname. You can
  specify the hostname to lookup on a DNS server by listing it on each
  test. 


  The second form of the test allows you to perform multiple queries
  of the DNS server, requesting different types of DNS records. The
  TYPE defines the type of DNS data: A (IP-address), MX (Mail
  eXchanger), PTR (reverse), CNAME (alias), SOA (Start-Of-Authority),
  NS (Name Server) are among the more common ones used. The ``lookup''
  is the query. E.g. to lookup the MX records for the ``foo.com''
  domain, you would use ``dns=mx:foo.com''. Or to lookup the
  nameservers for the ``bar.org'' domain, ``dns=ns:bar.org''. You can
  list multiple lookups, separated by commas. For the test to end up
  with a green status, all lookups must succeed. 



 



\end{description}

\subsection{OTHER NETWORK TESTS}
\begin{description}
\item[ntp] Check for a running NTP (Network Time Protocol) server on
  this host. This test uses the ``ntpdate'' utility to check for a NTP
  server - you should either have ntpdate in your PATH, or set the
  location of the ntpdate program in \$BBHOME/etc/bbsys.local 


 

\item[rpc[=rpcservice1,rpcservice2,...]] Check for one or more
  available RPC services. This check is indirect in that it only
  queries the RPC Portmapper on the host, not the actual service. 


  If only ``rpc'' is given, the test only verifies that the portmapper
  is available on the remote host. If you want to check that one or
  more RPC services are registered with the portmapper, list the names
  of the desired RPC services after the equals-sign. E.g. for a
  working NFS server the ``mount'', ``nlockmgr'' and ``nfs'' services
  must be available; this can be checked with
  ``rpc=mount,nlockmgr,nfs''. 



  This test uses the rpcinfo tool for the actual test; if this tool is
  not available in the PATH of bbtest-net, you must define the RPCINFO
  environment variable to point at this tool. See
  \emph{hobbitserver.cfg(5)}


\end{description}
\subsection{HTTP TESTS}
 Simple testing of a http URL is done simply by putting the URL into
 the bb-hosts file. Note that this only applies to URL's that begin
 with ``http:'' or ``https:''. 


  The following items describe more advanced forms of http URL's. 


 \begin{description}
\item[Basic Authentication with username/password] If the URL requires
  authentication in the form of a username and password, it is most
  likely using the HTTP ``Basic'' authentication. bbtest-net support
  this, and you can provide the username and password either by
  embedding them in the URL e.g.  

 
\url{http://USERNAME:PASSWORD@www.sample.com/} 
 or by putting the username and password into the ~/.netrc file (see
 \emph{ftp(1)} for details). 


 

\item[Authentication with SSL client certificates] An SSL client
  certificate can be used for authentication. To use this, the client
  certificate must be stored in a PEM-formatted file together with the
  client certificate key, in the \$BBHOME/certs/ directory. The URL is
  then given as  

 
\url{http://CERT:FILENAME@www.sample.com/} 
 The ``CERT:'' part is literal - i.e. you write C-E-R-T-colon and then
 the filename of the PEM-formatted certificate.  

 A PEM-formatted certificate file can be generated based on
 certificates stored in Microsoft Internet Explorer and OpenSSL. Do as
 follows:  

 From the MSIE Tools-Options menu, pick the Content tab, click on
 Certificates, choose the Personal tab, select the certificate and
 click Export. Make sure you export the private key also. In the
 Export File Format, choose PKCS 12 (.PFX), check the ``Include all
 certificates'' checkbox and uncheck the ``Enable strong
 protection''. Provide a temporary password for the exported file, and
 select a filename for the PFX-file.  

 Now run ``openssl pkcs12 -in file.pfx -out file.pem''. When prompted
 for the ``Import Password'', provide the temporary password you gave
 when exporting the certificate. Then provide a ``PEM pass phrase''
 (twice) when prompted for one.  

 The file.pem file is the one you should use in the FILENAME field in
 the URL - this file must be kept in \$BBHOME/certs/. The PEM pass
 phrase must be put into a file named the same as the certificate, but
 with extension ``.pass''. E.g. if you have the PEM certificate in
 \$BBHOME/certs/client.pem, you must put the pass phrase into the
 \$BBHOME/certs/client.pass file. Make sure to protect this file with
 Unix permissions, so that only the user running Hobbit can read it. 

 

\item[Forcing an HTTP or SSL version] Some SSL sites will only allow
  you to connect, if you use specific ``dialects'' of HTTP or
  SSL. Normally this is auto-negotiated, but experience shows that
  this fails on some systems. 


  bbtest-net can be told to use specific dialects, by adding one or
  more ``dialect names'' to the URL scheme, i.e. the ``http'' or
  ``https'' in the URL: 



  * ``2'', e.g. https2://www.sample.com/ : use only SSLv2  
 * ``3'', e.g. https3://www.sample.com/ : use only SSLv3  
 * ``m'', e.g. httpsm://www.sample.com/ : use only 128-bit ciphers  
 * ``h'', e.g. httpsh://www.sample.com/ : use only $>$128-bit ciphers  
 * ``10'', e.g. http10://www.sample.com/ : use HTTP 1.0  
 * ``11'', e.g. http11://www.sample.com/ : use HTTP 1.1 


  These can be combined where it makes sense, e.g to force SSLv2 and HTTP 1.0 you would use ``https210''. 


 

\item[Testing sites by IP-address] bbtest-net ignores the ``testip''
  tag normally used to force a test to use the IP-address from the
  bb-hosts file instead of the hostname, when it performs http and
  https tests. 


  The reason for this is that it interacts badly with virtual hosts,
  especially if these are IP-based as is common with https-websites. 



  Instead the IP-address to connect to can be overridden by specifying it as: 


 \url{http://www.sample.com=1.2.3.4/index.html} 



  The ``=1.2.3.4'' will case bbtest-net to run the test against the
  IP-address ``1.2.3.4'', but still trying to access a virtual website
  with the name ``www.sample.com``. 



  The ``=ip.address.of.host'' must be the last part of the hostname, so if you need to combine this with e.g. an explicit portnumber, it should be done as 


 \url{http://www.sample.com:3128=1.2.3.4/index.html} 



 

\item[HTTP Testing via proxy] bbtest-net supports the Big Brother
  syntax for specifying an HTTP proxy to use when performing http
  tests. This syntax just joins the proxy- and the target-URL into
  one, e.g.  

 
\url{http://webproxy.sample.com:3128/http://www.foo.com/} 
 would be the syntax for testing the www.foo.com website via the proxy
 running on ``webproxy.sample.com'' port 3128. 


  If the proxy portnumber is not specified, the default HTTP portnumber (80) is used. 


  If your proxy requires authentication, you can specify the username and password inside the proxy-part of the URL, e.g.  
 
\url{http://fred:Wilma1@webproxy.sample.com:3128/http://www.foo.com/}
will authenticate to the proxy using a username of ``fred'' and a
password of ``Wilma1'', before requesting the proxy to fetch the
www.foo.com homepage. 



  Note that it is not possible to test https-sites via a proxy, nor is it possible to use https for connecting to the proxy itself. 


\item[cont[=COLUMN];URL;[expected\_data\_regexp|\#digesttype:digest]]
  This tag is used to specify a http/https check, where it is also
  checked that specific content is present in the server response. 


  If the URL itself includes a semi-colon, this must be escaped as
  '\%3B' to avoid confusion over which semicolon is part of the URL,
  and which semicolon acts as a delimiter. 



  The data that must be returned can be specified either as a regular
  expression (except that $<$space$>$ is not allowed) or as a message
  digest (typically using an MD5 sum or SHA-1 hash). 



  The regex is pre-processed for backslash ``$\backslash$'' escape
  sequences. So you can really put any character in this string by
  escaping it first:  

 
$\backslash$nNewline(LF,ASCII10decimal)  
 
$\backslash$rCarriagereturn(CR,ASCII13decimal)  
 
$\backslash$tTAB(ASCII8decimal)  
 
$\backslash$$\backslash$Backslash(ASCII92decimal)  
 
$\backslash$XXThecharacterwithASCIIhex-valueXX  



  If you must have whitespace in the regex, use the [[:space:]]
  syntax, e.g. if you want to test for the string ``All is OK'', use
  ``All[[:space:]]is[[:space:]]OK''. Note that this may depend on your
  particular implementation of the regex functions found in your C
  library. Thanks to Charles Goyard for this tip. 



  Note: If you are migrating from the ``cont2.sh'' script, you must
  change the '\_' used as wildcards by cont2.sh into '.' which is the
  regular-expression wildcard character. 



  Message digests can use different algorithms: ``md5'', ``sha1'',
  ``sha256'', ``sha512'' or ``rmd160''. The digest is calculated on
  the data portion of the response from the server, i.e. HTTP headers
  are not included in the digest (as they change from one request to
  the next). Note that the md5 and sha1 hash algorithms are no longer
  considered cryptographically safe. 



  The expected digest value can be computed with the \emph{bbdigest(1)}
 utility. 


  ``cont'' tags in bb-hosts result in two status reports: One status
  with the ``http'' check, and another with the ``content'' check. 



  As with normal URL's, the extended syntax described above can be
  used e.g. when testing SSL sites that require the use of SSLv2 or
  strong ciphers. 



  The column name for the result of the content check is by default
  called ``content'' - you can change the default with the
  ``--content=NAME'' option to bbtest-net. See \emph{bbtest-net(1)}
  for a description of this option. 



  If more than one content check is present for a host, the first
  content check is reported in the column ``content'', the second is
  reported in the column ``content1'', the third in ``content2'' etc. 



  You can also specify the columnname directly in the test
  specification, by writing it as
  ``cont=COLUMN;\url{http://...}``. Column-names cannot include
  whitespace or semi-colon. 



  The content-check status by default includes the full URL that was
  requested, and the HTML data returned by the server. You can hide
  the HTML data on a per-host (not per-test) basis by adding the
  \textbf{HIDEHTTP} tag to the host entry. 



 

\item[content=URL] This syntax is deprecated. You should use the
  ``cont'' tag instead, see above. 


 

\item[post[=COLUMN];URL;form-data;[expected\_data\_regexp|\#digesttype:digest]]
  This tag can be used to test web pages, that use an input form. Data
  can be posted to the form by specifying them in the form-data field,
  and the result can be checked as if it was a normal content check
  (see above for a description of the cont-tag and the restrictions on
  how the URL must be writen). 


  The form-data field by default is in the
  ``application/x-www-form-urlencoded'' format, which is the most
  commonly used format for web forms. 



  E.g. if you have a web form defined like this: 


  
$<$formaction=''/cgi-bin/form.cgi''method=''post''$>$  
 
$<$p$>$Givenname$<$inputtype=''text''name=''givenname''$>$$<$/p$>$  
 
$<$p$>$Surname$<$inputtype=''text''name=''surname''$>$$<$/p$>$  
 
$<$inputtype=''submit''value=''Send''$>$  
 
$<$/form$>$ 


  and you want to post the value ``John'' to the first field and ``Doe
  Jr.'' to the second field, then the formdata field would be 



  
givenname=John\&surname=Doe$\backslash$x20Jr. 


  Note that any spaces in the input value is replaced with '+'. 


  If your form-data requires a different content-type, you can specify
  it by beginning the form-data with \textbf{(content-type=TYPE)},
  e.g. ``(content-type=text/xml)'' followed by the POST data. Note
  that as with normal forms, the POST data should be specified using
  escape-sequences for reserved characters: ``space'' should be
  entered as ``$\backslash$x20'', double quote as ``$\backslash$x22'',
  newline as ``$\backslash$n'', carriage-return as ``$\backslash$r'',
  TAB as ``$\backslash$t'', backslash as
  ``$\backslash$$\backslash$''. Any byte value can be entered using
  ``$\backslash$xNN'' with NN being the hexadecimal value,
  e.g. ``$\backslash$x20'' is the space character. 



  The [expected\_data\_regexp|\#digesttype:digest] is the expected
  data returned from the server in response to the POST. See the
  ``cont;'' tag above for details. If you are only interested in
  knowing if it is possible to submit the form (but don't care about
  the data), this can be an empty string - but the ';' at the end is
  required. 



 

\item[nocont[=COLUMN];URL;forbidden\_data\_regexp] This tag works just
  like ``cont'' tag, but reverses the test. It is green when the
  ``forbidden\_data\_regexp'' is NOT found in the response, and red
  when it IS found. So it can be used to watch for data that should
  NOT be present in the response, e.g. a server error message. 


 

\item[nopost[=COLUMN];URL;form-data;expected\_data\_regexp] This tag
  works just like ``post'' tag, but reverses the test. It is green
  when the ``forbidden\_data\_regexp'' is NOT found in the response,
  and red when it IS found. So it can be used to watch for data that
  should NOT be present in the response, e.g. a server error message. 


 

\item[type[=COLUMN];URL;expected\_content\_type] This is a variant of
  the content check - instead of checking the content data, it checks
  the type of the data as given by the HTTP Content-Type: header. This
  can used to check if a URL returns e.g. a PDF file, regardless of
  what is inside the PDF file. 


 

\item[httpstatus[=COLUMN];URL;okstatusexpr;notokstatusexpr] This is
  used to explicitly test for certain HTTP statuscodes returned when
  the URL is requested. The \textbf{okstatusexpr} and
  \textbf{nokokstatusexpr} expressions are Perl-compatible regular
  expressions, e.g. ``2..|302'' will match all OK codes and the
  redirect (302) status code. If the URL cannot be retrived, the
  status is ``999''. 


 

\item[HIDEHTTP] The status display for HTTP checks usually includes
  the URL, and for content checks also the actual data from the
  webpage. If you would like to hide these from view, then the
  HIDEHTTP tag will keep this information from showing up on the
  status webpages. 


 

\item[browser=BROWSERNAME] By default, Hobbit sends an HTTP
  ``User-Agent'' header identifying it a ``Hobbit''. Some websites
  require that you use a specific browser, typically Internet
  Explorer. To cater for testing of such sites, this tag can be used
  to modify the data sent in the User-Agent header.   E.g. to perform
  an HTTP test with Hobbit masquerading as an Internet Explorer 6.0
  browser, use \textbf{browser=''Mozilla/4.0 (compatible; MSIE 6.0;
    Windows NT 5.0)''}. If you do not know what the User-Agent header
  should be, open up the browser that works with this particular site,
  and open the URL
  ``javascript:document.writeln(navigator.userAgent)'' (just copy this
  into the ``Open URL'' dialog. The text that shows up is what the
  browser sends as the User-Agent header. 


 


\end{description}

\subsection{LDAP (DIRECTORY SERVER) TESTS}
\begin{description}
\item[ldap]
\item[ldaps] Simple check for an LDAP service. This check merely looks
  for any service running on the ldap/ldaps service port, but does not
  perform any actual LDAP transaction. 


 

\item[ldap://hostport/dn[?attrs[?scope[?filter[?exts]]]]] Check for an
  LDAP service by performing an LDAP request. This tag is in the form
  of an LDAP URI (cf. RFC 2255). This type of LDAP test requires that
  \emph{bbtest-net(1)} was built with support for LDAP, e.g. via the
  OpenLDAP library. The components of the LDAP URI are:
  \begin{verbatim}


  \emph{hostport}
 is a host name with an optional ":portnumber"
  \emph{dn}
 is the search base
  \emph{attrs}
 is a comma separated list of attributes to request
  \emph{scope}
 is one of these three strings:
    base one sub (default=base)
  \emph{filter}
 is filter
  \emph{exts}
 are recognized set of LDAP and/or API extensions.

\end{verbatim}


 

\item[ldaps://hostport/dn[?attrs[?scope[?filter[?exts]]]]] LDAP
  service check using LDAPv3 and STARTTLS for talking to an LDAP
  server that requires TLS encryption. See \emph{bbtest-net(1)} for a
  discussion of the different ways of running LDAP servers with
  SSL/TLS, and which of these are supported by bbtest-net. 


 

\item[ldaplogin=username:password] Define a username and password to
  use when binding to the LDAP server for ldap URI tests. If not
  specified, bbtest-net will attempt an anonymous bind. 


 

\item[ldapyellowfail] Used with an LDAP URL test. If the LDAP query
  fails during the search of the directory, the ldap status is
  normally reported as ``red'' (alarm). This tag reduces a search
  failure to a ``yellow'' (warning) status. 


 


\end{description}
\subsection{PERFORMANCE MONITORING TESTS}
\begin{description}
\item[apache[=URL]] If you are running an Apache webserver, adding
  this tag makes \emph{bbtest-net(1)} collect performance statistics
  from the Apache webserver by querying the URL
  \textbf{\url{http://IP.ADDRESS.OF.HOST/server-status?auto}}. The
  response is sent as a data-report and processed by the Hobbit
  hobbitd\_rrd module into an RRD file and an ``apache'' graph. If
  your webserver requires e.g. authentication, or runs on a different
  URL for the server-status, you can provide the full URL needed to
  fetch the server-status page,
  e.g.
  \textbf{apache=\url{http://LOGIN:PASSWORD@10.0.0.1/server-status?auto}}
  for a password protected server-status page, or
  \textbf{apache=\url{http://10.0.0.1:8080/apache/server-status?auto}}
  for a server listening on port 8080 and with a different path to the
  server-status page. 



  Note that you need to enable the server-status URL in your Apache
  configuration. The following configuration is needed: 



  
$<$Location/server-status$>$  
 
SetHandlerserver-status  
 
Orderdeny,allow  
 
Denyfromall  
 
allowfrom127.0.0.1  
 
$<$/Location$>$  
 
ExtendedStatusOn 


  Change ``127.0.0.1'' to the IP-address of the server that runs your network tests. 


 


\end{description}
\subsection{DEFAULT HOST}
 If you have certain tags that you want to apply to all hosts, you can
 define a host name ``.default.'' and put the tags on that host. Note
 that per-host definitions will override the default ones. 


 \textbf{NOTE:}
 The ``.default.'' host entry will only accept the following tags -
 others are silently ignored: NOCOLUMNS, COMMENT, DESCR, CLASS,
 dialup, testip, nobb2, nodisp, noinfo, notrends, TRENDS, NOPROPRED,
 NOPROPYELLOW, NOPROPPURPLE, NOPROPACK, REPORTTIME, WARNPCT, NET,
 noclear, nosslcert, ssldays, DOWNTIME, depends, noping, noconn,
 trace, notrace, HIDEHTTP, browser, pulldata. Specifically, note that
 network tests, ``badTEST'' settings, and alternate pageset relations
 cannot be listed on the ``.default.'' host. 



 
\subsection{SENDING SUMMARIES TO REMOTE HOBBIT SERVERS}
\begin{description}
\item[summary ROW.COLUMN IP URL] If you have multiple Hobbit servers,
  the ``summary'' directive lets you form a hierarchy of servers by
  sending the overall status of this server to a remote Hobbit server,
  which then displays this in a special summary section. E.g. if your
  offices are spread over three locations, you can have a Hobbit
  server at each office. These branch-office Hobbits have a
  ``summary'' definition in their bb-hosts file that makes them report
  the overall status of their branch Hobbit to the central Hobbit
  server you maintain at the corporate headquarters. 


  Multiple ``summary'' definitions are allowed. 


  The ROW.COLUMN setting defines how this summary is presented on the
  server that receives the summary. The ROW text will be used as the
  heading for a summary line, and the COLUMN defines the name of the
  column where this summary is shown - like the hostname and testname
  used in the normal displays. The IP is the IP-address of the
  \textbf{remote} (upstream) Hobbit server, where this summary is
  sent). The URL is the URL of your \textbf{local} Hobbit server. 



  The URL need not be that of your Hobbit server's main page - it
  could be the URL of a subpage on the local Hobbit server. Hobbit
  will report the summary using the color of the page found at the URL
  you specify. E.g. on your corporate Hobbit server you want a summary
  from the Las Vegas office - but you would like to know both what the
  overall status is, and what is the status of the servers on the
  critical Sales department back-office servers in Las Vegas. So you
  configure the Las Vegas Hobbit server to send \textbf{two}
  summaries: 





  
summaryVegas.All10.0.1.1\url{http://vegas.foo.com/hobbit/} 
 
summaryVegas.Sales10.0.1.1\url{http://vegas.foo.com/hobbit/sales/}


 


  This gives you one summary line for Baltimore, with two columns: An
  ``All'' column showing the overall status, and a ``Sales'' column
  showing the status of the ``sales'' page on the Baltimore Hobbit
  server. 



  Note: Pages defined using alternate pageset definitions cannot be
  used, the URL must point to a webpage from the default set of Hobbit
  webpages. 



 


\end{description}
\subsection{OTHER TAGS}
\begin{description}
\item[pulldata[=[IP][:port]]] This option is recognized by the
  \emph{hobbitfetch(8)} utility, and causes it to poll the host for
  client data. The optional IP-address and port-number can be used if
  the client-side \emph{msgcache(8)} daemon is listening on a
  non-standard IP-address or port-number. 


 

\end{description}
\subsection{FILES}
\textbf{~hobbit/server/etc/bb-hosts}


 
\subsection{SEE ALSO}
bbgen(1), bbtest-net(1), bbdigest(1), hobbitserver.cfg(5), hobbit(7) 

 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{hobbit-alerts.cfg - Configuration for the hobbitd\_alert module}
 
\subsection{SYNOPSIS}
\textbf{~hobbit/server/etc/hobbit-alerts.cfg}


 
\subsection{DESCRIPTION}
 The hobbit-alerts.cfg file controls the sending of alerts by Hobbit when monitoring detects a failure. 

 
\subsection{FILE FORMAT}
 The configuration file consists of \textbf{rules}
, that may have one or more \textbf{recipients}
 associated. A recipient specification may include additional rules that limit the circumstances when this recipient is eligible for receiving an alert. 

  Blank lines and lines starting with a hash mark (\#) are treated as comments and ignored. Long lines can be broken up by putting a backslash at the end of the line and continuing the entry on the next line. 


 
\subsection{RULES}
 A rule consists of one of more filters using these keywords: 

 \textbf{PAGE=targetstring}
 Rule matching an alert by the name of the page in BB. This is the path of the page as defined in the bb-hosts file. E.g. if you have this setup: \begin{description}
\item[]\begin{verbatim}

page servers All Servers
subpage web Webservers
10.0.0.1 www1.foo.com
subpage db Database servers
10.0.0.2 db1.foo.com

\end{verbatim}


\end{description}



  Then the ``All servers'' page is found with \textbf{PAGE=servers}
, the ``Webservers'' page is \textbf{PAGE=servers/web}
 and the ``Database servers'' page is \textbf{PAGE=servers/db}
. Note that you can also use regular expressions to specify the page name, e.g. \textbf{PAGE=\%.*/db}
 would find the ``Database servers'' page regardless of where this page was placed in the hierarchy. 


  The PAGE name of top-level page is an empty string. To match this, use \textbf{PAGE=\%\^{}\$}
 to match the empty string. 


 


 \textbf{EXPAGE=targetstring}
 Rule excluding an alert if the pagename matches. 


 \textbf{HOST=targetstring}
 Rule matching an alert by the hostname. 


 \textbf{EXHOST=targetstring}
 Rule excluding an alert by matching the hostname. 


 \textbf{SERVICE=targetstring}
 Rule matching an alert by the service name. 


 \textbf{EXSERVICE=targetstring}
 Rule excluding an alert by matching the service name. 


 \textbf{GROUP=groupname}
 Rule matching an alert by the group name. Groupnames are assigned to a status via the GROUP setting in the hobbit-clients.cfg file. 


 \textbf{EXGROUP=groupname}
 Rule excluding an alert by the group name. Groupnames are assigned to a status via the GROUP setting in the hobbit-clients.cfg file. 


 \textbf{COLOR=color[,color]}
 Rule matching an alert by color. Can be ``red'', ``yellow'', or ``purple''. The forms ``!red'', ``!yellow'' and ``!purple'' can also be used to NOT send an alert if the color is the specified one. 


 \textbf{TIME=timespecification}
 Rule matching an alert by the time-of-day. This is specified as the DOWNTIME timespecification in the bb-hosts file. 


 \textbf{DURATION$>$time, DURATION$<$time}
 Rule matcing an alert if the event has lasted longer/shorter than the given duration. E.g. DURATION$>$1h (lasted longer than 1 hour) or DURATION$<$30 (only sends alerts the first 30 minutes). The duration is specified as a number, optionally followed by 'm' (minutes, default), 'h' (hours) or 'd' (days). 


 \textbf{RECOVERED}
 Rule matches if the alert has recovered from an alert state. 


 \textbf{NOTICE}
 Rule matches if the message is a ``notify'' message. This type of message is sent when a host or test is disabled or enabled. 


  The ``targetstring'' is either a simple pagename, hostname or servicename, OR a '\%' followed by a Perl-compatible regular expression. E.g. ``HOST=\%www(.*)'' will match any hostname that begins with ``www''. The same for the ``groupname'' setting. 


 
\subsection{RECIPIENTS}
 The recipients are listed after the initial rule. The following keywords can be used to define recipients: 

 \textbf{MAIL address[,address]}
 Recipient who receives an e-mail alert. This takes one parameter, the e-mail address. 


 \textbf{SCRIPT /path/to/script recipientID}
 Recipient that invokes a script. This takes two parameters: The script filename, and the recipient that gets passed to the script. 


 \textbf{IGNORE}
 This is used to define a recipient that does NOT trigger any alerts, and also terminates the search for more recipients. It is useful if you have a rule that handles most alerts, but there is just that one particular server where you dont want cpu alerts on Monday morning. Note that the IGNORE recipient always has the STOP flag defined, so when the IGNORE recipient is matched, no more recipients will be considered. So the location of this recipient in your set of recipients is important. 


 \textbf{FORMAT=formatstring}
 Format of the text message with the alert. Default is ``TEXT'' (suitable for e-mail alerts). ``PLAIN'' is the same as text, but without the URL link to the status webpage. ``SMS'' is a short message with no subject for SMS alerts. ``SCRIPT'' is a brief message template for scripts. 


 \textbf{REPEAT=time}
 How often an alert gets repeated. As with DURATION, time is a number optionally followed by 'm', 'h' or 'd'. 


 \textbf{UNMATCHED}
 The alert is sent to this recipient ONLY if no other recipients received an alert for this event. 


 \textbf{STOP}
 Stop looking for more recipients after this one matches. This is implicit on IGNORE recipients. 


 \textbf{Rules}
 You can specify rules for a recipient also. This limits the alerts sent to this particular recipient. 


 
\subsection{MACROS}
 It is possible to use \textbf{macros}
 in the configuration file. To define a macro: 

 \$MYMACRO=text extending to end of line 



  After the definition of a macro, it can be used throughout the file. Wherever the text \$MYMACRO appears, it will be substituted with the text of the macro before any processing of rules and recipients. 


  It is possible to nest macros, as long as the macro is defined before it is used. 


 
\subsection{ALERT SCRIPTS}
 Alerts can go out via custom scripts, by using the SCRIPT keyword for a recipient. Such scritps have access to the following environment variables: 

 \textbf{BBALPHAMSG}
 The full text of the status log triggering the alert 


 \textbf{ACKCODE}
 The ``cookie'' that can be used to acknowledge the alert 


 \textbf{RCPT}
 The recipientID from the SCRIPT entry 


 \textbf{BBHOSTNAME}
 The name of the host that the alert is about 


 \textbf{MACHIP}
 The IP-address of the host that has a problem 


 \textbf{BBSVCNAME}
 The name of the service that the alert is about 


 \textbf{BBSVCNUM}
 The numeric code for the service. From the SVCCODES definition. 


 \textbf{BBHOSTSVC}
 HOSTNAME.SERVICE that the alert is about. 


 \textbf{BBHOSTSVCCOMMAS}
 As BBHOSTSVC, but dots in the hostname replaced with commas 


 \textbf{BBNUMERIC}
 A 22-digit number made by BBSVCNUM, MACHIP and ACKCODE. 


 \textbf{RECOVERED}
 Is ``1'' if the service has recovered. 


 \textbf{EVENTSTART}
 Timestamp when the current status (color) began. 


 \textbf{SECS}
 Number of seconds the service has been down. 


 \textbf{DOWNSECSMSG}
 When recovered, holds the text ``Event duration : N'' where N is the DOWNSECS value. 


 \textbf{CFID}
 Line-number in the hobbit-alerts.cfg file that caused the script to be invoked. Can be useful when troubleshooting alert configuration rules. 


 
\subsection{SEE ALSO}
hobbitd\_alert(8), hobbitd(8), hobbit(7), the ``Configuring Hobbit Alerts'' guide in the Online documentation. 

 


  

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{hobbit-clients.cfg - Configuration file for the hobbitd\_client module}
 
\subsection{SYNOPSIS}
\textbf{~hobbit/server/etc/hobbit-clients.cfg}


 
\subsection{DESCRIPTION}
 The hobbit-clients.cfg file controls what color is assigned to the status-messages that are generated from the Hobbit client data - typically the cpu, disk, memory, procs- and msgs-columns. Color is decided on the basis of some \textbf{settings}
 defined in this file; settings apply to specific hosts through a set of \textbf{rules}
. 

  Note: This file is only used on the Hobbit server - it is not used by the Hobbit client, so there is no need to distribute it to your client systems. 


 
\subsection{FILE FORMAT}
 Blank lines and lines starting with a hash mark (\#) are treated as comments and ignored. 

 


 
\subsection{CPU STATUS COLUMN SETTINGS}


 \textbf{LOAD warnlevel paniclevel}



  If the system load exceeds ``warnlevel'' or ``paniclevel'', the ``cpu'' status will go yellow or red, respectively. These are decimal numbers. 


  Defaults: warnlevel=5.0, paniclevel=10.0 


 \textbf{UP bootlimit toolonglimit}



  The cpu status goes yellow if the system has been up for less than ``bootlimit'' time, or longer than ``toolonglimit''. The time is in minutes, or you can add h/d/w for hours/days/weeks - eg. ``2h'' for two hours, or ``4w'' for 4 weeks. 


  Defaults: bootlimit=1h, toolonglimit=-1 (infinite). 


 


 \textbf{CLOCK max.offset}



  The cpu status goes yellow if the system clock on the client differs more than ``max.offset'' seconds from that of the Hobbit server. Note that this is not a particularly accurate test, since it is affected by network delays between the client and the server, and the load on both systems. You should therefore not rely on this being accurate to more than +/- 5 seconds, but it will let you catch a client clock that goes completely wrong. The default is NOT to check the system clock.  
\textbf{NOTE:}
 Correct operation of this test obviously requires that the system clock of the Hobbit server is correct. You should therefore make sure that the Hobbit server is synchronized to the real clock, e.g. by using NTP. 


 


  Example: Go yellow if the load average exceeds 5, and red if it exceeds 10. Also, go yellow for 10 minutes after a reboot, and after 4 weeks uptime. Finally, check that the system clock is at most 15 seconds offset from the clock of the Hobbit system. \begin{description}
\item[]\begin{verbatim}

LOAD 5 10
UP 10m 4w
CLOCK 15

\end{verbatim}


\end{description}



 


 
\subsection{DISK STATUS COLUMN SETTINGS}


 \textbf{DISK filesystem warnlevel paniclevel}
 \textbf{DISK filesystem IGNORE}



  If the utilization of ``filesystem'' is reported to exceed ``warnlevel'' or ``paniclevel'', the ``disk'' status will go yellow or red, respectively. ``warnlevel'' and ``paniclevel'' are either the percentage used, or the space available as reported by the local ``df'' command on the host. For the latter type of check, the ``warnlevel'' must be followed by the letter ``U'', e.g. ``1024U''. 


  The special keyword ``IGNORE'' causes this filesystem to be ignored completely, i.e. it will not appear in the ``disk'' status column and it will not be tracked in a graph. This is useful for e.g. removable devices, backup-disks and similar hardware. 


  ``filesystem'' is the mount-point where the filesystem is mounted, e.g. ``/usr'' or ``/home''. A filesystem-name that begins with ``\%'' is interpreted as a Perl-compatible regular expression; e.g. ``\%\^{}/oracle.*/'' will match any filesystem whose mountpoint begins with ``/oracle''. 


  Defaults: warnlevel=90\%, paniclevel=95\% 


 
\subsection{MEMORY STATUS COLUMN SETTINGS}


 \textbf{MEMPHYS warnlevel paniclevel}
 
\textbf{MEMACT warnlevel paniclevel}
 
\textbf{MEMSWAP warnlevel paniclevel}



  If the memory utilization exceeds the ``warnlevel'' or ``paniclevel'', the ``memory'' status will change to yellow or red, respectively. Note: The words ``PHYS'', ``ACT'' and ``SWAP'' are also recognized. 


  Example: Go yellow if more than 20\% swap is used, and red if more than 40\% swap is used or the actual memory utilisation exceeds 90\%. Dont alert on physical memory usage. \begin{description}
\item[]\begin{verbatim}

MEMSWAP 20 40
MEMACT 90 90
MEMPHYS 101 101

\end{verbatim}


\end{description}



  Defaults: \begin{description}
\item[]\begin{verbatim}

MEMPHYS warnlevel=100 paniclevel=101 (i.e. it will never go red).
MEMSWAP warnlevel=50 paniclevel=80
MEMACT  warnlevel=90 paniclevel=97

\end{verbatim}


\end{description}



 


 \textbf{PAGING warnlevel paniclevel}



  Paging rates (Page in \& out per second) for operating systems that measure that data (currently only z/VM and z/VME). Defaults are warnlevel=5, paniclevel=10. 


 
\subsection{PROCS STATUS COLUMN SETTINGS}


 \textbf{PROC processname minimumcount maximumcount color [TRACK=id] [TEXT=text]}



  The ``ps'' listing sent by the client will be scanned for how many processes containing ``processname'' are running, and this is then matched against the min/max settings defined here. If the running count is outside the thresholds, the color of the ``procs'' status changes to ``color''. 


  To check for a process that must NOT be running: Set minimum and maximum to 0. 


  ``processname'' can be a simple string, in which case this string must show up in the ``ps'' listing as a command. The scanner will find a ps-listing of e.g. ``/usr/sbin/cron'' if you only specify ``processname'' as ``cron''. ``processname'' can also be a Perl-compatiable regular expression, e.g. ``\%java.*inst[0123]'' can be used to find entries in the ps-listing for ``java -Xmx512m inst2'' and ``java -Xmx256 inst3''. In that case, ``processname'' must begin with ``\%'' followed by the regular expression. Note that Hobbit defaults to case-insensitive pattern matching; if that is not what you want, put ``(?-i)'' between the ``\%'' and the regular expression to turn this off. E.g. ``\%(?-i)HTTPD'' will match the word HTTPD only when it is upper-case.  
 If ``processname'' contains whitespace (blanks or TAB), you must enclose the full string in double quotes - including the ``\%'' if you use regular expression matching. E.g. 


  
PROC''\%hobbitd\_channel--channel=data.*hobbitd\_rrd''11yellow 


  or 


  
PROC''java-DCLASSPATH=/opt/java/lib''25 


  You can have multiple ``PROC'' entries for the same host, all of the checks are merged into the ``procs'' status and the most severe check defines the color of the status. 


  The optional \textbf{TRACK=id}
 setting causes Hobbit to track the number of processes found in an RRD file, and put this into a graph which is shown on the ``procs'' status display. The \textbf{id}
 setting is a simple text string which will be used as the legend for the graph, and also as part of the RRD filename. It is recommended that you use only letters and digits for the ID.  
 Note that the process counts which are tracked are only performed once when the client does a poll cycle - i.e. the counts represent snapshots of the system state, not an average value over the client poll cycle. Therefore there may be peaks or dips in the actual process counts which will not show up in the graphs, because they happen while the Hobbit client is not doing any polling. 


  The optional \textbf{TEXT=text}
 setting is used in the summary of the ``procs'' status. Normally, the summary will show the ``processname'' to identify the process and the related count and limits. But this may be a regular expression which is not easily recognizable, so if defined, the \textbf{text}
 setting string will be used instead. This only affects the ``procs'' status display - it has no effect on how the rule counts or recognizes processes in the ``ps'' output. 


  Example: Check that ``cron'' is running:  
PROC cron 



  Example: Check that at least 5 ``httpd'' processes are running, but not more than 20:  
PROC httpd 5 20 



  Defaults:  
mincount=1, maxcount=-1 (unlimited), color=''red''. 
 
Note that no processes are checked by default. 



 
\subsection{MSGS STATUS COLUMN SETTINGS}


 \textbf{LOG logfilename pattern [COLOR=color] [IGNORE=excludepattern]}



  The Hobbit client extracts interesting lines from one or more logfiles - see the \emph{client-local.cfg(5)}
 man-page for information about how to configure which logs a client should look at. 


  The \textbf{LOG}
 setting determine how these extracts of log entries are processed, and what warnings or alerts trigger as a result. 


  ``logfilename'' is the name of the logfile. Only logentries from this filename will be matched against this rule. Note that ``logfilename'' can be a regular expression (if prefixed with a '\%' character). 


  ``pattern'' is a string or regular expression. If the logfile data matches ``pattern'', it will trigger the ``msgs'' column to change color. If no ``color'' parameter is present, the default is to go ``red'' when the pattern is matched. To match against a regular expression, ``pattern'' must begin with a '\%' sign - e.g ``\%WARNING|NOTICE'' will match any lines containing either of these two words. Note that Hobbit defaults to case-insensitive pattern matching; if that is not what you want, put ``(?-i)'' between the ``\%'' and the regular expression to turn this off. E.g. ``\%(?-i)WARNING'' will match the word WARNING only when it is upper-case. 


  ``excludepattern'' is a string or regular expression that can be used to filter out any unwanted strings that happen to match ``pattern''. 


  Example: Trigger a red alert when the string ``ERROR'' appears in the ``/var/adm/syslog'' file:  
LOG /var/adm/syslog ERROR 



  Example: Trigger a yellow warning on all occurrences of the word ``WARNING'' or ``NOTICE'' in the ``daemon.log'' file, except those from the ``lpr'' system:  
LOG /var/log/daemon.log \%WARNING|NOTICE COLOR=yellow IGNORE=lpr 



  Defaults:  
color=''red'', no ``excludepattern''. 



  Note that no logfiles are checked by default. Any log data reported by a client will just show up on the ``msgs'' column with status OK (green). 


 


 
\subsection{FILES STATUS COLUMN SETTINGS}


 \textbf{FILE filename [color] [things to check] [TRACK]}



 \textbf{DIR directoryname [color] [size$<$MAXSIZE] [size$>$MINSIZE] [TRACK]}



  These entries control the status of the ``files'' column. They allow you to check on various data for files and directories. 


 \textbf{filename}
 and \textbf{directoryname}
 are names of files or directories, with a full path. You can use a regular expression to match the names of files and directories reported by the client, if you prefix the expression with a '\%' character. 


 \textbf{color}
 is the color that triggers when one or more of the checks fail. 


  The \textbf{TRACK}
 keyword causes the size of the file or directory to be tracked in an RRD file, and presented in a graph on the ``files'' status display. 


  For files, you can check one or more of the following: \begin{description}
\item[noexist] triggers a warning if the file exists. By default, a warning is triggered for files that have a FILE entry, but which do not exist. 
\item[type=TYPE] where TYPE is one of ``file'', ``dir'', ``char'', ``block'', ``fifo'', ``socket'' or ``symlink''. Triggers warning if the file is not of the specified type. 
\item[ownerid=OWNER] triggers a warning if the owner does not match what is listed here. OWNER is specified either with the numeric uid, or the user name. 
\item[groupid=GROUP] triggers a warning if the group does not match what is listed here. GROUP is specified either with the numeric gid, or the group name. 
\item[mode=MODE] triggers a warning if the file permissions are not as listed. MODE is written in the standard octal notation, e.g. ``644'' for the rw-r--r-- permissions. 
\item[size$<$MAX.SIZE and size$>$MIN.SIZE] triggers a warning it the file size is greater than MAX.SIZE or less than MIN.SIZE, respectively. For filesizes, you can use the letters ``K'', ``M'', ``G'' or ``T'' to indicate that the filesize is in Kilobytes, Megabytes, Gigabytes or Terabytes, respectively. If there is no such modifier, Kilobytes is assumed. E.g. to warn if a file grows larger than 1MB, use \textbf{size$<$1024M}
. 
\item[mtime$>$MIN.MTIME mtime$<$MAX.MTIME] checks how long ago the file was last modified (in seconds). E.g. to check if a file was updated within the past 10 minutes (600 seconds): \textbf{mtime$<$600}
. Or to check that a file has NOT been updated in the past 24 hours: \textbf{mtime$>$86400}
. 
\item[mtime=TIMESTAMP] checks if a file was last modified at TIMESTAMP. TIMESTAMP is a unix epoch time (seconds since midnight Jan 1 1970 UTC). 
\item[ctime$>$MIN.CTIME, ctime$<$MAX.CTIME, ctime=TIMESTAMP] acts as the mtime checks, but for the ctime timestamp (when the directory entry of the file was last changed, eg. by chown, chgrp or chmod). 
\item[md5=MD5SUM, sha1=SHA1SUM, rmd160=RMD160SUM, sha256=SHA256SUM, sha512=SHA512SUM] trigger a warning if the file checksum using the MD5, SHA1, RMD160, SHA-256 or SHA-512 message digest algorithms do not match the one configured here. Note: The ``file'' entry in the \emph{client-local.cfg(5)}
 file must specify which algorithm to use. 

 


\end{description}



  For directories, you can check one or more of the following: \begin{description}
\item[size$<$MAX.SIZE and size$>$MIN.SIZE] triggers a warning it the directory size is greater than MAX.SIZE or less than MIN.SIZE, respectively. Directory sizes are reported in whatever unit the \textbf{du}
 command on the client uses - often KB or diskblocks - so MAX.SIZE and MIN.SIZE must be given in the same unit. 

 


\end{description}



  Experience shows that it can be difficult to get these rules right. Especially when defining minimum/maximum values for file sizes, when they were last modified etc. The one thing you must remember when setting up these checks is that the rules describe criteria that must be met - only when they are met will the status be green. 


  So ``mtime$<$600'' means ``the difference between current time and the mtime of the file must be less than 600 seconds - if not, the file status will go red''. 


 


 
\subsection{PORTS STATUS COLUMN SETTINGS}


 \textbf{PORT criteria [MIN=mincount] [MAX=maxcount] [COLOR=color] [TRACK=id] [TEXT=displaytext]}



  The ``netstat'' listing sent by the client will be scanned for how many sockets match the \textbf{criteria}
 listed. The criteria you can use are: \begin{description}
\item[LOCAL=addr] ``addr'' is a (partial) local address specification in the format used on the output from netstat. 
\item[EXLOCAL=addr] Exclude certain local adresses from the rule. 
\item[REMOTE=addr] ``addr'' is a (partial) remote address specification in the format used on the output from netstat. 
\item[EXREMOTE=addr] Exclude certain remote adresses from the rule. 
\item[STATE=state] Causes only the sockets in the specified state to be included, ``state'' is usually LISTEN or ESTABLISHED but can be any socket state reported by the clients ``netstat'' command. 
\item[EXSTATE=state] Exclude certain states from the rule. 

\end{description}



  ``addr'' is typically ``10.0.0.1:80'' for the IP 10.0.0.1, port 80. Or ``*:80'' for any local address, port 80. Note that the Hobbit clients normally report only the numeric data for IP-adresses and port-numbers, so you must specify the port number (e.g. ``80'') instead of the service name (``www'').  
 ``addr'' and ``state'' can also be a Perl-compatiable regular expression, e.g. ``LOCAL=\%[.:](80|443)'' can be used to find entries in the netstat local port for both http (port 80) and https (port 443). In that case, portname or state must begin with ``\%'' followed by the reg.expression. 


  The socket count found is then matched against the min/max settings defined here. If the count is outside the thresholds, the color of the ``ports'' status changes to ``color''. To check for a socket that must NOT exist: Set minimum and maximum to 0. 


  The optional \textbf{TRACK=id}
 setting causes Hobbit to track the number of sockets found in an RRD file, and put this into a graph which is shown on the ``ports'' status display. The \textbf{id}
 setting is a simple text string which will be used as the legend for the graph, and also as part of the RRD filename. It is recommended that you use only letters and digits for the ID.  
 Note that the sockets counts which are tracked are only performed once when the client does a poll cycle - i.e. the counts represent snapshots of the system state, not an average value over the client poll cycle. Therefore there may be peaks or dips in the actual sockets counts which will not show up in the graphs, because they happen while the Hobbit client is not doing any polling. 


  The \textbf{TEXT=displaytext}
 option affects how the port appears on the ``ports'' status page. By default, the port is listed with the local/remote/state rules as identification, but this may be somewhat difficult to understand. You can then use e.g. ``TEXT=Secure Shell'' to make these ports appear with the name ``Secure Shell'' instead. 


  Defaults: mincount=1, maxcount=-1 (unlimited), color=''red''. Note: No ports are checked by default. 


  Example: Check that the SSH daemon is listening on port 22. Track the number of active SSH connections, and warn if there are more than 5.  
 
PORTLOCAL=\%[.:]22\$STATE=LISTEN''TEXT=SSHlistener''  
 
PORTLOCAL=\%[.:]22\$STATE=ESTABLISHEDMAX=5TRACK=sshTEXT=SSH 


 
\subsection{CHANGING THE DEFAULT SETTINGS}
 If you would like to use different defaults for the settings described above, then you can define the new defaults after a DEFAULT line. E.g. this would explicitly define all of the default settings: \begin{description}
\item[]\begin{verbatim}

DEFAULT
        UP      1h
        LOAD    5.0 10.0
        DISK    * 90 95
        MEMPHYS 100 101
        MEMSWAP 50 80
        MEMACT  90 97

\end{verbatim}


\end{description}


 


 
\subsection{RULES TO SELECT HOSTS}
 All of the settings can be applied to a group of hosts, by preceding them with rules. A rule defines of one of more filters using these keywords (note that this is identical to the rule definitions used in the \emph{hobbit-alerts.cfg(5)}
 file). 

 \textbf{PAGE=targetstring}
 Rule matching an alert by the name of the page in
 BB. ``targetstring'' is the path of the page as defined in the
 bb-hosts file. E.g. if you have this setup: \begin{description}

\item[]\begin{verbatim}

page servers All Servers
subpage web Webservers
10.0.0.1 www1.foo.com
subpage db Database servers
10.0.0.2 db1.foo.com

\end{verbatim}


\end{description}



  Then the ``All servers'' page is found with \textbf{PAGE=servers}
, the ``Webservers'' page is \textbf{PAGE=servers/web}
 and the ``Database servers'' page is \textbf{PAGE=servers/db}
. Note that you can also use regular expressions to specify the page name, e.g. \textbf{PAGE=\%.*/db}
 would find the ``Database servers'' page regardless of where this page was placed in the hierarchy. 


  The top-level page has a the fixed name \textbf{/}
, e.g. \textbf{PAGE=/} would match all hosts on the Hobbit
  frontpage. If you need it in a regular expression, use
  \textbf{PAGE=\%\^{}/} to avoid matching the forward-slash present in
  subpage-names. 



 \textbf{EXPAGE=targetstring}
 Rule excluding a host if the pagename matches. 


 \textbf{HOST=targetstring}
 Rule matching a host by the hostname. ``targetstring'' is either a
 comma-separated list of hostnames (from the bb-hosts file), ``*'' to
 indicate ``all hosts'', or a Perl-compatible regular
 expression. E.g. ``HOST=dns.foo.com,www.foo.com`` identifies two
 specific hosts; ``HOST=\%www.*.foo.com EXHOST=www-test.foo.com''
 matches all hosts with a name beginning with ``www'', except the
 ``www-test'' host. 



 \textbf{EXHOST=targetstring}
 Rule excluding a host by matching the hostname. 


 \textbf{CLASS=classname}
 Rule match by the client class-name. You specify the class-name for a
 host when starting the client through the ``--class=NAME'' option to
 the runclient.sh script. If no class is specified, the host by
 default goes into a class named by the operating system. 



 \textbf{EXCLASS=classname}
 Exclude all hosts belonging to ``classname'' from this rule. 


 \textbf{TIME=timespecification}
 Rule matching by the time-of-day. This is specified as the DOWNTIME time specification in the bb-hosts file. E.g. ``TIME=W:0800:2200'' applied to a rule will make this rule active only on week-days between 8AM and 10PM. 


 
\subsection{DIRECTING ALERTS TO GROUPS}
 For some tests - e.g. ``procs'' or ``msgs'' - the right group of
 people to alert in case of a failure may be different, depending on
 which of the client rules actually detected a problem. E.g. if you
 have PROCS rules for a host checking both ``httpd'' and ``sshd''
 processes, then the Web admins should handle httpd-failures, whereas
 ``sshd'' failures are handled by the Unix admins. 


  To handle this, all rules can have a ``GROUP=groupname'' setting. When a rule with this setting triggers a yellow or red status, the groupname is passed on to the Hobbit alerts module, so you can use it in the alert rule definitions in \emph{hobbit-alerts.cfg(5)}
 to direct alerts to the correct group of people. 



 
\subsection{RULES: APPLYING SETTINGS TO SELECTED HOSTS}
 Rules must be placed after the settings, e.g. \begin{description}
\item[]\begin{verbatim}

LOAD 8.0 12.0  HOST=db.foo.com TIME=*:0800:1600

\end{verbatim}


\end{description}



  If you have multiple settings that you want to apply the same rules
  to, you can write the rules *only* on one line, followed by the
  settings. E.g. 

\begin{description}
\item[]\begin{verbatim}

HOST=%db.*.foo.com TIME=W:0800:1600
        LOAD 8.0 12.0
        DISK /db  98 100
        PROC mysqld 1

\end{verbatim}


\end{description}



  will apply the three settings to all of the ``db'' hosts on
  week-days between 8AM and 4PM. This can be combined with
  per-settings rule, in which case the per-settings rule overrides the
  general rule; e.g. \begin{description}\item[]\begin{verbatim}


HOST=%.*.foo.com
        LOAD 7.0 12.0 HOST=bax.foo.com
        LOAD 3.0 8.0

\end{verbatim}


\end{description}



  will result in the load-limits being 7.0/12.0 for the
  ``bax.foo.com'' host, and 3.0/8.0 for all other foo.com hosts. 

  The entire file is evaluated from the top to bottom, and the first
  match found is used. So you should put the specific settings first,
  and the generic ones last. 
 
\subsection{NOTES}
 For the LOG, FILE and DIR checks, it is necessary also to configure
 the actual file- and directory-names in the
 \emph{client-local.cfg(5)} file. If the filenames are not listed
 there, the clients will not collect any data about these
 files/directories, and the settings in the hobbit-clients.cfg file
 will be silently ignored. 


  The ability to compute file checksums with MD5, SHA1 or RMD160
  should not be used for general-purpose file integrity checking,
  since the overhead of calculating these on a large number of files
  can be significant. If you need this, look at tools designed for
  this purpose - e.g. Tripwire or AIDE. 



  At the time of writing (april 2006), the SHA-1 and RMD160 algorithms
  are considered cryptographically safe. The MD5 algorithm has been
  shown to have some weaknesses, and is not considered strong enough
  when a high level of security is required. 



\subsection{SEE ALSO}
hobbitd\_client(8), client-local.cfg(5), hobbitd(8), hobbit(7) 

 
  user-friendly names can be shown for hosts regardless of their true
  hostname. You can also have automatic links to on-line
  documentation, so information about your critical systems is just a
  click away. 

\item[Integrated trend analysis, historical data and SLA reporting]
  Hobbit stores trend- and availability-information about everything
  it monitors. So if you need to look at how your systems behave over
  time, Hobbit has all of the information you need: Whether is is
  response times of your webpages during peak hours, the CPU
  utilisation over the past 4 weeks, or what the availability of a
  site was compared to the SLA - it's all there inside Hobbit. All
  measurements are tracked and made available in time-based graphs. 


  When you need to drill down into events that have occurred, Hobbit
  provides a powerful tool for viewing the event history for each
  statuslog, with overviews of when problems have occurred during the
  past and easy-to-use zoom-in on the event. 

  For SLA reporting, You can configure planned downtime, agreed
  service availability level, service availability time and have
  Hobbit generate availability reports directly showing the actual
  availability measured against the agreed SLA. Such reports of
  service availability can be generated on-the-fly, or pre-generated
  e.g. for monthly reporting. 

\item[Role-based views] You can have multiple different views of the
  same hosts for different parts of the organisation, e.g. one view
  for the hardware group, and another view for the webmasters - all of
  them fed by the same test tools. 


  If you have a dedicated Network Operations Centre, you can configure
  precisely which alerts will appear on their monitors - e.g. a simple
  anomaly in the system logfile need not trigger a call to 3rd-level
  support at 2 AM, but if the on-line shop goes down you do want
  someone to respond immediately. So you put the webcheck for the
  on-line shop on the NOC monitor page, and leave out the log-file
  check. 
 

\item[Also for the techies] The Hobbit user-interface is simple, but
  engineers will also find lots of relevant information. E.g. the data
  that clients report to Hobbit contain the raw output from a number
  of system commands. That information is available directly in
  Hobbit, so an administrator no longer needs to login to a server to
  get an overview of how it is behaving - the very commands they would
  normally run have alredy been performed, and the results are on-line
  in Hobbit. 


\item[Easy to adapt to your needs] Hobbit includes a lot of tests in
  the core package, but there will always be something specific to
  your setup that you would like to watch. Hobbit allows you to write
  test scripts in your favourite scripting language and have the
  results show up as regular status columns in Hobbit. You can trigger
  alerts from these, and even track trends in graphs just by a simple
  configuration setting. 


\item[Real network service tests] The network test tool knows how to
  test most commonly used protocols, including HTTP, SMTP (e-mail),
  DNS, LDAP (directory services), and many more. When checking
  websites, it is possible to not only check that the webserver is
  responding, but also that the response looks correct by matching the
  response against a pre-defined pattern or a checksum. So you can
  test that a network service is really working and supplying the data
  you expect - not just that the service is running. 

  Protocols that use SSL encryption such as https-websites are fully
  supported, and while checking such services the network tester will
  automatically run a check of the validity of the SSL server
  certificate, and warn about certificates that are about to expire. 

\item[Highly configurable alerts] You want to know when something
  breaks. But you don't want to get flooded with alerts all the
  time. Hobbit lets you define several criteria for when to send out
  an alert, so you only get alerts when there is really something that
  needs your attention right away. While you are handling an incident,
  you can tell Hobbit about it so it stops sending more alerts, and so
  that everyone else can check with Hobbit and know that the problem
  is being taken care of. 


\item[Combined super-tests and test interdependencies] If a single
  test is not enough, combination tests can be defined that combine
  the result of several tests to a single status-report. So if you
  need to monitor that at least 3 out of 5 servers are running at any
  time, Hobbit can do that for you and generate the necessary
  availability report. 

  Tests can also be configured to depend on each other, so that when a
  critical router goes down you will get alerts only for the router -
  and not from the 200 hosts behind the router. 

 
\end{description}

\section{SECURITY}
 All of the Hobbit server tools run under an unprivileged user
 account. A single program - the \emph{hobbitping(1)} network
 connectivity tester - must be installed setuid-root, but has been
 written so that it drops all root privileges immediately after
 performing the operation that requires root privileges. 

 It is recommended that you setup a dedicated account for Hobbit. 

 Communications between the Hobbit server and Hobbit clients use the
 Big Brother TCP port 1984. If the Hobbit server is located behind a
 firewall, it must allow for inbound connections to the Hobbit server
 on tcp port 1984. Normally, Hobbit clients - i.e. the servers you
 are monitoring - must be permitted to connect to the Hobbit server
 on this port. However, if that is not possible due to firewall
 policies, then Hobbit includes the \emph{hobbitfetch(8)} and
 \emph{msgcache(8)} tools to allows for a pull-style way of
 collecting data, where it is the Hobbit server that initiates
 connections to the clients. 


 The Hobbit webpages are dynamically generated through CGI programs. 


 Access to the Hobbit webpages is controlled through your webserver
 access controls, e.g. you can require a login through some form of
 HTTP authentication. 

 
\section{DEMONSTRATION SITE}
 A site running this software can be seen at \url{http://www.hswn.dk/hobbit/}

 
\section{PREREQUISITES}

 You will need a Unix-like system (Linux, Solaris, HP-UX, AIX,
 FreeBSD, Mac OS X or similar) with a webserver installed. You will
 also need a C compiler and some additional libraries, but many
 systems come with the required development tools and libraries
 pre-installed. The required libraries are: 


\begin{enumerate}

 \item \textbf{RRDtool}
 This library is used to store and present trend-data. It is required. 

 \item \textbf{libpcre}
 This library is used for advanced pattern-matching of text strings in
 configuration files. This library is required. 

 \item \textbf{OpenSSL}
 This library is used for communication with SSL-enabled network
 services. Although optional, it is recommended that you install this
 for Hobbit since many network tests do use SSL. 

 \item \textbf{OpenLDAP}
 This library is used for testing LDAP servers. Use of this is optional. 

\end{enumerate}

\section{INSTALLATION}
  For more detailed information about Hobbit system requirements and
  how to install Hobbit, refer to the online documentation
  ``Installing Hobbit'' available from the Hobbit webserver (via the
  ``Help'' menu), or from the ``docs/install.html'' file in the Hobbit
  source archive. 


\section{SUPPORT and MAILING LISTS}
hobbit@hswn.dk is an open mailing list for discussions about
Hobbit. If you would like to participate, send an e-mail to
\textbf{hobbit-subscribe@hswn.dk} to join the list. 


An archive of the mailing list is available at \url{http://www.hswn.dk/hobbiton/}


If you just want to be notified of new releases of Hobbit, please
subscribe to the hobbit-announce mailing list. This is a moderated
list, used only for announcing new Hobbit releases. To be added to
the list, send an e-mail to \textbf{hobbit-announce-subscribe@hswn.dk}. 

\section{Hobbit Wiki Book}

~\cite{wikibook:wikibooktjyang} System Monitoring with Hobbit wiki book.

It is a community effort for hobbit documentation.

\begin{enumerate}

\item User Guide  \url{http://en.wikibooks.org/wiki/System_Monitoring_with_Hobbit/User_Guide}

\item User Guide Administration Guide
  \url{http://en.wikibooks.org/wiki/System_Monitoring_with_Hobbit/Administration_Guide}

\item Developer Guide \url{http://en.wikibooks.org/wiki/System_Monitoring_with_Hobbit/Developer_Guide}

\item Other Docs
\url{http://en.wikibooks.org/wiki/System_Monitoring_with_Hobbit/Other_Docs}

\end{enumerate}

\section{HOBBIT SERVER DAEMONS}
 These daemons implement the core functionality of the Hobbit server: 

\begin{enumerate}

 \item \emph{hobbitd(8)} is the core daemon that collects all reports about
 the status of your hosts. It uses a number of helper modules to
 implement certain tasks such as updating logfiles and sending out
 alerts: hobbitd\_client, hobbitd\_history, hobbitd\_alert and
 hobbitd\_rrd. There is also a hobbitd\_filestore module for
 compatibility with Big Brother. 



 \item \emph{hobbitd\_channel(8)}
 Implements the communication between the Hobbit daemon and the other Hobbit server modules. 


 \item \emph{hobbitd\_history(8)}
 Stores historical data about the things that Hobbit monitors. 


 \item \emph{hobbitd\_rrd(8)}
 Stores trend data, which is used to generate graphs of the data monitored by Hobbit. 


 \item \emph{hobbitd\_alert(8)}
 handles alerts. When a status changes to a critical state, this module decides if an alert should be sent out, and to whom. 


 \item \emph{hobbitd\_client(8)}
 handles data collected by the Hobbit clients, analyzes the data and feeds back several status updates to Hobbit to build the view of the client status. 


 \item \emph{hobbitd\_hostdata(8)}
 stores historical client data when something breaks. E.g. when a
 webpage stops responding hobbitd\_hostdata will save the latest
 client data, so that you can use this to view a snapshot of how the
 system state was just prior to it failing. 


\end{enumerate}
 
\section{HOBBIT NETWORK TEST TOOLS}

These tools are used on servers that execute tests of network
services. 

\begin{enumerate}

 \item \emph{hobbitping(1)}
 performs network connectivity (ping) tests. 


 \item \emph{bbtest-net(1)}
 runs the network service tests. 


 \item \emph{bbretest-net.sh(1)} is an extension script for re-doing failed
 network tests with a higher frequency than the normal network
 tests. This allows Hobbit to pick up the recovery of a network
 service as soon as it happens, resulting in less downtime being
 recorded. 

\end{enumerate}



 
\section{HOBBIT TOOLS HANDLING THE WEB USER-INTERFACE}
 These tools take care of generating and updating the various Hobbit web-pages. 

\begin{enumerate}
 \item \emph{bbgen(1)}
 takes care of updating the Hobbit webpages. 


 \item \emph{hobbitsvc.cgi(1)}
 This CGI program generates an HTML view of a single status log. It is used to present the Hobbit status-logs. 


 \item \emph{hobbitgraph.cgi(1)}
 This CGI program generates graphs of the trend-data collected by Hobbit. 


 \item \emph{hobbit-hostgraphs.cgi(1)}
 When you want to combine multiple graphs into one, this CGI lets you
 combine graphs so you can e.g. compare the load on all of the nodes
 in your server farm. 



 \item \emph{hobbit-nkview.cgi(1)}
 Generates the Critical Systems view, based on the currently critical
 systems and the configuration of what systems and services you want
 to monitor when. 



 \item \emph{bb-hist.cgi(1)}
 This CGI program generates a webpage with the most recent history of
 a particular host+service combination. 



 \item \emph{bb-eventlog.cgi(1)}
 This CGI lets you view a log of events that have happened over a
 period of time, for a single host or test, or for multiple systems. 



 \item \emph{bb-ack.cgi(1)}
 This CGI program allows a user to acknowledge an alert he received
 from Hobbit about a host that is in a critical state. Acknowledging
 an alert serves two purposes: First, it stops more alerts from being
 sent so the technicians are not bothered wit more alerts, and
 secondly it provides feedback to those looking at the Hobbit webpages
 that the problem is being handled. 



 \item \emph{hobbit-mailack(8)}
 is a tool for processing acknowledgements sent via e-mail, e.g. as a response to an e-mail alert. 


 \item \emph{hobbit-enadis.cgi(8)}
 is a CGI program to disable or re-enable hosts or individual
 tests. When disabling a host or test, you stop alarms from being sent
 and also any outages do not affect the SLA calculations. So this tool
 is useful when systems are being brought down for maintenance. 



 \item \emph{bb-findhost.cgi(1)}
 is a CGI program that finds a given host in the Hobbit webpages. As
 your Hobbit installation grows, it can become difficult to remember
 exactly which page a host is on; this CGI script lets you find hosts
 easily. 



 \item \emph{bb-rep.cgi(1)} This CGI program triggers the generation of Hobbit availability reports, using \emph{bbgen(1)}
 as the reporting back-end engine. 


 \item \emph{bb-replog.cgi(1)} This CGI program generates the detailed availability report for a particular host+service combination. 


 \item \emph{bb-snapshot.cgi(1)} is a CGI program to build the Hobbit
 webpages in a ``snapshot'' mode, showing the look of the webpages at
 a particular point in time. It uses \emph{bbgen(1)} as the back-end
 engine. 



 \item \emph{hobbit-statusreport.cgi(1)} is a CGI program reporting test
 results for a single status but for several hosts. It is used to
 e.g. see which SSL certificates are about to expire, across all of
 the Hobbit webpages. 



 \item \emph{bb-csvinfo.cgi(1)}
 is a CGI program to present information about a host. The information
 is pulled from a CSV (Comma Separated Values) file, which is easily
 exported from any spreadsheet or database program. 

\end{enumerate}

 
 
\section{CLIENT-SIDE TOOLS}
\begin{enumerate}

 \item \emph{logfetch(1)}
 is a utility used by the Hobbit Unix client to collect information
 from logfiles on the client. It can also monitor various other
 file-related data, e.g. file metadata or directory sizes. 

 \item \emph{clientupdate(1)}
 Is used on Hobbit clients, to automatically update the client
 software with new versions. Through this tool, updates of the client
 software can happen without an administrator having to logon to the
 server. 

 \item \emph{msgcache(8)}
 This tool acts as a mini Hobbit server to the client. It stores
 client data internally, so that the \emph{hobbitfetch(8)} utility can
 pick it up later and send it to the Hobbit server. It is typically
 used on hosts that cannot contact the Hobbit server directly due to
 network- or firewall-restrictions. 

\end{enumerate}

\section{HOBBIT COMMUNICATION TOOLS}

 These tools are used for communications between the Hobbit server and
 the Hobbit clients. If there are no firewalls then they are not
 needed, but it may be necessary due to network or firewall issues to
 make use of them. 

\begin{enumerate}
\item \emph{bbproxy(8)}
 is a proxy-server that forwards Hobbit messages between clients and
 the Hobbit server. The clients must be able to talk to the proxy, and
 the proxy must be able to talk to the Hobbit server. 



\item \emph{hobbitfetch(8)}
 is used when the client is not able to make outbound connections to
 neither bbproxy nor the Hobbit server (typically, for clients located
 in a DMZ network zone). Together with the \emph{msgcache(8)} utility
 running on the client, the Hobbit server can contact the clients and
 pick up their data. 

\end{enumerate}
 
\section{OTHER TOOLS}

\begin{enumerate}

\item \emph{hobbitlaunch(8)}
 is a program scheduler for Hobbit. It acts as a master program for
 running all of the Hobbit tools on a system. On the Hobbit server, it
 controls running all of the server tasks. On a Hobbit client, it
 periodically launches the client to collect data and send them to the
 Hobbit server. 


\item  \emph{bb(1)}
 is the tool used to communicate with the Hobbit server. It is used to
 send status reports to the Hobbit server, through the custom
 Hobbit/BB protocol, or via HTTP. It can be used to query the state of
 tests on the central Hobbit server and retrieve Hobbit configuration
 files. The server-side script \emph{bbmessage.cgi(1) } used to
 receive messages sent via HTTP is also included. 


\item  \emph{bbcmd(1)}
 is a wrapper for the other Hobbit tools which sets up all of the
 environment variables used by Hobbit tools. 



\item  \emph{bbhostgrep(1)}
 is a utility for use by Hobbit extension scripts. It allows an
 extension script to easily pick out the hosts that are relevant to a
 script, so it need not parse a huge bb-hosts file with lots of
 unwanted test-specifications. 



\item  \emph{bbhostshow(1)}
 is a utility to dump the full \emph{bb-hosts(5)}
 file following any ``include'' statements. 


\item  \emph{bbdigest(1)}
 is a utility to compute message digest values for use in content checks that use digests. 


\item  \emph{bbcombotest(1)}
 is an extension script for the Hobbit server, allowing you to build
 complicated tests from simpler Hobbit test results. E.g. you can
 define a test that uses the results from testing your webserver,
 database server and router to have a single test showing the
 availability of your enterprise web application. 



\item  \emph{trimhistory(8)}
 is a tool to trim the Hobbit history logs. It will remove all log
 entries and optionally also the individual status-logs for events
 that happened before a given time. 

\end{enumerate}

\section{VERSIONS}

\begin{enumerate}

 \item \emph{Version 1} of bbgen was relased in November 2002, and optimized the
 webpage generation on Big Brother servers. 

 \item \emph{Version 2} of bbgen was released in April 2003, and added a tool for performing network tests. 

 \item \emph{Version 3} of bbgen was released in September 2004, and eliminated
 the use of several external libraries for network tests, resulting
 in a significant performance improvement. 

 \item \emph{Version 4.0 }released on March 30 2005, the project was
 de-coupled from Big Brother, and the name changed to Hobbit. This
 version was the first full implementation of the Hobbit server, but
 it still used the data collected by Big Brother clients for
 monitoring host metrics. 

 \item \emph{Version 4.1} was released in July 2005 included a simple Hobbit client for Unix. Logfile monitoring was not implemented. 


 \item \emph{Version 4.2} was released in July 2006, and includes a fully functional Hobbit client for Unix. 

\end{enumerate}
 
 
\section{COPYRIGHT}

Hobbit is Copyright(C)2002-2007,HenrikStorner$<$henrik@storner.dk$>$   
Parts of the Hobbit sources are from public-domain or other freely available
sources. These are the the Red-Black tree implementation, and the
MD5-, SHA1-, SHA2- and RIPEMD160-implementations. Details of the
license for these is in the README file included with the Hobbit
sources. All other files are released under the GNU General Public
License version 2, with the additional exemption that compiling,
linking, and/or using OpenSSL is allowed. See the file COPYING for
details. 


 

\section{SEE ALSO}

\begin{enumerate}
\item hobbitd(8) 
\item hobbitd\_channel(8) 
\item hobbitd\_history(8) 
\item hobbitd\_rrd(8)
\item hobbitd\_alert(8)
\item hobbitd\_client(8)
\item hobbitd\_hostdata(8)
\item hobbitping(1)
\item bbtest-net(1)
\item bbretest-net.sh(1)
\item bbgen(1)
\item hobbitsvc.cgi(1)
\item hobbitgraph.cgi(1)
\item hobbit-hostgraphs.cgi(1)
\item hobbit-nkview.cgi(1)
\item bb-hist.cgi(1)
\item bb-eventlog.cgi(1)
\item bb-ack.cgi(1)
\item hobbit-mailack(8)
\item hobbit-enadis.cgi(8)
\item bb-findhost.cgi(1)
\item bb-rep.cgi(1)
\item bb-replog.cgi(1)
\item bb-snapshot.cgi(1)
\item hobbit-statusreport.cgi(1)
\item bb-csvinfo.cgi(1)
\item logfetch(1)
\item clientupdate(1)
\item msgcache(8)
\item bbproxy(8)
\item hobbitfetch(8)
\item hobbitlaunch(8)
\item bb(1)
\item bbmessage.cgi(1)
\item bbcmd(1)
\item bbhostgrep(1)
\item bbhostshow(1)
\item bbdigest(1)
\item bbcombotest(1)
\item trimhistory(8)
\item bb-hosts(5)
\item hobbitlaunch.cfg(5)
\item hobbitserver.cfg(5)
\item hobbit-alerts.cfg(5)
\item hobbit-clients.cfg(5)
\item client-local.cfg(5) 
\end{enumerate}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Server Configuration files}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\newpage
\section{ hobbitserver.cfg - Hobbit environment variables }
 
\subsection{DESCRIPTION}
 Hobbit programs use multiple environment variables beside the normal set of variables. The environment definitions are stored in the ~hobbit/server/etc/hobbitserver.cfg file. Each line in this file is of the form \textbf{NAME=VALUE}
 and defines one environment variable NAME with the value VALUE. 

 
\subsection{ENVIRONMENT AREAS}
 In some cases it may be useful to have different values for an environment variable, depending on where it is used. This is possible by defining variables with an associated ``area''. Such definitions have the form \textbf{AREA/NAME=VALUE}
. 

  E.g. to define a special setup of the BBDISPLAY variable when it is used by an application in the ``management'' area, you would do this: \begin{description}
\item[]\begin{verbatim}

  BBDISP="127.0.0.1"            # Default definition
  management/BBDISP="10.1.0.5"  # Definition in the "management" area

\end{verbatim}


\end{description}



  Areas are invoked by using the ``--area'' option for all tools, or via the ENVAREA setting in the \emph{hobbitlaunch.cfg(5)}
 file. 


 
\subsection{GENERAL SETTINGS}


 \begin{description}
\item[BBSERVERHOSTNAME] The fully-qualified hostname of the server that is running Hobbit. 

 

\item[BBSERVERWWWNAME] The hostname used to access this servers' web-pages, used to construct URL's in the Hobbit webpages. Default is the BBSERVERHOSTNAME. 

 

\item[BBSERVERIP] The public IP-address of the server that is running Hobbit. 

 

\item[BBSERVEROS] A name identifying the operating system of the Hobbit server. The known names are currently ``linux'', ``freebsd'', ``solaris'', ``hpux'', ``aix'' and ``osf''. 

 

\item[FQDN] If set to TRUE, Hobbit will use fully-qualified hostnames throughout. If set to FALSE, hostnames are stripped of their domain-part before being processed. It is \textbf{highly recommended}
 that you keep this set to TRUE. Default: TRUE. 

 

\item[BBLOGSTATUS] Controls how the HTML page for a status log is generated. If set to DYNAMIC, the HTML logs are generated on-demand by the \emph{bb-hostsvc.cgi(1)}
 script. If set to STATIC, you must activate the \emph{hobbitd\_filestore(8)}
 module (through an entry in the \emph{hobbitlaunch.cfg(5)}
 file) to create and store the HTML logs whenever a status update is received. Setting ``BBLOGSTATUS=STATIC'' is \textbf{discouraged}
 since the I/O load on the Hobbit server will increase significantly. 

 

\item[PINGCOLUMN] Defines the name of the column for ``ping'' test status. The data from the ``ping'' test is used internally by Hobbit, so it must be defined here so all of the Hobbit tools know which column to watch for this data. The default setting is PINGCOLUMN=conn. 

 

\item[INFOCOLUMN] Defines the name of the column for the ``info'' pages. 

 

\item[TRENDSCOLUMN] Defines the name of the column for the RRD graph pages. 

 

\item[RRDHEIGHT] The default height (in pixels) of the RRD graph images. Default: 120 pixels. 

 

\item[RRDWIDTH] The default width (in pixels) of the RRD graph images. Default: 576 pixels. 

 

\item[TRENDSECONDS] The graphs on the ``trends'' page show data for the past TRENDSECONDS seconds. Default: 172800 seconds, i.e. 48 hours. 

 

\item[HTMLCONTENTTYPE] The Content-type reported by the CGI scripts that generate web pages. By default, this it ``text/html''. If you have on-line help texts in character sets other than the ISO-8859-1 (western european) character set, it may be necessary to modify this to include a character set. E.g.  
 
HTMLCONTENTTYPE=''text/html;charset=euc-jp''  
 for a Japanese character sets. Note: Some webservers will automatically add this, if configured to do so. 

 

\item[HOLIDAYS] Defines the default set of holidays used if there is no ``holidays'' tag for a host in the bb-hosts file. Holiday sets are defined in the \emph{hobbit-holidays.cfg(5)}
 file. If not defined, only the default holidays (those defined outside a named holiday set) will be considered as holidays. 

 

\item[WEEKSTART] Defines which day is the first day of the week. Set to ``0'' for Sunday, ``1'' for Monday. Default: 1 (Monday). 

 


 


\end{description}

\subsection{DIRECTORIES}


 \begin{description}
\item[BBSERVERROOT] The top-level directory for the Hobbit installation. The default is the home-directory for the user running Hobbit. 

 

\item[BBSERVERLOGS] The directory for the Hobbit's own logfiles (NOT the status-logs from the monitored hosts). 

 

\item[BBHOME] The Hobbit server directory, where programs and configurations are kept. Default: \$BBSERVERROOT/server/ . 

 

\item[BBTMP] Directory used for temporary files. Default: \$BBHOME/tmp/ 

 

\item[BBWWW] Directory for Hobbit webfiles. The \$BBWEB URL must map to this directory. Default: \$BBHOME/www/ 

 

\item[BBNOTES] Directory for Hobbit notes-files. The \$BBNOTESSKIN URL must map to this directory. Default: \$BBHOME/www/notes/ 

 

\item[BBREP] Directory for Hobbit availability reports. The \$BBREPURL URL must map to this directory. Note also that your webserver must have write-access to this directory, if you want to use the \emph{bb-rep.cgi(1)}
 CGI script to generate reports on-demand. Default: \$BBHOME/www/rep/ 

 

\item[BBSNAP] Directory for Hobbit snapshots. The \$BBSNAPURL URL must map to this directory. Note also that your webserver must have write-access to this directory, if you want to use the \emph{bb-snapshot.cgi(1)}
 CGI script to generate snapshots on-demand. Default: \$BBHOME/www/snap/ 

 

\item[BBVAR] Directory for all data stored about the monitored items. Default: \$BBSERVERROOT/data/ 

 

\item[BBLOGS] Directory for storing the raw status-logs. Not used unless ``hobbitd\_filestore --status'' is running, which is \textbf{discouraged}
 since it increases the load on the Hobbit server significantly. Default: \$BBVAR/logs/ 

 

\item[BBHTML] Directory for storing HTML status-logs. Not used unless ``hobbitd\_filestore --status --html'' is running, which is \textbf{discouraged}
 since it increases the load on the Hobbit server significantly. Default: \$BBHOME/www/html/ 

 

\item[BBHIST] Directory for storing the history of monitored items. Default: \$BBVAR/hist/ 

 

\item[BBHISTLOGS] Directory for storing the detailed status-log of historical events. Default: \$BBVAR/histlogs/ 

 

\item[BBACKS] Directory for storing information about alerts that have been acknowledged. Default: \$BBVAR/acks/ 

 

\item[BBDISABLED] Directory for storing information about tests that have been disabled. Default: \$BBVAR/disabled/ 

 

\item[BBDATA] Directory for storing incoming ``data'' messages. Default: \$BBVAR/data/ 

 

\item[BBRRDS] Top-level directory for storing RRD files (the databases with trend-information used to generate graphs). Default: \$BBVAR/rrd/ 

 

\item[CLIENTLOGS] Directory for storing the data sent by a Hobbit client around the time a status changes to a warning (yellow) or critical (red) state. Used by the \emph{hobbitd\_hostdata(8)}
 module. Default: \$BBVAR/hostdata/ 

 


 


\end{description}

\subsection{SYSTEM FILES}


 \begin{description}
\item[BBHOSTS] Full path to the Hobbit \emph{bb-hosts(5)}
 configuration file. Default: \$BBHOME/etc/bb-hosts. 

 

\item[BB] Full path to the \emph{bb(1)}
 client program. Default: \$BBHOME/bin/bb. 

 

\item[BBGEN] Full path to the \emph{bbgen(1)}
 webpage generator program. Default: \$BBHOME/bin/bbgen. 

 


 


\end{description}

\subsection{URLS}
\begin{description}
\item[BBSERVERWWWURL] The root URL for the Hobbit webpages, without the hostname. This URL must be mapped to the ~/server/www/ directory in your webserver configuration. See the sample Apache configuration in ~/server/etc/hobbit-apache.conf. 

 

\item[BBSERVERCGIURL] The root URL for the Hobbit CGI-scripts, without the hostname. This directory must be mapped to the ~/cgi-bin/ directory in your webserver configuration, and must be flagged as holding executable scripts. See the sample Apache configuration in ~/server/etc/hobbit-apache.conf. 

 

\item[BBWEBHOST] Initial part of the Hobbit URL, including just the protocol and the hostname, e.g. ``\url{http://www.foo.com}`` 

 

\item[BBWEBHOSTURL] Prefix for all of the static Hobbit webpages, e.g. ``\url{http://www.foo.com/hobbit}`` 

 

\item[BBWEBHTMLLOGS] URL prefix for the static HTML status-logs generated when BBLOGSTATUS=STATIC. Note that this setting is \textbf{discouraged}
 so this setting should not be used. 

 

\item[BBWEB] URL prefix (without hostname) of the Hobbit webpages. E.g. ``/hobbit''. 

 

\item[BBSKIN] URL prefix (without hostname) of the Hobbit graphics. E.g. ``/hobbit/gifs''. 

 

\item[BBHELPSKIN] URL prefix (without hostname) of the Hobbit on-line help files. E.g ``/hobbit/help''. 

 

\item[BBMENUSKIN] URL prefix (without hostname) of the Hobbit menu files. E.g ``/hobbit/menu''. 

 

\item[BBNOTESSKIN] URL prefix (without hostname) of the Hobbit on-line notes files. E.g ``/hobbit/notes''. 

 

\item[BBREPURL] URL prefix (without hostname) of the Hobbit availability reports. E.g. ``/hobbit/rep''. 

 

\item[BBSNAPURL] URL prefix (without hostname) of the Hobbit snapshots. E.g. ``/hobbit/snap''. 

 

\item[BBWAP] URL prefix (without hostname) of the Hobbit WAP/WML files. E.g. ``/hobbit/wml''. 

 

\item[CGIBINURL] URL prefix (without hostname) of the Hobbit CGI-scripts. Default: \$BBSERVERCGIURL . 

 

\item[COLUMNDOCURL] Format string used to build a link to the documentation for a column heading. Default: ``\$CGIBINURL/hobbitcolumn.sh?\%s'', which causes links to use the \emph{hobbitcolumn.sh(1)}
 script to document a column. 

 


 


\end{description}
\subsection{SETTINGS FOR SENDING MESSAGES TO HOBBIT}
\begin{description}
\item[BBDISP] The IP-address used to contact the \emph{hobbitd(8)}
 service. Used by clients and the tools that perform network tests. Default: \$BBSERVERIP 

 

\item[BBDISPLAYS] List of IP-adresses. Clients and network test tools will try to send status reports to a Hobbit server running on each of these adresses. This setting is only used if BBDISP=0.0.0.0. 

 

\item[PAGELEVELS] Compatibility setting for Big Brother: List of colors that are considered ``critical'' and therefore will trigger an alert. Not used by Hobbit. 

 

\item[BBPAGE] Compatibility setting for Big Brother: This is the IP-address of the server where a BBPAGER service is running. It is not used by Hobbit. 

 

\item[BBPAGERS] Compatibility setting for Big Brother: List of servers running the BBPAGER service, used if BBPAGE=0.0.0.0. It is not used by Hobbit. 

 

\item[BBPORT] The portnumber for used to contact the \emph{hobbitd(8)}
 service. Used by clients and the tools that perform network tests. Default: 1984. 

 

\item[DOCOMBO] Compatibility setting for Big Brother. Controls whether so send combo-messages or not. Ignored by Hobbit. 

 

\item[BBMAXMSGSPERCOMBO] The maximum number of status messages to combine into one combo message. You may need to lower this number of your BBDISPLAY server has trouble keeping up with the incoming status messages from bbtest-net. Default: 100. 

 

\item[BBSLEEPBETWEENMSGS] Length of a pause introduced between each successive transmission of a combo-message by bbtest-net. You may have to increase this value to give your BBDISPLAY server time to process one combo message before the next one arrives. This number defines how many microseconds to wait between the messages. Default: 0 (send messages as quickly as possible). 

 


 


\end{description}
\subsection{HOBBITD SETTINGS}


 \begin{description}
\item[ALERTCOLORS] Comma-separated list of the colors that may trigger an alert-message. The default is ``red,yellow,purple''. Note that alerts may further be generated or suppresed based on the configuration in the \emph{hobbit-alerts.cfg(5)}
 file. 

 

\item[OKCOLORS] Comma-separated list of the colors that may trigger a recovery-message. The default is ``green,clear,blue''. 

 

\item[ALERTREPEAT] How often alerts get repeated while a status is in an alert state. This is the default setting, which may be changed in the \emph{hobbit-alerts.cfg(5)}
 file. 

 

\item[BBGHOSTS] Controls how status messages from unknown hosts (i.e. hosts not listed in the bb-hosts file) are handled. 

 \textbf{BBGHOSTS=1:}
 Causes the status report to be silently discarded. This is the default behaviour in Hobbit. 


 \textbf{BBGHOSTS=2:}
 Discards the status report, but keep track of the hostname and report it on the hobbitd status page. 


  When BBGHOSTS is set to 1 or 2, the hostnames in incoming status-messages is matched without any case-sensitivity, unlike normal Big Brother which is case-sensitive in hostnames. So with BBGHOSTS set to 1 or 2, ``WWW.FOO.COM'' and ``www.foo.com`` are considered to be the same host. If necessary, the incoming hostname will be changed to match the way it is written in the bb-hosts file, changing case as needed. 


 

\item[MAXMSG\_STATUS] The maximum size of a ``status'' message in kB, default: 256. Status messages are the ones that end up as columns on the web display. The default size should be adequate in most cases, but some extension scripts can generate very large status messages - close to 1024 kB. You should only change this if you see messages in the hobbitd log file about status messages being truncated. 

 

\item[MAXMSG\_CLIENT] The maximum size of a ``client'' message in kB, default: 512. ``client'' messages are generated by the Hobbit client, and often include large process-listings. You should only change this if you see messages in the hobbitd log file about client messages being truncated. 

 

\item[MAXMSG\_DATA] The maximum size of a ``data'' message in kB, default: 256. ``data'' messages are typically used for client reports of e.g. netstat or vmstat data. You should only change this setting if you see messages in the hobbitd log file about data messages being truncated. 

 

\item[MAXMSG\_NOTES] The maximum size of a ``notes'' message in kB, default: 256. ``notes'' messages provide a way for uploading documentation about a host to Hobbit; it is not enabled by default. If you want to upload large documents, you may need to change this setting. 

 

\item[MAXMSG\_STACHG] The maximum size of a ``status change'' message in kB, default: Current value of the MAXMSG\_STATUS setting. Status-change messages occur when a status changes color. There is no reason to change this setting. 

 

\item[MAXMSG\_PAGE] The maximum size of a ``page'' message in kB, default: Current value of the MAXMSG\_STATUS setting. ``page'' messages are alerts, and include the status message that triggers the alert. There is no reason to change this setting. 

 

\item[MAXMSG\_ENADIS] The maximum size of an ``enadis'' message in kB, default: 32. ``enadis'' are small messages used when enabling or disabling hosts and tests, so the default size should be adequate. 

 

\item[MAXMSG\_CLICHG] The maximum size of a ``client change'' message in kB, default: Current value of the MAXMSG\_CLIENT setting. Client-change messages occur when a status changes color to one of the alert-colors, usually red, yellow and purple. There is no reason to change this setting. 

 


 


\end{description}

\subsection{HOBBITD\_HISTORY SETTINGS}


 \begin{description}
\item[BBALLHISTLOG] If set to TRUE, \emph{hobbitd\_history(8)}
 will update the \$BBHIST/allevents file logging all changes to a status. The allevents file is used by the \emph{bb-eventlog.cgi(1)}
 tool to show the list of recent events on the BB2 webpage. 

 

\item[BBHOSTHISTLOG] If set to TRUE, \emph{hobbitd\_history(8)}
 will update the host-specific eventlog that keeps record of all status changes for a host. This logfile is not used by any Hobbit tool. 

 

\item[SAVESTATUSLOG] If set to TRUE, \emph{hobbitd\_history(8)}
 will save historical detailed status-logs to the \$BBHISTLOGS directory. 

 


 


\end{description}

\subsection{HOBBITD\_ALERT SETTINGS}


 \begin{description}
\item[MAIL] Command used to send alerts via e-mail, including a ``Subject:'' header in the mail. Default: ``mail -s'' 

 

\item[MAILC] Command used to send alerts via e-mail in a form that does not have a ``Subject'' in the mail. Default: ``mail'' 

 

\item[SVCCODES] Maps status-columns to numeric service-codes. The numeric codes are used when sending an alert using a script, where the numeric code of the service is provided in the BBSVCNUM variable. 

 


 


\end{description}

\subsection{HOBBITD\_RRD SETTINGS}


 \begin{description}
\item[TEST2RRD] List of ``COLUMNNAME[=RRDSERVICE]'' settings, that define which status- and data-messages have a corresponding RRD graph. You will normally not need to modify this, unless you have added a custom TCP-based test to the bb-services file, and want to collect data about the response-time, OR if you are using the \emph{hobbitd\_rrd(8)}
 external script mechanism to collect data from custom tests. Note: All TCP tests are automatically added. 

  This is also used by the \emph{bb-hostsvc.cgi(1) }
 script to determine if the detailed status view of a test should include a graph. 


 

\item[GRAPHS] List of the RRD databases, that should be shown as a graph on the ``trends'' column. 

 

\item[NORRDDISKS] This is used to disable the tracking of certain filesystems. By default all filesystems reported by a client are tracked. In some cases you may want to disable this for certain filesystems, e.g. database filesystems since they are always completely full. This setting is a regular expression that is matched against the filesystem name (the Unix mount-point, or the Windows disk-letter) - if the filesystem name matches this expression, then it will not be tracked by Hobbit.  
 Note: Setting this does not affect filesystems that are already being tracked by Hobbit - to remove them, you must remove the RRD files for the unwanted filesystems from the ~hobbit/data/rrd/HOSTNAME/ directory. 

 

\item[RRDDISKS] This is used to enable tracking of only selected filesystems (see the NORRDDISKS setting above). By default all filesystems are being tracked, setting this changes that default so that only those filesystems that match this pattern will be tracked. 

 


 


\end{description}

\subsection{BBTEST-NET NETWORK TEST SETTINGS}


 \begin{description}
\item[BBLOCATION] If this variable is defined, then only the hosts that have been tagged with ``NET:\$BBLOCATION'' will be tested by the bbtest-net tool. 

 

\item[CONNTEST] If set to TRUE, the connectivity (ping) test will be performed. 

 

\item[IPTEST\_2\_CLEAR\_ON\_FAILED\_CONN] If set to TRUE, then failing network tests go CLEAR if the conn-test fails. 

 

\item[NONETPAGE] List of network services (separated with $<$space$>$) that should go yellow upon failure instead of red. 

 

\item[BBROUTERTEXT] When using the ``router'' or ``depends'' tags for a host, a failure status will include text that an ``Intermediate router is down''. With todays network topologies, the router could be a switch or another network device; if you define this environment variable the word ``router'' will be replaced with whatever you put into the variable. So to inform the users that an intermediate switch or router is down, use BBROUTERTEXT=''switch or router''. This can also be set on a per-host basis using the ``DESCR:hosttype:description'' tag in the \emph{bb-hosts(5)}
 file. 

 

\item[NETFAILTEXT] When a network test fails, the status message reports ``SERVICENAME not OK''. The ``not OK'' message can be changed via this variable, e.g. you can change it to ``FAILED'' or customize it as you like. 

 

\item[FPING] The command used to run the \emph{hobbitping(1)}
 tool for the connectivity test. (The name FPING is due to the fact that the ``fping'' utility was used until Hobbit version 4.2). This may include suid-root wrappers and hobbitping options. Default: ``hobbitping'' 

 

\item[TRACEROUTE] Defines the location of the ``traceroute'' tool and any options needed to run it. traceroute it used by the connectivity test when the ping test fails; if requested via the ``trace'' tag, the TRACEROUTE command is executed to try to determine the point in the network that is causing the problem. By default the command executed is ``traceroute -n -q 2 -w 2 -m 15'' (no DNS lookup, max. 2 probes, wait 2 seconds per hop, max 15 hops). 

  If you have the \emph{mtr(8)}
 tool installed - available from \url{http://www.bitwizard.nl/mtr/} - I strongly recommend using this instead. The recommended setting for mtr is ``/usr/sbin/mtr -c 2 -n --report'' (the exact path to the mtr utility may be different on your system). Note that mtr needs to be installed suid-root on most systems. 


 

\item[NTPDATE] Defines the \emph{ntpdate(1)}
 program used for the ``ntp'' test. Default: ``ntpdate'' 

 

\item[RPCINFO] Defines the \emph{rpcinfo(8)}
 program used for ``rpc'' tests. Default: ``rpcinfo'' 

 


 


\end{description}

\subsection{BBGEN WEBPAGE GENERATOR SETTINGS}


 \begin{description}
\item[HOBBITLOGO] HTML code that is inserted on all standard headers. The default is to add the text ``Hobbit'' in the upper-left corner of the page, but you can easily replace this with e.g. a company logo. If you do, I suggest that you keep it at about 30-35 pixels high, and 100-150 pixels wide. 

 

\item[MKBBLOCAL] The string ``Pages hosted locally'' that appears above all of the pages linked from the main Hobbit webpage. 

 

\item[MKBBSUBLOCAL] The string ``Subpages hosted locally'' that appears above all of the sub-pages linked from pages below the main Hobbit webpage. 

 

\item[MKBBREMOTE] The string ``Remote status display'' that appears about the summary statuses displayed on the min Hobbit webpage. 

 

\item[MKBBTITLE] HTML tags designed to go in a $<$FONT$>$ tag, to choose the font for titles of the webpages. 

 

\item[MKBBROWFONT] HTML tags designed to go in a $<$FONT$>$ tag, to choose the font for row headings (hostnames) on the webpages. 

 

\item[MKBBCOLFONT] HTML tags designed to go in a $<$FONT$>$ tag, to chose the font for column headings (test names) on the webpages. 

 

\item[MKBBACKFONT] HTML tags designed to go in a $<$FONT$>$ tag, to chose the font for the acknowledgement text displayed on the status-log HTML page for an acknowledged status. 

 

\item[ACKUNTILMSG] When displaying the detailed status of an acknowledged test, Hobbit will include the time that the acknowledge expires using the print-format defined in this setting. You can define the timeformat using the controls in your systems \emph{strftime(3)}
 routine, and add the text suitable for your setup. 

 

\item[BBDATEFORMAT] On webpages generated by bbgen, the default header includes the current date and time. Normally this looks like ``Tue Aug 24 21:59:47 2004''. The BBDATEFORMAT controls the format of this timestamp - you can define the format using the controls in the \emph{strftime(3)}
 routine. E.g. to have it show up as ``2004-08-24 21:59:47 +0200'' you would set BBDATEFORMAT=''\%Y-\%m-\%d \%H:\%M:\%S \%z'' 

 

\item[HOLIDAYFORMAT] How holiday dates are displayed. The default is ``\%d/\%m'' which show the day and month. American users may want to change this to ``\%m/\%d'' to suit their preferred date-display style. This is a formatting string for the system \emph{strftime(3)}
 routine, so any controls available for this routine may be used. 

 

\item[MKBB2COLREPEAT] Inspired by Jeff Stoner's col\_repeat\_patch.tgz patch, this defines the maximum number of rows before repeating the column headings on a webpage. This sets the default value for the \emph{bbgen(1)}
 ``--maxrows'' option; if the command-line option is also specifed, then it overrides this environment variable. Note that unlike Jeff's patch, bbgen implements this for both the bb2.html page and all other pages (bb.html, subpages, bbnk.html). 

 

\item[SUMMARY\_SET\_BKG] If set to TRUE, then summaries will affect the color of the main Hobbit webpage. Default: FALSE. 

 

\item[DOTHEIGHT] The height (in pixels) of the icons showing the color of a status. Default: 16, which matches the default icons. 

 

\item[DOTWIDTH] The width (in pixels) of the icons showing the color of a status. Default: 16, which matches the default icons. 

 

\item[CLIENTSVCS] List of the status logs fed by data from the Hobbit client. These status logs will - if there are Hobbit client data available for the host - include a link to the raw data sent by the client. Default: cpu,disk,memory,procs,svcs. 

 

\item[BBRSSTITLE] If defined, this is the title of the RSS/RDF documents generated when \emph{bbgen(1)}
 is invoked with the ``--rss'' option. The default value is ``Hobbit Alerts''. 

 

\item[WMLMAXCHARS] Maximum size of a WAP/WML output ``card'' when generating these. Default: 1500. 

 

\item[BBMKBB2EXT] List of scripts to run as extensions to the BB2 page. Note that two scripts, ``eventlog.sh'' and ``acklog.sh'' are handled specially: They are handled internally by bbgen, but the script names must be listed in this variable for this function to be enabled. 

 

\item[BBHISTEXT] List of scripts to run as extensions to a history page. 

 

\item[BBREPWARN] Default threshold for listing the availability as ``critical'' (red) when generating the availability report. This can be set on a per-host basis with the WARNPCT setting in \emph{bb-hosts(5).}
 Default: 97 (percent) 

 

\item[BBGENREPOPTS] Default bbgen options used for reports. This will typically include such options as ``--subpagecolumns'', and also ``--ignorecolumns'' if you wish to exclude certain tests from reports by default. 

 

\item[BBGENSNAPOPTS] Default bbgen options used by snapshots. This should be identical to the options you normally used when building Hobbit webpages. 

 


\end{description}

\subsection{FILES}
\textbf{~hobbit/server/etc/hobbitserver.cfg}


 
\subsection{SEE ALSO}
hobbit(7) 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{HOBBITLAUNCH.CFG}

 hobbitlaunch.cfg - Task definitions for the hobbitlaunch utility 

 
\subsection{SYNOPSIS}
\textbf{~hobbit/server/etc/hobbitlaunch.cfg}


 
\subsection{DESCRIPTION}
 The hobbitlaunch.cfg file holds the list of tasks that hobbitlaunch
 runs to perform all of the tasks needed by the Hobbit monitor. 


 
\subsection{FILE FORMAT}
 A task is defined by a \textbf{key}
, a \textbf{command}
, and optionally also \textbf{interval}
, \textbf{environment}
, and \textbf{logfile}
. 

  Blank lines and lines starting with a hash mark (\#) are treated as
  comments and ignored. Long lines can be broken up by putting a
  backslash at the end of the line and continuing the entry on the
  next line. 



  An entry looks like this: 


  
[hobbitd]  
 
ENVFILE/usr/local/hobbit/server/etc/hobbitserver.cfg  
 
CMD/usr/local/hobbit/server/bin/hobbitd 


  
[updateweb]  
 
ENVFILE/usr/local/hobbit/server/etc/hobbitserver.cfg  
 
CMD/usr/local/hobbit/server/bin/bbgen  
 
NEEDShobbitd  
 
GROUPwebupdates  
 
INTERVAL5m  
 
LOGFILE/var/log/hobbit/updateweb.log 


  The \textbf{key} is enclosed in angle brackets, and must be unique
  for each task. You can choose your key-names as you like, they are
  only used internally in hobbitlaunch to identify each task. 



  The \textbf{command}
 is defined by the CMD keyword. This is the full command including any
 options you want to use for this task. This is required for all
 tasks. 



  The \textbf{DISABLED}
 keyword means that this command is disabled. hobbitlaunch will not
 start this task. It is recommended that you use this to disable
 standard tasks, instead of removing them or commenting them
 out. Upgrades to Hobbit will add standard tasks back into the file,
 so unless you have them listed as DISABLED then tasks may re-appear
 unexpectedly after an upgrade. 



  The \textbf{ONHOST}
 keyword tells hobbitlaunch that this task should only run on specific
 hosts. After the ONHOST keyword, you must provide a ``regular
 expression''; if the hostname where hobbitlaunch runs matches this
 expression, then the task will run. If it doesn't match, then the
 task is treated as if it were DISABLED. 



  The \textbf{NEEDS}
 instructs hobbitlaunch not to run this task unless the task defined
 by the NEEDS keyword is already running. This is used e.g. to delay
 the start of some application until the needed daemons have been
 started. The task that must be running is defined by its \textbf{key}

. 


  The \textbf{GROUP}
 keyword can be used to limit the number of tasks that may run
 simultaneously. E.g. if you are generating multiple pagesets of
 webpages, you dont want them to run at the same time. Putting them
 into a GROUP will cause hobbitlaunch to delay the start of new tasks,
 so that only one task will run per group. You can change the limit by
 defining the group before the tasks, with a ``GROUP groupname
 maxtasks'' line. 



  The \textbf{INTERVAL}
 keyword defines how often this command is executed. The example shows
 a command that runs every 5 minutes. If no interval is given, the
 task is only run once - this is useful for tasks that run continually
 as daemons - although if the task stops for some reason, then
 hobbitlaunch will attempt to restart it. Intervals can be specified
 in seconds (if you just put a number there), or in minutes (5m),
 hours (2h), or days (1d). 



  The \textbf{ENVFILE}
 setting points to a file with definitions of environment
 variables. Before running the task, hobbitlaunch will setup all of
 the environment variables listed in this file. Since this is a
 per-task setting, you can use the same hobbitlaunch instance to run
 e.g. both the server- and client-side Hobbit tasks. If this option is
 not present, then the environment defined to hobbitlaunch is used. 



  The \textbf{ENVAREA}
 setting modifies which environment variables are loaded, by picking
 up the ones that are defined for this specific ``area''. See
 \emph{hobbitserver.cfg(5)} for information about environment areas. 


  The \textbf{LOGFILE}
 setting defines a logfile for the task. hobbitlaunch will start the
 task with stdout and stderr redirected to this file. If this option
 is not present, then the output goes to the same location as the
 hobbitlaunch output. 



 
\subsection{SEE ALSO}
hobbitlaunch(8), hobbitd(8), hobbit(7) 




 
\subsection{RELATION TO BBNK PAGE}
 This view is a replacement for the statically generated ``bbnk'' page
 provided in versions of Hobbit prior to version 4.2. Although the
 ``bbnk'' pages are supported throughout Hobbit 4.x, it is recommended
 that You switch to the newer Critical Systems view provided by this
 CGI. 


 
\subsection{OPTIONS}
\begin{description}
\item[--nkacklevel=NUMBER] Sets the acknowledgment level for
  acknowledgments sent via the \emph{hobbit-ackinfo.cgi(1)} page. Note
  that this may be overridden by the configuration of the
  hobbit-ackinfo.cgi utility. 


 

\item[--env=FILENAME] Loads the environment defined in FILENAME before
  executing the CGI script. 


 

\item[--area=NAME] Load environment variables for a specific area. NB:
  if used, this option must appear before any --env=FILENAME option. 


 

\item[--debug] Enables debugging output. 

 


\end{description}
\subsection{ENVIRONMENT VARIABLES}
\begin{description}
\item[BBHOME] Used to locate the template files for the generated web pages. 

 

\item[QUERY\_STRING] Contains the parameters for the CGI script. 


\end{description}
\subsection{SEE ALSO}
hobbit-ackinfo.cgi(1), hobbit(7) 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\include{hobbitcgi.cfg.5}
\newpage
\section{HOBBITCGI.CFG}
 hobbitcgi.cfg - Command-line parameters for the Hobbit CGI tools 

 
\subsection{SYNOPSIS}
\textbf{\$BBHOME/etc/hobbitcgi.cfg}


 
\subsection{DESCRIPTION}
\emph{hobbitcgi.cfg(1)}
 controls the commandline options passed to all of the Hobbit CGI tools through their respective shell-script wrappers. Typically the options listed here are used for system-wide configuration of the CGI utilities, e.g. to define where they read configuration files. 

  The exact set of commandline options available are described in the man-page for each of the CGI utilities. 


  The file is ``sourced'' into the shell script wrapper, so assignments to the CGI-specific variables must follow standard shell-script syntax. 


 
\subsection{SETTINGS}
\begin{description}
\item[CGI\_ACKINFO\_OPTS] Options for the \emph{hobbit-ackinfo.cgi(1)}
 utility. 

 

\item[CGI\_ACK\_OPTS] Options for the \emph{bb-ack.cgi(1)}
 utility. 

 

\item[CGI\_CSVINFO\_OPTS] Options for the \emph{bb-csvinfo.cgi(1)}
 utility. 

 

\item[CGI\_DATEPAGE\_OPTS] Options for the \emph{bb-datepage.cgi(1)}
 utility. 

 

\item[CGI\_ENADIS\_OPTS] Options for the \emph{hobbit-enadis.cgi(8)}
 utility. 

 

\item[CGI\_EVENTLOG\_OPTS] Options for the \emph{bb-eventlog.cgi(1)}
 utility. 

 

\item[CGI\_FINDHOST\_OPTS] Options for the \emph{bb-findhost.cgi(1)}
 utility. 

 

\item[CGI\_HIST\_OPTS] Options for the \emph{bb-hist.cgi(1)}
 utility. 

 

\item[CGI\_HOBBITCOLUMN\_OPTS] Hobbit-specific options for column documentation. This uses the \emph{bb-csvinfo.cgi(1)}
 utility with the \textbf{server/etc/columndoc.cfg}
 configuration file. 

 

\item[CGI\_HOBBITCONFREPORT\_OPTS] Options for the \emph{hobbit-confreport.cgi(1)}
 utility. 

 

\item[CGI\_HOBBITGRAPH\_OPTS] Options for the \emph{hobbitgraph.cgi(1)}
 utility. 

 

\item[CGI\_HOSTGRAPHS\_OPTS] Options for the \emph{hobbit-hostgraphs.cgi(1)}
 utility. 

 

\item[CGI\_NKEDIT\_OPTS] Options for the \emph{hobbit-nkedit.cgi(1)}
 utility. 

 

\item[CGI\_NKVIEW\_OPTS] Options for the \emph{hobbit-nkview.cgi(1)}
 utility. 

 

\item[CGI\_REPLOG\_OPTS] Options for the \emph{bb-replog.cgi(1)}
 utility. 

 

\item[CGI\_REP\_OPTS] Options for the \emph{bb-rep.cgi(1)}
 utility. 

 

\item[CGI\_SNAPSHOT\_OPTS] Options for the \emph{bb-snapshot.cgi(1)}
 utility. 

 

\item[CGI\_SVCHIST\_OPTS] Options for the \emph{hobbitsvc.cgi(1)}
 utility when used to view historical logs. Note that the ``--historical'' option must be included in this setting. 

 

\item[CGI\_SVC\_OPTS] Options for the \emph{hobbitsvc.cgi(1)}
 utility. 

 


\end{description}
\subsection{SEE ALSO}
hobbit(7), the individual CGI utility man-pages. 




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Network Service Testing}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{BBTEST-NET}
 bbtest-net - Hobbit network test tool 

\subsection{SYNOPSIS}
\textbf{bbtest-net -?}
 
\textbf{bbtest-net --help}
 
\textbf{bbtest-net --version}
 
\textbf{bbtest-net [options]}
 
 (See the OPTIONS section for a description of the available commandline options). 

 
\subsection{DESCRIPTION}
\emph{bbtest-net(1)} handles the network tests of hosts defined in the
Hobbit configuration file, bb-hosts. It is normally run at regular
intervals by \emph{hobbitlaunch(8)} via an entry in the
\emph{hobbitlaunch.cfg(5)} file. 

 bbtest-net does all of the normal tests of TCP-based network services
 (telnet, ftp, ssh, smtp, pop, imap ....) - i.e. all of the services
 listed as BBNETSVCS in bbdef.sh. For these tests, a completely new
 and very speedy service- checker has been implemented. 



  bbtest-net has built-in support for testing SSL-enabled protocols,
  e.g. imaps, pop3s, nntps, telnets, if SSL-support was enabled when
  configuring bbgen. The full list of known tests is found in the
  \emph{bb-services(5)} file in \$BBHOME/etc/bb-services. 



  In addition, it implements the ``dns'' and ``dig'' tests for testing
  DNS servers. This is done in the same way as bb-network.sh does it. 


  bbtest-net also implements a check for NTP servers - this test is
  called ``ntp''. If you want to use it, you must define the NTPDATE
  environment variable to point at the location of your
  \emph{ntpdate(1)} program. 



  Note: bbtest-net performs the connectivity test (ping) based on the
  hostname, unless the host is tagged with ``testip'' or the
  ``--dns=ip'' option is used. So the target of the connectivity test
  can be determined by your /etc/hosts file or DNS. 



 
\subsection{GENERAL OPTIONS}


\begin{description}

\item[--timeout=N] Determines the timeout (in seconds) for each
  service that is tested. For TCP tests (those from BBNETSVCS), if the
  connection to the service does not succeed within N seconds, the
  service is reported as being down. For HTTP tests, this is the
  absolute limit for the entire request to the webserver (the time
  needed to connect to the server, plus the time it takes the server
  to respond to the request). Default: 10 seconds 



 

\item[--conntimeout=N] This option is deprecated, and will be
  ignored. Use the --timeout option instead. 


 

\item[--cmdtimeout=N] This option sets a timeout for the external
  commands used for testing of NTP and RPC services, and to perform
  traceroute. 


 

\item[--concurrency=N] Determines the number of network tests that run
  in parallel. Default is operating system dependent, but will usually
  be 256. If bbtest-net begins to complain about not being able to get
  a ``socket'', try running bbtest-net with a lower value like 50 or
  100. 


 

\item[--dns-timeout=N (default: 30 seconds)] bbtest-net will timeout
  all DNS lookups after N seconds. Any pending DNS lookups are
  regarded as failed, i.e. the network tests that depend on this DNS
  lookup will report an error.  

 Note: If you use the --no-ares option, timeout of DNS lookups cannot
 be controlled by bbtest-net. 


\item[--dns-max-all=N] Same as ``--dns-timeout=N''. The
  ``--dns-max-all'' option is deprecated and should not be used. 
 

\item[--dns=[ip|only|standard]] Determines how bbtest-net finds the IP
  adresses of the hosts to test. By default (the ``standard''),
  bbtest-net does a DNS lookup of the hostname to determine the IP
  address, unless the host has the ``testip'' tag, or the DNS lookup
  fails.  

 With ``--dns=only'' bbtest-net will ONLY do the DNS lookup; it it
 fails, then all services on that host will be reported as being down.  

 With ``--dns=ip'' bbtest-net will never do a DNS lookup; it will use
 the IP adresse specified in bb-hosts for the tests. Thus, this
 setting is equivalent to having the ``testip'' tag on all hosts. Note
 that http tests will ignore this setting and still perform a DNS
 lookup for the hostname given in the URL; see the ``bbtest-net tags
 for HTTP tests'' section in \emph{bb-hosts(5)}

\item[--no-ares] Disable the ARES resolver built into bbtest-net. This
  makes bbtest-net resolve hostnames using your system resolver
  function. You should only use this as a last resort if bbtest-net
  cannot resolve the hostnames you use in the normal way (via DNS or
  /etc/hosts). One reason for using this would be if you need to
  resolve hostnames via NIS/NIS+ (a.k.a. Yellow Pages).  

 The system resolver function does not provide a mechanism for
 controlling timeouts of the hostname lookups, so if your DNS or NIS
 server is down, bbtest-net can take a very long time to run. The
 --dns-timeout option is effectively disabled when using this option. 
 

\item[--dnslog=FILENAME] Log failed hostname lookups to the file
  FILENAME. FILENAME should be a full pathname. 

\item[--report[=COLUMNNAME]] With this option, bbtest-net will send a
  status message with details of how many hosts were processed, how
  many tests were generated, any errors that occurred during the run,
  and some timing statistics. The default columnname is ``bbtest''. 

\item[--test-untagged] When using the BBLOCATION environment variable
  to test only hosts on a particular network segment, bbtest-net will
  ignore hosts that do not have any ``NET:x'' tag. So only hosts that
  have a NET:\$BBLOCATION tag will be tested.  

 With this option, hosts with no NET: tag are included in the test, so
 that all hosts that either have a matching NET: tag, or no NET: tag
 at all are tested. 

 

\item[--frequenttestlimit=N] Used with the \emph{bbretest-net.sh(1)}
 bbgen extension. This option determines how long failed tests remain
 in the frequent-test queue. The default is 1800 seconds (30
 minutes). 


 

\item[--timelimit=N] Causes bbtest-net to generate a warning if the
  run-time of bbtest-net exceeds N seconds. By default N is set to the
  value of BBSLEEP, so a warning triggers if the network tests cannot
  complete in the time given for one cycle of the BBNET server. Apart
  from the warning, this option has no effect, i.e. it will not
  terminate bbtest-net prematurely. So to eliminate any such warnings,
  use this option with a very high value of N. 



\item[--huge=N] Warn if the response from a TCP test is more than N
  bytes. If you see from the bbtest status report that you are
  transferring large amounts of data for your tests, you can enable
  this option to see which tests have large replies.   Default: 0
  (disabled). 


 

\item[--validity=N] Make the test results valid for N minutes before
  they go purple. By default test results are valid for 30 minutes; if
  you run bbtest-net less often than that, the results will go purple
  before the next run of bbtest-net. This option lets you change how
  long the status is valid. 


\end{description}

\subsection{OPTIONS FOR TESTS OF THE SIMPLE TCP SERVICES}
\begin{description}
\item[--checkresponse[=COLOR]] When testing well-known services
  (e.g. FTP, SSH, SMTP, POP-2, POP-3, IMAP, NNTP and rsync),
  bbtest-net will look for a valid service-specific ``OK''
  response. If another reponse is seen, this will cause the test to
  report a warning (yellow) status. Without this option, the response
  from the service is ignored.  

 The optional color-name is used to select a color other than yellow
 for the status message when the response is
 wrong. E.g. ``--checkresponse=red'' will cause a ``red'' status
 message to be sent when the service does not respond as expected. 


 

\item[--no-flags] By default, bbtest-net sends some extra information
  in the status messages, called ``flags''. These are used by bbgen
  e.g. to pick different icons for reversed tests when generating the
  Hobbit webpages. This option makes bbtest-net omit these flags from
  the status messages. 



\end{description}

\subsection{OPTIONS FOR THE PING TEST}
 Note: bbtest-net uses the program defined by the FPING environment to
 execute ping-tests - by default, that is the \emph{hobbitping(1)}
 utility. See \emph{hobbitserver.cfg(5)} for a description of how to
 customize this, e.g. if you need to run it with ``sudo'' or a similar
 tool. 


 \begin{description}
\item[--ping] Enables bbtest-net's ping test. The column name used for
  ping test results is defined by the PINGCOLUMN environment variable
  in \emph{hobbitserver.cfg(5).}

 
 If not specifed, bbtest-net uses the CONNTEST environment variable to
 determine if it should perform the ping test or not. So if you prefer
 to use another tool to implement ping checks, either set the CONNTEST
 environment variable to false, or run bbtest-net with the
 ``--noping''. 


 

\item[--noping] Disable the connectivity test. 

 

\item[--trace]
\item[--notrace] Enable/disable the use of traceroute when a ping-test
  fails. Performing a traceroute for failed ping tests is a slow
  operation, so the default is not to do any traceroute, unless it is
  requested on a per-host basis via the ``trace'' tag in the
  \emph{bb-hosts(5) } entry for each host. The ``--trace'' option
  changes this, so the default becomes to run traceroute on all hosts
  where the ping test fails; you can then disable it on specific hosts
  by putting a ``notrace'' tag on the host-entry. 


 


\end{description}

\subsection{OPTIONS FOR HTTP (WEB) TESTS}
\begin{description}
\item[--content=CONTENTTESTNAME] Determines the name of the column
  Hobbit displays for content checks. The default is ``content''. If
  you have used the ``cont.sh'' or ``cont2.sh'' scripts earlier, you
  may want to use ``--content=cont'' to report content checks using
  the same test name as these scripts do. 


\end{description}

\subsection{OPTIONS FOR SSL CERTIFICATE TESTS}
\begin{description}
\item[--ssl=SSLCERTTESTNAME] Determines the name of the column Hobbit
  displays for the SSL certificate checks. The default is
  ``sslcert''. 

\item[--no-ssl] Disables reporting of the SSL certificate check. 

 

\item[--sslwarn=N]
\item[--sslalarm=N] Determines the number of days before an SSL
  certificate expires, where bbtest-net will generate a warning or
  alarm status for the SSL certificate column. 



\end{description}
\subsection{DEBUGGING OPTIONS}
\begin{description}
\item[--no-update] Don't send any status updates to the BBDISPLAY
  server. Instead, all messages are dumped to stdout. 



\item[--timing] Causes bbtest-net to collect information about the
  time spent in different parts of the program. The information is
  printed on stdout just before the program ends. Note that this
  information is also included in the status report sent with the
  ``--report'' option. 


\item[--debug] Dumps a bunch of status about the tests as they progress to stdout. 

 

\item[--dump[=before|=after|=both]] Dumps internal memory structures
  before and/or after the tests have executed. 


 
\end{description}
\subsection{INFORMATIONAL OPTIONS}
\begin{description}
\item[--help or -?] Provide a summary of available commandline options. 

 

\item[--version] Prints the version number of bbtest-net 

 

\item[--services] Dump the list of defined TCP services bbtest-net
  knows how to test. Do not run any tests. 



\end{description}
\subsection{USING COOKIES IN WEB TESTS}
 If the file \$BBHOME/etc/cookies exist, cookies will be read from
 this file and sent along with the HTTP requests when checking
 websites. This file is in the Netscape Cookie format, see
 \url{http://www.netscape.com/newsref/std/cookie}\_spec.html for
 details on this format. The \emph{curl(1)} utility can output a file
 in this format if run with the ``--cookie-jar FILENAME'' option. 


 


 
\subsection{ABOUT SSL CERTIFICATE CHECKS}
 When bbtest-net tests services that use SSL- or TLS-based protocols,
 it will check that the server certificate has not expired. This check
 happens automatically for https (secure web), pop3s, imaps, nntps and
 all other SSL-enabled services (except ldap, see LDAP TESTS below). 


  All certificates found for a host are reported in one status message. 


  Note: On most systems, the end-date of the certificate is limited to
  Jan 19th, 2038. If your certificate is valid after this date,
  bbtest-net will report it as valid only until Jan 19, 2038. This is
  due to limitations in your operating system C library. 


 
\subsection{LDAP TESTS}
 ldap testing can be done in two ways. If you just put an ``ldap'' or
 ``ldaps'' tag in bb-hosts, a simple test is performed that just
 verifies that it is possible to establish a connection to the port
 running the ldap service (389 for ldap, 636 for ldaps). 


  Instead you can put an LDAP URI in bb-hosts. This will cause
  bbtest-net to initiate a full-blown LDAP session with the server,
  and do an LDAP search for the objects defined by the URI. This
  requires that bbtest-net was built with LDAP support, and relies on
  an existing LDAP library to be installed. It has been tested with
  OpenLDAP 2.0.26 (from Red Hat 9) and 2.1.22. The Solaris 8 system
  ldap library has also been confirmed to work for un-encrypted (plain
  ldap) access. 


  The format of LDAP URI's is defined in RFC 2255. LDAP URLs look like this: \begin{verbatim}


  \textbf{ldap://}
\emph{hostport}
\textbf{/}
\emph{dn}
[\textbf{?}
\emph{attrs}
[\textbf{?}
\emph{scope}
[\textbf{?}
\emph{filter}
[\textbf{?}
\emph{exts}
]]]]

where:
  \emph{hostport}
 is a host name with an optional ":portnumber"
  \emph{dn}
 is the search base
  \emph{attrs}
 is a comma separated list of attributes to request
  \emph{scope}
 is one of these three strings:
    base one sub (default=base)
  \emph{filter}
 is filter
  \emph{exts}
 are recognized set of LDAP and/or API extensions.

Example:
  ldap://ldap.example.net/dc=example,dc=net?cn,sn?sub?(cn=*)

\end{verbatim}



  All ``bind'' operations to LDAP servers use simple
  authentication. Kerberos and SASL are not supported. If your LDAP
  server requires a username/password, use the ``ldaplogin'' tag to
  specify this, cf. \emph{bb-hosts(5) } If no username/password
  information is provided, an anonymous bind will be attempted. 



  SSL support requires both a client library and an LDAP server that
  support LDAPv3; it uses the LDAP ``STARTTLS'' protocol request after
  establishing a connection to the standard (non-encrypted) LDAP port
  (usually port 389). It has only been tested with OpenSSL 2.x, and
  probably will not work with any other LDAP library. 



  The older LDAPv2 experimental method of tunnelling normal LDAP
  traffic through an SSL connection - ldaps, running on port 636 - is
  not supported, unless someone can explain how to get the OpenLDAP
  library to support it. This method was never formally described in
  an RFC, and implementations of it are non-standard. 



  For a discussion of the various ways of running encrypted ldap, see  
\url{http://www.openldap.org/lists/openldap-software/200305/msg00079.html} 
\url{http://www.openldap.org/lists/openldap-software/200305/msg00084.html} 
\url{http://www.openldap.org/lists/openldap-software/200201/msg00042.html} 
\url{http://www.openldap.org/lists/openldap-software/200206/msg00387.html}


  When testing LDAP URI's, all of the communications are handled by
  the ldap library. Therefore, it is not possible to obtain the SSL
  certificate used by the LDAP server, and it will not show up in the
  ``sslcert'' column. 



 
\subsection{USING MULTIPLE NETWORK TEST SYSTEMS}
 If you have more than one system running network tests - e.g. if your
 network is separated by firewalls - then is is problematic to
 maintain multiple bb-hosts files for each of the systems. bbtest-net
 supports the NET:location tag in \emph{bb-hosts(5)} to distinguish
 between hosts that should be tested from different network
 locations. If you set the environment variable BBLOCATION e.g. to
 ``dmz'' before running bbtest-net, then it will only test hosts that
 have a ``NET:dmz'' tag in bb-hosts. This allows you to keep all of
 your hosts in the same bb-hosts file, but test different sets of
 hosts by different BBNET systems. 


 


 
\subsection{BBTEST-NET INTERNALS}
 bbtest-net first reads the bb-services file to see which network
 tests are defined. It then scans the bb-hosts file, and collects
 information about the TCP service tests that need to be tested. It
 picks out only the tests that were listed in the bb-services file,
 plus the ``dns'', ``dig'' and ``ntp'' tests - those tests that
 bb-network.sh would normally use the ``bbnet'' tool to test. 


  It then runs two tasks in parallel: First, a separate process is
  started to run the ``hobbitping'' tool for the connectivity
  tests. While hobbitping is busy doing the ``ping'' checks,
  bbtest-net runs all of the TCP-based network tests. 



  All of the TCP-based service checks are handled by a connection
  tester written specifically for this purpose. It uses only standard
  Unix-style network programming, but relies on the Unix ``select(2)''
  system-call to handle many simultaneous connections happening in
  parallel. Exactly how many parallel connections are being used
  depends on your operating system - the default is FD\_SETSIZE/4,
  which amounts to 256 on many Unix systems. 



  You can choose the number of concurrent connections with the
  ``--concurrency=N'' option to bbtest-net. 



  Connection attempts timeout after 10 seconds - this can be changed
  with the ``--timeout=N'' option. 



  Both of these settings play a part in deciding how long the testing
  takes. A conservative estimate for doing N TCP tests is: 



  
(1+(N/concurrency))*timeout 


  In real life it will probably be less, as the above formula is for
  every test to require a timeout. Since the most normal use of BB is
  to check for services that are active, you should have a lot less
  timeouts. 



  The ``ntp'' and ``rpcinfo'' checks rely on external programs to do
  each test. Thus, they perform only marginally better than the
  standard bb-network.sh script. 



 
\subsection{ENVIRONMENT VARIABLES}
\begin{description}
\item[BBLOCATION] Defines the network segment where bbtest-net is
  currently running. This is used to filter out only the entries in
  the \emph{bb-hosts(5)} file that have a matching ``NET:LOCATION''
  tag, and execute the tests for only those hosts. 


 

\item[BBMAXMSGSPERCOMBO] Defines the maximum number of status messages
  that can be sent in one combo message. Default is 0 - no limit.  

 In practice, the maximum size of a single Hobbit message sets a limit
 - the default value for the maximum message size is 32 KB, but that
 will easily accomodate 100 status messages per transmission. So if
 you want to experiment with this setting, I suggest starting with a
 value of 10. 



\item[BBSLEEPBETWEENMSGS] Defines a a delay (in microseconds) after
  each message is transmitted to the BBDISPLAY server. The default is
  0, i.e. send the messages as fast as possible. This gives your
  BBDISPLAY server some time to process the message before the next
  message comes in. Depending on the speed of your BBDISPLAY server,
  it may be necessary to set this value to half a second or even 1 or
  2 seconds. Note that the value is specified in MICROseconds, so to
  define a delay of half a second, this must be set to the value
  ``500000''; a delay of 1 second is achieved by setting this to
  ``1000000'' (one million). 


 

\item[FPING] Command used to run the \emph{hobbitping(1) }
  utility. Used by bbtest-net for connectivity (ping) testing. See
  \emph{hobbitserver.cfg(5)} for more information about how to
  customize the program that is executed to do ping tests. 


\item[TRACEROUTE] Location of the \emph{traceroute(8)} utility, or an
  equivalent tool e.g. \emph{mtr(8).} Optionally used when a
  connectivity test fails to pinpoint the network location that is
  causing the failure. 


 

\item[NTPDATE] Location of the \emph{ntpdate(1) }
 utility. Used by bbtest-net when checking the ``ntp'' service. 

 

\item[RPCINFO] Location of the \emph{rpcinfo(8) }
 utility. Used by bbtest-net for the ``rpc'' service checks. 

 


\end{description}
\subsection{FILES}
\begin{description}
\item[~/server/etc/bb-services (Hobbit)] This file contains
  definitions of TCP services that bbtest-net can test. Definitions
  for a default set of common services is built into bbtest-net, but
  these can be overridden or supplemented by defining services in the
  bb-services file. See \emph{bb-services(5)} for details on this
  file. 


 

\item[\$BBHOME/etc/netrc - authentication data for password-protected
  webs] If you have password-protected sites, you can put the
  usernames and passwords for these here. They will then get picked up
  automatically when running your network tests. This works for
  web-sites that use the ``Basic'' authentication scheme in HTTP. See
  \emph{ftp(1)} for details - a sample entry would look like this  

 
machinewww.acme.comloginfredpasswordWilma1  
 Note that the machine-name must be the name you use in the
 \url{http://machinename/} URL setting - it need not be the one you
 use for the system-name in Hobbit. 


 
\item[\$BBHOME/etc/cookies] This file may contain website cookies, in
  the Netscape HTTP Cookie format. If a website requires a static
  cookie to be present in order for the check to complete, then you
  can add this cookie to this file, and it will be sent along with the
  HTTP request. To get the cookies into this file, you can use the
  ``curl --cookie-jar FILE'' to request the URL that sets the cookie. 


 

\item[\$BBTMP/*.status - test status summary] Each time bbtest-net
  runs, if any tests fail (i.e. they result in a red status) then they
  will be listed in a file name TESTNAME.[LOCATION].status. The
  LOCATION part may be null. This file is used to determine how long
  the failure has lasted, which in turn decides if this test should be
  included in the tests done by \emph{bbretest-net.sh(1)}

 
 It is also used internally by bbtest-net when determining the color
 for tests that use the ``badconn'' or ``badTESTNAME'' tags. 


 

\item[\$BBTMP/frequenttests.[LOCATION]] This file contains the
  hostnames of those hosts that should be retested by the
  \emph{bbretest-net.sh(1)} test tool. It is updated only by
  bbtest-net during the normal runs, and read by bbretest-net.sh. 



\end{description}
\subsection{SEE ALSO}
bb-hosts(5), bb-services(5), hobbitserver.cfg(5), hobbitping(1), curl(1), ftp(1), fping(1), ntpdate(1), rpcinfo(8) 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{BB-WEBPAGE}
 bb-webpage - Utility to show a webpage using header and footer \
\subsection{SYNOPSIS}
\textbf{bb-webpage [options]}


 
\subsection{DESCRIPTION}
\textbf{bb-webpage} is a tool to generate a webpage in the Hobbit
style, with a standard header- and footer as well as a Hobbit
background. The data to present on the webpage, apart from the header
and footer, are passed to bb-webpage in stdin. The generated webpage
is printed to stdout. 


 
\subsection{OPTIONS}
\begin{description}
\item[--env=FILENAME] Loads the environment defined in FILENAME before executing the CGI script. 

 

\item[--hffile=PREFIX] Use the header- and footer-files in
  \$BBHOME/web/PREFIX\_header and PREFIX\_footer. If not specified,
  bb\_header and bb\_footer are used. 


 

\item[--color=COLOR] Set the background color of the generated webpage to COLOR. Default: Blue 

 

\item[--debug] Enable debugging output. 

 
\end{description}
\subsection{SEE ALSO}
hobbit(7) 

 



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{HOBBITFETCH}
\subsection{NAME}
 hobbitfetch - fetch client data from passive clients \
\subsection{SYNOPSIS}
\textbf{hobbitfetch [--server=HOBBIT.SERVER.IP] [options]}


 
\subsection{DESCRIPTION}
 This utility is used to collect data from Hobbit clients. 

  Normally, Hobbit clients will themselves take care of sending all of
  their data directly to the Hobbit server. In that case, you do not
  need this utility at all. However, in some network setups clients
  may be prohibited from establishing a connection to an external
  server such as the Hobbit server, due to firewall policies. In such
  a setup you can configure the client to store all of the client data
  locally by enabling the \emph{msgcache(8)} utility on the client,
  and using \textbf{hobbitfetch} on the Hobbit server to collect data
  from the clients. 



  hobbitfetch will only collect data from clients that have the
  \textbf{pulldata} tag listed in the \emph{bb-hosts(5)} file. The
  IP-address listed in the bb-hosts file must be correct, since this
  is the IP-address where hobbitfetch will attempt to contact the
  client. If the msgcache daemon is running on a non-standard
  IP-address or portnumber, you can specify the portnumber as in
  \textbf{pulldata=192.168.1.2:8084} for contacting the msgcache
  daemon using IP 192.168.1.2 port 8084. If the IP-address is omitted,
  the default IP in the bb-hosts file is used. If the port number is
  omitted, the portnumber from the BBPORT setting in
  \emph{hobbitserver.cfg(5)} is used (normally, this is port 1984). 



 
\subsection{OPTIONS}
\begin{description}
\item[--server=HOBBIT.SERVER.IP] Defines the IP address of the Hobbit
  server where the collected client messages are forwarded to. By
  default, messages are sent to the loopback address 127.0.0.1,
  i.e. to a Hobbit server running on the same host as hobbitfetch. 


 

\item[--interval=N] Sets the interval (in seconds) between polls of a client. Default: 60 seconds. 

 

\item[--id=N] Used when you have a setup with multiple Hobbit
 servers. In that case, you must run hobbitfetch on each of the Hobbit
 servers, with hobbitfetch instance using a different value of N. This
 allows several Hobbit servers to pick up data from the clients
 running msgcache, and msgcache can distinguish between which messages
 have already been forwarded to which server.  

 N is a number in the range 1-31. 

 

\item[--log-interval=N] Limit how often hobbitfetch will log problems
  with fetching data from a host, in seconds. Default: 900 seconds (15
  minutes). This is to prevent a host that is down or where msgcache
  has not been started from flooding the hobbitfetch logs. Note that
  this is ignored when debugging is enabled. 


 

\item[--debug] Enable debugging output. 

 


\end{description}
\subsection{SEE ALSO}
msgcache(8), hobbitd(8), hobbit(7) 

 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{bbcmd}
 \motohbcmd{bbcmd} - Run a Hobbit command with environment set \subsection{SYNOPSIS}
\textbf{bbcmd --env=ENVFILE COMMAND}


 
\subsection{DESCRIPTION}
\emph{bbcmd(1)} is a utility that can setup the Hobbit environment
variables as defined in a \emph{hobbitlaunch(8)} compatible
environment definition file, and then execute a command with this
environment in place. It is mostly used for testing extension scripts
or in other situations where you need to run a single command with the
environment in place. 


The ``--env=ENVFILE'' option points bbcmd to the file where the
environment definitions are loaded from. 



COMMAND is the command to execute after setting up the environment. 

If you want to run multiple commands, it is often easiest to just use
``sh'' as the COMMAND - this gives you a sub-shell with the
environment defined globally. 

\subsection{SEE ALSO} hobbitlaunch(8), hobbit(7) 



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{CLIENTLAUNCH.CFG}
 clientlaunch.cfg - Task definitions for the hobbitlaunch utility 

 
\subsection{SYNOPSIS}
\textbf{~hobbit/client/etc/clientlaunch.cfg}


 
\subsection{DESCRIPTION}
 The clientlaunch.cfg file holds the list of tasks that hobbitlaunch
 runs on a Hobbit client. This is typically just the Hobbit client
 itself, but you can add custom test scripts here and have them
 executed regularly by the Hobbit scheduler. 


 
\subsection{FILE FORMAT}
 See the \emph{hobbitlaunch.cfg(5)}
 description. 

 
\subsection{SEE ALSO}
hobbitlaunch(8), hobbit(7) 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Combination Tests}

\newpage
\section{BBCOMBOTEST}
 bbcombotest - Hobbit combination test tool \

section{SYNOPSIS}
\textbf{bbcombotest --help}
 
\textbf{bbcombotest --version}
 
\textbf{bbcombotest [--debug] [--quiet]}


 
\subsection{DESCRIPTION}
\textbf{bbcombotest} is a Hobbit extension script that runs on the
BBDISPLAY server. It combines the results of one or more of the normal
Hobbit test results into a combined test result, using standard
arithmetic og logical operators. 


  The resulting tests are sent to the Hobbit display server as any
  normal test - so all of the standard Hobbit functions (history,
  statistics etc.) are available for the combined tests. 



  The tool was born from the need to monitor systems with built-in
  redundancy and automatic failover - e.g. load-balanced web
  servers. But other uses are possible. 



 
\subsection{OPTIONS}
\begin{description}
\item[--quiet] Normally, the test status sent by bbcombotest includes
  information about the underlying test results used to determine the
  current value of the combined test. ``--quiet'' eliminates this
  information from the test status page. 


 

\item[--debug] Provide debugging output for use in troubleshooting problems with bbcombotest. 

 

\item[--no-update] Dont send any status messages - instead, the result of the combotests is simply dumped to stdout. Useful for debugging. 


\end{description}
\subsection{FILES}
\begin{description}
\item[\$BBHOME/etc/bbcombotest.cfg] Configuration file for bbcombotest, where the combined tests are defined 
\item[\$BBHOME/etc/hobbitlaunch.cfg] Configuration file controlling when bbcombotest is run. 


\end{description}
\subsection{SEE ALSO}
bbcombotest.cfg(5), bb-hosts(5), hobbitserver.cfg(5), hobbitlaunch.cfg(5) 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{CLIENT-LOCAL.CFG}
\subsection{NAME}
 client-local.cfg - Local configuration settings for Hobbit clients 

 
\subsection{SYNOPSIS}
\textbf{~hobbit/server/etc/client-local.cfg}


 
\subsection{DESCRIPTION}
 The client-local.cfg file contains settings that are used by each
 Hobbit client when it runs on a monitored host. It provides a
 convenient way of configuring clients from a central location without
 having to setup special configuration maintenance tools on all
 clients. 


  The client-local.cfg file is currently used to configure what logfiles the client should fetch data from, to be used as the basis for the ``msgs'' status column; and to configure which files and directories are being monitored in the ``files'' status column. 


  Note that there is a dependency between the client-local.cfg file
  and the \emph{hobbit-clients.cfg(5)} file. When monitoring e.g. a
  logfile, you must first enter it into the client-local.cfg file, to
  trigger the Hobbit client into reporting any data about the
  logfile. Next, you must configure hobbit-clients.cfg so the Hobbit
  server knows what to look for in the file data sent by the
  client. So: client-local.cfg defines what raw data is collected by
  the client, and hobbit-clients.cfg defines how to analyze them. 



 
\subsection{PROPAGATION TO CLIENTS}
 The client-local.cfg file resides on the Hobbit server. 

  When clients connect to the Hobbit server to send in their client
  data, they will receive part of this file back from the Hobbit
  server. The configuration received by the client is then used the
  next time the client runs. 



  This method of propagating the configuration means that there is a
  delay of up to two poll cycles (i.e. 5-10 minutes) from a
  configuration change is entered into the client-local.cfg file, and
  until you see the result in the status messages reported by the
  client. 



 
\subsection{FILE FORMAT}
 The file is divided into sections, delimited by ``[name]'' lines. A
 section name can be either an operating system identifier - linux,
 solaris, hp-ux, aix, freebsd, openbsd, netbsd, darwin - or a
 hostname. When deciding which section to send to a client, Hobbit
 will first look for a section named after the hostname of the client;
 if such a section does not exist, it will look for a section named by
 the operating system of the client. So you can configure special
 configurations for individual hosts, and have a default configuration
 for all other hosts of a certain type. 


  Apart from the section delimiter, the file format is free-form, or
  rather it is defined by the tools that make use of the
  configuration. 



 
\subsection{LOGFILE CONFIGURATION ENTRIES}
 A logfile configuration entry looks like this: 

  
log:/var/log/messages:10240  
 
ignoreMARK  
 
triggerOops 


  The \textbf{log:FILENAME:SIZE} line defines the filename of the log,
  and the maximum amount of data (in bytes) to send to the Hobbit
  server. FILENAME is usually an explicit full-path filename on the
  client. If it is enclosed in backticks, it is a command which the
  Hobbit client runs and each line of output from this command is then
  used as a filename. This allows scripting which files to monitor,
  e.g. if you have logfiles that are named with some sort of
  timestamp. 



  The \textbf{ignore PATTERN} line (optional) defines lines in the
  logfile which are ignored entirely, i.e. they are stripped from the
  logfile data before sending it to the Hobbit server. It is used to
  remove completely unwanted ``noise'' entries from the logdata
  processed by Hobbit. ``PATTERN'' is a regular expression. 



  The \textbf{trigger PATTERN}
 line (optional) is used only when there is more data in the log than
 the maximum size set in the ``log:FILENAME:SIZE'' line. The
 ``trigger'' pattern is then used to find particularly interesting
 lines in the logfile - these will always be sent to the Hobbit
 server. After picking out the ``trigger'' lines, any remaining space
 up to the maximum size is filled in with the most recent entries from
 the logfile. ``PATTERN'' is a regular expression. 



 
\subsection{COUNTING LOGENTRIES}
 A special type of log-handling is possible, where the number of lines
 matching a regular expressions are merely counted. This is
 \textbf{linecount:FILENAME}, followed by a number of lines of the
 form \textbf{ID:PATTERN}

. E.g. 

  
linecount:/var/log/messages  
 
diskerrors:I/Oerror.*device.*hd  
 
badlogins:Failedlogin 


 


 
\subsection{FILE CONFIGURATION ENTRIES}
 A file monitoring entry is used to watch the meta-data of a file:
 Owner, group, size, permissions, checksum etc. It looks like this: 


  
\url{file:/var/log/messages}[:HASH] 


  The \textbf{\url{file:FILENAME}}
 line defines the filename of the file to monitor. As with the
 ``log:'' entries, a filename enclosed in backticks means a command
 which will generate the filenames dynamically. The optional [:HASH]
 setting defines what type of hash to compute for the file:
 \textbf{md5}

, \textbf{sha1}
, \textbf{rmd160}
, \textbf{sha256}
 or \textbf{sha512}
. By default, no hash is calculated.  
\textbf{NOTE:}
 If you want to check multiple files using a wildcard, you \textbf{must}
 use a command to generate the filenames. Putting wildcards directly into the \textbf{file:}
 entry will not work. 


 
\subsection{DIRECTORY CONFIGURATION ENTRIES}
 A directory monitoring entry is used to watch the size of a directory and any sub-directories. It looks like this: 

  
dir:DIRECTORYNAME 


  The \textbf{dir:DIRECTORYNAME}
 line defines the filename of the file to monitor. As with the ``log:'' entries, a filename enclosed in backticks means a command which will generate the filenames dynamically. The Hobbit client will run the \emph{du(1)}
 command with the directoryname as parameter, and send the output back to the Hobbit server.  
\textbf{NOTE:}
 If you want to check multiple directories using a wildcard, you \textbf{must}
 use a command to generate the directory names. Putting wildcards directly into the \textbf{dir:}
 entry will not work. E.g. use something like  
dir:`find /var/log -maxdepth 1 -type d` 



  The ``du'' command used can be configured through the \textbf{DU}
 environment variable. On some systems, by default \textbf{du}
 reports data in disk blocks instead of KB (e.g. Solaris). So you may want to configure the Hobbit client to use a \textbf{du}
 command which reports data in KB, e.g. by setting  
 
DU=''du-k''  
 in the hobbitclient.cfg file. 


 
\subsection{NOTES}
 The ability of the Hobbit client to calculate file hashes and monitor
 those can be used for file integrity validation on a small
 scale. However, there is a significant processing overhead in
 calculating these every time the Hobbit client runs, so this should
 not be considered a replacement for host-based intrusion detection
 systems such as Tripwire or AIDE. 


  Use of the directory monitoring on directory structures with a large number of files and/or sub-directories can be quite ressource-intensive. 


 
\subsection{SEE ALSO}
hobbit-clients.cfg(5), hobbitd\_client(8), hobbitd(8), hobbit(7) 

 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{HOBBITGRAPH.CGI}
\subsection{NAME}
 hobbitgraph.cgi - CGI to generate Hobbit trend graphs 
\subsection{SYNOPSIS}
\textbf{hobbitgraph [options]}


 
\subsection{DESCRIPTION}
\textbf{hobbitgraph.cgi}
 is invoked as a CGI script via the hobbitgraph.sh CGI wrapper. 

  hobbitgraph.cgi is passed a QUERY\_STRING environment variable with the following parameters: 


 \textbf{host}
 Name of the host to generate a graph for 


 \textbf{service}
 Name of the service to generate a graph for 


 \textbf{disp}
 Display-name of the host, used on the generated graphs instead of hostname. 


 \textbf{graph}
 Can be ``hourly'', ``daily'', ``weekly'' or ``monthly'' to select the time period that the graph covers. 


 \textbf{first}
 Used to split multi-graphs into multiple graphs. This causes
 hobbitgraph.cgi to generate only the graphs starting with the
 ``first'th'' graph and continuing for ``count''. 


 \textbf{count}
 Number of graphs in a multi-graph. 


 \textbf{upper}
 Set the upper limit of the graph. See \emph{rrdgraph(1)}
 for a description of the ``-u'' option. 


 \textbf{lower}
 Set the lower limit of the graph. See \emph{rrdgraph(1)}
 for a description of the ``-l'' option. 


 \textbf{graph\_start}
 Set the starttime of the graph. This is used in zoom-mode. 


 \textbf{graph\_end}
 Set the end-time of the graph. This is used in zoom-mode. 


 \textbf{action=menu}
 Generate an HTML page with links to 4 graphs, representing the hourly, weekly, monthly and yearly graphs. Doesn't actually generate any graphs, only the HTML that links to the graphs. 


 \textbf{action=selzoom}
 Generate an HTML page with link to single graph, and with JavaScript code that lets the user select part of the graph for a zoom-operation. Doesn't actually generate graph, only the HTML that links to the graph. 


 \textbf{action=view}
 Generate a single graph image. 


 
\subsection{OPTIONS}
\begin{description}
\item[--config=FILENAME] Loads the graph configuration file from FILENAME. If not specified, the file \$BBHOME/etc/hobbitgraph.cfg is used. See the \emph{hobbitgraph.cfg(5)}
 for details about this file. 

 

\item[--env=FILENAME] Loads the environment settings defined in FILENAME before executing the CGI. 

 

\item[--rrddir=DIRECTORY] The top-level directory for the RRD files. If not specified, the directory given by the BBRRDS environment is used. 

 

\item[--save=FILENAME] Instead of returning the image via the CGI interface (i.e. on stdout), save the generated image to FILENAME. 

 

\item[--debug] Enable debugging output. 

 


\end{description}
\subsection{ENVIRONMENT}


 \textbf{QUERY\_STRING}
 Provided by the webserver CGI interface, this decides what graph to generate. 


 
\subsection{FILES}


 \textbf{hobbitgraph.cfg:}
 The configuration file determining how graphs are generated from RRD files. 


 
\subsection{SEE ALSO}
hobbitgraph.cfg(5), hobbit(7), rrdtool(1) 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{BBCOMBOTEST.CFG}
\subsection{NAME}
 bbcombotest.cfg - Configuration of bbcombotest tool 

 
\subsection{SYNOPSIS}
\textbf{\$BBHOME/etc/bbcombotest.cfg}


 
\subsection{DESCRIPTION}
\emph{bbcombotest(1)}
 uses it's own configuration file, \$BBHOME/etc/bbcombotest.cfg Each line in this file defines a combined test. 

 
\subsection{FILE FORMAT}
 Each line of the file defines a new combined test. Blank lines and
 lines starting with a hash mark (\#) are treated as comments and
 ignored. 


  The configuration file uses the hostnames and testnames that are
  already used in your Hobbit bb-hosts file. These are then combined
  using normal logical operators - ``||'' for ``or'', ``\&\&'' for
  ``and'' etc. 



  A simple test - e.g. ``Web1.http'' - results in the value ``1'' if
  the ``http'' test for server ``Web1'' is green, yellow or clear. It
  yields the value ``0'' if it is red, purple or blue. 



  Apart from the logical operations, you can also do integer
  arithmetic and comparisons. E.g. the following is valid: 



  WebCluster.http = (Web1.http + Web2.http + Web3.http) $>$= 2 


  This test is green if two or more of the http tests for Web1, Web2 and Web3 are green. 


  The full range of operators are: 


  
+Add  
-Subtract  
*Multiply  
/Divide  
\%Modulo  
|Bit-wise''or''  
\&Bit-wise''and''  
||Logical''or''  
\&\&Logical''and''  
$>$Greaterthan  
$<$Lessthan  
$>$=Greaterthanorequal  
$<$=Lessthanorequal  
==Equal 


  There is currently no support for a ``not'' operator. If you need
  it, use the transcription ``(host.test == 0)'' instead of
  ``!host.test''. 



  NB: All operators have EQUAL PRECEDENCE. If you need something evaluated in a specific order, use parentheses to group the expressions together. 


  If the expression comes out as ``0'', the combined test goes red. If it comes out as non-zero, the combined test is green. 


  Note: If the expression involves hostnames with a character that is
  also an operator - e.g. if you have a host
  ``t1-router-newyork.foo.com'' with a dash in the hostname - then the
  operator-character must be escaped with a backslash '$\backslash$'
  in the expression, or it will be interpreted as an
  operator. E.g. like this: 



  
nyc.conn=(t1$\backslash$-router$\backslash$-nyc.conn||backup$\backslash$-router$\backslash$-nyc.conn) 


 


 
\subsection{EXAMPLE}
 WebCluster.http = (Web1.http || Web2.http)  
 AppSrvCluster.procs = (AppSrv1.conn \&\& AppSrv1.procs) || (AppSrv2.conn \&\& AppSrv2.procs)  
 Customer.cluster = WebCluster.http \&\& AppSrvCluster.procs  


  The first line defines a new test, with hostname ``WebCluster'' and
  the columnname ``http''. It will be green if the http test on either
  the ``Web1'' or the ``Web2'' server is green. 



  The second line defines a ``procs'' test for the ``AppSrvCluster''
  host. Each of the AppSrv1 and AppSrv2 hosts is checked for ``conn''
  (ping) and their ``procs'' test. On each host, both of these must be
  green, but the combined test is green if that condition is fulfilled
  on just one of the hosts. 



  The third line uses the two first tests to build a ``double
  combined'' test, defining a test that shows the overall health of
  the system. 

 
\subsection{FILES}
\textbf{\$BBHOME/etc/bbcombotest.cfg}

 
\subsection{SEE ALSO}
bbcombotest(1) 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{CLIENTUPDATE}


\subsection{NAME}
 clientupdate - Hobbit client update utility \subsection{SYNOPSIS}
\textbf{clientupdate [options]}


 
\subsection{DESCRIPTION}
\textbf{clientupdate}
 is part of the Hobbit client. It is responsible for updating an existing client installation from a central repository of client packages stored on the Hobbit server. 

  When the Hobbit client sends a normal client report to the Hobbit server, the server responds with the section of the \emph{client-local.cfg(5)}
 file that is relevant to this client. Included in this may be a ``clientversion'' value. The clientversion received from the server is compared against the current clientversion installed on the client, as determined by the contents of the \$BBHOME/etc/clientversion.cfg file. If the two versions are not identical, clientupdate is launched to update the client installation. 


 
\subsection{OPTIONS}
\begin{description}
\item[--level] Report the current clientversion. 

 

\item[--update=NEWVERSION] Attempt to update the client to NEWVERSION by fetching this version of the client software from the Hobbit server. 

 

\item[--reexec] Used internally during the update process, see \textbf{OPERATION}
 below. 

 

\item[--remove-self] Used internally during the update process. This option causes the running clientupdate utility to delete itself - it is used during the update to purge a temporary copy of the clientupdate utility that is installed in \$BBTMP. 

 


\end{description}
\subsection{USING CLIENTUPDATE IN HOBBIT}
 To manage updating clients without having to logon to each server, you can use the clientupdate utility. This is how you setup the release of a new client version. 

 \begin{description}
\item[Create the new client] Setup the new client \$BBHOME directory, e.g. by copying an existing client installation to an empty directory and modifying it for your needs. It is a good idea to delete all files in the tmp/ and logs/ directories, since there is no need to copy these over to all of the clients. Pay attention to the etc/ files, and make sure that they are suitable for the systems where you want to deploy this new client. You can add files - e.g. extension scripts in the ext/ directory - but the clientupdate utility cannot delete or rename files. 

 

\item[Package the client] When your new client software is ready, create a tar-file of the new client. All files in the tar archive must have filenames relative to the clients' \$BBHOME (usually, ~hobbit/client/). Save the tarfile on the Hobbit server in ~hobbit/server/download/somefile.tar. Dont compress it. It is recommended that you use some sort of operating-system and version-numbering scheme for the filename, but you can choose whatever filename suits you - the only requirement is that it must end with ``.tar''. The part of the filename preceding ``.tar'' is what Hobbit will use as the ``clientversion'' ID. 

 

\item[Configure which hosts receive the new client] In the \emph{client-local.cfg(5)}
 file, you must now setup a \textbf{clientversion:ID}
 line where the \textbf{ID}
 matches the filename you used for the tar-file. So if you have packaged the new client into the file \textbf{linux.v2.tar}
, then the corresponding entry in client-local.cfg would be \textbf{clientversion:linux.v2}
. 

 

\item[Wait for hobbitd to reload client-local.cfg] hobbitd will automatically reload the client-local.cfg file after at most 10 minutes. If you want to force an immediate reload, send a SIGHUP signal to the hobbitd process. 

 

\item[Wait for the client to update] The next time the client contacts the Hobbit server to send the client data, it will notice the new clientversion setting in client-local.cfg, and will run \textbf{clientupdate}
 to install the new client software. So when the client runs the next time, it will use the new client software. 

 


\end{description}

\subsection{OPERATION}
\textbf{clientupdate}
 runs in two steps: 

 \begin{description}
\item[Re-exec step] The first step is when clientupdate is first invoked from the hobbitclient.sh script with the ``--re-exec'' option. This step copies the clientupdate program from \$BBHOME/bin/ to a temporary file in the \$BBTMP directory. This is to avoid conflicts when the update procedure installs a new version of the clientupdate utility itself. Upon completion of this step, the clientupdate utility automatically launches the next step by running the program from the file in \$BBTMP. 

 

\item[Update step] The second step downloads the new client software from the Hobbit server. The new software must be packed into a tar file, which clientupdate then unpacks into the \envar{\$BBHOME} directory. 

 


\end{description}

\subsection{ENVIRONMENT VARIABLES}
 clientupdate uses several of the standard Hobbit environment variables, including \envar{\textbf{BBHOME}}
 and \envar{\textbf{BBTMP}}
. 

 
\subsection{SEE ALSO}
hobbit(7), bb(1), client-local.cfg(5) 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{HOBBITGRAPH.CGI}


\subsection{NAME}
 hobbitgraph.cgi - CGI to generate Hobbit trend graphs \subsection{SYNOPSIS}
\textbf{hobbitgraph [options]}


 
\subsection{DESCRIPTION}
\textbf{hobbitgraph.cgi}
 is invoked as a CGI script via the hobbitgraph.sh CGI wrapper. 

  hobbitgraph.cgi is passed a QUERY\_STRING environment variable with the following parameters: 


 \textbf{host}
 Name of the host to generate a graph for 


 \textbf{service}
 Name of the service to generate a graph for 


 \textbf{disp}
 Display-name of the host, used on the generated graphs instead of hostname. 


 \textbf{graph}
 Can be ``hourly'', ``daily'', ``weekly'' or ``monthly'' to select the time period that the graph covers. 


 \textbf{first}
 Used to split multi-graphs into multiple graphs. This causes hobbitgraph.cgi to generate only the graphs starting with the ``first'th'' graph and continuing for ``count''. 


 \textbf{count}
 Number of graphs in a multi-graph. 


 \textbf{upper}
 Set the upper limit of the graph. See \emph{rrdgraph(1)}
 for a description of the ``-u'' option. 


 \textbf{lower}
 Set the lower limit of the graph. See \emph{rrdgraph(1)}
 for a description of the ``-l'' option. 


 \textbf{graph\_start}
 Set the starttime of the graph. This is used in zoom-mode. 


 \textbf{graph\_end}
 Set the end-time of the graph. This is used in zoom-mode. 


 \textbf{action=menu}
 Generate an HTML page with links to 4 graphs, representing the hourly, weekly, monthly and yearly graphs. Doesn't actually generate any graphs, only the HTML that links to the graphs. 


 \textbf{action=selzoom}
 Generate an HTML page with link to single graph, and with JavaScript code that lets the user select part of the graph for a zoom-operation. Doesn't actually generate graph, only the HTML that links to the graph. 


 \textbf{action=view}
 Generate a single graph image. 


 
\subsection{OPTIONS}
\begin{description}
\item[--config=FILENAME] Loads the graph configuration file from FILENAME. If not specified, the file \$BBHOME/etc/hobbitgraph.cfg is used. See the \emph{hobbitgraph.cfg(5)}
 for details about this file. 

 

\item[--env=FILENAME] Loads the environment settings defined in FILENAME before executing the CGI. 

 

\item[--rrddir=DIRECTORY] The top-level directory for the RRD files. If not specified, the directory given by the BBRRDS environment is used. 

 

\item[--save=FILENAME] Instead of returning the image via the CGI interface (i.e. on stdout), save the generated image to FILENAME. 

 

\item[--debug] Enable debugging output. 

 


\end{description}
\subsection{ENVIRONMENT}


 \textbf{QUERY\_STRING}
 Provided by the webserver CGI interface, this decides what graph to generate. 


 
\subsection{FILES}


 \textbf{hobbitgraph.cfg:}
 The configuration file determining how graphs are generated from RRD files. 


 
\subsection{SEE ALSO}
hobbitgraph.cfg(5), hobbit(7), rrdtool(1) 

 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{BB-SNAPSHOT.CGI}
\subsection{NAME}
 bb-snapshot.cgi - CGI program to rebuild the Hobbit webpages for a
 specific point in time. 
\subsection{SYNOPSIS}

\textbf{bb-snapshot.cgi}


 
\subsection{DESCRIPTION}
\textbf{bb-snapshot.cgi} is invoked as a CGI script via the
bb-snapshot.sh CGI wrapper. It rebuilds the Hobbit web pages to the
look they had at a particular point in time, based upon the historical
information logged about events. 


 bb-snapshot.cgi is passed a QUERY\_STRING environment variable with the following parameters: 


  
mon(Startmonthofthesnapshot)  
day(Startday-of-monthofthesnapshot)  
yr(Startyearofthesnapshot)  
hour(Starthourofthesnapshot)  
min(Startminuteofthesnapshot)  
sec(Startsecondofthesnapshot) 


  The ``month'' parameters must be specified as the three-letter
  english month name abbreviation: Jan, Feb, Mar ... 



  ``day'' must be in the range 1..31; ``yr'' must be specified
  including century (e.g. ``2003''). ``hour'' must be specified using
  a 24-hour clock. 



  All of the processing involved in generating the report is done by
  invoking \emph{bbgen(1)} with the proper ``--snapshot'' option. 


 
\subsection{OPTIONS}
\begin{description}
\item[--env=FILENAME] Load environment from FILENAME before executing the CGI. 

 

\item[bbgen-options] All options except ``--env'' are passed on to the \emph{bbgen(1)}
 program building the snapshot files. 

 


\end{description}


\subsection{ENVIRONMENT VARIABLES}
\begin{description}
\item[BBGENSNAPOPTS] bbgen options passed by default to the
  bb-snapshot.cgi script. This happens in the bb-snapshot.sh CGI
  wrapper script. 

\item[BBHOME] Home directory of the Hobbit server files 
\item[BBSNAP] Directory where generated snapshots are stored. This
  directory must be writable by the userid executing the CGI script,
  typically ``www'', ``apache'' or ``nobody''. Default:
  \$BBHOME/www/snap/ 

\item[BBSNAPURL] The URL prefix to use when accessing the reports via
  a browser. Default: \$BBWEB/snap 



\end{description}
\subsection{SEE ALSO}
bbgen(1), bb-hosts(5), hobbitserver.cfg(5) 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{HOBBITD\_SAMPLE}
\subsection{NAME}
 hobbitd\_sample - example of a hobbitd worker module \subsection{SYNOPSIS}
\textbf{hobbitd\_channel --channel=status hobbitd\_sample [options]}

 
\subsection{DESCRIPTION}
 hobbitd\_sample is a worker module for hobbitd, and as such it is
 normally run via the \emph{hobbitd\_channel(8)} program. It receives
 messages from hobbitd via stdin, and simply displays these on
 stdout. It can be used with all types of hobbitd channels. 


  hobbitd\_sample is not designed to actually run, except as a
  demonstration. The purpose of this tool is to show how hobbitd
  worker modules can be implemented to handle different tasks that
  need to hook into the hobbitd processing. 


 
\subsection{OPTIONS}
\begin{description}
\item[--timeout=N] Read messages with a timeout of N seconds. 

 

\item[--debug] Enable debugging output. 

 


\end{description}
\subsection{SEE ALSO}
hobbitd\_channel(8), hobbitd(8), hobbit(7) 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{BB-CSVINFO.CGI}
\subsection{NAME}
 bb-csvinfo.cgi - CGI program to show host information from a CSV file \subsection{SYNOPSIS}
\textbf{bb-csvinfo.cgi}


 
\subsection{DESCRIPTION}
\textbf{bb-csvinfo.cgi}
 is invoked as a CGI script via the bb-csvinfo.sh CGI wrapper. Based
 on the parameters it receives, it searches a comma- separated file
 for the matching host, and presents the information found as a
 table. 


  bb-csvinfo.cgi is passed a QUERY\_STRING environment variable with
  the following parameters: 



  
key(stringtosearchfor,typicallyhostname)  
column(columnnumbertosearch-default0)  
db(nameoftheCSVdatabasefilein\$BBHOME/etc/,defaulthostinfo.csv)  
delimiter(delimitercharacterforcolumns,defaultsemi-colon) 


  CSV files are easily created from e.g. spreadsheets, by exporting
  them in CSV format. You should have one host per line, with the
  first line containing the column headings. Despite their name, the
  default delimiter for CSV files is the semi-colon - if you need a
  different delimiter, invoke bb-csvinfo.cgi with the
  ``delimiter=$<$character$>$'' in the query string. 



 
\subsection{Example usage}
 This example shows how you can use the bb-csvinfo CGI. It assumes you
 have a CSV-formatted file with information about the hosts stored as
 \$BBHOME/etc/hostinfo.csv, and the hostname is in the first column of
 the file. 


 \begin{description}
\item[Use with the bbgen --docurl] The --docurl option to \emph{bbgen(1)}
 sets up all of the hostnames on your Hobbit webpages to act as links
 to a CGI script. To invoke the bb-csvinfo CGI script, run bbgen with
 the option 


  
--docurl=/cgi-bin/bb-csvinfo.sh?db=hostinfo.csv\&key=\%s 



\end{description}

\subsection{SEE ALSO}
bb-hosts(5), hobbitserver.cfg(5), bbgen(1) 

 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{HOBBIT-HOSTGRAPHS.CGI}
 hobbit-hostgraphs.cgi - CGI program to show multiple graphs 

\subsection{SYNOPSIS}
\textbf{hobbit-hostgraph.cgi}


\subsection{DESCRIPTION}
\textbf{hobbit-hostgraph.cgi} is invoked as a CGI script via the hobbit-hostgraph.sh CGI wrapper. 

  If no parameters are provided when invoked, it will present a form
  where the user can select a time period, one or more hosts, and a
  set of graphs. 



  The parameters selected by the user are passed to a second
  invocation of hobbit-hostgraph.cgi, and result in a webpage showing
  a list of graph images based on the trend data stored about the
  hosts. 



  If multiple graph-types are selected, hobbit-hostgraph.cgi will display a list of graphs, with one graph per type. 


  If multiple hosts are selected, hobbit-hostgraph.cgi will attempt to
  display a multi-host graph for each type where the graphs for all
  hosts are overlayed in a single image, allowing for easy comparison
  of the hosts. 



  The hostlist uses the PAGEPATH cookie provided by Hobbit webpages to
  select the list of hosts to present. Only the hosts visible on the
  page where hobbit-hostgraph.cgi is invoked from will be visible. 



  The resulting graph page can be bookmarked, but the bookmark also fixates the time period shown. 


 
\subsection{OPTIONS}
\begin{description}
\item[--env=FILENAME] Loads the environment defined in FILENAME before executing the CGI script. 

 


\end{description}
\subsection{BUGS}
 This utility is experimental. It may change in a future release of Hobbit. 

  It is possible for the user to select graphs which do not exist. This results in broken image links. 


  The set of graph-types is fixed in the server/web/hostgraphs\_form template and does not adjust to which graphs are available. 


  If the tool is invoked directly, all hosts defined in Hobbit will be listed. 


 
\subsection{SEE ALSO}
bb-hosts(5), hobbitserver.cfg(5) 

 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\include{bb-datepage.cgi.1}

\newpage
\section{BB-DATEPAGE.CGI}

 bb-datepage.cgi - Hobbit CGI script to view pre-built reports by date \

\subsection{SYNOPSIS}

\textbf{bb-datepage.cgi?type={day,week,month} --url=URLPREFIX [options]}


 
\subsection{DESCRIPTION}
\textbf{bb-datepage.cgi}
 is invoked as a CGI script via the bb-datepage.sh CGI wrapper. 

  bb-datepage.cgi is passed a QUERY\_STRING environment variable with
  the type of time-selection that is desired: Either ``day'', ``week''
  or ``month'' can be requested. It will then generate a web form with
  appropriate day/week/month selection boxes, and based on the users'
  selection a resulting url is built from the URLPREFIX and the time
  selection. The browser is then redirected to this URL. 



  The URL is constructed from the URLPREFIX, the type-parameter, the
  value of the ``pagepath'' or ``host'' cookie, and the users'
  selection as follows: 



 \begin{description}
\item[type=day] The final URL is \textbf{URLPREFIX/daily/YEAR/MONTH/DAY/PAGEPATH}. 

 

\item[type=week] The final URL is \textbf{URLPREFIX/weekly/YEAR/WEEK/PAGEPATH}
. 

 

\item[type=month] The final URL is \textbf{URLPREFIX/monthly/YEAR/MONTH/PAGEPATH}
. 

  YEAR is the full year (4 digits, including century). MONTH is the
  two-digit number of the month (01..12). DAY is the number of the day
  in the month (01..31). WEEK is the ISO 8601:1988 week-number
  (01..53). PAGEPATH is the current value of the ``pagepath'' cookie
  if set; if it is not set but the ``host'' cookie is set, then this
  host is looked up in the bb-hosts file and the page where this host
  is found is used for PAGEPATH. These two cookies are set by the
  default web-header templates supplied with Hobbit. 



\end{description}

\subsection{OPTIONS}
\begin{description}
\item[--url=URLPREFIX] This specifies the initial part of the final URL. This option is required. 

 

\item[--hffile=FILENAME] Specifies the template files (from \$BBHOME/web/) to use. The default is ``--hffile=report''. 

 

\item[--color=COLOR] Sets the background color of the generated webpage. The default is blue. 

 

\item[--env=FILENAME] Loads the environment defined in FILENAME before executing the CGI script. 

 

\item[--debug] Enables debugging output. 

 

\item[\$BBHOME/web/report\_form\_daily] HTML form template for the date selection form when type=daily. 

 

\item[\$BBHOME/web/report\_form\_weekly] HTML form template for the date selection form when type=weekly. 

 

\item[\$BBHOME/web/report\_form\_monthly] HTML form template for the date selection form when type=monthly. 

 

\item[\$BBHOME/web/report\_header] HTML header file for the generated web page 

 

\item[\$BBHOME/web/report\_footer] HTML footer file for the generated web page 

 


\end{description}
\subsection{ENVIRONMENT VARIABLES}
\begin{description}
\item[BBHOME] Used to locate the template files for the generated web pages. 

 

\item[QUERY\_STRING] Contains the parameters for the CGI script. 

 


\end{description}
\subsection{SEE ALSO}
bbgen(1), bb-hosts(5), hobbitserver.cfg(5) 

 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\include{hobbitlaunch.8}
\newpage
\section{HOBBITLAUNCH}
 hobbitlaunch - Master program to launch other Hobbit programs 

 
\subsection{SYNOPSIS}
\textbf{hobbitlaunch [options]}


 
\subsection{DESCRIPTION}
\emph{hobbitlaunch(8)} is the main program that controls the execution
and scheduling of all of the components in the Hobbit system. 


  hobbitlaunch allows the administrator to add, remove or change the
  set of Hobbit applications and extensions without restarting Hobbit
  - hobbitlaunch will automatically notice any changes in the set of
  tasks, and change the scheduling of activities accordingly. 



  hobbitlaunch also allows the administrator to setup specific
  logfiles for each component of the Hobbit system, instead of getting
  output from all components logged to a single file. 



 
\subsection{OPTIONS}
\begin{description}
\item[--env=FILENAME] Loads the environment from FILENAME before
  starting other tools. The environment defined by FILENAME is the
  default, it can be overridden by the ENVFILE option in
  \emph{hobbitlaunch.cfg(5)}



 

\item[--config=FILENAME] This option defines the file that
  hobbitlaunch scans for tasks it must launch. A description of this
  file is in \emph{hobbitlaunch.cfg(5)}

 The default tasklist is /etc/hobbitlaunch.cfg 

 

\item[--log=FILENAME] Defines the logfile where hobbitlaunch logs
  information about failures to launch tasks and other data about the
  operation of hobbitlaunch. Logs from individual tasks are defined in
  the hobbitlaunch.cfg file. By default this is logged to stdout. 


 

\item[--pidfile=FILENAME] Filename which hobbitlaunch saves its own process-ID to. Commonly used by automated start/stop scripts. 

 

\item[--verbose] Logs the launch of all tasks to the logfile. Note that the logfile may become quite large if you enable this. 

 

\item[--dump] Just dump the contents of the hobbitlaunch.cfg file after parsing it. Used for debugging. 

 

\item[--debug] Enable debugging output while running. 

 

\item[--no-daemon] hobbitlaunch normally detaches from the controlling
  tty and runs as a background task. This option keeps it running in
  the foreground. 


 

\end{description}
\subsection{STARTING TASKS}  hobbitlaunch will read the configuration
 file and start all of the tasks listed there. 


  If a task completes abnormally (i.e. terminated by a signal or with
  a non-zero exit status), then hobbitlaunch will attempt to restart
  it 5 times. If it still will not run, then the task is disabled for
  10 minutes. This will be logged to the hobbitlaunch logfile. 


  If the configuration file changes, hobbitlaunch will re-read it and
  notice any changes. If a running task was removed from the
  configuration, then the task is stopped. If a new task was added, it
  will be started. If the command used for a task changed, or it was
  given a new environment definition file, or the logfile was changed,
  then the task is stopped and restarted with the new definition. 



 
\subsection{SEE ALSO}
hobbitlaunch.cfg(5), hobbit(7) 

 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\include{bbdigest.1}
\newpage
\section{BBDIGEST}
 bbdigest - calculate message digests

\subsection{SYNOPSIS}
\textbf{bbdigest md5|sha1|rmd160 [filename]}


 
\subsection{DESCRIPTION}
\emph{bbdigest(1)}
 is a utility to calculate message digests for a file or document. It
 is used when defining HTTP- or FTP-based content checks, where
 \emph{bbtest-net(1)} checks that a URL returns a specific document;
 instead of having to compare the entire document, the comparison is
 done against a pre-computed message digest value using the MD5,
 RIPEMD160, SHA1 or any of the SHA2 (SHA-512, SHA-256, SHA-384,
 SHA-224) message digest algorithms. 


  The optional \textbf{filename} parameter is the input file whose
  message digest should be calculated; if no filename is given, the
  data is read from standard input. 



  bbdigest outputs a string containing the digest algorithm and the
  computed message digest. This is in a format suitable for use in the
  \emph{bb-hosts(5)}

 definition of a content check. 


 
\subsection{EXAMPLE}


\$bbdigestmd5index.html  md5:88b81b110a85c83db56a939caa2e2cf6 
  
\$curl-s\url{http://www.foo.com/}|bbdigestsha1  sha1:e5c69784cb971680e2c7380138e04021a20a45a2 

 
\subsection{SEE ALSO}
bbtest-net(1), bb-hosts(5) 

 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{BB-EVENTLOG.CGI}

 bb-eventlog.cgi - CGI program to report the Hobbit eventlog \subsection{SYNOPSIS}
\textbf{bb-eventlog.cgi}


 

\subsection{DESCRIPTION}
\textbf{bb-eventlog.cgi}
 is invoked as a CGI script via the bb-eventlog.sh CGI wrapper. Based
 on the parameters it receives, it generates the Hobbit event log for
 a period. This log shows all status changes that have occurred for
 all hosts and services. 


  bb-eventlog.cgi is passed a QUERY\_STRING environment variable with the following parameters: 


  
MAXTIME(maximumminutestogobackinthelog)  
MAXCOUNT(maximumnumberofeventstoreport) 


 
\subsection{OPTIONS}
\begin{description}
\item[--top=N] Shows a summary of the top-N changing hosts and services. 

 

\item[--env=FILENAME] Loads the environment defined in FILENAME before executing the CGI script. 

 


\end{description}
\subsection{SEE ALSO}
bb-hosts(5), hobbitserver.cfg(5) 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\include{hobbit-mailack.8}
\newpage
\section{HOBBIT-MAILACK}

 hobbit-mailack - permit acknowledging alerts via e-mail \subsection{SYNOPSIS}
\textbf{hobbit-mailack --env=FILENAME [--debug]}


 
\subsection{DESCRIPTION}
 hobbit-mailack normally runs as an input mail-filter for the hobbit user, e.g. by being called from the hobbit users' \emph{procmailrc(5)}
 file. hobbit-mailack recognizes e-mails that are replies to \emph{hobbitd\_alert(8)}
 mail alerts, and converts the reply mail into an acknowledge message that is sent to the Hobbit system. This permits an administrator to acknowledge an alert via e-mail. 

 
\subsection{ADDING INFORMATION TO THE REPLY MAIL}
 By default, an acknowledgment is valid for 1 hour. If you know in advance that solving the problem is going to take longer, you can change this by adding \textbf{delay=DURATION}
 to the subject of your mail reply or on a line in the reply message. Duration is in minutes, unless you add a trailing 'h' (for 'hours'), 'd' (for 'days') or 'w' (for 'weeks'). 

  You can also include a message that will show up on the status-page together with the acknowledgment, e.g. to provide an explanation for the issue or some other information to the users. You can either put it at the end of the subject line as \textbf{msg=Some random text}
, or you can just enter it in the e-mail as the first non-blank line of text in the mail (a ``delay=N'' line is ignored when looking for the message text). 


 
\subsection{USE WITH PROCMAIL}
 To setup hobbit-mailack, create a \textbf{.procmailrc}
 file in the hobbit-users home-directory with the following contents: \begin{description}
\item[]\begin{verbatim}

DEFAULT=$HOME/Mailbox
LOGFILE=$HOME/procmail.log
:0
| $HOME/server/bin/hobbit-mailack --env=$HOME/server/etc/hobbitserver.cfg

\end{verbatim}


 


\end{description}
\subsection{USE WITH QMAIL}
 If you are using Qmail to deliver mail locally, you can run hobbit-mailack directly from a \textbf{.qmail}
 file. Setup the hobbit-users .qmail file like this: \begin{description}
\item[]\begin{verbatim}

| $HOME/server/bin/hobbit-mailack --env=$HOME/server/etc/hobbitserver.cfg

\end{verbatim}


 


\end{description}
\subsection{OPTIONS}
\begin{description}
\item[--env=FILENAME] Load environment from FILENAME, usually hobbitserver.cfg. 

 

\item[--debug] Dont send a message to hobbitd, but dump the message to stdout. 

 


\end{description}
\subsection{SEE ALSO}
hobbitd\_alert(8), hobbitd(8), hobbit(7) 

 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{BB-FINDHOST.CGI}

 bb-findhost.cgi - Hobbit CGI script to find hosts

\subsection{SYNOPSIS}
\textbf{bb-findhost.cgi?host=REGEX}


 
\subsection{DESCRIPTION}
\textbf{bb-findhost.cgi}
 is invoked as a CGI script via the bb-findhost.sh CGI wrapper. 

  bb-findhost.cgi is passed a QUERY\_STRING environment variable with
  the ``host=REGEX'' parameter. The REGEX is a Posix regular
  expression (see \emph{regex(7)} ) describing the hostnames to look
  for. A trailing wildcard is assumed on all hostnames -
  e.g. requesting the hostname ``www'' will match any host whose name
  begins with ``www''. 

  It then produces a single web page, listing all of the hosts that
  matched any of the hostnames, with links to the Hobbit webpages
  where they are located. 

  The output page lists hosts in the order they appear in the
  \emph{bb-hosts(5)} file. 



  A sample web page implementing the search facility is included with
  bbgen, you access it via the URL /bb/help/bb-findhost.html. 



 
\subsection{OPTIONS}
\begin{description}
\item[--env=FILENAME] Loads the environment from FILENAME before executing the CGI. 

 


\end{description}
\subsection{FILES}
\begin{description}
\item[\$BBHOME/web/findhost\_header] HTML header file for the generated web page 

 

\item[\$BBHOME/web/findhost\_footer] HTML footer file for the generated web page 

 

\item[\$BBHOME/web/findhost\_form] Query form displayed when
  bb-findhost.cgi is called with no parameters. 


\end{description}
\subsection{ENVIRONMENT VARIABLES}
\begin{description}
\item[BBHOSTS] bb-findhost.cgi uses the BBHOSTS environment variable
  to find the bb-hosts file listing all known hosts and their page
  locations. 


\item[BBHOME] Used to locate the template files for the generated web pages. 


\end{description}
\subsection{SEE ALSO}
bbgen(1), bb-hosts(5), hobbitserver.cfg(5) 

 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{HOBBITCLIENT.CFG}

 hobbitclient.cfg - Hobbit client environment variables 

 

\subsection{DESCRIPTION}
 Hobbit programs use multiple environment variables beside the normal
 set of variables. For the Hobbit client, the environment definitions
 are stored in the ~hobbit/client/etc/hobbitclient.cfg file. Each line
 in this file is of the form \textbf{NAME=VALUE} and defines one
 environment variable NAME with the value VALUE. 


 
\subsection{SETTINGS}

\begin{description}

\item[BBDISP] The IP-address used to contact the Hobbit
  server. Default: Chosen when the Hobbit client was compiled. 


 

\item[BBDISPLAYS] List of IP-adresses of Hobbit servers. Data will be
  sent to all of the servers listed here. This setting is only used if
  BBDISP=0.0.0.0. 


 

\item[BBPORT] The portnumber for used to contact the Hobbit server. Default: 1984. 

 

\item[BBHOME] The Hobbit client top-level directory. Default: The
  \$HOBBITCLIENTHOME setting inherited from the ``runclient.sh''
  script which starts the Hobbit client. 


 

\item[BBCLIENTLOGS] The directory for the Hobbit clients' own logfiles. Default: \$BBHOME/logs 

 

\item[BBTMP] Directory used for temporary files. Default: \$BBHOME/tmp/ 

 

\item[BB] Full path to the \emph{bb(1)}
 client program. Default: \$BBHOME/bin/bb. 

 

\item[Commands] Many extension scripts expect a series of environment
  variables to point at various system utilities. These are included
  in the file when the client is built. 



\end{description}

\subsection{INHERITED SETTINGS}
 Some environment variables are inherited from the ``runclient.sh'' script which launches the Hobbit client: 

 \begin{description}
\item[MACHINEDOTS] The hostname of the local system. Default: Taken from ``uname -n''. 

 

\item[MACHINE] The hostname of the local system, with dots replaced by
  commas. For compatibility with Big Brother extension scripts. 


 

\item[BBOSTYPE] The operating system of the local system, in lowercase. Default: taken from ``uname -s''. 

 

\item[HOBBITCLIENTHOME] The top-level directory for the Hobbit
  client. Default: The location of the ``runclient.sh'' script. 



\end{description}

\subsection{SEE ALSO}
hobbit(7) 
 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Report Generation}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage
\section{HOBBIT-NKEDIT.CGI}

 hobbit-nkedit.cgi - Hobbit Critical Systems view CGI 

\subsection{SYNOPSIS}
\textbf{hobbit-nkedit.cgi}



\subsection{DESCRIPTION}
\textbf{hobbit-nkedit.cgi} is invoked as a CGI script via the hobbit-nkedit.sh CGI wrapper. 

  hobbit-nkedit.cgi is a web-based editor for the
  \emph{hobbit-nkview.cfg(5)} file, which is used to configure the
  Hobbit ``Critical Systems'' view. 


  A detailed description of how to use the editor is provided in the
  Hobbit Web documentation, available from the ``Help'' -$>$
  ``Critical Systems'' link on the Hobbit website. 



\subsection{SECURITY}
 Access to this CGI script should be restricted through access
 controls in your webserver. Editing the Critical Systems View
 configuration will impact the monitoring of your site. 


\subsection{OPTIONS}
\begin{description}
\item[--config=FILENAME] Name of the Critical Systems View
  configuration file. The default is hobbit-nkview.cfg in the
  \$BBHOME/etc/ directory. 


 

\item[--env=FILENAME] Loads the environment defined in FILENAME before executing the CGI script. 

 

\item[--area=NAME] Load environment variables for a specific area. NB:
  if used, this option must appear before any --env=FILENAME option. 


 

\item[--debug] Enables debugging output. 

 


\end{description}
\subsection{SEE ALSO}
hobbit-nkview.cgi(1), hobbit(7) 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Web page generation}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{BBGEN}

 bbgen - Hobbit webpage generator \subsection{SYNOPSIS}
\textbf{bbgen -?}
 
\textbf{bbgen --help}
 
\textbf{bbgen --version}
 
\textbf{bbgen [options] [output-directory]}
 
 (See the OPTIONS section for a description of the available commandline options). 

 
\subsection{DESCRIPTION}
\textbf{bbgen}
 generates the overview webpages for the Hobbit monitor. These are the
 webpages that show the overall status of your hosts, not the detailed
 status pages for each test. 


 
\subsection{OPTIONS}
 bbgen has a large number of commandline options. The options can be
 used to change the behaviour of bbgen and affect the web pages
 generated by it. 


 
\subsection{GENERAL OPTIONS}


 \begin{description}
\item[--help or -?] Provide a summary of available commandline options. 

 

\item[--version] Prints the version number of bbgen 

 

\item[--docurl=URL] Make hostnames be hyperlinks to documentation,
  accessed via a common web page (typically a CGI script or a
  PHP-driven dynamic page). The URL parameter is a formatting string
  with the name of the web page - you can put a ``\%s'' in it which
  will be replaced by the hostname being accessed. E.g. if you use the
  bb-notes extension from www.deadcat.net, you would enable this with
  ``--docurl=/hobbit/admin/notes.php?host=\%s''. For the host
  www.storner.dk this will result in a link to
  ``/hobbit/admin/notes.php?host=www.storner.dk``. 


 

\item[--doccgi=URL] This option is deprecated; please use --docurl instead. 

 

\item[--no-doc-window] By default, links to documentation for hosts
  and services cause a new window to appear with the information. With
  this option, the documentation will appear in the same window as the
  Hobbit status. 


 

\item[--htmlextension=.EXTENSION] Sets the filename extension used for
  the webpages generated by bbgen. By default, an extension of
  ``.html'' is used. Note that you need to specify the ``dot''. 


 

\item[--report[=COLUMNNAME]] With this option, bbgen will send a
  status message with details of how many hosts were processed, how
  many pages were generated, any errors that occurred during the run,
  and some timing statistics. The default columnname is ``bbgen''. 


 

\item[--htaccess[=htaccess-filename]] Create .htaccess files when new
  web page directories are created. The content of the .htaccess files
  are determined by the BBHTACCESS environment variable (for the
  top-level directory with bb.html and bb2.html); by the
  BBPAGEHTACCESS variable (for the page-level directories); and by the
  BBSUBPAGEHTACCESS variable for subpage- and subparent-level
  directories. The filename of the .htaccess files default to
  ``.htaccess'' if no filename is given with this option. The
  BBHTACCESS variable is copied verbatim into the top-level .htaccess
  file. The BBPAGEHTACCESS variable may contain a ``\%s'' where the
  name of the page is inserted. The BBSUBPAGEHTACCESS variable may
  contain two ``\%s'' instances: The first is replaced with the
  pagename, the second with the subpagename. 


 

\item[--max-eventcount=N] Limit the eventlog on the BB2 page to only N
  events. Default: 100. 


 

\item[--max-eventtime=N] Limit the eventlog on the BB2 page to events
  that happened within the past N minutes. Default: 240. 


 

\item[--no-eventlog] Disable the eventlog normally displayed on the BB2 page 

 

\item[--max-ackcount=N] Limit the acknowledgment log on the BB2 page to only N events. Default: 25. 

 

\item[--max-acktime=N] Limit the acknowledgment log on the BB2 page to acks that happened within the past N minutes. Default: 240. 

 

\item[--no-acklog] Disable the acknowledgement log normally displayed on the BB2 page. 

 

\item[--nklog[=NK log column]] This generates a text-based log of what
  is shown on the bbnk.html status page, and sends a status message
  for the BBDISPLAY server itself reflecting the color of the NK
  status page. This allows you to track when problems have appeared on
  the bbnk status page. The logfile is stored in \$BBHOME/nkstatus.log 



 


\end{description}

\subsection{PAGE LAYOUT OPTIONS}
 These options affect how the webpages generated by bbgen appear in the browser. 

 \begin{description}
\item[--pages-last] Put page- and subpage-links after hosts. 
\item[--pages-first] Put page- and subpage-links before hosts (default). 

  These two options decide whether a page with links to subpages and hosts have the hosts or the subpages first. 


 

\item[--subpagecolumns=N] Determines the number of columns used for links to pages and subpages. The default is N=1. 

 

\item[--maxrows=N] Column headings on a page are by default only shown
  at the beginning of a page, subpage or group of hosts. This options
  causes the column headings to repeat for every N hosts shown. 


 

\item[--pagetitle-links] Normally, only the colored ``dots'' next to a
  page or subpage act as links to the page itself. With this option,
  the page title will link to the page also. 


 

\item[--pagetext-headings] Use the description text from the ``page''
  or ``subpage'' tags as a heading for the page, instead of the
  ``Pages hosted locally'' or other standard heading. 


 

\item[--no-underline-headings] Normally, page headings are underlined
  using an HTML ``horizontal ruler'' tag. This option disables the
  underlining of headings. 


 

\item[--recentgifs[=MINUTES]] Use images named COLOR-recent.gif for
  tests, where the test status has changed within the past 24
  hours. These GIF files need to be installed in the
  \$BBHOME/www/gifs/ directory. By default, the threshold is set to 24
  hours - if you want it differently, you can specify the time limit
  also. E.g. ``--recentgifs=3h'' will show the recent GIFs for only 3
  hours after a status change. 


 

\item[--sort-group-only-items] In a normal ``group-only'' directive,
  you can specify the order in which the tests are displayed, from
  left to right. If you prefer to have the tests listed in
  alphabetical order, use this option - the page will then generate
  ``group-only'' groups like it generates normal groups, and sort the
  tests alphabetically. 


 

\item[--dialupskin=URL] If you want to visually show that a test is a
  dialup-test, you can use an alternate set of icons for the
  green/red/yellow$>$/etc. images by specifying this option. The URL
  parameter specified here overrides the normal setting from the
  BBSKIN environment variable, but only for dialup tests. 


 

\item[--reverseskin=URL] Same as ``--dialupskin'', but for reverse tests (tests with '!' in front). 

 

\item[--tooltips=[always,never,main]] Determines which pages use
  tooltips to show the description of the host (from the COMMENT entry
  in the \emph{bb-hosts(5)}

 file). If set to \textbf{always}
, tooltips are used on all pages. If set to \textbf{never}
, tooltips are never used. If set to \textbf{main}
, tooltips are used on the main pages, but not on the BB2 (all non-green) or NK (critical systems) pages. 

 


\end{description}

\subsection{COLUMN SELECTION OPTIONS}
 These options affect which columns (tests) are included in the webpages generated by bbgen. 

 \begin{description}
\item[--ignorecolumns=test[,test]] The given columns will be
  completely ignored by bbgen when generating webpages. Can be used to
  generate reports where you eliminate some of the more noisy tests,
  like ``msgs''. 


 

\item[--nk-reds-only] Only red status columns will be included on the
  NK page. By default, the NK page will contain hosts with red, yellow
  and clear status. 


 

\item[--bb2colors=COLOR[,COLOR]] Defines which colors cause a test to
  appear on the ``All non-green'' status page (a.k.a. the BB2
  page). COLOR is red, yellow or purple. The default is to include all
  three. 


 

\item[--bb2-ignorecolumns=test[,test]] Same as the --ignorecolumns, but applies to hosts on the BB2 page only. 

 

\item[--bb2-ignorepurples] Deprecated, use ``--bb2colors'' instead. 

 

\item[--bb2-ignoredialups] Ignore all dialup hosts on the BB2 page, including the BB2 eventlog. 

 

\item[--includecolumns=test[,test]] Always include these columns on
  bb2 page Will include certain columns on the bb2.html page,
  regardless of its color. Normally, bb2.html drops a test-column, if
  all tests are green. This can be used e.g. to always have a link to
  the trends column (with the RRD graphs) from your bb2.html page. 


 

\item[--eventignore=test[,test]] Ignore these tests in the BB2 event log display. 

 


\end{description}

\subsection{STATUS PROPAGATION OPTIONS}
 These options suppress the normal propagation of a status upwards in
 the page hierarchy. Thus, you can have a test with status yellow or
 red, but still have the entire page green. It is useful for tests
 that need not cause an alarm, but where you still want to know the
 actual status. These options set global defaults for all hosts; you
 can use the NOPROPRED and NOPROPYELLOW tags in the \emph{bb-hosts(5)}
 file to apply similar limits on a per-host basis. 


\begin{description}

\item[--nopropyellow=test[,test] or --noprop=test[,test]] Disable
  upwards status propagation when YELLOW. The ``--noprop'' option is
  deprecated and should not be used. 
 

\item[--noproppurple=test[,test]] Disable upwards status propagation when PURPLE. 

 

\item[--nopropred=test[,test]] Disable upwards status propagation when RED or YELLOW. 

 

\item[--nopropack=test[,test]] Disable upwards status propagation when
  status has been acknowledged. If you want to disable all acked tests
  from being propageted, use ``--nopropack=*''. 


 


\end{description}

\subsection{PURPLE STATUS OPTIONS}
 Purple statuses occur when reporting of a test status stops. A test
 status is valid for a limited amount of time - normally 30 minutes -
 and after this time, the test becomes purple. 


 \begin{description}
\item[--purplelog=FILENAME] Generate a logfile of all purple status messages. 

 


\end{description}

\subsection{ALTERNATE PAGESET OPTIONS}


 \begin{description}
\item[--pageset=PAGESETNAME] Build webpages for an alternate pageset than the default. See the PAGESETS section below. 

 

\item[--template=TEMPLATE] Use an alternate template for header and
  footer files. Typically used together the the ``--pageset'' option;
  see the PAGESETS section below. 

\end{description}

\subsection{ALTERNATE OUTPUT FORMATS}


 \begin{description}

\item[--wml[=test1,test2,...]] This option causes bbgen to generate a
  set of WML ``card'' files that can be accessed by a WAP device (cell
  phone, PDA etc.) The generated files contain the hosts that have a
  RED or YELLOW status on tests specified. This option can define the
  default tests to include - the defaults can be overridden or amended
  using the ``WML:'' or ``NK:'' tags in the \emph{bb-hosts(5)}
  file. If no tests are specified, all tests will be included. 


 

\item[--nstab=FILENAME] Generate an HTML file suitable for a Netscape
  6/Mozilla sidebar entry. To actually enable your users to obtain
  such a sidebar entry, you need this Javascript code in a webpage
  (e.g. you can include it in the \$BBHOME/web/bb\_header file): 


%  $<$SCRIPT TYPE=''text/javascript''$>$  
% $<$!--  
% function addNetscapePanel() \{  
% 
%if((typeofwindow.sidebar==''object'')\&\&  
%(typeofwindow.sidebar.addPanel==''function''))  
% 
%window.sidebar.addPanel(``Hobbit'',  
% 
%''\url{http://your.server.com/nstab.html}``,''``);  
% 
%else  
% 
%alert(``SidebaronlyforMozillaorNetscape6+'');  
% \}  
% //--$>$  
% $<$/SCRIPT$>$ 
%

  and then you can include a ``Add this to sidebar'' link using this as a template: 


% $<$AHREF=''javascript:addNetscapePanel();''$>$AddtoSidebar$<$/A$>$ 


  or if you prefer to have the standard Netscape ``Add tab'' button, you would do it with 

%
%  
%$<$AHREF=''javascript:addNetscapePanel();''$>$  
% 
%$<$IMGSRC=''/gifs/add-button.gif''HEIGHT=45WIDTH=100  
% 
%ALT=''[AddSidebar]''STYLE=''border:0''$>$  
% 
%$<$/A$>$ 


  The ``add-button.gif'' is available from Netscape at
  \url{http://developer.netscape.com/docs/manuals/browser/sidebar/add-button.gif.}



  If FILENAME does not begin with a slash, the Netscape sidebar file is placed in the \$BBHOME/www/ directory. 


 

\item[--nslimit=COLOR] The minimum color to include in the Netscape
  Sidebar - default is ``red'', meaning only critical alerts are
  included. If you want to include warnings also, use
  ``--nslimit=yellow''. 


 

\item[--rss] Generate RSS/RDF content delivery stream of your Hobbit
  alerts. This output format can be dynamically embedded in other web
  pages, much like the live newsfeeds often seen on web sites. Two RSS
  files will be generated, one reflects the BB2 page, the other
  reflects the BBNK page. They will be in the ``bb2.rss'' and
  ``bbnk.rss'' files, respectively. In addition, an RSS file will be
  generated for each page and/or subpage listing the hosts present on
  that page or subpage.  

 The FILENAME parameter previously allowed on the --rss option is now obsolete.  
 For more information about RSS/RDF content feeds, please see \url{http://www.syndic8.com/.}

 

\item[--rssextension=.EXTENSION] Sets the filename extension used for
  the RSS files generated by bbgen. By default, an extension of
  ``.rss'' is used. Note that you need to specify the ``dot''. 


 

\item[--rssversion=\\{0.91|0.92|1.0|2.0\\}] The desired output format of
  the RSS/RDF feed. Version 0.91 appears to be the most commonly used
  format, and is the default if this option is omitted. 


 

\item[--rsslimit=COLOR] The minimum color to include in the RSS feed -
  default is ``red'', meaning only critical alerts are included. If
  you want to include warnings also, use ``--rsslimit=yellow''. 

\end{description}

\subsection{OPTIONS USED BY CGI FRONT-ENDS}
\begin{description}
\item[--reportopts=START:END:DYNAMIC:STYLE] Invoke bbgen in
  report-generation mode. This is normally used by the
  \emph{bb-rep.cgi(1)}

 CGI script, but may also be used directly when pre-generating
 reports. The START parameter is the start-time for the report in Unix
 time\_t format (seconds since Jan 1st 1970 00:00 UTC); END is the
 end-time for the report; DYNAMIC is 0 for a pre-built report and 1
 for a dynamic (on-line) report; STYLE is ``crit'' to include only
 critical (red) events, ``non-crit'' to include all non-green events,
 and ``all'' to include all events. 


 

\item[--csv=FILENAME] Used together with --reportopts, this causes
  bbgen to generate an availability report in the form of a
  comma-separated values (CSV) file. This format is commonly used for
  importing into spreadsheets for further processing.  

 The CSV file includes Unix timestamps. To display these as human
 readable times in Excel, the formula
 \textbf{=C2/86400+DATEVALUE(1-jan-1970)}

 (if you have the Unix timestamp in the cell C2) can be used. The
 result cell should be formatted as a date/time field. Note that the
 timestamps are in UTC, so you may also need to handle local timezone
 and DST issues yourself. 


 

\item[--csvdelim=DELIMITER] By default, a comma is used to delimit
  fields in the CSV output. Some non-english spreadsheets use a
  different delimiter, typically semi-colon. To generate a CSV file
  with the proper delimiter, you can use this option to set the
  character used as delimiter. E.g. ``--csvdelim=;'' - note that this
  normally should be in double quotes, to prevent the Unix shell from
  interpreting the delimiter character as a commandline delimiter. 



\item[--snapshot=TIME] Generate a snapshot of the Hobbit pages, as
  they appeared at TIME. TIME is given as seconds since Jan 1st 1970
  00:00 UTC. Normally used via the \emph{bb-snapshot.cgi(1)} CGI script. 

 


\end{description}
\subsection{DEBUGGING OPTIONS}


 \begin{description}
\item[--debug] Causes bbgen to dump large amounts of debugging output
  to stdout, if it was compiled with the -DDEBUG enabled. When
  reporting a problem with bbgen, please try to reproduce the problem
  and provide the output from running bbgen with this option. 


 

\item[--timing] Dump information about the time spent by various parts
  of bbgen to stdout. This is useful to see what part of the
  processing is responsible for the run-time of bbgen.  

 Note: This information is also provided in the output sent to the Hobbit display when using the ``--report'' option. 

 


 


\end{description}

\subsection{BUILDING ALTERNATE PAGESETS}
 With version 1.4 of bbgen comes the possibility to generate multiple
 sets of pages from the same data.  

 Suppose you have two groups of people looking at the BB
 webpages. Group A wants to have the hosts grouped by the client, they
 belong to. This is how you have Hobbit set up - the default
 pageset. Now group B wants to have the hosts grouped by operating
 system - let us call it the ``os'' set. Then you would add the page
 layout to bb-hosts like this: 


 ospage win Microsoft Windows  
 ossubpage win-nt4 MS Windows NT 4  
 osgroup NT4 File servers  
 osgroup NT4 Mail servers  
 ossubpage win-xp MS Windows XP  
 ospage unix Unix  
 ossubpage unix-sun Solaris  
 ossubpage unix-linux Linux 


  This defines a set of pages with one top-level page (the bb.html
  page), two pages linked from bb.html (win.html and unix.html), and
  from e.g. the win.html page there are subpages win-nt4.html and
  win-xp.html  

 The syntax is identical to the normal ``page'' and ``subpage''
 directives in bb-hosts, but the directive is prefixed with the
 pageset name. Dont put any hosts in-between the page and subpage
 directives - just add all the directives at the top of the bb-hosts
 file.  

 How do you add hosts to the pages, then ? Simple - just put a tag
 ``OS:win-xp'' on the host definition line. The ``OS'' must be the
 same as prefix used for the pageset names, but in uppercase. The
 ``win-xp'' must match one of the pages or subpages defined within
 this pageset. E.g. 



  207.46.249.190 www.microsoft.com \# OS:win-xp \url{http://www.microsoft.com/} 
 64.124.140.181 www.sun.com \# OS:unix-sun \url{http://www.sun.com/}


  If you want the host to appear inside a group defined on that page,
  you must identify the group by number, starting at 1. E.g. to put a
  host inside the ``NT4 Mail servers'' group in the example above, use
  ``OS:win-nt4,2'' (the second group on the ``win-nt4'' page).  

 If you want the host to show up on the frontpage instead of a subpage, use ``OS:*'' . 


  All of this just defines the layout of the new pageset. To generate
  it, you must run bbgen once for each pageset you define -
  i.e. create an extension script like this: \begin{description}

\item[]\begin{verbatim}

#!/bin/sh

BBWEB="/hobbit/os" $BBHOME/bin/bbgen \
        --pageset=os --template=os \
        $BBHOME/www/os/

\end{verbatim}


\end{description}



  Save this to \$BBHOME/ext/os-display.sh, and set this up to run as a
  Hobbit extension; this means addng an extra section to
  hobbitlaunch.cfg to run it. 



  This generates the pages. There are some important options used here:  
 * BBWEB=''/hobbit/os'' environment variable, and the  
''\$BBHOME/www/os/''optionworktogether,andplacesthe  
newpagesetHTMLfilesinasubdirectoryoffthenormal  
Hobbitwebroot.IfyounormallyaccesstheHobbitpagesas  
''\url{http://hobbit.acme.com/hobbit/}``,youwillthenaccess  
thenewpagesetas''\url{http://hobbit.acme.com/hobbit/os/}``  
NB:ThedirectorygivenasBBWEBmustcontainasymbolic  
linktothe\$BBHOME/www/html/directory,orlinksto  
individualstatusmessageswillnotwork.Similarlinks  
shouldbemadeforthegifs/,help/andnotes/  
directories.  
 * ``--pageset=os'' tells bbgen to structure the webpages  
usingthe''os''layout,insteadofthedefaultlayout.  
 * ``--template=os'' tells bbgen to use a different set of  
header-andfooter-templates.Normallybbgenusesthe  
standardtemplatein\$BBHOME/web/bb\_headerand  
.../bb\_footer-withthisoption,itwillinsteaduse  
thefiles''os\_header''and''os\_footer''fromthe  
\$BBHOME/web/directory.Thisallowsyoutocustomize  
headersandfootersforeachpageset.Ifyoujustwant  
tousethenormaltemplate,youcanomitthisoption. 


 
\subsection{USING BBGEN FOR REPORTS}
 bbgen reporting is implemented via drop-in replacements for the standard Hobbit reporting scripts (bb-rep.sh and bb-replog.sh) installed in your webservers cgi-bin directory. 

  These two shell script have been replaced with two very small
  shell-scripts, that merely setup the Hobbit environment variables,
  and invoke the \emph{bb-rep.cgi(1)} or \emph{bb-replog.cgi(1)}
  scripts in \$BBHOME/bin/ 



  You can use bbgen commandline options when generating reports,
  e.g. to exclude certain types of tests
  (e.g. ``--ignorecolumns=msgs'') from the reports, to specify the
  name of the trends- and info- columns that should not be in the
  report, or to format the report differently
  (e.g. ``--subpagecolumns=2''). If you want certain options to be
  used when a report is generated from the web interface, put these
  options into your \$BBHOME/etc/hobbitserver.cfg file in the
  BBGENREPOPTS environment variable. 



  The report files generated by bbgen are stored in individual
  directories (one per report) below the \$BBHOME/www/rep/
  directory. These should be automatically cleaned up - as new reports
  are generated, the old ones get removed. 



  After installing, try generating a report. You will probably see
  that the links in the upper left corner (to bb-ack.html, bb2.html
  etc.) no longer works. To fix these, change your
  \$BBHOME/web/bbrep\_header file so these links do not refer to
  ``\&BBWEB'' but to the normal URL prefix for your Hobbit pages. 



 
\subsection{SLA REPORTING}
 bbgen reporting allows for the generation of true SLA (Service Level
 Agreement) reports, also for service periods that are not 24x7. This
 is enabled by defining a ``REPORTTIME:timespec'' tag for the hosts to
 define the service period, and optionally a ``WARNPCT:level'' tag to
 define the agreed availability. 


  Note: See \emph{bb-hosts(5)}
 for the exact syntax of these options. 


  ``REPORTTIME:timespec'' specifies the time of day when the service
  is expected to be up and running. By default this is 24 hours a day,
  all days of the week. If your SLA only covers Mon-Fri 7am - 8pm, you
  define this as ``REPORTTIME=W:0700:2000'', and the report generator
  will then compute both the normal 24x7 availability but also a ``SLA
  availability'' which only takes the status of the host during the
  SLA period into account. 



  The DOWNTIME:timespec parameter affects the SLA availability
  calculation. If an outage occurs during the time defined as possible
  ``DOWNTIME'', then the failure is reported with a status of
  ``blue''. (The same color is used if you ``disable'' then host using
  the Hobbit ``disable'' function). The time when the test status is
  ``blue'' is not included in the SLA calculation, neither in the
  amount of time where the host is considered down, nor in the total
  amount of time that the report covers. So ``blue'' time is
  effectively ignored by the SLA availability calculation, allowing
  you to have planned downtime without affecting the reported SLA
  availability. 



  Example: A host has ``DOWNTIME:*:0700:0730 REPORTTIME=W:0600:2200''
  because it is rebooted every day between 7am and 7.30am, but the
  service must be available from 6am to 10pm. For the day of the
  report, it was down from 7:10am to 7:15am (the planned reboot), but
  also from 9:53pm to 10:15pm. So the events for the day are: 



  
0700:greenfor10minutes(600seconds)  
0710:bluefor5minutes(300seconds)  
0715:greenfor14hours38minutes(52680seconds)  
2153:redfor22minutes(1320seconds)  
2215:green 


  The service is available for 600+52680 = 53280 seconds. It is down
  (red) for 420 seconds (the time from 21:53 until 22:00 when the SLA
  period ends). The total time included in the report is 15 hours (7am
  - 10pm) except the 5 minutes blue = 53700 seconds. So the SLA
  availability is 53280/53700 = 99,22\% 



  The ``WARNPCT:level'' tag is supported in the bb-hosts file, to set
  the availability threshold on a host-by-host basis. This threshold
  determines whether a test is reported as green, yellow or red in the
  reports. A default value can be set for all hosts with the via the
  BBREPWARN environment variable, but overridden by this tag. The
  level is given as a percentage, e.g. ``WARNPCT:98.5'' 

 
\subsection{PRE-GENERATED REPORTS}
 Normally, bbgen produce reports that link to dynamically generated webpages with the detailed status of a test (via the bb-replog.sh CGI script). 

  It is possible to have bbgen produce a report without these dynamic
  links, so the report can be exported to another server. It may also
  be useful to pre-generate the reports, to lower the load by having
  multiple users generate the same reports. 



  To do this, you must run bbgen with the ``--reportopts'' option to
  select the time interval that the report covers, the reporting style
  (critical, non-green, or all events), and to request that no dynamic
  pages are to be generated. 



  The syntax is: 


  
bbgen--reportopts=starttime:endtime:nodynamic:style 


  ``starttime'' and ``endtime'' are specified as Unix time\_t values,
  i.e. seconds since Jan 1st 1970 00:00 GMT. Fortunately, this can
  easily be computed with the GNU date utility if you use the ``+\%s''
  output option. If you don't have the GNU date utility, either pick
  that up from www.gnu.org; or you can use the ``etime'' utility for
  the same purpose, which is available from the archive at
  www.deadcat.net. 



  ``nodynamic'' is either 0 (for dynamic pages, the default) or 1 (for no dynamic, i.e. pre-generated, pages). 


  ``style'' is either ``crit'' (include critical i.e. red events only), ``nongr'' (include all non-green events), or ``all'' (include all events). 


  Other bbgen options can be used, e.g. ``--ignorecolumns'' if you want to exclude certain tests from the report. 


  You will normally also need to specify the BBWEB environment
  variable (it must match the base URL for where the report will be
  made accessible from), and an output directory where the report
  files are saved. If you specify BBWEB, you should probably also
  define the BBHELPSKIN and BBNOTESSKIN environment variables. These
  should point to the URL where your Hobbit help- and notes-files are
  located; if they are not defined, the links to help- and notes-files
  will point inside the report directory and will probably not work. 



  So a typical invocation of bbgen for a static report would be: 


  
START=`date+\%s--date=''22Jun200300:00:00''`  
END=`date+\%s--date=''22Jun200323:59:59''`  
BBWEB=/reports/bigbrother/daily/2003/06/22$\backslash$  
BBHELPSKIN=/hobbit/help$\backslash$  
BBNOTESSKIN=/hobbit/notes$\backslash$  
bbgen--reportopts=\$START:\$END:1:crit$\backslash$  
--subpagecolumns=2$\backslash$  
/var/www/docroot/reports/hobbit/daily/2003/06/22 


  The ``BBWEB'' setting means that the report will be available with a
  URL of
  ``\url{http://www.server.com/reports/hobbit/daily/2003/06/22}``. The
  report contains internal links that use this URL, so it cannot be
  easily moved to another location. 



  The last parameter is the corresponding physical directory on your
  webserver matching the BBWEB URL. You can of course create the
  report files anywhere you like - perhaps on another machine - and
  then move them to the webserver later on. 



  Note how the \emph{date(1)}
 utility is used to calculate the start- and end-time parameters. 


 
\subsection{SEE ALSO}
bb-hosts(5), hobbitserver.cfg(5), hobbitlaunch.cfg(5), bb-rep.cgi(1), bb-snapshot.cgi(1), hobbit(7) 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\include{hobbit-nkview.cfg.5}
\newpage
\section{HOBBIT-NKVIEW.CGI}

hobbit-nkview.cgi - Hobbit Critical Systems view CGI

 \subsection{SYNOPSIS}
\textbf{hobbit-nkview.cgi}


 
\subsection{DESCRIPTION}
\textbf{hobbit-nkview.cgi}
 is invoked as a CGI script via the hobbit-nkview.sh CGI wrapper. 

  hobbit-nkview.cgi matches the current critical statuses against the \emph{hobbit-nkview.cfg(5)}
 file, and generates the ``Critical Systems'' view. 


 
\subsection{RELATION TO BBNK PAGE}
 This view is a replacement for the statically generated ``bbnk'' page
 provided in versions of Hobbit prior to version 4.2. Although the
 ``bbnk'' pages are supported throughout Hobbit 4.x, it is recommended
 that You switch to the newer Critical Systems view provided by this
 CGI. 


 
\subsection{OPTIONS}
\begin{description}
\item[--nkacklevel=NUMBER] Sets the acknowledgment level for
  acknowledgments sent via the \emph{hobbit-ackinfo.cgi(1)} page. Note
  that this may be overridden by the configuration of the
  hobbit-ackinfo.cgi utility. 


 

\item[--env=FILENAME] Loads the environment defined in FILENAME before
  executing the CGI script. 


 

\item[--area=NAME] Load environment variables for a specific area. NB:
  if used, this option must appear before any --env=FILENAME option. 


 

\item[--debug] Enables debugging output. 

 


\end{description}
\subsection{ENVIRONMENT VARIABLES}
\begin{description}
\item[BBHOME] Used to locate the template files for the generated web pages. 

 

\item[QUERY\_STRING] Contains the parameters for the CGI script. 

 


\end{description}
\subsection{SEE ALSO}
hobbit-ackinfo.cgi(1), hobbit(7) 

  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{BB-HIST.CGI}

 bb-hist.cgi - CGI program to display service history \subsection{SYNOPSIS}
\textbf{bb-hist.cgi}


 
\subsection{DESCRIPTION}
\textbf{bb-hist.cgi}
 is invoked as a CGI script via the bb-hist.sh CGI wrapper. It is
 passed a QUERY\_STRING environment variable with the following
 parameters: 


  
HISTFILE(aHobbitservicehistoryfile)  
ENTRIES(thenumberofentriestoshow)  
 The following non-standard parameters are handled by the bbgen version of bb-hist.cgi: 


  
IP(IPaddressofhost-fordisplaypurposesonly)  
PIXELS(widthofcolorbarwheninpixel-mode)  
ENDTIME(whenthecolorbarbegins,atime\_tvalue)  
BARSUMS(whichcolorbarsandsummariestoshow) 


  bb-hist.cgi analyses the service history file for changes that have
  occurred within the past 24 hours, and build a colorbar showing the
  status of the service over this period of time. A statistics summary
  is also produced, listing the amount of time for each status (green,
  yellow, red, purple, blue, clear). 



  Finally, a summary of the last N events is given, with links to the actual event logs. 


  Unlike the standard bb-hist.sh script, bb-hist.cgi provides a
  colorbar and statistics summaries also covering the past 1 week, 4
  weeks and 1 year of data. Via links it is possible to browse the
  entire history of the service at the requested interval. 



  Note that since the resolution of the display is limited, events may
  be too short to show up on a colorbar; also, the exact placement of
  an event may not fully match up with the time-markers. 



  The graphs should correctly handle the display of months with
  different number of days, as well as the display of periods that
  involve beginning and end of Daylight Savings Time, if this occurs
  in your timezone. 



  All dates and times shown are in local time for the timezone defined on the BBDISPLAY server. 


 


 
\subsection{PARAMETERS}
\begin{description}

\item[HISTFILE] Defines the host and service whose history is
  presented. 

\item[ENTRIES] The number of log-entries to show in the event log
  table. Default is 50; to view all log entries set this to ``ALL''. 

\item[IP] The IP-address of the host. This is only used for the title
  of the document. 

\item[PIXELS] The width of the colorbar graph in pixels. If this is
  set to 0, a percentage-based graph will be shown, similar to the one
  provided by the standard bb-hist.sh script. Pixel-based graphs can
  have a higher resolution, but do not resize automatically to suit
  the size of a browser window. The default value for this parameter
  is defined at compile-time; 960 is a good value for displays with a
  1024x768 resolution. 

\item[BARSUMS] Defines which colorbars and summaries to show. This is
  a number made up from a bitmask. The 1-day graph uses the value
  ``1''; the 1-week graph uses the value ``2''; the 4-week graph uses
  the value ``4'' and the 1-year graph the value ``8''. To show
  multiple graph, add the values - e.g. ``6'' will show the 1-week and
  4-weeks graphs, whereas ``15'' will show all the graphs. The default
  is defined at compile-time. 

\item[ENDTIME] The history display by default ends with the current
  time. Setting the ENDTIME parameter causes it to end at the time
  specified - this is given as a Unix ``time\_t'' value, i.e. as the
  number of seconds elapsed since Jan 1 1970 00:00 UTC. 


 


\end{description}
\subsection{OPTIONS}
\begin{description}
\item[--env=FILENAME] Load the environment from FILENAME before executing the CGI. 

\end{description}
\subsection{SEE ALSO}
bb-hosts(5), hobbitserver.cfg(5) 

 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{HOBBIT-CONFREPORT.CGI}
 hobbit-confreport.cgi - Hobbit Configuration report

 \subsection{SYNOPSIS}
\textbf{hobbit-confreport.cgi}

 
\subsection{DESCRIPTION}
\textbf{hobbit-confreport.cgi}
 is invoked as a CGI script via the hobbit-confreport.sh CGI wrapper. 

 \textbf{hobbit-confreport.cgi}
 provides a plain HTML (Web) report of the Hobbit configuration for a
 group of hosts; which hosts are included is determined by the hosts
 available on the webpage from where the CGI script is invoked. 



  The configuration report include the hostnames, a list of the
  statuses monitored for each host, and if applicable any
  configuration settings affecting these. Alerts that may be triggered
  by status changes are also included. 



  The report is plain HTML without any images included, and therefore
  suitable for inclusion into e-mails or other documents that may be
  accessed outside the Hobbit system. 



 
\subsection{OPTIONS}
\begin{description}
\item[--critical] Report only on the statuses that are configured to
  show up on the \textbf{Critical Systems} view. 

 

\item[--old-nk-config] Use the deprecated \textbf{NK}
 tag in bb-hosts to determine if tests appear on the Critical Systems view. 

 

\item[--env=FILENAME] Loads the environment defined in FILENAME before
  executing the CGI script. 


 

\item[--area=NAME] Load environment variables for a specific area. NB:
  if used, this option must appear before any --env=FILENAME option. 


\item[--debug] Enables debugging output. 

 

\end{description}
\subsection{BUGS}
 Client-side configuration done in the \emph{hobbit-clients.cfg(5)}
 is not currently reflected in the report. 

  Critical Systems view configuration is not reflected in the report. 


 
\subsection{SEE ALSO}
bb-hosts(5), hobbit-alerts.cfg(5), hobbit-clients.cfg(5), hobbit(7) 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{HOBBIT-NKVIEW.CGI}


 hobbit-nkview.cgi - Hobbit Critical Systems view CGI 

\subsection{SYNOPSIS}
\textbf{hobbit-nkview.cgi}


 
\subsection{DESCRIPTION}
\textbf{hobbit-nkview.cgi} is invoked as a CGI script via the hobbit-nkview.sh CGI wrapper. 

  hobbit-nkview.cgi matches the current critical statuses against the
  \emph{hobbit-nkview.cfg(5)} file, and generates the ``Critical
  Systems'' view. 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{BBHOSTGREP}

 bbhostgrep - pick out lines in bb-hosts

 \subsection{SYNOPSIS}
\textbf{bbhostgrep --help}
 
\textbf{bbhostgrep --version}
 
\textbf{bbhostgrep [--noextras] [--test-untagged] [--bbdisp] [--bbnet] TAG [TAG...]}


 
\subsection{DESCRIPTION}
\emph{bbhostgrep(1)}
 is for use by extension scripts that need to pick out the entries in
 a bb-hosts file that are relevant to the script. 


  The utility accepts test names as parameters, and will then parse
  the bb-hosts file and print out the host entries that have at least
  one of the wanted tests specified. Tags may be given with a trailing
  asterisk '*', e.g. ``bbhostgrep http*'' is needed to find all http
  and https tags. 



  The bbhostgrep utility supports the use of ``include'' directives
  inside the bb-hosts file, and will find matching tags in all
  included files. 



  If the DOWNTIME or SLA tags are used in the \emph{bb-hosts(5)} file,
  these are interpreted relative to the current time. bbhostgrep then
  outputs a ``INSIDESLA'' or ``OUTSIDESLA'' tag for easier use by
  scripts that want to check if the current time is inside or outside
  the expected uptime window. 



 
\subsection{OPTIONS}
\begin{description}
\item[--noextras] Remove the ``testip'', ``dialup'', ``INSIDESLA'' and ``OUTSIDESLA'' tags from the output. 

 

\item[--test-untagged] When using the BBLOCATION environment variable
  to test only hosts on a particular network segment, bbtest-net will
  ignore hosts that do not have any ``NET:x'' tag. So only hosts that
  have a NET:\$BBLOCATION tag will be tested.   With this option,
  hosts with no NET: tag are included in the test, so that all hosts
  that either have a matching NET: tag, or no NET: tag at all are
  tested. 


 

\item[--no-down[=TESTNAME]] bbhostgrep will query the Hobbit server
  for the current status of the ``conn'' test, and if TESTNAME is
  specified also for the current state of the specified test. If the
  status of the ``conn'' test for a host is non-green, or the status
  of the TESTNAME test is disabled, then this host is ignored and will
  not be included in the output. This can be used to ignore hosts that
  are down, or hosts where the custom test is disabled. 


 

\item[--bbdisp] Search the bb-hosts file following include statements
  as a BBDISPLAY server would. 


 

\item[--bbnet] Search the bb-hosts file following include statements
  as a BBNET server would. 


 


\end{description}
\subsection{EXAMPLE}
 If your bb-hosts file looks like this 

  
192.168.1.1www.test.com\#ftptelnet!oracle  
192.168.1.2db1.test.com\#oracle  
192.168.1.3mail.test.com\#smtp 


  and you have a custom Hobbit extension script that performs the
  ``oracle'' test, then running ``bbhostgrep oracle'' would yield 



  
192.168.1.1www.test.com\#!oracle  
192.168.1.2db1.test.com\#oracle 


  so the script can quickly find the hosts that are of interest. 


  Note that the reverse-test modifier - ``!oracle'' - is included in
  the output; this also applies to the other test modifiers defined by
  Hobbit (the dialup and always-true modifiers). 



  If your extension scripts use more than one tag, just list all of
  the interesting tags on the command line. 



  bbhostgrep also supports the ``NET:location'' tag used by
  bbtest-net, so if your script performs network checks then it will
  see only the hosts that are relevant for the test location that the
  script currently executes on. 



 
\subsection{USE IN EXTENSION SCRIPTS}
 To integrate bbhostgrep into an existing script, look for the line in the script that grep's in the \$BBHOSTS file. Typically it will look somewhat like this: 

  
\$GREP-i''\^{}[0-9].*\#.*TESTNAME''\$BBHOSTS|...codetohandletest 


  Instead of the grep, we will use bbhostgrep. It then becomes 


  
\$BBHOME/bin/bbhostgrepTESTNAME|...codetohandletest 


  which is simpler, less error-prone and more efficient. 


 
\subsection{ENVIRONMENT VARIABLES}
\begin{description}
\item[BBLOCATION] If set, bbhostgrep outputs only lines from bb-hosts that have a matching NET:\$BBLOCATION setting. 

 

\item[BBHOSTS] Filename for the Hobbit \emph{bb-hosts(5)}
 file. 

 


\end{description}
\subsection{FILES}
\begin{description}
\item[\$BBHOSTS] The Hobbit bb-hosts file 

 


\end{description}
\subsection{SEE ALSO}
bb-hosts(5), hobbitserver.cfg(5) 

  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{HOBBITD}

 hobbitd - Master network daemon for a Hobbit server
 \subsection{SYNOPSIS}
\textbf{hobbitd [options]}


 
\subsection{DESCRIPTION}
 hobbitd is the core daemon in the Hobbit Monitor. It is designed to handle monitoring of a large number of hosts, with a strong focus on being a high-speed, low-overhead implementation of a Big Brother compatible server. 

  To achieve this, hobbitd stores all information about the state of the monitored systems in memory, instead of storing it in the host filesystem. A number of plug-ins can be enabled to enhance the basic operation; e.g. a set of plugins are provided to implement persistent storage in a way that is compatible with the Big Brother daemon. However, even with these plugins enabled, hobbitd still performs much faster than the standard bbd daemon. 


  hobbitd is normally started and controlled by the \emph{hobbitlaunch(8)}
 tool, and the command used to invoke hobbitd should therefore be in the hobbitlaunch.cfg file. 


 
\subsection{OPTIONS}
\begin{description}
\item[--bbhosts=FILENAME] Specifies the path to the Hobbit bb-hosts file. This is used to check if incoming status messages refer to known hosts; depending on the ``--ghosts'' option, messages for unknown hosts may be dropped. If this option is omitted, the default path used is set by the BBHOSTS environment variable. 

 

\item[--checkpoint-file=FILENAME] With regular intervals, hobbitd will dump all of its internal state to this check-point file. It is also dumped when hobbitd terminates, or when it receives a SIGUSR1 signal. 

 

\item[--checkpoint-interval=N] Specifies the interval (in seconds) between dumps to the check-point file. The default is 900 seconds (15 minutes). 

 

\item[--restart=FILENAME] Specifies an existing file containing a previously generated hobbitd checkpoint. When starting up, hobbitd will restore its internal state from the information in this file. You can use the same filename for ``--checkpoint-file'' and ``--restart''. 

 

\item[--ghosts= \\{allow|drop|log\\}] How to handle status messages from unknown hosts. The ``allow'' setting accepts all status messages, regardless of whether the host is known in the bb-hosts file or not. ``drop'' silently ignores reports from unknown hosts. ``log'' works like drop, but logs the event in the hobbitd output file. The default is ``allow'', unless the BBGHOSTS environment variable is set. 

 

\item[--no-purple] Prevent status messages from going purple when they are no longer valid. Unlike the standard bbd daemon, purple-handling is done by hobbitd. 

 

\item[--listen=IP[:PORT]] Specifies the IP-address and port where hobbitd will listen for incoming connections. By default, hobbitd listens on IP 0.0.0.0 (i.e. all IP- adresses available on the host) and port 1984. 

 

\item[--daemon] hobbitd is normally started by \emph{hobbitlaunch(8)}
 it will then detach from the terminal and continue running as a background task. 

 

\item[--timeout=N] Set the timeout used for incoming connections. If a status has not been received more than N seconds after the connection was accepted, then the connection is dropped and any status message is discarded. Default: 10 seconds. 

 

\item[--env=FILENAME] Loads the content of FILENAME as environment settings before starting hobbitd. This is mostly used when running as a stand-alone daemon; if hobbitd is started by hobbitlaunch, the environment settings are controlled by the hobbitlaunch hobbitlaunch.cfg file. 

 

\item[--pidfile=FILENAME] hobbitd writes the process-ID it is running with to this file. This is for use in automated startup scripts. The default file is \$BBSERVERLOGS/hobbitd.pid. 

 

\item[--log=FILENAME] Redirect all output from hobbitd to FILENAME. 

 

\item[--store-clientlogs[=[!]COLUMN]] Determines which status columns can cause a client message to be broadcast to the CLICHG channel. By default, no client messages are pushed to the CLICHG channel. If this option is specified with no parameter list, all status columns that go into an alert state will trigger the client data to be sent to the CLICHG channel. If a paramater list is added to this option, only those status columns listed in the list will cause the client data to be sent to the CLICHG channel. Several column names can be listed, separated by commas. If all columns are given as ``!COLUMNNAME'', then all status columns except those listed will cause the client data to be sent. 

 

\item[--status-senders=IP[/MASK][,IP/MASK]] Controls which hosts may send ``status'', ``combo'', ``config'' and ``query'' commands to hobbitd. 

  By default, any host can send status-updates. If this option is used, then status-updates are accepted only if they are sent by one of the IP-adresses listed here, or if they are sent from the IP-address of the host that the updates pertains to (this is to allow Hobbit clients to send in their own status updates, without having to list all clients here). So typically you will need to list your BBNET servers here. 


  The format of this option is a list of IP-adresses, optionally with a network mask in the form of the number of bits. E.g. if you want to accept status-updates from the host 172.16.10.2, you would use  
 
--status-senders=172.16.10.2  
 whereas if you want to accept status updates from both 172.16.10.2 and from all of the hosts on the 10.0.2.* network (a 24-bit IP network), you would use  
 
--status-senders=172.16.10.2,10.0.2.0/24 


 

\item[--maint-senders=IP[/MASK][,IP/MASK]] Controls which hosts may send maintenance commands to hobbitd. Maintenance commands are the ``enable'', ``disable'', ``ack'' and ``notes'' commands. Format of this option is as for the --status-senders option. It is strongly recommended that you use this to restrict access to these commands, so that monitoring of a host cannot be disabled by a rogue user - e.g. to hide a system compromise from the monitoring system. 

 \textbf{Note:}
 If messages are sent through a proxy, the IP-address restrictions are of little use, since the messages will appear to originate from the proxy server address. It is therefore strongly recommended that you do NOT include the address of a server running bbproxy in the list of allowed addresses. 


 

\item[--www-senders=IP[/MASK][,IP/MASK]] Controls which hosts may send commands to retrieve the state of hobbitd. These are the ``hobbitdlog'', ``hobbitdboard'' and ``hobbitdxboard'' commands, which are used by \emph{bbgen(1)}
 and \emph{bbcombotest(1)}
 to retrieve the state of the Hobbit system so they can generate the Hobbit webpages. 

 \textbf{Note:}
 If messages are sent through a proxy, the IP-address restrictions are of little use, since the messages will appear to originate from the proxy server address. It is therefore strongly recommended that you do NOT include the address of a server running bbproxy in the list of allowed addresses. 


 

\item[--admin-senders=IP[/MASK][,IP/MASK]] Controls which hosts may send administrative commands to hobbitd. These commands are the ``drop'' and ``rename'' commands. Access to these should be restricted, since they provide an un-authenticated means of completely disabling monitoring of a host, and can be used to remove all traces of e.g. a system compromise from the Hobbit monitor. 

 \textbf{Note:}
 If messages are sent through a proxy, the IP-address restrictions are of little use, since the messages will appear to originate from the proxy server address. It is therefore strongly recommended that you do NOT include the address of a server running bbproxy in the list of allowed addresses. 


 

\item[--no-download] Disable the ``download'' and ``config'' commands which can be used by clients to pull files from the Hobbit server. The use of these may be seen as a security risk since they allow file downloads. 

 

\item[--debug] Enable debugging output. 

 

\item[--dbghost=HOSTNAME] For troubleshooting problems with a specific host, it may be useful to track the exact communications from a single host. This option causes hobbitd to dump all traffic from a single host to the file ``/tmp/hobbitd.dbg''. 

 


\end{description}
\subsection{HOW ALERTS TRIGGER}
 When a status arrives, hobbitd matches the old and new color against the ``alert'' colors (from the ``ALERTCOLORS'' setting) and the ``OK'' colors (from the ``OKCOLORS'' setting). The old and new color falls into one of three categories: 

 \textbf{OK:}
 The color is one of the ``OK'' colors (e.g. ``green''). 


 \textbf{ALERT:}
 The color is one of the ``alert'' colors (e.g. ``red''). 


 \textbf{UNDECIDED:}
 The color is neither an ``alert'' color nor an ``OK'' color (e.g. ``yellow''). 


  If the new status shows an ALERT state, then a message to the \emph{hobbitd\_alert(8) }
 module is triggered. This may be a repeat of a previous alert, but \emph{hobbitd\_alert(8)}
 will handle that internally, and only send alert messages with the interval configured in \emph{hobbit-alerts.cfg(5).}



  If the status goes from a not-OK state (ALERT or UNDECIDED) to OK, and there is a record of having been in a ALERT state previously, then a recovery message is triggered. 


  The use of the OK, ALERT and UNDECIDED states make it possible to avoid being flooded with alerts when a status flip-flops between e.g yellow and red, or green and yellow. 


 
\subsection{CHANNELS}
 A lot of functionality in the Hobbit server is delegated to ``worker modules'' that are fed various events from hobbitd via a ``channel''. Programs access a channel using IPC mechanisms - specifically, shared memory and semaphores - or by using an instance of the \emph{hobbitd\_channel(8)}
 intermediate program. hobbitd\_channel enables access to a channel via a simple file I/O interface. 

  A skeleton program for hooking into a hobbitd channel is provided as part of Hobbit in the \emph{hobbitd\_sample(8)}
 program. 


  The following channels are provided by hobbitd: 


 \textbf{status}
 This channel is fed the contents of all incoming ``status'' and ``summary'' messages. 


 \textbf{stachg}
 This channel is fed information about tests that change status, i.e. the color of the status-log changes. 


 \textbf{page}
 This channel is fed information about tests where the color changes between an alert color and a non-alert color. It also receives information about ``ack'' messages. 


 \textbf{data}
 This channel is fed information about all ``data'' messages. 


 \textbf{notes}
 This channel is fed information about all ``notes'' messages. 


 \textbf{enadis}
 This channel is fed information about hosts or tests that are being disabled or enabled. 


 \textbf{client}
 This channel is fed the contents of the client messages sent by Hobbit clients installed on the monitored servers. 


 \textbf{clichg}
 This channel is fed the contents of a host client messages, whenever a status for that host goes red, yellow or purple. 


  Information about the data stream passed on these channels is in the Hobbit source-tree, see the ``hobbitd/new-daemon.txt'' file. 


 
\subsection{SIGNALS}
\begin{description}
\item[SIGHUP] Re-read the bb-hosts configuration file. 

 

\item[SIGUSR1] Force an immediate dump of the checkpoint file. 

 


\end{description}
\subsection{BUGS}
 Timeout of incoming connections are not strictly enforced. The check for a timeout only triggers during the normal network handling loop, so a connection that should timeout after N seconds may persist until some activity happens on another (unrelated) connection. 

 
\subsection{FILES}
 If ghost-handling is enabled via the ``--ghosts'' option, the bb-hosts file is read to determine the names of all known hosts. 

 
\subsection{SEE ALSO}
hobbit(7), hobbitserver.cfg(5). 
  

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{HOBBITPING}

 hobbitping - Hobbit ping tool
 \subsection{SYNOPSIS}
\textbf{hobbitping [--retries=N] [--timeout=N] [IP-adresses]}


 
\subsection{DESCRIPTION}
\emph{hobbitping(1)}
 is used for ping testing of the hosts monitored by the
 \emph{hobbit(7)} monitoring system. It reads a list of IP adresses
 from stdin, and performs a ``ping'' check to see if these hosts are
 alive. It is normally invoked by the \emph{bbtest-net(1)} utility,
 which performs all of the Hobbit network tests. 


  Optionally, if a list of IP-adresses is passed as commandline
  arguments, it will ping those IP's instead of reading them from
  stdin. 



  hobbitping only handles IP-adresses, not hostnames. 


  hobbitping was inspired by the \emph{fping(1)} tool, but has been
  written from scratch to implement a fast ping tester without much of
  the overhead found in other such utilities. The output from
  hobbitping is similar to that of ``fping -Ae''. 



  hobbitping probes multiple systems in parallel, and the runtime is
  therefore mostly dependant on the timeout-setting and the number of
  retries. With the default options, hobbitping takes approximately 18
  seconds to ping all hosts (tested with an input set of 1500 IP
  adresses). 



 
\subsection{SUID-ROOT INSTALLATION REQUIRED}
 hobbitping needs to be installed with suid-root privileges, since it
 requires a ``raw socket'' to send and receive ICMP Echo (ping)
 packets. 


  hobbitping is implemented such that it immediately drops the root
  privileges, and only regains them to perform two operations:
  Obtaining the raw socket, and optionally binding it to a specific
  source address. These operations are performed as root, the rest of
  the time hobbitping runs with normal user privileges. Specifically,
  no user-supplied data or network data is used while running with
  root privileges. Therefore it should be safe to provide hobbitping
  with the necessary suid-root privileges. 



 
\subsection{OPTIONS}
\begin{description}
\item[--retries=N] Sets the number of retries for hosts that fail to
  respond to the initial ping, i.e. the number of ping probes sent in
  addition to the initial probe. The default is --retries=2, to ping a
  host 3 times before concluding that it is not responding. 


 

\item[--timeout=N] Determines the timeout (in seconds) for ping
  probes. If a host does not respond within N seconds, it is regarded
  as unavailable, unless it responds to one of the retries. The
  default is --timeout=5. 


 

\item[--responses=N] hobbitping normally stops pinging a host after
  receiving a single response, and uses that to determine the
  round-trip time. If the first response takes longer to arrive -
  e.g. because of additional network overhead when first determining
  the route to the target host - it may skew the round-trip-time
  reports. You can then use this option to require N responses, and
  hobbitping will calculate the round-trip time as the average of all
  of responsetimes. 


 

\item[--max-pps=N] Maximum number of packets per second. This limits
  the number of ICMP packets hobbitping will send per second, by
  enforcing a brief delay after each packet is sent. The default
  setting is to send a maximum of 50 packets per second. Note that
  increasing this may cause flooding of the network, and since ICMP
  packets can be discarded by routers and other network equipment,
  this can cause erratic behaviour with hosts recorded as not
  responding when they are in fact OK. 


 

\item[--source=ADDRESS] Use ADDRESS as the source IP address of the
  ping packets sent. On multi-homed systems, allows you to select the
  source IP of the hosts going out, which might be necessary for ping
  to work. 


 

\item[--debug] Enable debug output. This prints out all packets sent and received. 



\end{description}
\subsection{SEE ALSO}
hobbit(7), bbtest-net(1), fping(1) 

 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{HOBBITD\_ALERT}

 hobbitd\_alert - hobbitd worker module for sending out alerts

 \subsection{SYNOPSIS}
\textbf{hobbitd\_channel --channel=page hobbitd\_alert [options]}


 
\subsection{DESCRIPTION}
 hobbitd\_alert is a worker module for hobbitd, and as such it is
 normally run via the \emph{hobbitd\_channel(8)} program. It receives
 hobbitd page- and ack-messages from the ``page'' channel via stdin,
 and uses these to send out alerts about failed and recovered hosts
 and services. 


  The operation of this module is controlled by the
  \emph{hobbit-alerts.cfg(5)} file. This file holds the definition of
  rules and recipients, that determine who gets alerts, how often, for
  what servers etc. 



 
\subsection{OPTIONS}
\begin{description}
\item[--config=FILENAME] Sets the filename for the \emph{hobbit-alerts.cfg}
 file. The default value is ``etc/hobbit-alerts.cfg'' below the Hobbit server directory. 

 

\item[--dump-config] Dumps the configuration after parsing it. May be
  useful to track down problems with configuration file errors. 


 

\item[--checkpoint-file=FILENAME] File where the current state of the
  hobbitd\_alert module is saved. When starting up, hobbitd\_alert
  will also read this file to restore the previous state. 


 

\item[--checkpoint-interval=N] Defines how often (in seconds) the checkpoint-file is saved. 

 

\item[--cfid] If this option is present, alert messages will include a
  line with ``cfid:N'' where N is the linenumber in the
  hobbit-alerts.cfg file that caused this message to be sent. This can
  be useful to track down problems with duplicate alerts. 


 

\item[--test HOST SERVICE [options]] Shows which alert rules matches
  the given HOST/SERVICE combination. Useful to debug configuration
  problems, and see what rules are used for an alert. 


  The possible options are:  
\textbf{--color=COLORNAME}
 The COLORNAME parameter is the color of the alert: red, yellow or purple.  
\textbf{--duration=SECONDS}
 The SECONDS parameter is the duration of the alert in seconds.  
\textbf{--group=GROUPNAME}
 The GROUPNAME paramater is a groupid string from the hobbit-clients.cfg file.  
\textbf{--time=TIMESTRING}
 The TIMESTRING parameter is the time-of-day for the alert, expressed
 as an absolute time in the epoch format (seconds since Jan 1
 1970). This is easily obtained with the GNU date utility using the
 ``+\%s'' output format. 



\item[--debug] Enable debugging output. 

 


\end{description}
\subsection{HOW HOBBIT DECIDES WHEN TO SEND ALERTS}
 The hobbitd\_alert module is responsible for sending out all
 alerts. When a status first goes to one of the ALERTCOLORS,
 hobbitd\_alert is notified of this change. It notes that the status
 is now in an alert state, and records the \textbf{timestamp} when
 this event started, and adds the alert to the list statuses that may
 potentially trigger one or more alert messages. 


  This list is then matched against the hobbit-alerts.cfg
  configuration. This happens at least once a minute, but may happen
  more often. E.g. when status first goes into an alert state, this
  will always trigger the matching to happen. 



  When scanning the configuration, hobbitd\_alert looks at all of the
  configuration rules. It also checks the DURATION setting against how
  long time has elapsed since the event started - i.e. against the
  timestamp logged when hobbitd\_alert first heard of this event. 



  When an alert recipient is found, the alert is sent and it is
  recorded when this recipient is due for his next alert message,
  based on the REPEAT setting defined for this recipient. The next
  time hobbitd\_alert scans the configuration for what alerts to send,
  it will still find this recipient because all of the configuration
  rules are fulfilled, but an alert message will not be generated
  until the repeat interval has elapsed. 



  It can happen that a status first goes yellow and triggers an alert,
  and later it goes red - e.g. a disk filling up. In that case,
  hobbitd\_alert clears the internal timer for when the next (repeat)
  alert is due for all recipients. You generally want to be told when
  something that has been in a warning state becomes critical, so in
  that case the REPEAT setting is ignored and the alert is sent. This
  only happens the first time such a change occurs - if the status
  switches between yellow and red multiple times, only the first
  transition from yellow-$>$red causes this override. 



  When an status recovers, a recovery message may be sent - depending
  on the configuration - and then hobbitd\_alert forgets everything
  about this status. So the next time it goes into an alert state, the
  entire process starts all over again. 



 


 
\subsection{ENVIRONMENT}
\begin{description}
\item[MAIL] The first part of a command line used to send out an
  e-mail with a subject, typically set to ``/usr/bin/mail -s''
  . hobbitd\_alert will add the subject and the mail recipients to
  form the command line used for sending out email alerts. 


 

\item[MAILC] The first part of a command line used to send out an
  e-mail without a subject. Typically this will be
  ``/usr/bin/mail''. hobbitd\_alert will add the mail recipients to
  form the command line used for sending out email alerts. 


 
\end{description}
\subsection{FILES}
\begin{description}
\item[~hobbit/server/etc/hobbit-alerts.cfg]


\end{description}
\subsection{SEE ALSO}
hobbit-alerts.cfg(5), hobbitd(8), hobbitd\_channel(8), hobbit(7) 

 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{BBHOSTSHOW}

 bbhostshow - output the full bb-hosts file 
\subsection{SYNOPSIS}
\textbf{bbhostshow [--bbdisp] [--bbnet] [filename]}


 
\subsection{DESCRIPTION}
\emph{bbhostshow(1)} dumps the full bb-hosts file to stdout. It
follows ``include'' tags in the bb-hosts files, and prints the full
contents as seen by the \emph{bbgen(1)} and \emph{bbtest-net(1)} utilities. 

  If no filename is given, bbhostshow displays the file pointed to by
  the BBHOSTS environment variable. 



 
\subsection{OPTIONS}
\begin{description}
\item[--bbdisp] Show the bb-hosts file following include statements as
  a BBDISPLAY server would. 


 

\item[--bbnet] Show the bb-hosts file following include statements as
  a BBNET server would. 

\end{description}
\subsection{ENVIRONMENT VARIABLES}
\begin{description}
\item[BBHOSTS] Filename for the \emph{bb-hosts(5)}
 file. 

 


\end{description}
\subsection{SEE ALSO}
bb-hosts(5), hobbitserver.cfg(5) 

  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{HOBBITD\_CAPTURE}

 hobbitd\_capture - catch selected messages from a hobbitd channel

\subsection{SYNOPSIS}
\textbf{hobbitd\_channel --channel=status hobbitd\_capture [options]}


 
\subsection{DESCRIPTION}
 hobbitd\_capture is a worker module for hobbitd, and as such it is
 normally run via the \emph{hobbitd\_channel(8)} program. It receives
 messages from hobbitd via stdin and filters them to select messages
 based on the hostname, testname or color of the status. By default
 the resulting messages are printed on stdout, but they can also be
 fed into a command for further processing. 


  hobbitd\_capture supports the \textbf{status}
, \textbf{data}
 and \textbf{hostdata}
 channels. 


 
\subsection{OPTIONS}
\begin{description}
\item[--hosts=PATTERN] Select messages only from hosts matching
  PATTERN (regular expression). 


 

\item[--exhosts=PATTERN] Exclude messages from hosts matching
  PATTERN. If used with the --hosts option, then the hostname must
  match the --hosts pattern, but NOT the --exhosts pattern. 


 

\item[--tests=PATTERN] Select messages only from tests matching PATTERN (regular expression). 

 

\item[--extests=PATTERN] Exclude messages from tests matching
  PATTERN. If used with the --tests option, then the testname must
  match the --tests pattern, but NOT the --extests pattern. 


 

\item[--colors=COLOR[,color]] Select messages based on the color of
  the status message. Multiple colors can be listed, separated by
  comma. Default: Accept all colors. 


 

\item[--batch-command=COMMAND] Instead of printing the messages to
  stdout, feed them to COMMAND on stdin. COMMAND can be any command
  which accepts the mssage on standard input. 


 

\item[--batch-timeout=SECONDS] Collect messages until no messages have arrived in SECONDS seconds, before sending them to the --batch-command COMMAND. 

 

\item[--debug] Enable debugging output. 

 


\end{description}
\subsection{SEE ALSO}
hobbitd\_channel(8), hobbitd(8), hobbit(7) 

 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{HOBBIT-STATUSREPORT.CGI}

 hobbit-statusreport.cgi - CGI program to report a status for a group
 of servers
 \subsection{SYNOPSIS}
\textbf{hobbit-statusreport.cgi --column=COLUMNNAME [options]}


 
\subsection{DESCRIPTION}
\textbf{hobbit-statusreport.cgi} is a CGI tool to generate a simple
HTML report showing the current status of a single column for a group
of Hobbit hosts. 


  E.g. You can use this report to get an overview of all of the SSL certificates that are about to expire. 


  The generated webpage is a simple HTML table, suitable for copying into other documents or e-mail. 


  hobbit-statusreport.cgi runs as a CGI program, invoked by your webserver. It is normally run via a wrapper shell-script in the CGI directory for Hobbit. 


 
\subsection{EXAMPLES}
 The Hobbit installation includes two web report scripts using this
 CGI tool: The \textbf{hobbit-certreport.sh} script generates a list
 of SSL server certificates that are yellow or red (i.e. they will
 expire soon); and the \textbf{hobbit-nongreen.sh} script generates a
 report of all statuses that are currently non-green. These can be
 accessed from a web browser through a URL referencing the script in
 the Hobbit CGI directory (e.g. ``/hobbit-cgi/hobbit-nongreen.sh''). 


 
\subsection{OPTIONS}
\begin{description}
\item[--column=COLUMNNAME] Report the status of the COLUMNNAME column. 

 

\item[--all] Report the status for all hosts known to Hobbit. By
  default, this tool reports only on the hosts found on the current
  page from where the CGI was invoked (by looking at the ``pagepath''
  cookie). 


 

\item[--filter=CRITERIA] Only report on statuses that match the
  CRITERIA setting. See the \emph{bb(1)} man-page - in the
  ``hobbitdboard'' command description - for details about specifying
  filters. 


 

\item[--heading=HTML] Defines the webpage heading - i.e. the ``title'' tag in the generated HTML code. 

 

\item[--show-column] Include the column name in the display. 

 

\item[--show-colors] Show the status color on the generated webpage. The default is to not show the status color. 

 

\item[--no-colors] Do not include text showing the current color of each status in the report. This is the default. 

 

\item[--show-summary] Show only a summary of the important lines in
  the status message. By default, the entire status message appears in
  the generated HTML code. This option causes the first non-blank line
  of the status message to be shown, and also any lines beginning with
  ``\&COLOR'' which is used by many status messages to point out lines
  of interest (non-green lines only, though). 


 

\item[--show-message] Show the entire message on the webpage. This is the default. 

 

\item[--link] Include HTML links to the host ``info'' page, and the status page. 

 

\item[--embedded] Only generate the HTML table, not a full
  webpage. This can be used to embed the status report into an
  external webpage. 


 

\item[--env=FILENAME] Load the environment from FILENAME before executing the CGI. 

 

\item[--area=NAME] Load environment variables for a specific area. NB:
  if used, this option must appear before any --env=FILENAME option. 


 


\end{description}
\subsection{SEE ALSO}
hobbit(7) 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\include{bbmessage.cgi.8}
\newpage
\section{BBMESSAGE.CGI}

 bbmessage.cgi - CGI utility used for proxying Hobbit data over HTTP

 \subsection{SYNOPSIS}
\textbf{bbmessage.cgi}


 
\subsection{DESCRIPTION}
\emph{bbmessage.cgi(8)}
 is the server-side utility receiving Hobbit messages sent by the
 \emph{bb(1)} utility over an HTTP transport. The \textbf{bb} utility
 normally sends data over a dedicated TCP protocol, but it may use
 HTTP to go through proxies or through restrictive firewalls. In that
 case, the webserver must have this CGI utility installed, which takes
 care of receiving the message via HTTP, and forwards it to a local
 Hobbit server through the normal Hobbit transport. 


  The CGI expects to be invoked from an HTTP ``POST'' request, with
  the POST-data being the status-message. \textbf{bbmessage.cgi}
  simply collects all of the POST data, and send it off as a message
  to the Hobbit daemon running on IP 127.0.0.1. This destination IP
  currently cannot be changed. 



  The CGI will return any output provided by the Hobbit daemon back to
  the requestor as the response to the HTTP POST, so this allows for
  all normal Hobbit commands to work. 



 
\subsection{SECURITY}
\textbf{bbmesage.cgi} will only send data to a Hobbit server through
the loopback interface, i.e. IP-address 127.0.0.1. 


  Access to the CGI should be restricted through webserver access
  controls, since the CGI provides no authentication at all to
  validate incoming messages. 



  If possible, consider using the \emph{bbproxy(8)}
 utility instead for native proxying of Hobbit data between networks. 


 
\subsection{SEE ALSO}
bb(1), bbproxy(8), hobbit(7) 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Hobbit server programs}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{HOBBITD\_CHANNEL}

 hobbitd\_channel - Feed a hobbitd channel to a worker module 

\subsection{SYNOPSIS}
\textbf{hobbitd\_channel --channel=CHANNEL [options] workerprogram [worker-options]}


 
\subsection{DESCRIPTION}
 hobbitd\_channel hooks into one of the \emph{hobbitd(8)} channels
 that provide information about events occurring in the Hobbit
 system. It retrieves messages from the hobbitd daemon, and passes
 them on to the \textbf{workerprogram} on the STDIN (file descripter
 1) of the worker program. Worker programs can then handle messages as
 they like. 


  A number of worker programs are shipped with hobbitd,
  e.g. \emph{hobbitd\_filestore(8)}

 \emph{hobbitd\_history(8)}
 \emph{hobbitd\_alert(8)}
 \emph{hobbitd\_rrd(8)}
 \emph{hobbitd\_client(8)}



  If you want to write your own worker module, a sample worker module
  is provided as part of the hobbitd distribution in the
  hobbitd\_sample.c file. This illustrates how to easily fetch and
  parse messages. 



 
\subsection{OPTIONS}
 hobbitd\_channel accepts a few options. 

 \begin{description}
\item[--channel=CHANNELNAME] Specifies the channel to receive messages
  from, only one channel can be used. This option is required. The
  following channels are available:  

 ``status'' receives all Hobbit status- and summary-messages  
 ``stachg'' receives information about status changes  
 ``page'' receives information about statuses triggering alerts  
 ``data'' receives all Hobbit ``data'' messages  
 ``notes'' receives all Hobbit ``notes'' messages  
 ``enadis'' receives information about hosts being disabled or enabled.  
 ``client'' receives all data sent from Hobbit client systems 

 

\item[--net=PEERSERVER:PEERPORT] Instead of launching a worker module
  as a local task, the messages in the channel are forwarded over a
  TCP/IP connection to another host where the worker module is
  running. This is typically used for sharing the load of the heavier
  worker modules across multiple systems, e.g. the hobbitd\_client and
  hobbitd\_rrd workers may receive data this way. With this option,
  the \textbf{workerprogram} parameter is ignored and may be omitted.  

 On the remote server, the worker modules are usually launched via inetd. 

 

\item[--daemon] hobbitd\_channel is normally started by
  \emph{hobbitlaunch(8)} as a task defined in the
  \emph{hobbitlaunch.cfg(5)} file. If you are not using hobbitlaunch,
  then starting hobbitd\_channel with this option causes it to run as
  a stand-alone background task. 


 

\item[--pidfile=FILENAME] If running as a stand-alone daemon,
  hobbitd\_channel will save the proces-ID of the daemon in
  FILENAME. This is useful for automated startup- and shutdown-
  scripts. 


 

\item[--env=FILENAME] Loads the environment variables defined in
  FILENAME before starting hobbitd\_channel. This is normally used
  only when running as a stand-alone daemon; if hobbitd\_channel is
  started by hobbitlaunch, then the environment is controlled by the
  task definition in the \emph{hobbitlaunch.cfg(5)} file. 

 

\item[--log=FILENAME] Redirect output to this log-file. 

 

\item[--debug] Enable debugging output. 

 


\end{description}

\subsection{FILES}
 This program does not use any configuration files. 

 
\subsection{SEE ALSO}
hobbitd(8), hobbit(7) 

 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{BB-HOSTSVC.CGI}

hgcmd{hobbitsvc.cgi} - CGI program to view Hobbit status logs

\subsection{SYNOPSIS}
\textbf{hobbitsvc.cgi [--hobbitd|--historical] [--history=\\{top|bottom\\}]}



\subsection{DESCRIPTION}
\textbf{hobbitsvc.cgi}
 is a CGI program to present a Hobbit status log in HTML form (ie, as a web page). It can be used both for the logs showing the current status, and for historical logs from the ``histlogs'' directory. It is normally invoked as a CGI program, and therefore receives most of the input parameters via the CGI QUERY\_STRING environment variable. 

  Unless the ``--historical'' option is present, the current status log is used. This assumes a QUERY\_STRING environment variable of the form  
 
HOSTSVC=hostname.servicename  
 where ``hostname'' is the name of the host with commas instead of dots, and ``servicename'' is the name of the service (the column name in Hobbit). Such links are automatically generated by the \emph{bbgen(1)}
 tool when the environment contains ``BBLOGSTATUS=dynamic''. 


  With the ``--historical'' option present, a historical logfile is used. This assumes a QUERY\_STRING environment variable of the form  
 
HOST=hostname\&SERVICE=servicename\&TIMEBUF=timestamp  
 where ``hostname'' is the name of the host with commas instead of dots, ``servicename'' is the name of the service, and ``timestamp'' is the time of the log. This is automatically generated by the \emph{bb-hist.cgi(1)}
 tool. 



\subsection{OPTIONS}
\begin{description}
\item[--hobbitd] Retrieve the current status log from \emph{hobbitd(1)}
 rather than from the logfile. This is for use with the Hobbit daemon from the Hobbit monitor version 4. 

 

\item[--historical] Use a historical logfile instead of the current logfile. 

 

\item[--history=\\{top|bottom|none\\}] When showing the current logfile, provide a ``HISTORY'' button at the top or the bottom of the webpage, or not at all. The default is to put the HISTORY button at the bottom of the page. 

 

\item[--env=FILENAME] Load the environment from FILENAME before executing the CGI. 

 

\item[--templates=DIRECTORY] Where to look for the HTML header- and footer-templates used when generating the webpages. Default: \$BBHOME/web/ 

 

\item[--no-svcid] Do not include the HTML tags to identify the hostname/service on the generated web page. Useful is this already happens in the hostsvc\_header template file, for instance. 

 

\item[--multigraphs=TEST1[,TEST2]] This causes hobbitsvc.cgi to generate links to service graphs that are split up into multiple images, with at most 5 graphs per image. This option only works in Hobbit mode. If not specified, only the ``disk'' status is split up this way. 

 

\item[--no-disable] By default, the info-column page includes a form allowing users to disable and re-enable tests. If your setup uses the default separation of administration tools into a separate, password- protected area, then use of the disable- and enable-functions requires access to the administration tools. If you prefer to do this only via the dedicated administration page, this option will remove the disable-function from the info page. 

 

\item[--no-jsvalidation] The disable-function on the info-column page by default uses JavaScript to validate the form before submitting the input to the Hobbit server. However, some browsers cannot handle the Javascript code correctly so the form does not work. This option disables the use of Javascript for form-validation, allowing these browsers to use the disable-function. 

 


\end{description}
\subsection{FILES}
\begin{description}
\item[\$BBHOME/web/hostsvc\_header] HTML template header 

 

\item[\$BBHOME/web/hostsvc\_footer] HTML template footer 

 


\end{description}
\subsection{ENVIRONMENT}
\begin{description}
\item[NONHISTS=info,trends,graphs] A comma-separated list of services that does not have meaningful history, e.g. the ``info'' and ``trends'' columns. Services listed here do not get a ``History'' button. 

 

\item[TEST2RRD=test,test] A comma-separated list of the tests that have an RRD graph. 

 


\end{description}
\subsection{SEE ALSO}
hobbit(7), hobbitd(1) 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\include{bbproxy.8}

\newpage
\section{BBPROXY}

 bbproxy - Hobbit message proxy 
\subsection{SYNOPSIS}
\textbf{bbproxy [options] --servers=IP}

 
\subsection{DESCRIPTION}
\emph{bbproxy(8)}
 is a proxy for forwarding Hobbit messages from one server to another. It will typically be needed if you have clients behind a firewall, so they cannot send status messages to the Hobbit server directly. 

 ~\cite{web:patchutils}hgcmd{bbproxy} serves three purposes. First, it acts as a regular proxy server, allowing clients that cannot connect directly to the Hobbit server to send messages to the Hobbit servers. Although bbproxy is optimized for handling status messages, it will forward all types of messages.  



  Second, it acts as a buffer, smoothing out peak loads if many clients try to send status messages simultaneously. bbproxy can absorb messages very quickly, but will queue them up internally and forward them to the Hobbit server at a reasonable pace. This helps even out the load on your Hobbit server.  



  Third, bbproxy merges small ``status'' messages into larger ``combo'' messages. This can dramatically decrease the number of connections that need to go from bbproxy to the Hobbit server, and is a slightly more efficient way of transmitting data to the Hobbit server. The merging of messages causes ``status'' messages to be delayed for up to 0.25 seconds before being sent off to the Hobbit server. 


 
\subsection{OPTIONS}
\begin{description}
\item[--servers=SERVERIP[:PORT][,SERVER2IP[:PORT]]] Specifies the IP-address and optional portnumber where incoming messages are forwarded to. The default portnumber is 1984, the standard Hobbit port number. Up to 3 servers can be specified; incoming messages are sent to all of them (except ``config'', ``query'' and ``download'' messages, which go to the LAST server only). If you have Hobbit clients sending their data via this proxy, note that the clients will receive their configuration data from the LAST of the servers listed here. This option is required. 

 

\item[--bbdisplay=SERVERIP[:PORT][,SERVER2IP[:PORT]]] Obsolete. Use ``--servers'' instead. 

 

\item[--listen=LOCALIP[:PORT]] Specifies the IP-adress where bbproxy listens for incoming connections. By default, bbproxy listens on all IP-adresses assigned to the host. If no portnumber is given, port 1984 will be used. 

 

\item[--timeout=N] Specifies the number of seconds after which a connection is aborted due to a timeout. Default: 10 seconds. 

 

\item[--report=[PROXYHOSTNAME.]PROXYSERVICE] If given, this option causes bbproxy to send a status report every 5 minutes to the Hobbit server about itself. If you have set the standard Hobbit environment, you can use ``--report=bbproxy'' to have bbproxy report its status to a ``bbproxy'' column in Hobbit. The default for PROXYHOSTNAME is the \$MACHINE environment variable, i.e. the hostname of the server running bbproxy. See REPORT OUTPUT below for an explanation of the report contents. 

 

\item[--lqueue=N] Size of the listen-queue where incoming connections can queue up before being processed. This should be large to accomodate bursts of activity from clients. Default: 512. 

 

\item[--daemon] Run in daemon mode, i.e. detach and run as a background proces. This is the default. 

 

\item[--no-daemon] Runs bbproxy as a foreground proces. 

 

\item[--pidfile=FILENAME] Specifies the location of a file containing the proces-ID of the bbproxy daemon proces. Default: /var/run/bbproxy.pid. 

 

\item[--logfile=FILENAME] Sends all logging output to the specified file instead of stderr. 

 

\item[--log-details] Log details (IP-address, message type and hostname) to the logfile. This can also be enabled and disabled at run-time by sending the bbproxy proces a SIGUSR1 signal. 

 

\item[--debug] Enable debugging output. 

 


\end{description}
\subsection{REPORT OUTPUT}
 If enabled via the ``--report'' option, bbproxy will send a status message about itself to the Hobbit server once every 5 minutes. 

  The status message includes the following information: 


 \begin{description}
\item[Incoming messages] The total number of connections accepted from clients since the proxy started. The ``(N msgs/second)'' is the average number of messages per second over the past 5 minutes. 

 

\item[Outbound messages] The total number of messages sent to the Hobbit servers. Note that this is probably smaller than the number of incoming messages, since bbproxy merges messages before sending them. 

 

\item[Incoming - Combo messages] The number of ``combo'' messages received from a client. 

 

\item[Incoming - Status messages] The number of ``status'' messages received from a client. bbproxy attempts to merge these into ``combo'' messages. The ``Messages merged'' is the number of ``status'' messages that were merged into a combo message, the ``Resulting combos'' is the number of ``combo'' messages that resulted from the merging. 

 

\item[Incoming - Page messages] The number of ``page'' messages received from a client. These are discarded, they are generated by the old Big Brother clients, but have no meaning in Hobbit. 

 

\item[Incoming - Other messages] The number of other messages (data, notes, ack, query, ...) messages received from a client. 

 

\item[Proxy ressources - Connection table size] This is the number of connection table slots in the proxy. This measures the number of simultaneously active requests that the proxy has handled, and so gives an idea about the peak number of clients that the proxy has handled simultaneously. 

 

\item[Proxy ressources - Buffer space] This is the number of KB memory allocated for network buffers. 

 

\item[Timeout details - reading from client] The number of messages dropped because reading the message from the client timed out. 

 

\item[Timeout details - connecting to server] The number of messages dropped, because a connection to the Hobbit server could not be established. 

 

\item[Timeout details - sending to server] The number of messages dropped because the communication to the Hobbit server timed out after a connection was established. 

 

\item[Timeout details - recovered] When a timeout happens while sending the status message to the server, bbproxy will attempt to recover the message and retry sending it to the server after waiting a few seconds. This number is the number of messages that were recovered, and so were not lost. 

 

\item[Timeout details - reading from server] The number of response messages that timed out while attempting to read them from the server. Note that this applies to the ``config'' and ``query'' messages only, since all other message types do not get any response from the servers. 

 

\item[Timeout details - sending to client] The number of response messages that timed out while attempting to send them to the client. Note that this applies to the ``config'' and ``query'' messages only, since all other message types do not get any response from the servers. 

 

\item[Average queue time] The average time it took the proxy to process a message, calculated from the messages that have passed through the proxy during the past 5 minutes. This number is computed from the messages that actually end up establishing a connection to the Hobbit server, i.e. status messages that were combined into combo-messages do not go into the calculation - if they did, it would reduce the average time, since it is faster to merge messages than send them out over the network. 

 


\end{description}

\subsection{}
 If you think the numbers do not add up, here is how they relate. 

  The ``Incoming messages'' should be equal to the sum of the ``Incoming Combo/Status/Page/Other messages'', or slightly more because messages in transit are not included in the per-type message counts. 


  The ``Outbound messages'' should be equal to sum of the ``Incoming Combo/Page/Other messages'', plus the ``Resulting combos'' count, plus ``Incoming Status messages'' minus ``Messages merged'' (this latter number is the number of status messages that were NOT merged into combos, but sent directly). The ``Outbound messages'' may be slightly lower than that, because messages in transit are not included in the ``Outbound messages'' count until they have been fully sent. 


 
\subsection{SIGNALS}
\begin{description}
\item[SIGHUP] Re-opens the logfile, e.g. after it has been rotated. 

 

\item[SIGTERM] Shut down the proxy. 

 

\item[SIGUSR1] Toggles logging of individual messages. 

 


\end{description}
\subsection{SEE ALSO}
bb(1), hobbitd(8), hobbit(7) 



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{HOBBITD\_CLIENT}

 hobbitd\_client - hobbitd worker module for client data 
\subsection{SYNOPSIS}
\textbf{hobbitd\_channel --channel=client hobbitd\_client [options]}


 
\subsection{DESCRIPTION}
 hobbitd\_client is a worker module for hobbitd, and as such it is normally run via the \emph{hobbitd\_channel(8)}
 program. It receives hobbitd client messages sent from systems that have the the Hobbit client installed, and use the client data to generate the Hobbit status messages for the cpu-, disk-, memory- and procs-columns. It also feeds Hobbit data messages with the netstat- and vmstat-data collected by the client. 

  When generating these status messages from the client data, hobbitd\_client will use the configuration rules defined in the \emph{hobbit-clients.cfg(5)}
 file to determine the color of each status message. 


 
\subsection{OPTIONS}
\begin{description}
\item[--clear-color=COLOR] Define the color used when sending ``msgs'', ``files'' or ``ports'' reports and there are no rules to check for these statuses. The default is to show a ``clear'' status, but some people prefer to have it ``green''. If you would rather prefer not to see these status columns at all, then you can use the ``--no-clear-msgs'', ``--no-clear-files'' and ``--no-clear-ports'' options instead. 

 

\item[--no-clear-msgs] If there are no logfile checks, the ``msgs'' column will show a ``clear'' status. If you would rather avoid having a ``msgs'' column, this option causes hobbitd\_client to not send in a clear ``msgs'' status. 

 

\item[--no-clear-files] If there are no file checks, the ``files'' column will show a ``clear'' status. If you would rather avoid having a ``files'' column, this option causes hobbitd\_client to not send in a clear ``files'' status. 

 

\item[--no-clear-ports] If there are no port checks, the ``ports'' column will show a ``clear'' status. If you would rather avoid having a ``ports'' column, this option causes hobbitd\_client to not send in a clear ``ports'' status. 

 

\item[--no-ps-listing] Normally the ``procs'' status message includes the full process-listing received from the client. If you prefer to just have the monitored processes shown, this option will turn off the full ps-listing. 

 

\item[--no-port-listing] Normally the ``ports'' status message includes the full netstat-listing received from the client. If you prefer to just have the monitored ports shown, this option will turn off the full netstat-listing. 

 

\item[--config=FILENAME] Sets the filename for the \emph{hobbit-clients.cfg}
 file. The default value is ``etc/hobbit-clients.cfg'' below the Hobbit server directory. 

 

\item[--dump-config] Dumps the configuration after parsing it. May be useful to track down problems with configuration file errors. 

 

\item[--test] Starts an interactive session where you can test the hobbit-clients.cfg configuration. 

 

\item[--debug] Enable debugging output. 

 


\end{description}
\subsection{FILES}
\begin{description}
\item[~hobbit/server/etc/hobbit-clients.cfg]

 


\end{description}
\subsection{SEE ALSO}
hobbit-clients.cfg(5), hobbitd(8), hobbitd\_channel(8), hobbit(7) 

 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\include{hobbitweb.5}
\newpage
\section{HOBBITWEB}

 Hobbit web page headers, footers and forms. 

 
\subsection{DESCRIPTION}
 The Hobbit webpages are somewhat customizable, by modifying the header- and footer-templates found in the ~hobbit/server/web/ directory. There are usually two or more files for a webpage: A \textbf{template\_header}
 file which is the header for this webpage, and a \textbf{template\_footer}
 file which is the footer. Webpages where entry forms are used have a \textbf{template\_form}
 file which is the data-entry form. 

  With the exception of the \textbf{bulletin}
 files, the header files are inserted into the HTML code at the very beginning and the footer files are inserted at the bottom. 


  The following templates are available: 


 \begin{description}
\item[bulletin] A \textbf{bulletin\_header}
 and \textbf{bulletin\_footer}
 is not shipped with Hobbit, but if they exist then the content of these files will be inserted in all HTML documents generated by Hobbit. The ``bulletin\_header'' contents will appear after the normal header for the webpage, and the ``bulletin\_footer'' will appear just before the normal footer for the webpage. These files can be used to post important information about the Hobbit system, e.g. to notify users of current operational or monitoring problems. 

 

\item[acknowledge] Header, footer and form template for the Hobbit \textbf{acknowledge alert}
 webpage generated by \emph{bb-ack.cgi(1)}


 

\item[bb] Header and footer for the Hobbit \textbf{Main view}
 webpages, generated by \emph{bbgen(1)}


 

\item[bb2] Header and footer for the Hobbit \textbf{All non-green view}
 webpage, generated by \emph{bbgen(1)}


 

\item[bbnk] Header and footer for the now deprecated \textbf{BBNK}
 webpage, generated by bbgen. You should use the newer \emph{hobbit-nkview.cgi(1)}
 utility instead, which uses the \textbf{hobbitnk}
 templates. 

 

\item[bbrep] Header and footer for the Hobbit \textbf{Main view}
 availability report webpages, generated by \emph{bbgen(1)}
 when running in availability report mode. 

 

\item[bbsnap] Header and footer for the Hobbit \textbf{Main view}
 snapshot webpages, generated by \emph{bbgen(1)}
 when running in snapshot report mode. 

 

\item[bbsnap2] Header and footer for the Hobbit \textbf{All non-green view}
 snapshot webpage, generated by \emph{bbgen(1)}
 when running in snapshot report mode. 

 

\item[columndoc] Header and footer for the Hobbit \textbf{Column documentation}
 webpages, generated by the \emph{bb-csvinfo.cgi(1)}
 utility in the default Hobbit configuration. 

 

\item[confreport] Header and footer for the Hobbit \textbf{Configuration report}
 webpage, generated by the \emph{hobbit-confreport.cgi(1)}
 utility. Note that there are also ``confreport\_front'' and ``confreport\_back'' templates, these are inserted into the generated report before the hostlist, and before the column documentation, respectively. 

 

\item[event] Header, footer and form for the Hobbit \textbf{Eventlog report}
, generated by \emph{hobbit-eventlog.cgi(1)}


 

\item[findhost] Header, footer and form for the Hobbit \textbf{Find host}
 webpage, generated by \emph{bb-findhost.cgi(1)}


 

\item[graphs] Header and footer for the Hobbit \textbf{Graph details}
 webpages, generated by \emph{hobbitgraph.cgi(1)}


 

\item[hist] Header and footer for the Hobbit \textbf{History}
 webpage, generated by \emph{bb-hist.cgi(1)}


 

\item[histlog] Header and footer for the Hobbit \textbf{Historical status-log}
 webpage, generated by \emph{hobbitsvc.cgi(1)}
 utility when used to show a historical (non-current) status log. 

 

\item[hobbitnk] Header and footer for the Hobbit \textbf{Critical Systems view}
 webpage, generated by \emph{hobbit-nkview.cgi(1)}


 

\item[hostsvc] Header and footer for the Hobbit \textbf{Status-log}
 webpage, generated by \emph{hobbitsvc.cgi(1)}
 utility when used to show a current status log. 

 

\item[info] Header and footer for the Hobbit \textbf{Info column}
 webpage, generated by \emph{hobbitsvc.cgi(1)}
 utility when used to show the host configuration page. 

 

\item[maintact] Header and footer for the Hobbit \textbf{}
 webpage, generated by \emph{hobbit-enadis.cgi(1)}
 utility when using the Enable/Disable ``preview'' mode. 

 

\item[maint] Header, footer and form for the Hobbit \textbf{Enable/disable}
 webpage, generated by \emph{hobbit-enadis.cgi(1)}


 

\item[nkack] Form show on the \textbf{status-log}
 webpage when viewed from the ``Critical Systems'' overview. This form is used to acknowledge a critical status by the operators monitoring the Critical Systems view. 

 

\item[nkedit] Header, footer and form for the \textbf{Critical Systems Editor}
, the \emph{hobbit-nkedit.cgi(1)}
 utility. 

 

\item[replog] Header and footer for the Hobbit \textbf{Report status-log}
 webpage, generated by \emph{hobbitsvc.cgi(1)}
 utility when used to show a status log for an availability report. 

 

\item[report] Header, footer and forms for selecting a pre-generated \textbf{Availability Report}
. Handled by the \emph{bb-datepage.cgi(1)}
 utility. 

 

\item[snapshot] Header and footer for the Hobbit \textbf{Snapshot report}
 selection webpage, generated by \emph{bb-snapshot.cgi(1)}


 


\end{description}

\subsection{SEE ALSO}
bbgen(1), hobbitsvc.cgi(1), hobbit(7) 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Report Generation}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{BB-REP.CGI}

 bb-rep.cgi - CGI front-end to bbgen reporting
 \subsection{SYNOPSIS}
\textbf{bb-rep.cgi [--noclean] [bbgen-options]}


 
\subsection{DESCRIPTION}
\textbf{bb-rep.cgi}
 is invoked as a CGI script via the bb-rep.sh CGI wrapper. It triggers the generation of a Hobbit availability report for the timeperiod specified by the CGI paramaters. 

  bb-rep.cgi is passed a QUERY\_STRING environment variable with the following parameters: 


  
start-mon(Startmonthofthereport)  
start-day(Startday-of-monthofthereport)  
start-yr(Startyearofthereport)  
end-mon(Endmonthofthereport)  
end-day(Endday-of-monthofthereport)  
end-yr(Endyearofthereport)  
style(Reportstyle)  
 The following non-standard parameters are handled by the bbgen version of bb-rep.cgi: 


  
suburl(Pageinreporttogoto,ifnotthetoppage) 


  The ``month'' parameters must be specified as the three-letter english month name abbreviation: Jan, Feb, Mar ... 


  Start- and end-days are in the range 1..31; the start- and end-year must be specified including century (e.g. ``2003''). 


  End-times beyond the current time are silently replaced with the current time. 


  The generated report will include data for the start- and end-days, i.e. the report will begin at 00:00:00 of the start-day, and end at 23:59:59 of the end-day. 


  The ``style'' parameter is passed directly to \emph{bbgen(1)}
 and should be ``crit'', ``non-crit'' or ``all''. Other values result in undefined behaviour. 


  All of the processing involved in generating the report is done by invoking \emph{bbgen(1)}
 with the proper ``--reportopts'' option. 


 
\subsection{OPTIONS}
\begin{description}
\item[--noclean] Do not clean the BBREP directory of old reports. Makes the report-tool go a bit faster - instead, you can clean up the BBREP directory e.g. via a cron-job. 

 

\item[--env=FILENAME] Load the environment from FILENAME before executing the CGI. 

 

\item[bbgen-options] All other options passed to bb-rep.cgi are passed on to the \emph{bbgen(1)}
 program building the report files. 

 


\end{description}
\subsection{FILES}
\begin{description}
\item[\$BBHOME/web/report\_header] HTML template header for the report request form 

 

\item[\$BBHOME/web/report\_footer] HTML template footer for the report request form 

 

\item[\$BBHOME/web/report\_form] HTML template report request form 

 


\end{description}
\subsection{ENVIRONMENT VARIABLES}
\begin{description}
\item[BBGENREPOPTS] bbgen options passed by default to the bb-rep.cgi. This happens in the bb-rep.sh wrapper. 
\item[BBHOME] Home directory of the Hobbit server installation 
\item[BBREP] Directory where generated reports are stored. This directory must be writable by the userid executing the CGI script, typically ``www'', ``apache'' or ``nobody''. Default: \$BBHOME/www/rep/ 
\item[BBREPURL] The URL prefix to use when accessing the reports via a browser. Default: \$BBWEB/rep 


\end{description}
\subsection{SEE ALSO}
bbgen(1), bb-hosts(5), hobbitserver.cfg(5) 

 


  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\include{hobbitd_filestore.8}
\newpage
\section{HOBBITD\_FILESTORE}

 hobbitd\_filestore - hobbitd worker module for storing Hobbit data \subsection{SYNOPSIS}
\textbf{hobbitd\_channel --channel=status hobbitd\_filestore --status [options]}
 
\textbf{hobbitd\_channel --channel=data hobbitd\_filestore --data [options]}
 
\textbf{hobbitd\_channel --channel=notes hobbitd\_filestore --notes [options]}
 
\textbf{hobbitd\_channel --channel=enadis hobbitd\_filestore --enadis [options]}


 
\subsection{DESCRIPTION}
 hobbitd\_filestore is a worker module for hobbitd, and as such it is normally run via the \emph{hobbitd\_channel(8)}
 program. It receives hobbitd messages from a hobbitd channel via stdin, and stores these in the filesystem in a manner that is compatible with the Big Brother daemon, bbd. 

  This program can be started multiple times, if you want to store messages for more than one channel. 


 
\subsection{OPTIONS}
\begin{description}
\item[--status] Incoming messages are ``status'' messages, they will be stored in the \$BBLOGS/ directory. If you are using \emph{hobbit(7)}
 throughout your Hobbit server, you will not need to run this module to save status messages, unless you have a third-party add-on that reads the status-logs directly. This module is NOT needed to get trend graphs, you should run the \emph{hobbitd\_rrd(8)}
 module instead. 

 

\item[--data] Incoming messages are ``data'' messages, they will be stored in the \$BBDATA directory. This module is not needed, unless you have a third-party module that processes the data-files. This module is NOT needed to get trend graphs, you should run the \emph{hobbitd\_rrd(8)}
 module instead. 

 

\item[--notes] Incoming messages are ``notes'' messages, they will be stored in the \$BBNOTES directory. This modules is only needed if you want to allow people to remotely update the notes-files available on the Hobbit webpages. 

 

\item[--enadis] Incoming messages are enable/disable messages, they will update files in the \$BBDISABLED directory. This is only needed if you have third-party add-ons that use these files. 

 

\item[--dir=DIRECTORY] Overrides the default output directory. 

 

\item[--html] Used together with ``--status''. Tells hobbitd\_filestore to also save an HTML version of the status-log. Should not be used unless you must run with ``BBLOGSTATUS=static''. 

 

\item[--htmldir=DIRECTORY] The directory where HTML-versions of the status logs are stored. Default: \$BBHTML 

 

\item[--htmlext=.EXT] Set the filename extension for generated HTML files. By default, HTML files are saved with a ``.html'' extension. 

 

\item[--multigraphs=TEST1[,TEST2]] This causes hobbitd\_filestore to generate HTML status pages with links to service graphs that are split up into multiple images, with at most 5 graphs per image. If not specified, only the ``disk'' status is split up this way. 

 

\item[--only=test[,test,test]] Save status messages only for the listed set of tests. This can be useful if you have an external script that needs to parse some of the status logs, but you do not want to save all status logs. 

 

\item[--debug] Enable debugging output. 

 


\end{description}
\subsection{FILES}
 This module does not rely on any configuration files. 

 
\subsection{SEE ALSO}
hobbitd\_channel(8), hobbitd\_rrd(8), hobbitd(8), hobbit(7) 

 
  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Hobbit Client}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{\motohbcmd{logfetch} - Hobbit client data collector }

 
\subsection{SYNOPSIS}
\textbf{logfetch CONFIGFILE STATUSFILE}


 
\subsection{DESCRIPTION}
\textbf{logfetch}
 is part of the Hobbit client. It is responsible for collecting data from logfiles, and other file-related data, which is then sent to the Hobbit server for analysis. 

  logfetch uses a configuration file, which is automatically retrieved from the Hobbit server. There is no configuration done locally. The configuration file is usually stored in the \textbf{\$BBHOME/tmp/logfetch.cfg}
 file, but editing this file has no effect since it is re-written with data from the Hobbit server each time the client runs. 


  logfetch stores information about what parts of the monitored logfiles have been processed already in the \textbf{\$BBHOME/tmp/logfetch.status}
 file. This file is an internal file used by logfetch, and should not be edited. If deleted, it will be re-created automatically. 


 
\subsection{SECURITY}
 logfetch needs read access to the logfiles it should monitor. If you configure monitoring of files or directories through the ``file:'' and ``dir:'' entries in \emph{client-local.cfg(5)}
 then logfetch will require at least read-acces to the directory where the file is located. If you request checksum calculation for a file, then it must be readable by the hobbit client user. 

  Do \textbf{NOT}
 install logfetch as suid-root. There is no way that logfetch can check whether the configuration file it uses has been tampered with, so installing logfetch with suid-root privileges could allow an attacker to read any file on the system by using a hand-crafted configuration file. In fact, logfetch will attempt to remove its own suid-root setup if it detects that it has been installed suid-root. 


 
\subsection{ENVIRONMENT VARIABLES}
\begin{description}
\item[DU] Command used to collect information about the size of directories. By default, this is the command \textbf{du -k}
. If the local du-command on the client does not recognize the ``-k'' option, you should set the DU environment variable in the \textbf{\$BBHOME/etc/hobbitclient.cfg}
 file to a command that does report directory sizes in kilobytes. 

 


\end{description}
\subsection{FILES}
\begin{description}
\item[\$BBHOME/tmp/logfetch.cfg]
\item[\$BBHOME/tmp/logfetch.status]

 


\end{description}
\subsection{SEE ALSO}
hobbit(7), hobbit-clients.cfg(5) 

  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\include{bb-replog.cgi.1}



\newpage
\section{BB-REPLOG.CGI}

 bb-replog.cgi - CGI program to report service availability log 

\subsection{SYNOPSIS}
\textbf{bb-replog.cgi}


 
\subsection{DESCRIPTION}
\textbf{bb-replog.cgi}
 is invoked as a CGI script via the bb-replog.sh CGI wrapper. Based on
 the parameters it receives, it generates an availability report for a
 specific host-service combination for the requested time-period. The
 availability report includes a calculation of the availability
 percentage (split out on percent green, yellow, red time), and an
 eventlog for the period listing the status changes that have occurred
 to allow for drill-down to the test reports that indicate a
 problem. Access to the individual historical status logs go via the
 \emph{hobbitsvc.cgi(1)} CGI script. 


  bb-replog.cgi is passed a QUERY\_STRING environment variable with the following parameters: 


  
HOSTSVC(thehostandservicetoreporton)  
STYLE(reportstyle:''crit'',''non-crit'',''all'')  
ST(starttimeinsecondssince1-1-197000:00UTC)  
END(endtimeinsecondssince1-1-197000:00UTC) 


  The following non-standard parameters are handled by the bbgen version of bb-hist.cgi: 


  
IP(IPaddressofhost-fordisplaypurposesonly)  
REPORTTIME(theREPORTTIME:settingforthishost)  
WARNPCT(theWARNPCT:settingforthishost) 


  The REPORTTIME and WARNPCT options are taken from the
  \emph{bb-hosts(5)} definition for the host, or the defaults are
  used. These modify the availability calculation to handle reporting
  against agreed Service Level Agreements re. the time of day when the
  service must be available, and the agreed availability level. 



 
\subsection{OPTIONS}
\begin{description}
\item[--env=FILENAME] Loads environment from FILENAME before executing the CGI. 

 


\end{description}
\subsection{SEE ALSO}
bb-hosts(5), hobbitserver.cfg(5), hobbitsvc.cgi(1) 

 
  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{HOBBITD\_HISTORY}

 hobbitd\_history - hobbitd worker module for logging status changes

 \subsection{SYNOPSIS}
\textbf{hobbitd\_channel --channel=stachg hobbitd\_history [options]}


 
\subsection{DESCRIPTION}
 hobbitd\_history is a worker module for hobbitd, and as such it is
 normally run via the \emph{hobbitd\_channel(8)} program. It receives
 hobbitd status-change messages from the ``stachg'' channel via stdin,
 and uses these to update the history logfiles in a manner that is
 compatible with the standard Big Brother daemon, bbd. 


 
\subsection{OPTIONS}
\begin{description}
\item[--histdir=DIRECTORY] The directory for the history files. If not
  specified, the directory given by the BBHIST environment is used. 


 

\item[--histlogdir=DIRECTORY] The directory for the historical status-logs. If not specified, the directory given by the BBHISTLOGS environment is used. 

 

\item[--debug] Enable debugging output. 

 


\end{description}
\subsection{ENVIRONMENT}
\begin{description}
\item[BBALLHISTLOG] This environment variable controls if the
  \$BBHIST/allevents logfile is updated. This file is used by the
  event-log display on the BB2 html page. If you do not use this, you
  can disable it by setting BBALLHISTLOGS=FALSE. 


 

\item[BBHOSTHISTLOG] This environment variable controls if the
  \$BBHIST/HOSTNAME logfile is updated. This file holds a list of all
  status changes seen for a single host, but is not used by any of the
  standard Hobbit tools. If you do not want to save this, you can
  disable it by setting BBHOSTHISTLOG=FALSE. 


 

\item[SAVESTATUSLOG] This environment variable controls if the
  historical status-logs are saved whenever a status change
  occurs. These logfiles are stored in the \$BBHISTLOGS directory, and
  are used for the detailed log-display of a status from the Hobbit
  ``History'' page. If you do not want to save these, you can disable
  it by setting SAVESTATUSLOG=FALSE. 


 


\end{description}
\subsection{FILES}
 This module does not rely on any configuration files. 

 
\subsection{SEE ALSO}
hobbitd\_channel(8), hobbitd(8), hobbit(7) 

  

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\include{msgcache.8}

\newpage
\section{MSGCACHE}

 msgcache - Cache client messages for later pickup by hobbitfetch 

 
\subsection{SYNOPSIS}
\textbf{msgcache [options]}


 
\subsection{DESCRIPTION}
\textbf{msgcache}
 implements a Hobbit message cache. It is intended for use with clients which cannot deliver their data to the Hobbit server in the normal way. Instead of having the client tools connect to the Hobbit server, msgcache runs locally and the client tools then deliver their data to the msgcache daemon. The msgcache daemon is then polled regularly by the \emph{hobbitfetch(8)}
 utility, which collects the client messages stored by msgcache and forwards them to the Hobbit server. 

 \textbf{NOTE:}
 When using msgcache, the \textbf{BBDISP}
 setting for the clients should be \textbf{BBDISP=127.0.0.1}
 instead of pointing at the real Hobbit server. 


 
\subsection{RESTRICTIONS}
 Clients delivering their data to msgcache instead of the real Hobbit server will in general not notice this. Specifically, the client configuration data provided by the Hobbit server when a client delivers its data is forwarded through the hobbitfetch / msgcache chain, so the normal centralized client configuration works. 

  However, other commands which rely on clients communicating directly with the Hobbit server will not work. This includes the \textbf{config}
 and \textbf{query}
 commands which clients may use to fetch configuration files and query the Hobbit server for a current status. 


  The \textbf{download}
 command also does not work with msgcache. This means that the automatic client update facility will not work for clients communicating via msgcache. 


 
\subsection{OPTIONS}
\begin{description}
\item[--listen=IPADDRESS[:PORT]] Defines the IP-address and portnumber where msgcache listens for incoming connections. By default, msgcache listens for connections on all network interfaces, port 1984. 

 

\item[--server=IPADDRESS[,IPADDRESS]] Restricts which servers are allowed to pick up the cached messages. By default anyone can contact the msgcache utility and request all of the cached messages. This option allows only the listed servers to request the cached messages. 

 

\item[--max-age=N] Defines how long cached messages are kept. If the message has not been picked up with N seconds after being delivered to msgcache, it is silently discarded. Default: N=600 seconds (10 minutes). 

 

\item[--daemon] Run as a daemon, i.e. msgcache will detach from the terminal and run as a background task 

 

\item[--no-daemon] Run as a foreground task. This option must be used when msgcache is started by \emph{hobbitlaunch(8)}
 which is the normal way of running msgcache. 

 

\item[--pidfile=FILENAME] Store the process ID of the msgcache task in FILENAME. 

 

\item[--logfile=FILENAME] Log msgcache output to FILENAME. 

 

\item[--debug] Enable debugging output. 

 


\end{description}
\subsection{SEE ALSO}
hobbitfetch(8), hobbit(7) 
  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{BBRETEST-NET.SH}

 bbretest-net.sh - Hobbit network re-test tool

 \subsection{SYNOPSIS}
\textbf{bbretest-net.sh}


 
\subsection{DESCRIPTION}
\textbf{bbretest-net.sh}
 is an extension script for Hobbit that runs on the network test
 server. It picks up the failing network tests executed by the
 \emph{bbtest-net(1)} program, and repeats these tests with a faster
 test cycle than the normal bbtest-net schedule. This means that when
 the server recovers and the network service becomes available again,
 this is detected quicker resulting in less reported downtime. 


  Only tests whose first failure occurred within 30 minutes are
  included in the tests that are run by bbretest-net.sh. The 30 minute
  limit is there to avoid hosts that are down for longer periods of
  time to bog down bbretest-net.sh. You can change this limit with the
  ``--frequenttestlimit=SECONDS'' when you run bbtest-net. 



 


 
\subsection{INSTALLATION}
 This script runs by default from your \emph{hobbitlaunch.cfg(5)}
 file. 

 


 
\subsection{FILES}
\begin{description}
\item[\$BBTMP/TESTNAME.LOCATION.status] Temporary status file managed
  by bbtest-net with status of tests that have currently failed. 

\item[\$BBTMP/frequenttests.LOCATION] Temporary file managed by
  bbtest-net with the hostnames that bbretest-net.sh should test. 


 


\end{description}
\subsection{SEE ALSO}
bbtest-net(1), hobbit(7), hobbitlaunch.cfg(5) 

 
  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\include{hobbitd_hostdata.8}

\newpage
\section{HOBBITD\_HOSTDATA}

 hobbitd\_hostdata - hobbitd worker module for storing historical
 client data 
\subsection{SYNOPSIS}
\textbf{hobbitd\_channel --channel=clichg hobbitd\_hostdata}


 
\subsection{DESCRIPTION}
 hobbitd\_hostdata is a worker module for hobbitd, and as such it is normally run via the \emph{hobbitd\_channel(8)}
 program. Whenever a status column in Hobbit changes to an alert state (usually red, yellow or purple), this module receives a copy of the latest Hobbit client data sent by the host, and stores it on disk. This allows you to review all of the data collected by the Hobbit client on the server around the time that a problem occurred. This can make troubleshooting incidents easier by providing a snapshot of the host status shortly before a problem became apparent. 

  Note: This module requires that \emph{hobbitd(8)}
 is launched with the ``--store-clientlogs'' option enabled. 


 
\subsection{FILES}
 All of the host data are stored in the \$CLIENTLOGS directory, by default this is the \$BBVAR/hostdata/ directory. 

 
\subsection{SEE ALSO}
hobbitd(8), hobbitd\_channel(8), hobbit(7) 

 
  

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\newpage
\section{ORCAHOBBIT}

hgcmd{orcahobbit} - Hobbit client utility to grab data from ORCA

 \subsection{SYNOPSIS}
\textbf{orcahobbit --orca=PREFIX [options]}


 
\subsection{NOTICE}
 This utility is included in the client distribution for Hobbit 4.2. However, the backend module to parse the data it sends it \textbf{NOT}
 included in Hobbit 4.2. It is possible to use the generic Hobbit NCV data handler in \emph{hobbitd\_rrd(8)}
 to process ORCA data, if you have an urgent need to do so. 

 
\subsection{DESCRIPTION}
\textbf{orcahobbit}
 is an add-on tool for the Hobbit client. It is used to grab data collected by the ORCA data collection tool (orcallator.se), and send it to the Hobbit server in NCV format. 

  orcahobbit should run from the client \emph{hobbitlaunch(8)}
 utility, i.e. there must be an entry in the \emph{clientlaunch.cfg(5)}
 file for orcahobbit. 


 
\subsection{OPTIONS}
\begin{description}
\item[--orca=PREFIX] The filename prefix for the ORCA data log. Typically this is the directory for the ORCA logs, followed by ``orcallator''. The actual filename for the ORCA logs include a timestamp and sequence number, e.g. ``orcallator-2006-06-20-000''. This option is required. 

 

\item[--debug] Enable debugging output. 

 


\end{description}
\subsection{SEE ALSO}
hobbit(7), clientlaunch.cfg(5) 

 


  

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{BB-SERVICES}

 bb-services - Configuration of TCP network services 

 
\subsection{SYNOPSIS}
\textbf{\$BBHOME/etc/bb-services}


 
\subsection{DESCRIPTION}
\textbf{bb-services}
 contains definitions of how \emph{bbtest-net(1)}
 should test a TCP-based network service (i.e. all common network services except HTTP and DNS). For each service, a simple dialogue can be defined to check that the service is functioning normally, and optional flags determine if the service has e.g. a banner or requires SSL- or telnet-style handshaking to be tested. 

 
\subsection{FILE FORMAT}
 bb-services is a text file. A simple service definition for the SMTP service would be this:  


  
[smtp]  
 
send''mail$\backslash$r$\backslash$nquit$\backslash$r$\backslash$n''  
 
expect''220''  
 
optionsbanner  



  This defines a service called ``smtp''. When the connection is first established, bbtest-net will send the string ``mail$\backslash$r$\backslash$nquit$\backslash$r$\backslash$n'' to the service. It will then expect a response beginning with ``220''. Any data returned by the service (a so-called ``banner'') will be recorded and included in the status message. 


  The full set of commands available for the bb-services file are: 


 \begin{description}
\item[[NAME]] Define the name of the TCP service, which will also be the column-name in the resulting display on the test status. If multiple tests share a common definition (e.g. ssh, ssh1 and ssh2 are tested identically), you may list these in a single ``[ssh|ssh1|ssh2]'' definition, separating each service-name with a pipe-sign. 

 

\item[send STRING]
\item[expect STRING] Defines the strings to send to the service after a connection is established, and the response that is expected. Either of these may be omitted, in which case \emph{bbtest-net(1)}
 will simply not send any data, or match a response against anything. 

  The send- and expect-strings use standard escaping for non-printable characters. ``$\backslash$r'' represents a carriage-return (ASCII 13), ``$\backslash$n'' represents a line-feed (ASCII 10), ``$\backslash$t'' represents a TAB (ASCII 8). Binary data is input as ``$\backslash$xNN'' with NN being the hexadecimal value of the byte. 


 

\item[port NUMBER] Define the default TCP port-number for this service. If no portnumber is defined, \emph{bbtest-net(1)}
 will attempt to lookup the portnumber in the standard /etc/services file. 

 

\item[options option1[,option2][,option3]] Defines test options. The possible options are  
 
banner-includereceiveddatainthestatusmessage  
 
ssl-serviceusesSSLsoperformanSSLhandshake  
 
telnet-serviceistelnet,soexchangetelnetoptions 

 


 


\end{description}

\subsection{FILES}
\textbf{\$BBHOME/etc/bb-services}


 
\subsection{SEE ALSO}
bbtest-net(1) 
  

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Data Backend}
\section{HOBBITD\_RRD}

 hobbitd\_rrd - hobbitd worker module for updating Hobbit RRD files

\subsection{SYNOPSIS}
\textbf{hobbitd\_channel --channel=status hobbitd\_rrd [options]}
 
\textbf{hobbitd\_channel --channel=data hobbitd\_rrd [options]}


 
\subsection{DESCRIPTION}
 hobbitd\_rrd is a worker module for hobbitd, and as such it is normally run via the \emph{hobbitd\_channel(8)}
 program. It receives ``status'' and ``data'' messages from hobbitd via stdin, and updates the RRD databases used to generate trend-graphs. 

  Clients can send data to Hobbit using both status- and data- messages. So you will normally run two instances of this module, once for the ``status'' channel and once for the ``data'' channel. 


  hobbitd\_rrd understands data sent by the LARRD 0.43c client-side scripts (the so-called ``bottom-feeder'' scripts). So you still want to install the LARRD bottom-feeders on the clients you monitor. 


  Note: For certain types of data, the RRD files used by Hobbit are imcompatible with those generated by the Big Brother LARRD add-on. See the COMPATIBILITY section below. 


 


 
\subsection{OPTIONS}
\begin{description}
\item[--debug] Enable debugging output. 

 

\item[--rrddir=DIRECTORY] Defines the directory where the RRD-files are stored. hobbitd\_rrd will use the location pointed to by the BBRRDS environment if this option is not present. 

 

\item[--extra-script=FILENAME] Defines the script that is run to get the RRD data for tests that are not built into hobbitd\_rrd. You must also specify which tests are handled by the external script in the \textbf{--extra-tests}
 option. This option can only be given once, so the script must handle all of the external test-data. See the CUSTOM RRD DATA section below. Note that this is NOT needed if your custom graphs are generated by the NCV (Name Colon Value) module described below, it is only required for data where you have a custom script to parse the status message and extract the data that is put into the graph. 

 

\item[--extra-tests=TEST[,TEST]] List of testnames that are handled by the external script. See the CUSTOM RRD DATA section below. Note that NCV graphs should NOT be listed here, but in the TEST2RRD environment variable - see below. 

 

\item[--processor=COMMAND] Feed the raw RRD data into COMMAND via standard input. COMMAND must be a simple command with no options; if necessary, COMMAND can be a script that runs the real command with the necessary options. The data sent to COMMAND consists of lines of text of the form  
 
dsname1[:dsname2]time:value1[:value2]rrdtype[key1][key2]  
 First the dataset names, corresponding to the DS definitions in the RRD files. Next the timestamp of the update, followed by the values in the same order as the dsname-list. Third item is the hostname, fourth is the type of RRD file. After that there may be between 0-2 additional keys: For ``disk'' this is the filesystem mountpoint, for ``tcp'' tests it is the service name, for ``tcp'' ``http'' tests there is also the URL checked. Note that filesystem names and URLs have forward slash substituted by comma. See the hobbitd/rrd/*.c sourcecode for details, look for the ``setupfn'' function calls. An example:  


 \begin{verbatim}

la 1196115478:7 myhost la
la 1196115478:169 myhost procs
la 1196115478:1 myhost users
la 1196115478:244 myhost clock
pct:used 1196115478:63:62338144 myhost disk ,root
realmempct 1196115478:76 myhost memory real
realmempct 1196115478:0 myhost memory swap
realmempct 1196115478:20 myhost memory actual
sec 1196115478:0.03 tcp myhost conn
sec 1196115478:1.38 myhost tcp http www.hobbitmon.com,

\end{verbatim}



 


 


 


\end{description}
\subsection{ENVIRONMENT}
\begin{description}
\item[TEST2RRD] Defines the mapping between a status-log columnname and the corresponding RRD database format. This is normally defined in the \emph{hobbitserver.cfg(5)}
 file. 

 

\item[BBRRDS] Default directory where RRD files are stored. 

 

\item[NCV\_testname] Defines the types of data collected by the ``ncv'' module in hobbitd\_rrd. See below for more information. 

 


\end{description}
\subsection{COLLECTED DATA}
 The following RRD-file datasets are generated by hobbitd\_rrd: 

 \begin{description}
\item[la] Records the CPU load average. Data is collected from the ``cpu'' status report. Requires that a Hobbit client is running on the monitored server. 

 

\item[disk] Records the disk utilization. Data is collected from the ``disk'' status report. Requires that a Hobbit-compatible client is running on the monitored server. 

 

\item[memory] Records memory- and swap-utilization. Data is collected from the ``memory'' status report. If no ``memory'' status is reported, it will use the data from the Win32 client ``cpu'' status report to generate this dataset. Requires that a Hobbit-compatible client is running on the monitored server. 

 

\item[netstat] Records TCP and UDP statistics. Data is collected from the ``netstat'' status report; however, this data is often sent via the Hobbit ``data'' protocol, so there need not be a ``netstat'' column visible on the Hobbit display. To get these data, the LARRD netstat bottom-feeder script must be running on the monitored server. 

 

\item[vmstat] Records system performance metrics from the ``vmstat'' command. Data is collected from the ``vmstat'' status report; however, this data is often sent via the Hobbit ``data'' protocol, so there need not be a ``vmstat'' column visible on the Hobbit display. To get these data, the LARRD vmstat bottom-feeder script must be running on the monitored server. 

 

\item[tcp] Response-time metrics from all of the Hobbit network tests are recorded in the ``tcp'' RRD. 

 

\item[apache] Apache server performance metrics, taken from the ``apache'' data report. See the description of the \textbf{apache}
 keyword in \emph{bb-hosts(5)}
 for details. 

 

\item[sendmail] Sendmail server performance metrics, taken from the ``mailstats'' output. To get these data, the LARRD sendmail bottom-feeder script must be running on the monitored server. 

 

\item[mailq] Mail queue size. To get these data, the LARRD nmailq bottom-feeder script must be running on the monitored server. 

 

\item[bea] BEA Weblogic performance data. This is an experimental set of data collected from BEA Weblogic servers via SNMP, by the ``beastats'' tool included with Hobbit. 

 

\item[iishealth] IIS webserver performance data, collected by the ``iishealth'' script. This script is a client-side add-on available from the www.deadcat.net archive. 

 

\item[temperature] Temperature data, collected with the temperature script from www.deadcat.net. To get these data, the temperature script must be running on the monitored server. 

 

\item[ntpstat] Tracks the deviation between the local system time and an NTP server, using the output from the ``ntpq -c rv'' command. A simple script to collect these data is included in the Hobbit contrib/ directory. 

 

\item[citrix] Tracks the number of active sessions on a Citrix server using the ``query session'' command. An extension for the BBNT client that generates data for this graph is in the Hobbit contrib/ directory. 

 


 


\end{description}

\subsection{CUSTOM RRD DATA IN NAME-COLON-VALUE (NCV) FORMAT}
 Many data-collection scripts report data in the form ``NAME : value'' or ``NAME = value''. So a generic module in hobbitd\_rrd allows for easy tracking of this type of data. 

  The ``ncv'' module will automatically detect all occurrences of a ``NAME : value'' or ``NAME = value'' string in a status message, and generate an RRD file holding all of the name/value data found in the message. The colon- or equal-sign must be present - if there is only whitespace, this module will fail. 


  Only the valid letters (A-Z, a-z) and digits (0-9) are used in the dataset names; whitespace and other characters are stripped off automatically. Only the first 19 characters of a dataset name are used (this is an RRD limitation). Underscore '\_' is not allowed, even though RRDtool permits this, and will be stripped from the name. 


  Note that each ``NAME : value'' must be on a line by itself. If you have a custom script generating the status- or data-message that is fed into the NCV handler, make sure it inserts a newline before each of the data-items you want to track. 


  To enable the ncv module for a status, add a ``COLUMNNAME=ncv'' to the TEST2RRD setting and the COLUMNNAME to the GRAPHS setting in \emph{hobbitserver.cfg(5)}
 , then restart Hobbit. Hobbit will now send all status-messages for the column COLUMNNAME through the hobbitd\_rrd ncv-handler. 


  The name of the RRD file will be COLUMNNAME.rrd. 


  By default, all of the datasets are generated as the RRD type ``DERIVE'' which works for all types of monotonically increasing counters. If you have data that are of the type GAUGE, you can override the default via an environment variable NCV\_COLUMNNAME. 


  E.g. if you are using the bb-mysqlstatus script from www.deadcat.net to collect data about your MySQL server, it generates a report in the column called ``mysql''. One data item is the average number of queries/second, which must be logged in the RRD file as type ``GAUGE''. To do that, add the following to hobbitserver.cfg:  
 
NCV\_mysql=''Queriespersecondavg:GAUGE''  
 If you have multiple datasets that you myst define, add them to the environment variable separated by commas, e.g.  
 
NCV\_mysql=''Uptime:NONE,Queriespersecondavg:GAUGE''  



  The dataset type ``NONE'' used above causes hobbitd\_rrd to ignore this data, it is not included in the RRD file. 


  You can use ``*'' as the dataset name to match all datasets not listed. E.g.  
 
NCV\_weather=''Rain:DERIVE,*:GAUGE''  
 will cause the ``Rainfall'' dataset to be of type DERIVE, and all others of type GAUGE. If you want to track only a few of the variables in your data, you can use ``*:NONE'' to drop any dataset not explicitly listed. 


  For a more detailed ``how to'' description, see the on-line HTML documentation of ``How to create graph custom data'' available in the Help menu section on your Hobbit server. 


 


 
\subsection{CUSTOM RRD DATA VIA SCRIPTS}
 hobbitd\_rrd provides a simple mechanism for adding custom graphs to the set of data collected on your Hobbit server. By adding the ``--extra-script'' and ``--extra-tests'' options, data reported to Hobbit from selected tests are passed to an external script, which can define the RRD data-sets to store in an RRD file. 

 \textbf{NOTE:}
 For performance reasons, you should not use this mechanism for large amounts of data. The overhead involved in storing the received message to disk and launching the script is significantly larger than the normal hobbitd\_rrd overhead. So if you have a large number of reports for a given test, you should consider implementing it in C and including it in the hobbitd\_rrd tool. 


  Apart from writing the script, You must also add a section to \emph{hobbitgraph.cfg(5)}
 so that \emph{hobbitgraph.cgi(1)}
 knows how to generate the graph from the data stored in the RRD file. To make the graphs actually show up on the status-page and/or the ``trends'' page, add the name of the new graph to the TEST2RRD and/or GRAPHS setting in \emph{hobbitserver.cfg(5).}



  The script is invoked for each message that arrives, where the test-name matches one of the testnames given in the ``--extra-tests'' option. The script receives three commandline parameters: 


 \begin{description}
\item[\textbf{Hostname}
] The name of the host reporting the data. 
\item[\textbf{Testname}
] The name of the test being reported. 
\item[\textbf{Filename}
] File containing the data that was reported. This file is generated for you by hobbitd\_rrd, and is also deleted automatically after your script is finished with it. 

 


\end{description}



  The script must process the data that is reported, and generate the following output: 


 \begin{description}
\item[\textbf{RRD data-set definitions}
] For each dataset that the RRD file holds, a line beginning with ``DS:'' must be output. If multiple data-sets are used, print one line for each dataset.  
 Data-set definitions are described in the \emph{rrdcreate(1)}
 documentation, but a common definition for e.g. tracking the number of users logged on would be ``DS:users:GAUGE:600:0:U''. ``users'' is the name of the dataset, ``GAUGE'' is the datatype, ``600'' is the longest time allowed between updates for the data to be valid, ``0'' is the minimum value, and ``U'' is the maximum value (a ``U'' means ``unknown''). 
\item[\textbf{RRD filename}
] The name of the RRD file where the data is stored. Note that Hobbit stores all RRD files in host-specific directories, so unlike LARRD you should not include the hostname in the name of the RRD file. 
\item[\textbf{RRD values}
] One line, with all of the data values collected by the script. Data-items are colon-delimited and must appear in the same sequence as your data-set definitions, e.g. if your RRD has two datasets with the values ``5'' and ``0.4'' respectively, then the script must output ``5:0.4'' as the RRD values.  
 In some cases it may be useful to define a dataset even though you will not always have data for it. In that case, use ``U'' (unknown) for the value. 

  If you want to store the data in multiple RRD files, the script can just print out more sequences of data-set definitions, RRD filenames and RRD values. If the data-set definitions are identical to the previous definition, you need not print the data-set definitions again - just print a new RRD filename and value. 


 


\end{description}



  The following sample script for tracking weather data shows how to use this mechanism. It assumes the status message include lines like these: \begin{description}
\item[]\begin{verbatim}

green Weather in Copenhagen is FAIR

Temperature: 21 degrees Celsius
Wind: 4 m/s
Humidity: 72 %
Rainfall: 5 mm since 6:00 AM

\end{verbatim}


\end{description}



  A shell-script to track all of these variables could be written like this: \begin{description}
\item[]\begin{verbatim}

#!/bin/sh

# Input parameters: Hostname, testname (column), and messagefile
HOSTNAME="$1"
TESTNAME="$2"
FNAME="$3"

if [ "$TESTNAME" = "weather" ]
then
        # Analyze the message we got
        TEMP=`grep "^Temperature:" $FNAME | awk '{print $2}'`
        WIND=`grep "^Wind:" $FNAME | awk '{print $2}'`
        HMTY=`grep "^Humidity:" $FNAME | awk '{print $2}'`
        RAIN=`grep "^Rainfall:" $FNAME | awk '{print $2}'`

        # The RRD dataset definitions
        echo "DS:temperature:GAUGE:600:-30:50"
        echo "DS:wind:GAUGE:600:0:U"
        echo "DS:humidity:GAUGE:600:0:100"
        echo "DS:rainfall:DERIVE:600:0:100"

        # The filename
        echo "weather.rrd"

        # The data
        echo "$TEMP:$WIND:$HMTY:$RAIN"
fi

exit 0

\end{verbatim}


 


 


\end{description}

\subsection{COMPATIBILITY}


  Some of the RRD files generated by hobbitd\_rrd are incompatible
  with the files generated by the Big Brother LARRD add-on: 



\begin{description}

\item[vmstat] The vmstat files with data from Linux based systems are
  incompatible due to the addition of a number of new data-items that
  LARRD 0.43 do not collect, but hobbitd\_rrd does. This is due to
  changes in the output from the Linux vmstat command, and changes in
  the way e.g. system load metrics are reported. 
 

\item[netstat] All netstat files from LARRD 0.43 are incompatible with
  hobbitd\_rrd. The netstat data collected by LARRD is quite
  confusing: For some types of systems LARRD collects packet-counts,
  for others it collects byte- counts. hobbitd\_rrd uses a different
  RRD file-format with separate counters for packets and bytes and
  tracks whatever data the system is reporting. 


 


 


\end{description}

\subsection{SEE ALSO}
hobbitd\_channel(8), hobbitd(8), hobbitserver.cfg(5), hobbit(7) 

 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Hobbit/BB Messages Protocols}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage


\subsection{BNF}
\textbf{\motohbcmd{bb} [options] RECIPIENT message}

\begin{verbatim}

<hb-messages> ::= <status_msg> <notify_msg> <data_msg> <enable_msg> <query_msg> 
                <config_msg> <drop_msg> <rename_msg> <hobbidlog_msg> <hobbidxlog_msg> 
                <hobbitdboard_msg> <download_msg> <client_msg> <clientlog_msg> <ping_msg> 
                <pullclient_msg> <ghostlist_msg> <schedule_msg>

<drop_msg>   ::= <drop HOSTNAME> <EOL> | <drop HOSTNAME TESTNAME> <EOL>
<HOSTNAME>   ::= <a..z> 
<TESTNAME>   ::= <cpu|trends|conn|info|> 
<status_msg> ::= <status[+LIFETIME][/group:GROUP] HOSTNAME.TESTNAME COLOR |
                 <additional text> ]> <EOL>
<notify_msg> ::= <notify HOSTNAME.TESTNAME <message text> ] >
<data_msg>   ::= <data HOSTNAME.DATANAME <newline> <additional text> >
<enable_msg> ::= [enable HOSTNAME.TESTNAME]
<query_msg>  ::= [query HOSTNAME.TESTNAME]
<config_msg> ::= [config FILENAME]
<drop_msg>   ::= [drop HOSTNAME]
<rename_msg> ::= [rename OLDHOSTNAME NEWHOSTNAME]
<hobbidlog_msg>    ::= 
<hobbidxlog_msg>   ::= [hobbitdxlog HOSTNAME.TESTNAME]
<hobbitdboard_msg> ::= [hobbitdboard [CRITERIA] [fields=FIELDLIST]]
<download_msg>     ::= [download FILENAME] <EOL>
<client_msg>       ::= [client HOSTNAME.OSTYPE [HOSTCLASS]]
<clientlog_msg>    ::= [clientlog HOSTNAME [section=SECTIONNAME[,SECTIONNAME...]]]
<ping_msg>         ::= [ping]  <EOL>
<pullclient_msg>   ::= [pullclient] <EOL>
<ghostlist_msg>    ::= [ghostlist] <EOL>
<schedule_msg>     ::= [schedule [TIMESTAMP COMMAND]]  <EOL>
<SECTIONNAME>      ::= [cpu|la| others sectionname]

\end{verbatim}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{bb - Hobbit client communication program}

\subsection{SYNOPSIS}
\textbf{\motohbcmd{bb} [options] RECIPIENT message}

\subsection{DESCRIPTION}
\emph{bb(1)} is the client program used to communicate with a Hobbit
server. It is frequently used by Hobbit client systems to send in
status messages and pager alerts on local tests. 


In Hobbit, the bb program is also used for administrative purposes,
e.g. to rename or delete hosts, or to disable hosts that are down for
longer periods of time. 

 
\subsection{OPTIONS AND PARAMETERS}
\begin{description}

\item[--debug] Enable debugging. This prints out details about how the
  connection to the BBDISPLAY server is being established. 

\item[--proxy=\url{http://PROXYSERVER:PROXYPORT/}] When sending the
  status messages via HTTP, use this server as an HTTP proxy instead
  of connecting directly to the BBDISPLAY server. 

\item[--timeout=N] Specifies the timeout for connecting to the Hobbit
  server, in seconds. The default is 5 seconds. 

\item[RECIPIENT] The \textbf{RECIPIENT}
 parameter defines which server receives the message. If RECIPIENT is
 given as ``0.0.0.0'', then the message is sent to all of the servers
 listed in the BBDISPLAYS or BBPAGERS environment variable (for
 ``status'' and ``page'' messages, respectively). 

Usually, a client will use ``\$BBDISP'' for the \textbf{RECIPIENT}
parameter, as this is defined for the client scripts to automatically
contain the correct value. 


The \textbf{RECIPIENT} parameter may be a URL for a webserver that
has the bbmessage.cgi or similar script installed. This tunnels the
Hobbit messages to the BBDISPLAY server using standard HTTP
protocol. The \emph{bbmessage.cgi(8)} CGI tool (included in Hobbit)
must be installed on the webserver for the HTTP transport to work.  


\item[MESSAGE] The \textbf{message} parameter is the message to be
  sent across to the Hobbit server. Messages must be enclosed in
  quotes, but by doing so they can span multiple lines. The maximum
  size of a message is defined by the maximum allowed length of your
  shell's commandline, and is typically  8-32 KB. 

If you need to send longer status messages, you can specify ``@'' as
the message: bb will then read the status message from its stdin. 


\end{description}

\subsection{HOBBIT MESSAGE SYNTAX}


This section lists the most commonly used messages in the Hobbit protocol. 


\begin{description}

\item[status[+LIFETIME][/group:GROUP] HOSTNAME.TESTNAME COLOR
  $<$additional text$>$] This sends in a status message for a single
  test (column) on a single host. TESTNAME is the name of the column
  where this test will show up; any name is valid except that using
  dots in the testname will not work. COLOR must be one of the valid
  colors: ``green'', ``yellow'', ``red'' or ``clear''. The colors
  ``blue'' and ``purple'' - although valid colors - should not be sent
  in a status-message, as these are handled specially by the Hobbit
  server.  

The ``additional text'' normally includes a local timestamp and a
summary of the test result on the first line. Any lines following the
first one are free-form, and can include any information that may be
useful to diagnose the problem being reported.  

The LIFETIME defines how long this status is valid after being
received by the Hobbit server. The default is 30 minutes, but you can
set any period you like. E.g. for a custom test that runs once an
hour, you will want to set this to at least 60 minutes - otherwise the
status will go purple after 30 minutes. It is a good idea to set the
LIFETIME to sligtly more than the interval between your tests, to
allow for variations in the time it takes your test to complete. The
LIFETIME is in minutes, unless you add an ``h'' (hours), ``d'' (days)
or ``w'' (weeks) immediately after the number, e.g. ``status+5h'' for
a status that is valid for 5 hours.  


The GROUP option is used to direct alerts from the status to a
specific group. It is currently used for status generated from the
Hobbit clients' data, e.g. to direct alerts for a ``procs'' status to
different people, depending on exactly which process is down. 


 

\item[notify HOSTNAME.TESTNAME $<$message text$>$] This triggers an
 informational message to be sent to those who receive alerts for this
 HOSTNAME+TESTNAME combination, according to the rules defined in
 \emph{hobbit-alerts.cfg(5)}  This is used by the
 \emph{hobbit-enadis.cgi(1)} tool to notify people about hosts being
 disabled or enabled, but can also serve as a general way of notifying
 server administrators. 


 

\item[data HOSTNAME.DATANAME$<$newline$>$$<$additional text$>$] The
 ``data'' message allows tools to send data about a host, without it
 appearing as a column on the Hobbit webpages. This is used e.g. to
 report statistics about a host, e.g. vmstat data which does not in
 itself represent something that has a red, yellow or green
 identity. It is used by RRD bottom-feeder modules, among others. In
 Hobbit, data messages are by default processed only by the
 \emph{hobbitd\_rrd(8)} module. If you want to handle data-messages by
 an external application, you may want to enable the
 \emph{hobbitd\_filestore(8)}  module for data-messages, to store
 data-messages in a format compatible with how the Big Brother daemon
 does. 


%\item[disable HOSTNAME.TESTNAME DURATION $<$additional text$>$]
 Disables a specific test for DURATION minutes. This will cause the
 status of this test to be listed as ``blue'' on the BBDISPLAY server,
 and no alerts for this host/test will be generated. If DURATION is
 given as a number followed by s/m/h/d, it is interpreted as being in
 seconds/minutes/hours/days respectively. \textbf{To} 

%disable\textbf{all}
%tests\textbf{for}
%a\textbf{host,}
%use\textbf{an}
%asterisk\textbf{*}
%for\textbf{TESTNAME.}


\item[enable HOSTNAME.TESTNAME] Re-enables a test that had been disabled. 

 

\item[query HOSTNAME.TESTNAME] Query the BBDISPLAY server for the
  latest status reported for this particular test. If the host/test
  status is known, the response is the first line of the status report
  - the current color will be the first word on the line. Additional
  lines of text that might be present on the status-message cannot be
  retrieved.  

 This allows any Hobbit client to determine the status of a particular
 test, whether it is one pertaining to the host where the client is
 running, some other host, or perhaps the result of a combined test
 from multiple hosts managed by \emph{bbcombotest(1)} This will
 typically be useful to Hobbit client extension scripts, that need to
 determine the status of other hosts e.g. to decide if an automatic
 recovery action should be initiated. 


 

\item[config FILENAME] Retrieve one of the Hobbit configuration files
  from the server. This command allows a client to pull files from the
  \$BBHOME/etc/ directory on the server, allowing for semi-automatic
  updates of the client configuration. Since the configuration files
  are designed to have a common file for the configuration of all
  hosts in the system - and this is in fact the recommended way of
  configuring your clients - this makes it easier to keep the
  configuration files synchronized. 


 

\item[drop HOSTNAME] Removes all data stored about the host
  HOSTNAME. It is assumed that you have already deleted the host from
  the bb-hosts configuration file. 


 

\item[drop HOSTNAME TESTNAME] Remove data about a single test (column). 

 

\item[rename OLDHOSTNAME NEWHOSTNAME] Rename all data for a host that
  changes its name. You should do this before changing the hostname in
  the bb-hosts configuration file. 


 

\item[rename HOSTNAME OLDTESTNAME NEWTESTNAME] Rename data about a single test (column). 

 

\item[hobbitdlog HOSTNAME.TESTNAME] Retrieve the Hobbit status-log for
  a single test. The first line of the response contain a series of
  fields separated by a pipe-sign: 


 \textbf{hostname}
 The name of the host 


 \textbf{testname}
 The name of the test 


 \textbf{color}
 Status color (green, yellow, red, blue, clear, purple) 


 \textbf{testflags}
 For network tests, the flags indicating details about the test (used by bbgen). 


 \textbf{lastchange}
 Unix timestamp when the status color last changed. 


 \textbf{logtime}
 Unix timestamp when the log message was received. 


 \textbf{validtime}
 Unix timestamp when the log message is no longer valid (it goes purple at this time). 


 \textbf{acktime}
 -1, or Unix timestamp when an active acknowledgement expires. 


 \textbf{disabletime}
 -1, or Unix timestamp when the status is no longer disabled. 


 \textbf{sender}
 IP-address where the status was received from. 


 \textbf{cookie}
 -1, or the cookie value used to acknowledge an alert. 


 \textbf{ackmsg}
 Empty, or the acknowledgment message sent when the status was
 acknowledged. Newline, pipe-signs and backslashes are escaped by with
 a backslash in C-style. 



 \textbf{dismsg}
 Empty, or the message sent when the status was disabled. Newline,
 pipe-signs and backslashes are escaped by with a backslash in
 C-style. 



  After the first line comes the full status log in plain text format. 


 

\item[hobbitdxlog HOSTNAME.TESTNAME] Retrieves an XML-string with the
  status log as for the ``hobbitdlog'' command. 


\item[hobbitdboard [CRITERIA] [fields=FIELDLIST]] Retrieves a summary
  of the status of all known tests available to the Hobbit daemon. 


  By default - if no CRITERIA is provided - it returns one line for
  all status messages that are found in Hobbit. You can filter the
  response by selecting a page, a host, a test or a color - wildcards
  are not supported, so you can pick only one page, host, test or
  color. 

 \textbf{page=PAGEPATH}
 Include only tests from hosts found on the PAGEPATH page in the bb-hosts file. 


 \textbf{host=HOSTNAME}
 Include only tests from the host HOSTNAME 


 \textbf{test=TESTNAME}
 Include only tests with the testname TESTNAME 


 \textbf{color=COLORNAME}
 Include only tests where the status color is COLORNAME 


  You can filter on e.g. both a hostname and a testname. 


  The response is one line for each status that matches the CRITERIA,
  or all statuses if no criteria is specified. The line is composed of
  a number of fields, separated by a pipe-sign. You can select what
  fields to retrieve by listing them in the FIELDLIST. The following
  fields are available: 


 \textbf{hostname}
 The name of the host 


 \textbf{testname}
 The name of the test 


 \textbf{color}
 Status color (green, yellow, red, blue, clear, purple) 


 \textbf{flags}
 For network tests, the flags indicating details about the test (used by bbgen). 


 \textbf{lastchange}
 Unix timestamp when the status color last changed. 


 \textbf{logtime}
 Unix timestamp when the log message was received. 


 \textbf{validtime}
 Unix timestamp when the log message is no longer valid (it goes purple at this time). 


 \textbf{acktime}
 -1, or Unix timestamp when an active acknowledgement expires. 


 \textbf{disabletime}
 -1, or Unix timestamp when the status is no longer disabled. 


 \textbf{sender}
 IP-address where the status was received from. 


 \textbf{cookie}
 -1, or the cookie value used to acknowledge an alert. 


 \textbf{line1}
 First line of status log. 


 \textbf{ackmsg}
 Empty (if no acknowledge is active), or the text of the acknowledge message. 


 \textbf{dismsg}
 Empty (if the status is currently enabled), or the text of the disable message. 


 \textbf{msg}
 The full text of the current status message. 

  The ackmsg, dismsg and msg fields have certain characters encoded:
  Newline is ``$\backslash$n'', TAB is ``$\backslash$t'', carriage
  return is ``$\backslash$r'', a pipe-sign is ``$\backslash$p'', and a
  backslash is ``$\backslash$$\backslash$''. 



  If the ``fields'' parameter is omitted, a default set of
  hostname,testname,color,flags,lastchange,logtime,validtime,acktime,disabletime,sender,cookie,line1
  is used. 

\item[hobbitdxboard] Retrieves an XML-string with the summary of all
  status logs as for the ``hobbitdboard'' command. 



 

\item[download FILENAME] Download a file from the Hobbit servers' download directory. 

 

\item[client HOSTNAME.OSTYPE [HOSTCLASS]] Used to send a ``client''
  message to the Hobbit server. Client messages are generated by the
  Hobbit client; when sent to the Hobbit server they are matched
  against the rules in the \emph{hobbit-clients.cfg(5)} configuration
  file, and status messages are generated for the client-side tests. 


 

\item[clientlog HOSTNAME [section=SECTIONNAME[,SECTIONNAME...]]]
  Retrieves the current raw client message last sent by HOSTNAME. The
  optional ``section'' filter is used to select specific sections of
  the client data. 



\item[ping] Attempts to contact the Hobbit server. If successful, the
  Hobbit server version ID is reported. 


 

\item[pullclient] This message is used when fetching client data via
  the ``pull'' mechanism implemented by \emph{hobbitfetch(8)} and
  \emph{msgcache(8)} for clients that cannot connect directly to the
  Hobbit server. 



\item[ghostlist] Report a list of \textbf{ghost} clients seen by the
  Hobbit server. Ghosts are systems that report data to the Hobbit
  server, but are not listed in the bb-hosts file. 

 

\item[schedule [TIMESTAMP COMMAND]] Schedules an command sent to the
  Hobbit server for execution at a later time. E.g. used to schedule
  disabling of a host or service at sometime in the future. COMMAND is
  a complete Hobbit command such as the ones listed above. TIMESTAMP
  is the Unix epoch time when the command will be executed.  

 If no parameters are given, the currently scheduled tasks are listed
 in the response. The response is one line per scheduled command, with
 the job-id, the time when the command will be executed, the IP
 address from which this was sent, and the full command string.   To
 cancel an previously scheduled command, \textbf{``schedule cancel
 JOBID''} can be used. JOBID is a number provided as the first item in
 the output from the schedule list. 


 


\end{description}

\subsection{EXAMPLE}


 Send a normal status message to the BBDISPLAY server, using the
 standard Hobbit protocol on TCP port 1984:  

 
\$\$BB\$BBDISP''statuswww.foo.com.httpgreen`date`WebOK'' 


  Send the same status message, but using HTTP protocol via the webservers' bbmessage.cgi script:  
 
\$\$BB\url{http://bb.foo.com/cgi-bin/bbmessage.cgi}''statuswww.foo.com.httpgreen`date`WebOK'' 


  Use ``query'' message to determine the color of the ``www'' test, and restart Apache if it is red:  



\$WWW=`\$BB\$BBDISP''querywww.foo.com.www``|awk'\{print\$1\}'`  \$if[''\$WWW''=''red''];then/etc/init.d/apacherestart;fi 


  Use ``config'' message to update the local bb-dftab file (but only if we get a response):  


  
\$\$BB\$BBDISP''configbb-dftab''$>$/tmp/bb-dftab.new  
\$if[-s/tmp/bb-dftab.new];then  
mv/tmp/bb-dftab.new\$BBHOME/etc/bb-dftab  
fi 


  Send a very large status message that has been built in the file
  ``statusmsg.txt''. Instead of providing it on the command line, pass
  it via stdin to the bb command: 



  
\$catstatusmsg.txt|\$BB\$BBDISP''@'' 


 
\subsection{NOTES}
 This man-page describes the bb client program provided as part of
 Hobbit . This implementation provides features not present in the
 standard Big Brother bb client - specifically, the support for
 sending messages over HTTP, and many commands such as ``query'' and
 ``config'' are not part of the bb client shipped with Big Brother. 


 
\subsection{SEE ALSO}

bbcombotest(1), bb-hosts(5), hobbitserver.cfg(5), hobbit(7) 
  


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Hobbit Server Administration}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage
\section{HOBBIT-ENADIS.CGI}
 hobbit-enadis.cgi - CGI program to enable/disable Hobbit tests \
\subsection{SYNOPSIS}
\textbf{hobbit-enadis.cgi (invoked via CGI from webserver)}


 
\subsection{DESCRIPTION}
\textbf{hobbit-enadis.cgi} is a CGI tool for disabling and enabling
hosts and tests monitored by Hobbit. You can disable monitoring of a
single test, all tests for a host, or multiple hosts - immediately or
at a future point in time. 


  hobbit-enadis.cgi runs as a CGI program, invoked by your
  webserver. It is normally run via a wrapper shell-script in the
  secured CGI directory for Hobbit. 



  hobbit-enadis.cgi is the back-end script for the enable/disable form
  present on the ``info'' status-pages. It can also run in
  ``stand-alone'' mode, in which case it displays a web form allowing
  users to select what to enable or disable. 



 


 
\subsection{OPTIONS}
\begin{description}
\item[--no-cookies] Normally, hobbit-enadis.cgi uses a cookie sent by
  the browser to initially filter the list of hosts presented. If this
  is not desired, you can turn off this behaviour by calling
  bb-ack.cgi with the --no-cookies option. This would normally be
  placed in the CGI\_ENADIS\_OPTS setting in \emph{hobbitcgi.cfg(5)}



 

\item[--env=FILENAME] Load the environment from FILENAME before
  executing the CGI. 


 

\item[--area=NAME] Load environment variables for a specific area. NB:
  if used, this option must appear before any --env=FILENAME option. 

\end{description}
\

subsection{FILES}
\begin{description}
\item [\$BBHOME/web/maint\_\\{header,form,footer\\}] HTML template header 

 


\end{description}
\subsection{BUGS}
 When using alternate pagesets, hosts will only show up on the
 Enable/Disable page if this is accessed from the primary page in
 which they are defined. So if you have hosts on multiple pages, they
 will only be visible for disabling from their main page which is not
 what you would expect. 


 
\subsection{SEE ALSO}
hobbit(7) 

 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{BB-ACK.CGI}
 bb-ack.cgi - Hobbit CGI script to acknowledge alerts \

\subsection{SYNOPSIS}
\textbf{bb-ack.cgi?ACTION=action\&NUMBER=acknum\&DELAY=validity\&MESSAGE=text}


 
\subsection{DESCRIPTION}
\textbf{bb-ack.cgi}
 is invoked as a CGI script via the bb-ack.sh CGI wrapper. 

  bb-ack.cgi is passed a QUERY\_STRING environment variable with the
  ACTION, NUMBER, DELAY and MESSAGE parameters. 



 
\subsection{PARAMETERS}
 ACTION is the action to perform. The only supported action is ``Ack'' to acknowledge an alert. 

  NUMBER is the number identifying the host/service to be
  acknowledged. It is included in all alert-messages sent out by
  Hobbit. 



  DELAY is the time (in minutes) that the acknowledge is valid. 


  MESSAGE is an optional text which will be shown on the status page
  while the acknowledgment is active. You can use it to e.g. tell
  users not to contact you about the problem, or inform them when the
  problem is expected to be resolved. 



 
\subsection{OPTIONS}
\begin{description}
\item[--no-pin] bb-ack.cgi normally requires the user to enter the
  acknowledgment code received in an alert message. If you run it with
  this option, the user will instead get a list of the current
  non-green statuses, and he may send an acknowledge without knowing
  the code. 


 

\item[--no-cookies] Normally, bb-ack.cgi uses a cookie sent by the
  browser to initially filter the list of hosts presented. If this is
  not desired, you can turn off this behaviour by calling bb-ack.cgi
  with the --no-cookies option. This would normally be placed in the
  CGI\_ACK\_OPTS setting in \emph{hobbitcgi.cfg(5)}



 
\item[--env=FILENAME] Loads the environment defined in FILENAME before executing the CGI script. 

 

\item[--debug] Enables debugging output. 

 


\end{description}
\subsection{FILES}
\begin{description}
\item[\$BBHOME/web/acknowledge\_header] HTML header file for the generated web page 

 

\item[\$BBHOME/web/acknowledge\_footer] HTML footer file for the generated web page 

 

\item[\$BBHOME/web/acknowledge\_form] Query form displayed when bb-ack.cgi is called with no parameters. 

 
\end{description}
\subsection{ENVIRONMENT VARIABLES}
\begin{description}
\item[BBHOME] Used to locate the template files for the generated web pages. 

 

\item[QUERY\_STRING] Contains the parameters for the CGI script. 

 


\end{description}
\subsection{BUGS}
 When using alternate pagesets, hosts will only show up on the
 acknowledgment page if this is accessed from the primary page in
 which they are defined. So if you have hosts on multiple pages, they
 will only be visible for acknowledging from their main page which is
 not what you would expect. 

 
\subsection{SEE ALSO}
bbgen(1), bb-hosts(5), hobbitserver.cfg(5) 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{HOBBIT-GHOSTS.CGI}
 hobbit-ghosts.cgi - CGI program to view ghost clients
 \subsection{SYNOPSIS}
\textbf{hobbit-ghosts.cgi}


 
\subsection{DESCRIPTION}
\textbf{hobbit-ghosts.cgi} is invoked as a CGI script via the hobbit-ghosts.sh CGI wrapper. 

  It generates a listing of the Hobbit clients that have reported data
  to the Hobbit server, but are not listed in the \emph{bb-hosts(5)}
  file. Data from these clients - called ``ghosts'' - are ignored,
  since Hobbit does not know which webpage to present the data on. 



  The listing includes the hostname that the client reports with, the
  IP-address where the report came from, and how long ago the report
  arrived. 



  By far the most common reason for hosts showing up here is that the
  client uses a hostname without a DNS domain, but the bb-hosts file
  uses the hostname with the DNS domain. Or vice versa. You can then
  use a \textbf{CLIENT} setting in the bb-hosts file to match the two
  hostnames together. 



 
\subsection{OPTIONS}
\begin{description}
\item[--env=FILENAME] Loads the environment defined in FILENAME before executing the CGI script. 


\end{description}
\subsection{SEE ALSO}
bb-hosts(5), hobbitserver.cfg(5) 

 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{TRIMHISTORY}
\subsection{NAME}
 \motohbcmd{trimhistory} - Remove old Hobbit history-log entries 

subsection{SYNOPSIS}
\textbf{trimhistory --cutoff=TIME [options]}


 
\subsection{DESCRIPTION}
 The \textbf{trimhistory}
 tool is used to purge old entries from the Hobbit history logs. These
 logfiles accumulate information about all status changes that have
 occurred for any given service, host, or the entire Hobbit system,
 and is used to generate the event- and history-log webpages. 


  Purging old entries can be done while Hobbit is running, since the
  tool takes care not to commit updates to a file if it changes
  mid-way through the operation. In that case, the update is aborted
  and the existing logfile is left untouched. 



  Optionally, this tool will also remove logfiles from hosts that are
  no longer defined in the Hobbit \emph{bb-hosts(5)} file. As an
  extension, even logfiles from services can be removed, if the
  service no longer has a valid status-report logged in the current
  Hobbit status. 



 
\subsection{OPTIONS}
\begin{description}
\item[--cutoff=TIME] This defines the cutoff-time when processing the
  history logs. Entries dated before this time are discarded. TIME is
  specified as the number of seconds since the beginning of the
  Epoch. This is easily generated by the GNU \emph{date(1)} utility,
  e.g. the following command will trim history logs of all entries
  prior to Oct. 1st 2004:  



  
trimhistory--cutoff=`date+\%s--date=''1Oct2004''` 


 

\item[--outdir=DIRECTORY] Normally, files in the BBHIST directory are
  replaced. This option causes trimhistory to save the shortened
  history logfiles to another directory, so you can verify that the
  operation works as intended. The output directory must exist. 


 

\item[--drop] Causes trimhistory to delete files from hosts that are
  not listed in the \emph{bb-hosts(5)} file. 

 

\item[--dropsvcs] Causes trimhistory to delete files from services
  that are not currently tracked by Hobbit. Normally these files would
  be left untouched if only the host exists. 

 

\item[--droplogs] Process the BBHISTLOGS directory also, and delete
  status-logs from events prior to the cut-off time. Note that this
  can dramatically increase the processing time, since there are often
  lots and lots of files to process. 


 

\item[--progress[=N]] This will cause trimhistory to output a status
  line for every N history logs or status-log collections it
  processes, to indicate how far it has progressed. The default
  setting for N is 100. 


 

\item[--env=FILENAME] Loads the environment from FILENAME before executing trimhistory. 

 

\item[--debug] Enable debugging output. 

 
\end{description}
\subsection{FILES}
\begin{description}
\item[\$BBHIST/allevents] The eventlog of all events that have happened in Hobbit. 

 

\item[\$BBHIST/HOSTNAME] The per-host eventlogs. 

 

\item[\$BBHIST/HOSTNAME.SERVICE] The per-service eventlogs. 

 

\item[\$BBHISTLOGS/*/*] The historical status-logs. 

 


\end{description}
\subsection{ENVIRONMENT VARIABLES}
\begin{description}
\item[BBHIST] The directory holding all history logs. 

 

\item[BBHISTLOGS] The top-level directory for the historical status-log collections. 

 

\item[BBHOSTS] The location of the bb-hosts file, holding the list of currently known hosts in Hobbit. 


\end{description}
\subsection{SEE ALSO}
hobbit(7), bb-hosts(5) 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{HOBBIT-ACKINFO.CGI}
 hobbit-ackinfo.cgi - Hobbit CGI script to acknowledge alerts \subsection{SYNOPSIS}
\textbf{hobbit-ackinfo.cgi}


 
\subsection{DESCRIPTION}
\textbf{hobbit-ackinfo.cgi}
 is invoked as a CGI script via the hobbit-ackinfo.sh CGI wrapper. 

  hobbit-ackinfo.cgi is used to acknowledge an alert on the Hobbit
  ``Critical Systems'' view, generated by the
  \emph{hobbit-nkview.cgi(1)} utility. This allows the staff viewing
  the Critical Systems view to acknowledge alerts with a ``Level 1''
  alert, thereby removing the alert from the Critical Systems view. 



  Note that the Level 1 alert generated by the hobbit-ackinfo.cgi
  utility does \textbf{NOT} stop alerts from being sent. 



  In a future version of Hobbit (after Hobbit 4.2), this utility will
  also be used for acknowledging alerts at other levels. 



 
\subsection{OPTIONS}
\begin{description}
\item[--level=NUMBER] Sets the acknowledgment level. This is typically
  used to force a specific level of the acknowledgment, e.g. a level 1
  acknowledge when called from the Critical Systems view. 


 

\item[--validity=TIME] Sets the validity of the acknowledgment. By
  default this is taken from the CGI parameters supplied by the user. 


 

\item[--sender=STRING] Logs STRING as the sender of the
  acknowledgment. By default, this is taken from the loginname of the
  webuser sending the acknowledgment. 


 

\item[--env=FILENAME] Loads the environment defined in FILENAME before executing the CGI script. 

 

\item[--area=NAME] Load environment variables for a specific area. NB:
  if used, this option must appear before any --env=FILENAME option. 


 

\item[--debug] Enables debugging output. 


\end{description}
\subsection{ENVIRONMENT VARIABLES}
\begin{description}
\item[BBHOME] Used to locate the template files for the generated web pages. 


\item[QUERY\_STRING] Contains the parameters for the CGI script. 

\end{description}
\subsection{SEE ALSO}
hobbit-nkview.cgi(1), hobbit(7) 


