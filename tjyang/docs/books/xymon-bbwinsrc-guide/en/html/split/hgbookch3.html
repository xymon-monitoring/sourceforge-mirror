<?xml version="1.0" encoding="iso-8859-1" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">  
<!--http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd-->  
<html xmlns="http://www.w3.org/1999/xhtml"  
> 
<head><title>3 Administration FAQ</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)" /> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)" /> 
<!-- html4-uni,2,html,xhtml --> 
<meta name="src" content="hgbook.tex" /> 
<meta name="date" content="2008-03-02 11:10:00" /> 
<link rel="stylesheet" type="text/css" href="hgbook.css" /> 
</head><body 
>
   <!--l. 1--><div class="crosslinks"><p class="noindent">[<a 
href="hgbookch4.html" >next</a>] [<a 
href="hgbookch2.html" >prev</a>] [<a 
href="hgbookch2.html#tailhgbookch2.html" >prev-tail</a>] [<a 
href="#tailhgbookch3.html">tail</a>] [<a 
href="hgbook.html#hgbookch3.html" >up</a>] </p></div>
   <h2 class="chapterHead"><span class="titlemark">Chapter&#x00A0;3</span><br /><a 
 id="x7-690003"></a>Administration FAQ</h2>
<!--l. 4--><p class="noindent">Mercurial offers a powerful mechanism to let you perform automated actions in response to events that occur in a repository. In
some cases, you can even control Mercurial&#x2019;s response to those events.
</p><!--l. 8--><p class="indent">   The name Mercurial uses for one of these actions is a <span 
class="ptmri7t-">hook</span>. Hooks are called &#x201C;triggers&#x201D; in some revision control systems,
but the two names refer to the same idea.
</p>
   <h3 class="sectionHead"><span class="titlemark">3.1    </span> <a 
 id="x7-700003.1"></a>An overview of hooks in Mercurial</h3>
<!--l. 14--><p class="noindent">Here is a brief list of the hooks that Mercurial supports. We will revisit each of these hooks in more detail later, in
section&#x00A0;<a 
href="#x7-1030003.8">3.8<!--tex4ht:ref: sec:hook:ref --></a>.
</p>
     <ul><li><span class="dt">
<a 
 id="dx7-70001"></a><a 
 id="dx7-70002"></a><span 
class="pcrr7tn-x-x-90">changegroup</span> </span><span class="dd">This is run after a group of changesets has been brought into the repository from elsewhere.
     </span><li><span class="dt">
<a 
 id="dx7-70003"></a><a 
 id="dx7-70004"></a><span 
class="pcrr7tn-x-x-90">commit</span> </span><span class="dd">This is run after a new changeset has been created in the local repository.
     </span><li><span class="dt">
<a 
 id="dx7-70005"></a><a 
 id="dx7-70006"></a><span 
class="pcrr7tn-x-x-90">incoming</span> </span><span class="dd">This is run once for each new changeset that is brought into the repository from elsewhere. Notice the difference
     from <a 
 id="dx7-70007"></a><a 
 id="dx7-70008"></a><span 
class="pcrr7tn-">changegroup</span>, which is run once per <span 
class="ptmri7t-">group </span>of changesets brought in.
     </span><li><span class="dt">
<a 
 id="dx7-70009"></a><a 
 id="dx7-70010"></a><span 
class="pcrr7tn-x-x-90">outgoing</span> </span><span class="dd">This is run after a group of changesets has been transmitted from this repository.
     </span><li><span class="dt">
<a 
 id="dx7-70011"></a><a 
 id="dx7-70012"></a><span 
class="pcrr7tn-x-x-90">prechangegroup</span> </span><span class="dd">This is run before starting to bring a group of changesets into the repository.
     </span><li><span class="dt">
<a 
 id="dx7-70013"></a><a 
 id="dx7-70014"></a><span 
class="pcrr7tn-x-x-90">precommit</span> </span><span class="dd">Controlling. This is run before starting a commit.
     </span><li><span class="dt">
<a 
 id="dx7-70015"></a><a 
 id="dx7-70016"></a><span 
class="pcrr7tn-x-x-90">preoutgoing</span> </span><span class="dd">Controlling. This is run before starting to transmit a group of changesets from this repository.
     </span><li><span class="dt">
<a 
 id="dx7-70017"></a><a 
 id="dx7-70018"></a><span 
class="pcrr7tn-x-x-90">pretag</span> </span><span class="dd">Controlling. This is run before creating a tag.
     </span><li><span class="dt">
<a 
 id="dx7-70019"></a><a 
 id="dx7-70020"></a><span 
class="pcrr7tn-x-x-90">pretxnchangegroup</span> </span><span class="dd">Controlling. This is run after a group of changesets has been brought into the local repository from another, but
     before the transaction completes that will make the changes permanent in the repository.
     </span><li><span class="dt">
<a 
 id="dx7-70021"></a><a 
 id="dx7-70022"></a><span 
class="pcrr7tn-x-x-90">pretxncommit</span> </span><span class="dd">Controlling. This is run after a new changeset has been created in the local repository, but before the transaction
     completes that will make it permanent.
     </span><li><span class="dt">
<a 
 id="dx7-70023"></a><a 
 id="dx7-70024"></a><span 
class="pcrr7tn-x-x-90">preupdate</span> </span><span class="dd">Controlling. This is run before starting an update or merge of the working directory.
     </span><li><span class="dt">
 <a 
 id="dx7-70025"></a><a 
 id="dx7-70026"></a><span 
class="pcrr7tn-x-x-90">tag</span> </span><span class="dd">This is run after a tag is created.
     </span><li><span class="dt">
<a 
 id="dx7-70027"></a><a 
 id="dx7-70028"></a><span 
class="pcrr7tn-x-x-90">update</span> </span><span class="dd">This is run after an update or merge of the working directory has finished.</li></ul>
                                                                                         
                                                                                         
<!--l. 49--><p class="noindent">Each of the hooks whose description begins with the word &#x201C;Controlling&#x201D; has the ability to determine whether an activity can
proceed. If the hook succeeds, the activity may proceed; if it fails, the activity is either not permitted or undone, depending on
the hook.
</p><!--l. 54--><p class="noindent">
</p>
   <h3 class="sectionHead"><span class="titlemark">3.2    </span> <a 
 id="x7-710003.2"></a>Hooks and security</h3>
<!--l. 56--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.2.1    </span> <a 
 id="x7-720003.2.1"></a>Hooks are run with your privileges</h4>
<!--l. 58--><p class="noindent">When you run a Mercurial command in a repository, and the command causes a hook to run, that hook runs on <span 
class="ptmri7t-">your </span>system,
under <span 
class="ptmri7t-">your </span>user account, with <span 
class="ptmri7t-">your </span>privilege level. Since hooks are arbitrary pieces of executable code, you should treat them
with an appropriate level of suspicion. Do not install a hook unless you are confident that you know who created it and what it
does.
</p><!--l. 65--><p class="indent">   In some cases, you may be exposed to hooks that you did not install yourself. If you work with Mercurial on an unfamiliar
system, Mercurial will run hooks defined in that system&#x2019;s global <a 
 id="dx7-72001"></a><a 
 id="dx7-72002"></a><span 
class="pcrr7tn-">hgrc</span>&#x00A0;file.
</p><!--l. 69--><p class="indent">   If you are working with a repository owned by another user, Mercurial can run hooks defined in that user&#x2019;s
repository, but it will still run them as &#x201C;you&#x201D;. For example, if you <a 
 id="dx7-72003"></a>&#x201C;<span 
class="pcrr7tn-">hg pull</span>&#x201D; from that repository, and its <a 
 id="dx7-72004"></a><span 
class="pcrr7tn-">.hg/hgrc</span>
defines a local <a 
 id="dx7-72005"></a><a 
 id="dx7-72006"></a><span 
class="pcrr7tn-">outgoing </span>hook, that hook will run under your user account, even though you don&#x2019;t own that
repository.
</p>
   <div class="fbox"><span 
class="ptmb7t-">Note:  </span>This only applies if you are pulling from a repository on a local or network
filesystem. If you&#x2019;re pulling over http or ssh, any <span 
class="pcrr7tn-">outgoing </span>hook will run under
whatever account is executing the server process, on the server.                               </div>
<!--l. 83--><p class="indent">   XXX To see what hooks are defined in a repository, use the <a 
 id="dx7-72009"></a>&#x201C;<span 
class="pcrr7tn-">hg config hooks</span>&#x201D; command. If you are working in one
repository, but talking to another that you do not own (e.g.&#x00A0;using <a 
 id="dx7-72010"></a>&#x201C;<span 
class="pcrr7tn-">hg pull</span>&#x201D; or <a 
 id="dx7-72011"></a>&#x201C;<span 
class="pcrr7tn-">hg incoming</span>&#x201D;), remember that it is the other
repository&#x2019;s hooks you should be checking, not your own.
</p><!--l. 89--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.2.2    </span> <a 
 id="x7-730003.2.2"></a>Hooks do not propagate</h4>
<!--l. 91--><p class="noindent">In Mercurial, hooks are not revision controlled, and do not propagate when you clone, or pull from, a repository. The reason for
this is simple: a hook is a completely arbitrary piece of executable code. It runs under your user identity, with your privilege
level, on your machine.
</p><!--l. 97--><p class="indent">   It would be extremely reckless for any distributed revision control system to implement revision-controlled
hooks, as this would offer an easily exploitable way to subvert the accounts of users of the revision control
system.
</p><!--l. 102--><p class="indent">   Since Mercurial does not propagate hooks, if you are collaborating with other people on a common project, you should not
assume that they are using the same Mercurial hooks as you are, or that theirs are correctly configured. You should document
the hooks you expect people to use.
</p><!--l. 108--><p class="indent">   In a corporate intranet, this is somewhat easier to control, as you can for example provide a &#x201C;standard&#x201D; installation of
Mercurial on an NFS filesystem, and use a site-wide <a 
 id="dx7-73001"></a><a 
 id="dx7-73002"></a><span 
class="pcrr7tn-">hgrc</span>&#x00A0;file to define hooks that all users will see. However, this too has its
limits; see below.
                                                                                         
                                                                                         
</p><!--l. 113--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.2.3    </span> <a 
 id="x7-740003.2.3"></a>Hooks can be overridden</h4>
<!--l. 115--><p class="noindent">Mercurial allows you to override a hook definition by redefining the hook. You can disable it by setting its value to the empty
string, or change its behaviour as you wish.
</p><!--l. 119--><p class="indent">   If you deploy a system-&#x00A0;or site-wide <a 
 id="dx7-74001"></a><a 
 id="dx7-74002"></a><span 
class="pcrr7tn-">hgrc</span>&#x00A0;file that defines some hooks, you should thus understand that your users can
disable or override those hooks.
</p><!--l. 123--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.2.4    </span> <a 
 id="x7-750003.2.4"></a>Ensuring that critical hooks are run</h4>
<!--l. 125--><p class="noindent">Sometimes you may want to enforce a policy that you do not want others to be able to work around. For example, you may
have a requirement that every changeset must pass a rigorous set of tests. Defining this requirement via a hook in a site-wide
<a 
 id="dx7-75001"></a><a 
 id="dx7-75002"></a><span 
class="pcrr7tn-">hgrc</span>&#x00A0;won&#x2019;t work for remote users on laptops, and of course local users can subvert it at will by overriding the
hook.
</p><!--l. 132--><p class="indent">   Instead, you can set up your policies for use of Mercurial so that people are expected to propagate changes through a
well-known &#x201C;canonical&#x201D; server that you have locked down and configured appropriately.
</p><!--l. 137--><p class="indent">   One way to do this is via a combination of social engineering and technology. Set up a restricted-access account; users can
push changes over the network to repositories managed by this account, but they cannot log into the account and run
normal shell commands. In this scenario, a user can commit a changeset that contains any old garbage they
want.
</p><!--l. 144--><p class="indent">   When someone pushes a changeset to the server that everyone pulls from, the server will test the changeset before it accepts
it as permanent, and reject it if it fails to pass the test suite. If people only pull changes from this filtering server, it will serve to
ensure that all changes that people pull have been automatically vetted.
</p><!--l. 151--><p class="noindent">
</p>
   <h3 class="sectionHead"><span class="titlemark">3.3    </span> <a 
 id="x7-760003.3"></a>Care with <span 
class="pcrr7tn-">pretxn </span>hooks in a shared-access repository</h3>
<!--l. 153--><p class="noindent">If you want to use hooks to do some automated work in a repository that a number of people have shared access to, you need to
be careful in how you do this.
</p><!--l. 157--><p class="indent">   Mercurial only locks a repository when it is writing to the repository, and only the parts of Mercurial that write to the
repository pay attention to locks. Write locks are necessary to prevent multiple simultaneous writers from scribbling on each
other&#x2019;s work, corrupting the repository.
</p><!--l. 163--><p class="indent">   Because Mercurial is careful with the order in which it reads and writes data, it does not need to acquire a lock when it
wants to read data from the repository. The parts of Mercurial that read from the repository never pay attention to locks. This
lockless reading scheme greatly increases performance and concurrency.
</p><!--l. 169--><p class="indent">   With great performance comes a trade-off, though, one which has the potential to cause you trouble unless you&#x2019;re aware of
it. To describe this requires a little detail about how Mercurial adds changesets to a repository and reads those
changes.
</p><!--l. 174--><p class="indent">   When Mercurial <span 
class="ptmri7t-">writes </span>metadata, it writes it straight into the destination file. It writes file data first, then manifest data
(which contains pointers to the new file data), then changelog data (which contains pointers to the new manifest data).
Before the first write to each file, it stores a record of where the end of the file was in its transaction log. If the
transaction must be rolled back, Mercurial simply truncates each file back to the size it was before the transaction
began.
</p><!--l. 183--><p class="indent">   When Mercurial <span 
class="ptmri7t-">reads </span>metadata, it reads the changelog first, then everything else. Since a reader will only
access parts of the manifest or file metadata that it can see in the changelog, it can never see partially written
data.
</p><!--l. 188--><p class="indent">   Some controlling hooks (<a 
 id="dx7-76001"></a><a 
 id="dx7-76002"></a><span 
class="pcrr7tn-">pretxncommit </span>and <a 
 id="dx7-76003"></a><a 
 id="dx7-76004"></a><span 
class="pcrr7tn-">pretxnchangegroup</span>) run when a transaction is almost complete. All of the
metadata has been written, but Mercurial can still roll the transaction back and cause the newly-written data to
                                                                                         
                                                                                         
disappear.
</p><!--l. 193--><p class="indent">   If one of these hooks runs for long, it opens a window of time during which a reader can see the metadata for changesets
that are not yet permanent, and should not be thought of as &#x201C;really there&#x201D;. The longer the hook runs, the longer that window is
open.
</p><!--l. 198--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.3.1    </span> <a 
 id="x7-770003.3.1"></a>The problem illustrated</h4>
<!--l. 200--><p class="noindent">In principle, a good use for the <a 
 id="dx7-77001"></a><a 
 id="dx7-77002"></a><span 
class="pcrr7tn-">pretxnchangegroup </span>hook would be to automatically build and test incoming
changes before they are accepted into a central repository. This could let you guarantee that nobody can push
changes to this repository that &#x201C;break the build&#x201D;. But if a client can pull changes while they&#x2019;re being tested, the
usefulness of the test is zero; an unsuspecting someone can pull untested changes, potentially breaking their
build.
</p><!--l. 208--><p class="indent">   The safest technological answer to this challenge is to set up such a &#x201C;gatekeeper&#x201D; repository as <span 
class="ptmri7t-">unidirectional</span>. Let it take
changes pushed in from the outside, but do not allow anyone to pull changes from it (use the <a 
 id="dx7-77003"></a><a 
 id="dx7-77004"></a><span 
class="pcrr7tn-">preoutgoing </span>hook to lock it
down). Configure a <a 
 id="dx7-77005"></a><a 
 id="dx7-77006"></a><span 
class="pcrr7tn-">changegroup </span>hook so that if a build or test succeeds, the hook will push the new changes out to another
repository that people <span 
class="ptmri7t-">can </span>pull from.
</p><!--l. 216--><p class="indent">   In practice, putting a centralised bottleneck like this in place is not often a good idea, and transaction visibility has nothing
to do with the problem. As the size of a project&#x2014;and the time it takes to build and test&#x2014;grows, you rapidly run into a wall with
this &#x201C;try before you buy&#x201D; approach, where you have more changesets to test than time in which to deal with them. The
inevitable result is frustration on the part of all involved.
</p><!--l. 224--><p class="indent">   An approach that scales better is to get people to build and test before they push, then run automated builds and tests
centrally <span 
class="ptmri7t-">after </span>a push, to be sure all is well. The advantage of this approach is that it does not impose a limit on the rate at which
the repository can accept changes.
</p><!--l. 230--><p class="noindent">
</p>
   <h3 class="sectionHead"><span class="titlemark">3.4    </span> <a 
 id="x7-780003.4"></a>A short tutorial on using hooks</h3>
<!--l. 233--><p class="noindent">It is easy to write a Mercurial hook. Let&#x2019;s start with a hook that runs when you finish a <a 
 id="dx7-78001"></a>&#x201C;<span 
class="pcrr7tn-">hg commit</span>&#x201D;, and simply prints the hash
of the changeset you just created. The hook is called <a 
 id="dx7-78002"></a><a 
 id="dx7-78003"></a><span 
class="pcrr7tn-">commit</span>.
</p>
   <hr class="figure" /><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x7-780261"></a>
                                                                                         
                                                                                         
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x7-78005r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;init</span><span 
class="pcrb7t-">&#x00A0;hook-test</span>
<br class="fancyvrb" /><a 
 id="x7-78007r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">cd</span><span 
class="pcrb7t-">&#x00A0;hook-test</span>
<br class="fancyvrb" /><a 
 id="x7-78009r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">echo</span><span 
class="pcrb7t-">&#x00A0;'[hooks]'</span><span 
class="pcrb7t-">&#x00A0;&#x003e;&#x003e;</span><span 
class="pcrb7t-">&#x00A0;.hg/hgrc</span>
<br class="fancyvrb" /><a 
 id="x7-78011r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">echo</span><span 
class="pcrb7t-">&#x00A0;'commit</span><span 
class="pcrb7t-">&#x00A0;=</span><span 
class="pcrb7t-">&#x00A0;echo</span><span 
class="pcrb7t-">&#x00A0;committed</span><span 
class="pcrb7t-">&#x00A0;$HG_NODE'</span><span 
class="pcrb7t-">&#x00A0;&#x003e;&#x003e;</span><span 
class="pcrb7t-">&#x00A0;.hg/hgrc</span>
<br class="fancyvrb" /><a 
 id="x7-78013r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">cat</span><span 
class="pcrb7t-">&#x00A0;.hg/hgrc</span>
<br class="fancyvrb" /><a 
 id="x7-78015r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;[hooks]</span>
<br class="fancyvrb" /><a 
 id="x7-78017r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;commit</span><span 
class="pcrr7tn-">&#x00A0;=</span><span 
class="pcrr7tn-">&#x00A0;echo</span><span 
class="pcrr7tn-">&#x00A0;committed</span><span 
class="pcrr7tn-">&#x00A0;$HG_NODE</span>
<br class="fancyvrb" /><a 
 id="x7-78019r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">echo</span><span 
class="pcrb7t-">&#x00A0;a</span><span 
class="pcrb7t-">&#x00A0;&#x003e;</span><span 
class="pcrb7t-">&#x00A0;a</span>
<br class="fancyvrb" /><a 
 id="x7-78021r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;add</span><span 
class="pcrb7t-">&#x00A0;a</span>
<br class="fancyvrb" /><a 
 id="x7-78023r10"></a><span 
class="ptmr7t-x-x-50">10</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;commit</span><span 
class="pcrb7t-">&#x00A0;-m</span><span 
class="pcrb7t-">&#x00A0;'testing</span><span 
class="pcrb7t-">&#x00A0;commit</span><span 
class="pcrb7t-">&#x00A0;hook'</span>
<br class="fancyvrb" /><a 
 id="x7-78025r11"></a><span 
class="ptmr7t-x-x-50">11</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;committed</span><span 
class="pcrr7tn-">&#x00A0;56f1582ee5ad216797b263fce7d2ebe2da234ff3</span>
   </div>
<br /><table class="caption" 
><tr style="vertical-align:baseline;" class="caption"><td class="id">Figure&#x00A0;3.1: </td><td  
class="content">A simple hook that runs when a changeset is committed</td></tr></table><!--tex4ht:label?: x7-780261 -->
                                                                                         
                                                                                         
   </td></tr></table></div><hr class="endfigure" />
<!--l. 243--><p class="indent">   All hooks follow the pattern in example&#x00A0;<a 
href="#x7-780261">3.1<!--tex4ht:ref: ex:hook:init --></a>. You add an entry to the <a 
 id="dx7-78027"></a><span 
class="pcrr7tn-">[hooks] </span>section of your <a 
 id="dx7-78028"></a><a 
 id="dx7-78029"></a><span 
class="pcrr7tn-">hgrc</span>&#x022E;n the left is the name
of the event to trigger on; on the right is the action to take. As you can see, you can run an arbitrary shell command in a
hook. Mercurial passes extra information to the hook using environment variables (look for <a 
 id="dx7-78030"></a><a 
 id="dx7-78031"></a><span 
class="pcrr7tn-">HG</span><span 
class="pcrr7tn-">_NODE </span>in the
example).
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.4.1    </span> <a 
 id="x7-790003.4.1"></a>Performing multiple actions per event</h4>
<!--l. 252--><p class="noindent">Quite often, you will want to define more than one hook for a particular kind of event, as shown in example&#x00A0;<a 
href="#x7-790112">3.2<!--tex4ht:ref: ex:hook:ext --></a>. Mercurial lets
you do this by adding an <span 
class="ptmri7t-">extension </span>to the end of a hook&#x2019;s name. You extend a hook&#x2019;s name by giving the name of the hook,
followed by a full stop (the &#x201C;<span 
class="pcrr7tn-">.</span>&#x201D; character), followed by some more text of your choosing. For example, Mercurial will run both
<span 
class="pcrr7tn-">commit.foo </span>and <span 
class="pcrr7tn-">commit.bar </span>when the <span 
class="pcrr7tn-">commit </span>event occurs.
</p>
   <hr class="figure" /><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x7-790112"></a>
                                                                                         
                                                                                         
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x7-79002r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">echo</span><span 
class="pcrb7t-">&#x00A0;'commit.when</span><span 
class="pcrb7t-">&#x00A0;=</span><span 
class="pcrb7t-">&#x00A0;echo</span><span 
class="pcrb7t-">&#x00A0;-n</span><span 
class="pcrb7t-">&#x00A0;"date</span><span 
class="pcrb7t-">&#x00A0;of</span><span 
class="pcrb7t-">&#x00A0;commit:</span><span 
class="pcrb7t-">&#x00A0;";</span><span 
class="pcrb7t-">&#x00A0;date'</span><span 
class="pcrb7t-">&#x00A0;&#x003e;&#x003e;</span><span 
class="pcrb7t-">&#x00A0;.hg/hgrc</span>
<br class="fancyvrb" /><a 
 id="x7-79004r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">echo</span><span 
class="pcrb7t-">&#x00A0;a</span><span 
class="pcrb7t-">&#x00A0;&#x003e;&#x003e;</span><span 
class="pcrb7t-">&#x00A0;a</span>
<br class="fancyvrb" /><a 
 id="x7-79006r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;commit</span><span 
class="pcrb7t-">&#x00A0;-m</span><span 
class="pcrb7t-">&#x00A0;'i</span><span 
class="pcrb7t-">&#x00A0;have</span><span 
class="pcrb7t-">&#x00A0;two</span><span 
class="pcrb7t-">&#x00A0;hooks'</span>
<br class="fancyvrb" /><a 
 id="x7-79008r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;committed</span><span 
class="pcrr7tn-">&#x00A0;5a24d5092a9110acec1985778f7f1b1551046eed</span>
<br class="fancyvrb" /><a 
 id="x7-79010r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;date</span><span 
class="pcrr7tn-">&#x00A0;of</span><span 
class="pcrr7tn-">&#x00A0;commit:</span><span 
class="pcrr7tn-">&#x00A0;Sun</span><span 
class="pcrr7tn-">&#x00A0;Mar</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;2</span><span 
class="pcrr7tn-">&#x00A0;16:16:30</span><span 
class="pcrr7tn-">&#x00A0;GMT</span><span 
class="pcrr7tn-">&#x00A0;2008</span>
   </div>
<br /><table class="caption" 
><tr style="vertical-align:baseline;" class="caption"><td class="id">Figure&#x00A0;3.2: </td><td  
class="content">Defining a second <a 
 id="dx7-79012"></a><a 
 id="dx7-79013"></a><span 
class="pcrr7tn-">commit </span>hook</td></tr></table><!--tex4ht:label?: x7-790112 -->
                                                                                         
                                                                                         
   </td></tr></table></div><hr class="endfigure" />
<!--l. 267--><p class="indent">   To give a well-defined order of execution when there are multiple hooks defined for an event, Mercurial sorts hooks by
extension, and executes the hook commands in this sorted order. In the above example, it will execute <span 
class="pcrr7tn-">commit.bar </span>before
<span 
class="pcrr7tn-">commit.foo</span>, and <span 
class="pcrr7tn-">commit </span>before both.
</p><!--l. 273--><p class="indent">   It is a good idea to use a somewhat descriptive extension when you define a new hook. This will help you to remember what
the hook was for. If the hook fails, you&#x2019;ll get an error message that contains the hook name and extension, so using
a descriptive extension could give you an immediate hint as to why the hook failed (see section&#x00A0;<a 
href="#x7-800003.4.2">3.4.2<!--tex4ht:ref: sec:hook:perm --></a> for an
example).
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.4.2    </span> <a 
 id="x7-800003.4.2"></a>Controlling whether an activity can proceed</h4>
<!--l. 283--><p class="noindent">In our earlier examples, we used the <a 
 id="dx7-80001"></a><a 
 id="dx7-80002"></a><span 
class="pcrr7tn-">commit </span>hook, which is run after a commit has completed. This is one of
several Mercurial hooks that run after an activity finishes. Such hooks have no way of influencing the activity
itself.
</p><!--l. 288--><p class="indent">   Mercurial defines a number of events that occur before an activity starts; or after it starts, but before it finishes.
Hooks that trigger on these events have the added ability to choose whether the activity can continue, or will
abort.
</p><!--l. 293--><p class="indent">   The <a 
 id="dx7-80003"></a><a 
 id="dx7-80004"></a><span 
class="pcrr7tn-">pretxncommit </span>hook runs after a commit has all but completed. In other words, the metadata representing the
changeset has been written out to disk, but the transaction has not yet been allowed to complete. The <a 
 id="dx7-80005"></a><a 
 id="dx7-80006"></a><span 
class="pcrr7tn-">pretxncommit </span>hook has
the ability to decide whether the transaction can complete, or must be rolled back.
</p><!--l. 299--><p class="indent">   If the <a 
 id="dx7-80007"></a><a 
 id="dx7-80008"></a><span 
class="pcrr7tn-">pretxncommit </span>hook exits with a status code of zero, the transaction is allowed to complete; the commit finishes; and
the <a 
 id="dx7-80009"></a><a 
 id="dx7-80010"></a><span 
class="pcrr7tn-">commit </span>hook is run. If the <a 
 id="dx7-80011"></a><a 
 id="dx7-80012"></a><span 
class="pcrr7tn-">pretxncommit </span>hook exits with a non-zero status code, the transaction is rolled back; the
metadata representing the changeset is erased; and the <a 
 id="dx7-80013"></a><a 
 id="dx7-80014"></a><span 
class="pcrr7tn-">commit </span>hook is not run.
</p>
   <hr class="figure" /><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x7-800413"></a>
                                                                                         
                                                                                         
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x7-80016r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">cat</span><span 
class="pcrb7t-">&#x00A0;check_bug_id</span>
<br class="fancyvrb" /><a 
 id="x7-80018r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;#!/bin/sh</span>
<br class="fancyvrb" /><a 
 id="x7-80020r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;#</span><span 
class="pcrr7tn-">&#x00A0;check</span><span 
class="pcrr7tn-">&#x00A0;that</span><span 
class="pcrr7tn-">&#x00A0;a</span><span 
class="pcrr7tn-">&#x00A0;commit</span><span 
class="pcrr7tn-">&#x00A0;comment</span><span 
class="pcrr7tn-">&#x00A0;mentions</span><span 
class="pcrr7tn-">&#x00A0;a</span><span 
class="pcrr7tn-">&#x00A0;numeric</span><span 
class="pcrr7tn-">&#x00A0;bug</span><span 
class="pcrr7tn-">&#x00A0;id</span>
<br class="fancyvrb" /><a 
 id="x7-80022r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;hg</span><span 
class="pcrr7tn-">&#x00A0;log</span><span 
class="pcrr7tn-">&#x00A0;-r</span><span 
class="pcrr7tn-">&#x00A0;$1</span><span 
class="pcrr7tn-">&#x00A0;--template</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="cmsy-10">{</span><span 
class="pcrr7tn-">desc</span><span 
class="cmsy-10">}</span><span 
class="pcrr7tn-">&#x00A0;|</span><span 
class="pcrr7tn-">&#x00A0;grep</span><span 
class="pcrr7tn-">&#x00A0;-q</span><span 
class="pcrr7tn-">&#x00A0;"</span><span 
class="cmsy-10">&#x2216;</span><span 
class="pcrr7tn-">&#x003c;bug</span><span 
class="pcrr7tn-">&#x00A0;&#x22C6;[0-9]"</span>
<br class="fancyvrb" /><a 
 id="x7-80024r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">echo</span><span 
class="pcrb7t-">&#x00A0;'pretxncommit.bug_id_required</span><span 
class="pcrb7t-">&#x00A0;=</span><span 
class="pcrb7t-">&#x00A0;./check_bug_id</span><span 
class="pcrb7t-">&#x00A0;$HG_NODE'</span><span 
class="pcrb7t-">&#x00A0;&#x003e;&#x003e;</span><span 
class="pcrb7t-">&#x00A0;.hg/hgrc</span>
<br class="fancyvrb" /><a 
 id="x7-80026r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">echo</span><span 
class="pcrb7t-">&#x00A0;a</span><span 
class="pcrb7t-">&#x00A0;&#x003e;&#x003e;</span><span 
class="pcrb7t-">&#x00A0;a</span>
<br class="fancyvrb" /><a 
 id="x7-80028r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;commit</span><span 
class="pcrb7t-">&#x00A0;-m</span><span 
class="pcrb7t-">&#x00A0;'i</span><span 
class="pcrb7t-">&#x00A0;am</span><span 
class="pcrb7t-">&#x00A0;not</span><span 
class="pcrb7t-">&#x00A0;mentioning</span><span 
class="pcrb7t-">&#x00A0;a</span><span 
class="pcrb7t-">&#x00A0;bug</span><span 
class="pcrb7t-">&#x00A0;id'</span>
<br class="fancyvrb" /><a 
 id="x7-80030r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;abort:</span><span 
class="pcrr7tn-">&#x00A0;pretxncommit.bug_id_required</span><span 
class="pcrr7tn-">&#x00A0;hook</span><span 
class="pcrr7tn-">&#x00A0;exited</span><span 
class="pcrr7tn-">&#x00A0;with</span><span 
class="pcrr7tn-">&#x00A0;status</span><span 
class="pcrr7tn-">&#x00A0;1</span>
<br class="fancyvrb" /><a 
 id="x7-80032r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;transaction</span><span 
class="pcrr7tn-">&#x00A0;abort!</span>
<br class="fancyvrb" /><a 
 id="x7-80034r10"></a><span 
class="ptmr7t-x-x-50">10</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;rollback</span><span 
class="pcrr7tn-">&#x00A0;completed</span>
<br class="fancyvrb" /><a 
 id="x7-80036r11"></a><span 
class="ptmr7t-x-x-50">11</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;commit</span><span 
class="pcrb7t-">&#x00A0;-m</span><span 
class="pcrb7t-">&#x00A0;'i</span><span 
class="pcrb7t-">&#x00A0;refer</span><span 
class="pcrb7t-">&#x00A0;you</span><span 
class="pcrb7t-">&#x00A0;to</span><span 
class="pcrb7t-">&#x00A0;bug</span><span 
class="pcrb7t-">&#x00A0;666'</span>
<br class="fancyvrb" /><a 
 id="x7-80038r12"></a><span 
class="ptmr7t-x-x-50">12</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;committed</span><span 
class="pcrr7tn-">&#x00A0;0795f5324510c4fcbc61603af9d3c625d00defe4</span>
<br class="fancyvrb" /><a 
 id="x7-80040r13"></a><span 
class="ptmr7t-x-x-50">13</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;date</span><span 
class="pcrr7tn-">&#x00A0;of</span><span 
class="pcrr7tn-">&#x00A0;commit:</span><span 
class="pcrr7tn-">&#x00A0;Sun</span><span 
class="pcrr7tn-">&#x00A0;Mar</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;2</span><span 
class="pcrr7tn-">&#x00A0;16:16:30</span><span 
class="pcrr7tn-">&#x00A0;GMT</span><span 
class="pcrr7tn-">&#x00A0;2008</span>
   </div>
<br /><table class="caption" 
><tr style="vertical-align:baseline;" class="caption"><td class="id">Figure&#x00A0;3.3: </td><td  
class="content">Using the <a 
 id="dx7-80042"></a><a 
 id="dx7-80043"></a><span 
class="pcrr7tn-">pretxncommit </span>hook to control commits</td></tr></table><!--tex4ht:label?: x7-800413 -->
                                                                                         
                                                                                         
   </td></tr></table></div><hr class="endfigure" />
<!--l. 312--><p class="indent">   The hook in example&#x00A0;<a 
href="#x7-800413">3.3<!--tex4ht:ref: ex:hook:pretxncommit --></a> checks that a commit comment contains a bug ID. If it does, the commit can complete. If not, the
commit is rolled back.
</p>
   <h3 class="sectionHead"><span class="titlemark">3.5    </span> <a 
 id="x7-810003.5"></a>Writing your own hooks</h3>
<!--l. 318--><p class="noindent">When you are writing a hook, you might find it useful to run Mercurial either with the <a 
 id="dx7-81001"></a><span 
class="pcrr7tn-">-v </span>option, or the <a 
 id="dx7-81002"></a><span 
class="pcrr7tn-">verbose </span>config item set
to &#x201C;true&#x201D;. When you do so, Mercurial will print a message before it calls each hook.
</p><!--l. 323--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.5.1    </span> <a 
 id="x7-820003.5.1"></a>Choosing how your hook should run</h4>
<!--l. 326--><p class="noindent">You can write a hook either as a normal program&#x2014;typically a shell script&#x2014;or as a Python function that is executed within the
Mercurial process.
</p><!--l. 330--><p class="indent">   Writing a hook as an external program has the advantage that it requires no knowledge of Mercurial&#x2019;s internals. You can
call normal Mercurial commands to get any added information you need. The trade-off is that external hooks are slower than
in-process hooks.
</p><!--l. 335--><p class="indent">   An in-process Python hook has complete access to the Mercurial API, and does not &#x201C;shell out&#x201D; to another process, so it is
inherently faster than an external hook. It is also easier to obtain much of the information that a hook requires by using the
Mercurial API than by running Mercurial commands.
</p><!--l. 341--><p class="indent">   If you are comfortable with Python, or require high performance, writing your hooks in Python may be a good choice.
However, when you have a straightforward hook to write and you don&#x2019;t need to care about performance (probably the majority
of hooks), a shell script is perfectly fine.
</p><!--l. 347--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.5.2    </span> <a 
 id="x7-830003.5.2"></a>Hook parameters</h4>
<!--l. 350--><p class="noindent">Mercurial calls each hook with a set of well-defined parameters. In Python, a parameter is passed as a keyword argument to
your hook function. For an external program, a parameter is passed as an environment variable.
</p><!--l. 355--><p class="indent">   Whether your hook is written in Python or as a shell script, the hook-specific parameter names and values will be the same.
A boolean parameter will be represented as a boolean value in Python, but as the number 1 (for &#x201C;true&#x201D;) or 0 (for
&#x201C;false&#x201D;) as an environment variable for an external hook. If a hook parameter is named <span 
class="pcrr7tn-">foo</span>, the keyword argument
for a Python hook will also be named <span 
class="pcrr7tn-">foo</span>, while the environment variable for an external hook will be named
<span 
class="pcrr7tn-">HG</span><span 
class="pcrr7tn-">_FOO</span>.
</p><!--l. 364--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.5.3    </span> <a 
 id="x7-840003.5.3"></a>Hook return values and activity control</h4>
<!--l. 366--><p class="noindent">A hook that executes successfully must exit with a status of zero if external, or return boolean &#x201C;false&#x201D; if in-process. Failure is
indicated with a non-zero exit status from an external hook, or an in-process hook returning boolean &#x201C;true&#x201D;. If an in-process
hook raises an exception, the hook is considered to have failed.
</p><!--l. 372--><p class="indent">   For a hook that controls whether an activity can proceed, zero/false means &#x201C;allow&#x201D;, while non-zero/true/exception means
&#x201C;deny&#x201D;.
                                                                                         
                                                                                         
</p><!--l. 375--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.5.4    </span> <a 
 id="x7-850003.5.4"></a>Writing an external hook</h4>
<!--l. 377--><p class="noindent">When you define an external hook in your <a 
 id="dx7-85001"></a><a 
 id="dx7-85002"></a><span 
class="pcrr7tn-">hgrc</span>&#x00A0;and the hook is run, its value is passed to your shell, which interprets it. This
means that you can use normal shell constructs in the body of the hook.
</p><!--l. 381--><p class="indent">   An executable hook is always run with its current directory set to a repository&#x2019;s root directory.
</p><!--l. 384--><p class="indent">   Each hook parameter is passed in as an environment variable; the name is upper-cased, and prefixed with the string
&#x201C;<span 
class="pcrr7tn-">HG</span><span 
class="pcrr7tn-">_</span>&#x201D;.
</p><!--l. 387--><p class="indent">   With the exception of hook parameters, Mercurial does not set or modify any environment variables when running a hook.
This is useful to remember if you are writing a site-wide hook that may be run by a number of different users with differing
environment variables set. In multi-user situations, you should not rely on environment variables being set to the values you
have in your environment when testing the hook.
</p><!--l. 395--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.5.5    </span> <a 
 id="x7-860003.5.5"></a>Telling Mercurial to use an in-process hook</h4>
<!--l. 397--><p class="noindent">The <a 
 id="dx7-86001"></a><a 
 id="dx7-86002"></a><span 
class="pcrr7tn-">hgrc</span>&#x00A0;syntax for defining an in-process hook is slightly different than for an executable hook. The value of the hook must
start with the text &#x201C;<span 
class="pcrr7tn-">python:</span>&#x201D;, and continue with the fully-qualified name of a callable object to use as the hook&#x2019;s
value.
</p><!--l. 402--><p class="indent">   The module in which a hook lives is automatically imported when a hook is run. So long as you have the module name and
<a 
 id="dx7-86003"></a><a 
 id="dx7-86004"></a><span 
class="pcrr7tn-">PYTHONPATH </span>right, it should &#x201C;just work&#x201D;.
</p><!--l. 406--><p class="indent">   The following <a 
 id="dx7-86005"></a><a 
 id="dx7-86006"></a><span 
class="pcrr7tn-">hgrc</span>&#x00A0;example snippet illustrates the syntax and meaning of the notions we just described.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x7-86008r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;[hooks]</span>
<br class="fancyvrb" /><a 
 id="x7-86010r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;commit.example</span><span 
class="pcrr7tn-">&#x00A0;=</span><span 
class="pcrr7tn-">&#x00A0;python:mymodule.submodule.myhook</span>
   </div>
<!--l. 412--><p class="noindent">When Mercurial runs the <span 
class="pcrr7tn-">commit.example </span>hook, it imports <span 
class="pcrr7tn-">mymodule.submodule</span>, looks for the callable object named <span 
class="pcrr7tn-">myhook</span>,
and calls it.
</p><!--l. 416--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.5.6    </span> <a 
 id="x7-870003.5.6"></a>Writing an in-process hook</h4>
<!--l. 418--><p class="noindent">The simplest in-process hook does nothing, but illustrates the basic shape of the hook API:
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x7-87002r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;def</span><span 
class="pcrr7tn-">&#x00A0;myhook(ui,</span><span 
class="pcrr7tn-">&#x00A0;repo,</span><span 
class="pcrr7tn-">&#x00A0;&#x22C6;&#x22C6;kwargs):</span>
<br class="fancyvrb" /><a 
 id="x7-87004r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;pass</span>
   </div>
<!--l. 424--><p class="noindent">The first argument to a Python hook is always a <a 
 id="dx7-87005"></a><span 
class="pcrr7tn-">mercurial.ui.ui </span>object. The second is a repository object; at the moment, it is
always an instance of <a 
 id="dx7-87006"></a><span 
class="pcrr7tn-">mercurial.localrepo.localrepository</span>. Following these two arguments are other keyword
arguments. Which ones are passed in depends on the hook being called, but a hook can ignore arguments it doesn&#x2019;t care about
by dropping them into a keyword argument dict, as with <span 
class="pcrr7tn-">&#x22C6;&#x22C6;kwargs </span>above.
                                                                                         
                                                                                         
</p><!--l. 433--><p class="noindent">
</p>
   <h3 class="sectionHead"><span class="titlemark">3.6    </span> <a 
 id="x7-880003.6"></a>Some hook examples</h3>
<!--l. 435--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.6.1    </span> <a 
 id="x7-890003.6.1"></a>Writing meaningful commit messages</h4>
<!--l. 437--><p class="noindent">It&#x2019;s hard to imagine a useful commit message being very short. The simple <a 
 id="dx7-89001"></a><a 
 id="dx7-89002"></a><span 
class="pcrr7tn-">pretxncommit </span>hook of figure&#x00A0;<a 
href="#x7-890234">3.4<!--tex4ht:ref: ex:hook:msglen.go --></a> will prevent you
from committing a changeset with a message that is less than ten bytes long.
</p>
   <hr class="figure" /><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x7-890234"></a>
                                                                                         
                                                                                         
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x7-89004r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">cat</span><span 
class="pcrb7t-">&#x00A0;.hg/hgrc</span>
<br class="fancyvrb" /><a 
 id="x7-89006r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;[hooks]</span>
<br class="fancyvrb" /><a 
 id="x7-89008r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;pretxncommit.msglen</span><span 
class="pcrr7tn-">&#x00A0;=</span><span 
class="pcrr7tn-">&#x00A0;test</span><span 
class="pcrr7tn-">&#x00A0;&#x2018;hg</span><span 
class="pcrr7tn-">&#x00A0;tip</span><span 
class="pcrr7tn-">&#x00A0;--template</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="cmsy-10">{</span><span 
class="pcrr7tn-">desc</span><span 
class="cmsy-10">}</span><span 
class="pcrr7tn-">&#x00A0;|</span><span 
class="pcrr7tn-">&#x00A0;wc</span><span 
class="pcrr7tn-">&#x00A0;-c&#x2018;</span><span 
class="pcrr7tn-">&#x00A0;-ge</span><span 
class="pcrr7tn-">&#x00A0;10</span>
<br class="fancyvrb" /><a 
 id="x7-89010r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">echo</span><span 
class="pcrb7t-">&#x00A0;a</span><span 
class="pcrb7t-">&#x00A0;&#x003e;</span><span 
class="pcrb7t-">&#x00A0;a</span>
<br class="fancyvrb" /><a 
 id="x7-89012r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;add</span><span 
class="pcrb7t-">&#x00A0;a</span>
<br class="fancyvrb" /><a 
 id="x7-89014r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;commit</span><span 
class="pcrb7t-">&#x00A0;-A</span><span 
class="pcrb7t-">&#x00A0;-m</span><span 
class="pcrb7t-">&#x00A0;'too</span><span 
class="pcrb7t-">&#x00A0;short'</span>
<br class="fancyvrb" /><a 
 id="x7-89016r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;abort:</span><span 
class="pcrr7tn-">&#x00A0;pretxncommit.msglen</span><span 
class="pcrr7tn-">&#x00A0;hook</span><span 
class="pcrr7tn-">&#x00A0;exited</span><span 
class="pcrr7tn-">&#x00A0;with</span><span 
class="pcrr7tn-">&#x00A0;status</span><span 
class="pcrr7tn-">&#x00A0;1</span>
<br class="fancyvrb" /><a 
 id="x7-89018r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;transaction</span><span 
class="pcrr7tn-">&#x00A0;abort!</span>
<br class="fancyvrb" /><a 
 id="x7-89020r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;rollback</span><span 
class="pcrr7tn-">&#x00A0;completed</span>
<br class="fancyvrb" /><a 
 id="x7-89022r10"></a><span 
class="ptmr7t-x-x-50">10</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;commit</span><span 
class="pcrb7t-">&#x00A0;-A</span><span 
class="pcrb7t-">&#x00A0;-m</span><span 
class="pcrb7t-">&#x00A0;'long</span><span 
class="pcrb7t-">&#x00A0;enough'</span>
   </div>
<br /><table class="caption" 
><tr style="vertical-align:baseline;" class="caption"><td class="id">Figure&#x00A0;3.4: </td><td  
class="content">A hook that forbids overly short commit messages</td></tr></table><!--tex4ht:label?: x7-890234 -->
                                                                                         
                                                                                         
   </td></tr></table></div><hr class="endfigure" />
   <h4 class="subsectionHead"><span class="titlemark">3.6.2    </span> <a 
 id="x7-900003.6.2"></a>Checking for trailing whitespace</h4>
<!--l. 450--><p class="noindent">An interesting use of a commit-related hook is to help you to write cleaner code. A simple example of &#x201C;cleaner code&#x201D; is the
dictum that a change should not add any new lines of text that contain &#x201C;trailing whitespace&#x201D;. Trailing whitespace is a series of
space and tab characters at the end of a line of text. In most cases, trailing whitespace is unnecessary, invisible noise, but it is
occasionally problematic, and people often prefer to get rid of it.
</p><!--l. 458--><p class="indent">   You can use either the <a 
 id="dx7-90001"></a><a 
 id="dx7-90002"></a><span 
class="pcrr7tn-">precommit </span>or <a 
 id="dx7-90003"></a><a 
 id="dx7-90004"></a><span 
class="pcrr7tn-">pretxncommit </span>hook to tell whether you have a trailing whitespace problem. If you
use the <a 
 id="dx7-90005"></a><a 
 id="dx7-90006"></a><span 
class="pcrr7tn-">precommit </span>hook, the hook will not know which files you are committing, so it will have to check every modified file in
the repository for trailing white space. If you want to commit a change to just the file <span 
class="pcrr7tn-">foo</span>, but the file <span 
class="pcrr7tn-">bar </span>contains trailing
whitespace, doing a check in the <a 
 id="dx7-90007"></a><a 
 id="dx7-90008"></a><span 
class="pcrr7tn-">precommit </span>hook will prevent you from committing <span 
class="pcrr7tn-">foo </span>due to the problem with <span 
class="pcrr7tn-">bar</span>. This
doesn&#x2019;t seem right.
</p><!--l. 468--><p class="indent">   Should you choose the <a 
 id="dx7-90009"></a><a 
 id="dx7-90010"></a><span 
class="pcrr7tn-">pretxncommit </span>hook, the check won&#x2019;t occur until just before the transaction for the commit
completes. This will allow you to check for problems only the exact files that are being committed. However, if you entered the
commit message interactively and the hook fails, the transaction will roll back; you&#x2019;ll have to re-enter the commit message after
you fix the trailing whitespace and run <a 
 id="dx7-90011"></a>&#x201C;<span 
class="pcrr7tn-">hg commit</span>&#x201D; again.
</p>
   <hr class="figure" /><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x7-900345"></a>
                                                                                         
                                                                                         
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x7-90013r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">cat</span><span 
class="pcrb7t-">&#x00A0;.hg/hgrc</span>
<br class="fancyvrb" /><a 
 id="x7-90015r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;[hooks]</span>
<br class="fancyvrb" /><a 
 id="x7-90017r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;pretxncommit.whitespace</span><span 
class="pcrr7tn-">&#x00A0;=</span><span 
class="pcrr7tn-">&#x00A0;hg</span><span 
class="pcrr7tn-">&#x00A0;export</span><span 
class="pcrr7tn-">&#x00A0;tip</span><span 
class="pcrr7tn-">&#x00A0;|</span><span 
class="pcrr7tn-">&#x00A0;(!</span><span 
class="pcrr7tn-">&#x00A0;egrep</span><span 
class="pcrr7tn-">&#x00A0;-q</span><span 
class="pcrr7tn-">&#x00A0;'&#x0302;</span><span 
class="cmsy-10">&#x2216;</span><span 
class="pcrr7tn-">+.&#x22C6;[</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="cmsy-10">&#x2216;</span><span 
class="pcrr7tn-">t]$')</span>
<br class="fancyvrb" /><a 
 id="x7-90019r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">echo</span><span 
class="pcrb7t-">&#x00A0;'a</span><span 
class="pcrb7t-">&#x00A0;'</span><span 
class="pcrb7t-">&#x00A0;&#x003e;</span><span 
class="pcrb7t-">&#x00A0;a</span>
<br class="fancyvrb" /><a 
 id="x7-90021r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;commit</span><span 
class="pcrb7t-">&#x00A0;-A</span><span 
class="pcrb7t-">&#x00A0;-m</span><span 
class="pcrb7t-">&#x00A0;'test</span><span 
class="pcrb7t-">&#x00A0;with</span><span 
class="pcrb7t-">&#x00A0;trailing</span><span 
class="pcrb7t-">&#x00A0;whitespace'</span>
<br class="fancyvrb" /><a 
 id="x7-90023r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;adding</span><span 
class="pcrr7tn-">&#x00A0;a</span>
<br class="fancyvrb" /><a 
 id="x7-90025r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;abort:</span><span 
class="pcrr7tn-">&#x00A0;pretxncommit.whitespace</span><span 
class="pcrr7tn-">&#x00A0;hook</span><span 
class="pcrr7tn-">&#x00A0;exited</span><span 
class="pcrr7tn-">&#x00A0;with</span><span 
class="pcrr7tn-">&#x00A0;status</span><span 
class="pcrr7tn-">&#x00A0;1</span>
<br class="fancyvrb" /><a 
 id="x7-90027r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;transaction</span><span 
class="pcrr7tn-">&#x00A0;abort!</span>
<br class="fancyvrb" /><a 
 id="x7-90029r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;rollback</span><span 
class="pcrr7tn-">&#x00A0;completed</span>
<br class="fancyvrb" /><a 
 id="x7-90031r10"></a><span 
class="ptmr7t-x-x-50">10</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">echo</span><span 
class="pcrb7t-">&#x00A0;'a'</span><span 
class="pcrb7t-">&#x00A0;&#x003e;</span><span 
class="pcrb7t-">&#x00A0;a</span>
<br class="fancyvrb" /><a 
 id="x7-90033r11"></a><span 
class="ptmr7t-x-x-50">11</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;commit</span><span 
class="pcrb7t-">&#x00A0;-A</span><span 
class="pcrb7t-">&#x00A0;-m</span><span 
class="pcrb7t-">&#x00A0;'drop</span><span 
class="pcrb7t-">&#x00A0;trailing</span><span 
class="pcrb7t-">&#x00A0;whitespace</span><span 
class="pcrb7t-">&#x00A0;and</span><span 
class="pcrb7t-">&#x00A0;try</span><span 
class="pcrb7t-">&#x00A0;again'</span>
   </div>
<br /><table class="caption" 
><tr style="vertical-align:baseline;" class="caption"><td class="id">Figure&#x00A0;3.5: </td><td  
class="content">A simple hook that checks for trailing whitespace</td></tr></table><!--tex4ht:label?: x7-900345 -->
                                                                                         
                                                                                         
   </td></tr></table></div><hr class="endfigure" />
<!--l. 482--><p class="indent">   Figure&#x00A0;<a 
href="#x7-900345">3.5<!--tex4ht:ref: ex:hook:ws.simple --></a> introduces a simple <a 
 id="dx7-90035"></a><a 
 id="dx7-90036"></a><span 
class="pcrr7tn-">pretxncommit </span>hook that checks for trailing whitespace. This hook is short,
but not very helpful. It exits with an error status if a change adds a line with trailing whitespace to any file,
but does not print any information that might help us to identify the offending file or line. It also has the nice
property of not paying attention to unmodified lines; only lines that introduce new trailing whitespace cause
problems.
</p>
   <hr class="figure" /><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x7-900716"></a>
                                                                                         
                                                                                         
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x7-90038r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">cat</span><span 
class="pcrb7t-">&#x00A0;.hg/hgrc</span>
<br class="fancyvrb" /><a 
 id="x7-90040r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;[hooks]</span>
<br class="fancyvrb" /><a 
 id="x7-90042r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;pretxncommit.whitespace</span><span 
class="pcrr7tn-">&#x00A0;=</span><span 
class="pcrr7tn-">&#x00A0;.hg/check_whitespace.py</span>
<br class="fancyvrb" /><a 
 id="x7-90044r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">echo</span><span 
class="pcrb7t-">&#x00A0;'a</span><span 
class="pcrb7t-">&#x00A0;'</span><span 
class="pcrb7t-">&#x00A0;&#x003e;&#x003e;</span><span 
class="pcrb7t-">&#x00A0;a</span>
<br class="fancyvrb" /><a 
 id="x7-90046r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;commit</span><span 
class="pcrb7t-">&#x00A0;-A</span><span 
class="pcrb7t-">&#x00A0;-m</span><span 
class="pcrb7t-">&#x00A0;'add</span><span 
class="pcrb7t-">&#x00A0;new</span><span 
class="pcrb7t-">&#x00A0;line</span><span 
class="pcrb7t-">&#x00A0;with</span><span 
class="pcrb7t-">&#x00A0;trailing</span><span 
class="pcrb7t-">&#x00A0;whitespace'</span>
<br class="fancyvrb" /><a 
 id="x7-90048r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;a,</span><span 
class="pcrr7tn-">&#x00A0;line</span><span 
class="pcrr7tn-">&#x00A0;2:</span><span 
class="pcrr7tn-">&#x00A0;trailing</span><span 
class="pcrr7tn-">&#x00A0;whitespace</span><span 
class="pcrr7tn-">&#x00A0;added</span>
<br class="fancyvrb" /><a 
 id="x7-90050r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;commit</span><span 
class="pcrr7tn-">&#x00A0;message</span><span 
class="pcrr7tn-">&#x00A0;saved</span><span 
class="pcrr7tn-">&#x00A0;to</span><span 
class="pcrr7tn-">&#x00A0;.hg/commit.save</span>
<br class="fancyvrb" /><a 
 id="x7-90052r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;abort:</span><span 
class="pcrr7tn-">&#x00A0;pretxncommit.whitespace</span><span 
class="pcrr7tn-">&#x00A0;hook</span><span 
class="pcrr7tn-">&#x00A0;exited</span><span 
class="pcrr7tn-">&#x00A0;with</span><span 
class="pcrr7tn-">&#x00A0;status</span><span 
class="pcrr7tn-">&#x00A0;1</span>
<br class="fancyvrb" /><a 
 id="x7-90054r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;transaction</span><span 
class="pcrr7tn-">&#x00A0;abort!</span>
<br class="fancyvrb" /><a 
 id="x7-90056r10"></a><span 
class="ptmr7t-x-x-50">10</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;rollback</span><span 
class="pcrr7tn-">&#x00A0;completed</span>
<br class="fancyvrb" /><a 
 id="x7-90058r11"></a><span 
class="ptmr7t-x-x-50">11</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">sed</span><span 
class="pcrb7t-">&#x00A0;-i</span><span 
class="pcrb7t-">&#x00A0;'s,</span><span 
class="pcrb7t-">&#x00A0;&#x22C6;$,,'</span><span 
class="pcrb7t-">&#x00A0;a</span>
<br class="fancyvrb" /><a 
 id="x7-90060r12"></a><span 
class="ptmr7t-x-x-50">12</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;commit</span><span 
class="pcrb7t-">&#x00A0;-A</span><span 
class="pcrb7t-">&#x00A0;-m</span><span 
class="pcrb7t-">&#x00A0;'trimmed</span><span 
class="pcrb7t-">&#x00A0;trailing</span><span 
class="pcrb7t-">&#x00A0;whitespace'</span>
<br class="fancyvrb" /><a 
 id="x7-90062r13"></a><span 
class="ptmr7t-x-x-50">13</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;a,</span><span 
class="pcrr7tn-">&#x00A0;line</span><span 
class="pcrr7tn-">&#x00A0;2:</span><span 
class="pcrr7tn-">&#x00A0;trailing</span><span 
class="pcrr7tn-">&#x00A0;whitespace</span><span 
class="pcrr7tn-">&#x00A0;added</span>
<br class="fancyvrb" /><a 
 id="x7-90064r14"></a><span 
class="ptmr7t-x-x-50">14</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;commit</span><span 
class="pcrr7tn-">&#x00A0;message</span><span 
class="pcrr7tn-">&#x00A0;saved</span><span 
class="pcrr7tn-">&#x00A0;to</span><span 
class="pcrr7tn-">&#x00A0;.hg/commit.save</span>
<br class="fancyvrb" /><a 
 id="x7-90066r15"></a><span 
class="ptmr7t-x-x-50">15</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;abort:</span><span 
class="pcrr7tn-">&#x00A0;pretxncommit.whitespace</span><span 
class="pcrr7tn-">&#x00A0;hook</span><span 
class="pcrr7tn-">&#x00A0;exited</span><span 
class="pcrr7tn-">&#x00A0;with</span><span 
class="pcrr7tn-">&#x00A0;status</span><span 
class="pcrr7tn-">&#x00A0;1</span>
<br class="fancyvrb" /><a 
 id="x7-90068r16"></a><span 
class="ptmr7t-x-x-50">16</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;transaction</span><span 
class="pcrr7tn-">&#x00A0;abort!</span>
<br class="fancyvrb" /><a 
 id="x7-90070r17"></a><span 
class="ptmr7t-x-x-50">17</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;rollback</span><span 
class="pcrr7tn-">&#x00A0;completed</span>
   </div>
<br /><table class="caption" 
><tr style="vertical-align:baseline;" class="caption"><td class="id">Figure&#x00A0;3.6: </td><td  
class="content">A better trailing whitespace hook</td></tr></table><!--tex4ht:label?: x7-900716 -->
                                                                                         
                                                                                         
   </td></tr></table></div><hr class="endfigure" />
<!--l. 497--><p class="indent">   The example of figure&#x00A0;<a 
href="#x7-900716">3.6<!--tex4ht:ref: ex:hook:ws.better --></a> is much more complex, but also more useful. It parses a unified diff to see if any lines add
trailing whitespace, and prints the name of the file and the line number of each such occurrence. Even better, if the change adds
trailing whitespace, this hook saves the commit comment and prints the name of the save file before exiting and telling
Mercurial to roll the transaction back, so you can use <a 
 id="dx7-90072"></a>&#x201C;<span 
class="pcrr7tn-">hg commit</span> <a 
 id="dx7-90073"></a><span 
class="pcrr7tn-">-l</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrro7t-">filename</span>&#x201D; to reuse the saved commit message once
you&#x2019;ve corrected the problem.
</p><!--l. 507--><p class="indent">   As a final aside, note in figure&#x00A0;<a 
href="#x7-900716">3.6<!--tex4ht:ref: ex:hook:ws.better --></a> the use of <a 
 id="dx7-90074"></a><span 
class="pcrr7tn-">perl</span>&#x2019;s in-place editing feature to get rid of trailing whitespace from a file.
This is concise and useful enough that I will reproduce it here.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x7-90076r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;perl</span><span 
class="pcrr7tn-">&#x00A0;-pi</span><span 
class="pcrr7tn-">&#x00A0;-e</span><span 
class="pcrr7tn-">&#x00A0;'s,</span><br class="newline" /><span 
class="pcrr7tn-">s+$,,'</span><span 
class="pcrr7tn-">&#x00A0;filename</span>
   </div>
   <h3 class="sectionHead"><span class="titlemark">3.7    </span> <a 
 id="x7-910003.7"></a>Bundled hooks</h3>
<!--l. 517--><p class="noindent">Mercurial ships with several bundled hooks. You can find them in the <span 
class="pcrr7tn-">hgext </span>directory of a Mercurial source tree. If you are
using a Mercurial binary package, the hooks will be located in the <span 
class="pcrr7tn-">hgext </span>directory of wherever your package installer put
Mercurial.
</p><!--l. 523--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.7.1    </span> <a 
 id="x7-920003.7.1"></a><span 
class="pcrr7tn-">acl</span>&#x2014;access control for parts of a repository</h4>
<!--l. 525--><p class="noindent">The <a 
 id="dx7-92001"></a><span 
class="pcrr7tn-">acl </span>extension lets you control which remote users are allowed to push changesets to a networked server. You can protect
any portion of a repository (including the entire repo), so that a specific remote user can push changes that do not affect the
protected portion.
</p><!--l. 531--><p class="indent">   This extension implements access control based on the identity of the user performing a push, <span 
class="ptmri7t-">not </span>on who committed the
changesets they&#x2019;re pushing. It makes sense to use this hook only if you have a locked-down server environment that
authenticates remote users, and you want to be sure that only specific users are allowed to push changes to that
server.
</p><!--l. 538--><p class="noindent">
</p>
   <h5 class="subsubsectionHead"><a 
 id="x7-930003.7.1"></a>Configuring the <span 
class="pcrr7tn-">acl </span>hook</h5>
<!--l. 540--><p class="noindent">In order to manage incoming changesets, the <a 
 id="dx7-93001"></a><span 
class="pcrr7tn-">acl </span>hook must be used as a <a 
 id="dx7-93002"></a><a 
 id="dx7-93003"></a><span 
class="pcrr7tn-">pretxnchangegroup </span>hook. This lets it see which files
are modified by each incoming changeset, and roll back a group of changesets if they modify &#x201C;forbidden&#x201D; files.
Example:
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x7-93005r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;[hooks]</span>
<br class="fancyvrb" /><a 
 id="x7-93007r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;pretxnchangegroup.acl</span><span 
class="pcrr7tn-">&#x00A0;=</span><span 
class="pcrr7tn-">&#x00A0;python:hgext.acl.hook</span>
   </div>
<!--l. 549--><p class="indent">   The <a 
 id="dx7-93008"></a><span 
class="pcrr7tn-">acl </span>extension is configured using three sections.
</p><!--l. 551--><p class="indent">   The <a 
 id="dx7-93009"></a><span 
class="pcrr7tn-">[acl] </span>section has only one entry, <a 
 id="dx7-93010"></a><span 
class="pcrr7tn-">sources</span>, which lists the sources of incoming changesets that the hook should pay
attention to. You don&#x2019;t normally need to configure this section. </p>
     <ul><li><span class="dt">
<a 
 id="dx7-93011"></a><span 
class="pcrr7tn-">serve</span> </span><span class="dd">Control incoming changesets that are arriving from a remote repository over http or ssh. This is the default value
     of <a 
 id="dx7-93012"></a><span 
class="pcrr7tn-">sources</span>, and usually the only setting you&#x2019;ll need for this configuration item.
                                                                                         
                                                                                         
     </span><li><span class="dt">
<a 
 id="dx7-93013"></a><span 
class="pcrr7tn-">pull</span> </span><span class="dd">Control incoming changesets that are arriving via a pull from a local repository.
     </span><li><span class="dt">
<a 
 id="dx7-93014"></a><span 
class="pcrr7tn-">push</span> </span><span class="dd">Control incoming changesets that are arriving via a push from a local repository.
     </span><li><span class="dt">
<a 
 id="dx7-93015"></a><span 
class="pcrr7tn-">bundle</span> </span><span class="dd">Control incoming changesets that are arriving from another repository via a bundle.</li></ul>
<!--l. 567--><p class="indent">   The <a 
 id="dx7-93016"></a><span 
class="pcrr7tn-">[acl.allow] </span>section controls the users that are allowed to add changesets to the repository. If this section is not
present, all users that are not explicitly denied are allowed. If this section is present, all users that are not explicitly allowed are
denied (so an empty section means that all users are denied).
</p><!--l. 573--><p class="indent">   The <a 
 id="dx7-93017"></a><span 
class="pcrr7tn-">[acl.deny] </span>section determines which users are denied from adding changesets to the repository. If this section is not
present or is empty, no users are denied.
</p><!--l. 577--><p class="indent">   The syntaxes for the <a 
 id="dx7-93018"></a><span 
class="pcrr7tn-">[acl.allow] </span>and <a 
 id="dx7-93019"></a><span 
class="pcrr7tn-">[acl.deny] </span>sections are identical. On the left of each entry is a glob pattern that
matches files or directories, relative to the root of the repository; on the right, a user name.
</p><!--l. 582--><p class="indent">   In the following example, the user <span 
class="pcrr7tn-">docwriter </span>can only push changes to the <span 
class="pcrr7tn-">docs </span>subtree of the repository, while <span 
class="pcrr7tn-">intern</span>
can push changes to any file or directory except <span 
class="pcrr7tn-">source/sensitive</span>.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x7-93021r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;[acl.allow]</span>
<br class="fancyvrb" /><a 
 id="x7-93023r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;docs/&#x22C6;&#x22C6;</span><span 
class="pcrr7tn-">&#x00A0;=</span><span 
class="pcrr7tn-">&#x00A0;docwriter</span>
<br class="fancyvrb" /><a 
 id="x7-93025r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x7-93027r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;[acl.deny]</span>
<br class="fancyvrb" /><a 
 id="x7-93029r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;source/sensitive/&#x22C6;&#x22C6;</span><span 
class="pcrr7tn-">&#x00A0;=</span><span 
class="pcrr7tn-">&#x00A0;intern</span>
   </div>
<!--l. 594--><p class="noindent">
</p>
   <h5 class="subsubsectionHead"><a 
 id="x7-940003.7.1"></a>Testing and troubleshooting</h5>
<!--l. 596--><p class="noindent">If you want to test the <a 
 id="dx7-94001"></a><span 
class="pcrr7tn-">acl </span>hook, run it with Mercurial&#x2019;s debugging output enabled. Since you&#x2019;ll probably be running it on a
server where it&#x2019;s not convenient (or sometimes possible) to pass in the <a 
 id="dx7-94002"></a><span 
class="pcrr7tn-">--debug </span>option, don&#x2019;t forget that you can enable
debugging output in your <a 
 id="dx7-94003"></a><a 
 id="dx7-94004"></a><span 
class="pcrr7tn-">hgrc</span>:
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x7-94006r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;[ui]</span>
<br class="fancyvrb" /><a 
 id="x7-94008r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;debug</span><span 
class="pcrr7tn-">&#x00A0;=</span><span 
class="pcrr7tn-">&#x00A0;true</span>
   </div>
<!--l. 605--><p class="noindent">With this enabled, the <a 
 id="dx7-94009"></a><span 
class="pcrr7tn-">acl </span>hook will print enough information to let you figure out why it is allowing or forbidding pushes from
specific users.
</p><!--l. 609--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.7.2    </span> <a 
 id="x7-950003.7.2"></a><span 
class="pcrr7tn-">bugzilla</span>&#x2014;integration with Bugzilla</h4>
<!--l. 611--><p class="noindent">The <a 
 id="dx7-95001"></a><span 
class="pcrr7tn-">bugzilla </span>extension adds a comment to a Bugzilla bug whenever it finds a reference to that bug ID in a commit comment.
You can install this hook on a shared server, so that any time a remote user pushes changes to this server, the hook gets
run.
</p><!--l. 616--><p class="indent">   It adds a comment to the bug that looks like this (you can configure the contents of the comment&#x2014;see below):
                                                                                         
                                                                                         
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x7-95003r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Changeset</span><span 
class="pcrr7tn-">&#x00A0;aad8b264143a,</span><span 
class="pcrr7tn-">&#x00A0;made</span><span 
class="pcrr7tn-">&#x00A0;by</span><span 
class="pcrr7tn-">&#x00A0;Joe</span><span 
class="pcrr7tn-">&#x00A0;User</span><span 
class="pcrr7tn-">&#x00A0;&#x003c;joe.user@domain.com&#x003e;</span><span 
class="pcrr7tn-">&#x00A0;in</span>
<br class="fancyvrb" /><a 
 id="x7-95005r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;the</span><span 
class="pcrr7tn-">&#x00A0;frobnitz</span><span 
class="pcrr7tn-">&#x00A0;repository,</span><span 
class="pcrr7tn-">&#x00A0;refers</span><span 
class="pcrr7tn-">&#x00A0;to</span><span 
class="pcrr7tn-">&#x00A0;this</span><span 
class="pcrr7tn-">&#x00A0;bug.</span>
<br class="fancyvrb" /><a 
 id="x7-95007r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x7-95009r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;For</span><span 
class="pcrr7tn-">&#x00A0;complete</span><span 
class="pcrr7tn-">&#x00A0;details,</span><span 
class="pcrr7tn-">&#x00A0;see</span>
<br class="fancyvrb" /><a 
 id="x7-95011r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;http://hg.domain.com/frobnitz?cmd=changeset;node=aad8b264143a</span>
<br class="fancyvrb" /><a 
 id="x7-95013r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x7-95015r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Changeset</span><span 
class="pcrr7tn-">&#x00A0;description:</span>
<br class="fancyvrb" /><a 
 id="x7-95017r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Fix</span><span 
class="pcrr7tn-">&#x00A0;bug</span><span 
class="pcrr7tn-">&#x00A0;10483</span><span 
class="pcrr7tn-">&#x00A0;by</span><span 
class="pcrr7tn-">&#x00A0;guarding</span><span 
class="pcrr7tn-">&#x00A0;against</span><span 
class="pcrr7tn-">&#x00A0;some</span><span 
class="pcrr7tn-">&#x00A0;NULL</span><span 
class="pcrr7tn-">&#x00A0;pointers</span>
   </div>
<!--l. 628--><p class="noindent">The value of this hook is that it automates the process of updating a bug any time a changeset refers to it. If you configure the hook
properly, it makes it easy for people to browse straight from a Bugzilla bug to a changeset that refers to that
bug.
</p><!--l. 633--><p class="indent">   You can use the code in this hook as a starting point for some more exotic Bugzilla integration recipes. Here are a few
possibilities: </p>
     <ul><li><span class="dt">
     </span><span class="dd">Require that every changeset pushed to the server have a valid bug&#x00A0;ID in its commit comment. In this case,
     you&#x2019;d want to configure the hook as a <a 
 id="dx7-95018"></a><a 
 id="dx7-95019"></a><span 
class="pcrr7tn-">pretxncommit </span>hook. This would allow the hook to reject changes that
     didn&#x2019;t contain bug IDs.
     </span><li><span class="dt">
     </span><span class="dd">Allow incoming changesets to automatically modify the <span 
class="ptmri7t-">state </span>of a bug, as well as simply adding a comment. For
     example, the hook could recognise the string &#x201C;fixed bug 31337&#x201D; as indicating that it should update the state of
     bug 31337 to &#x201C;requires testing&#x201D;.</li></ul>
<!--l. 647--><p class="noindent">
</p>
   <h5 class="subsubsectionHead"><a 
 id="x7-960003.7.2"></a>Configuring the <span 
class="pcrr7tn-">bugzilla </span>hook</h5>
<!--l. 650--><p class="noindent">You should configure this hook in your server&#x2019;s <a 
 id="dx7-96001"></a><a 
 id="dx7-96002"></a><span 
class="pcrr7tn-">hgrc</span>&#x00A0;as an <a 
 id="dx7-96003"></a><a 
 id="dx7-96004"></a><span 
class="pcrr7tn-">incoming </span>hook, for example as follows:
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x7-96006r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;[hooks]</span>
<br class="fancyvrb" /><a 
 id="x7-96008r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;incoming.bugzilla</span><span 
class="pcrr7tn-">&#x00A0;=</span><span 
class="pcrr7tn-">&#x00A0;python:hgext.bugzilla.hook</span>
   </div>
<!--l. 657--><p class="indent">   Because of the specialised nature of this hook, and because Bugzilla was not written with this kind of integration in mind,
configuring this hook is a somewhat involved process.
</p><!--l. 661--><p class="indent">   Before you begin, you must install the MySQL bindings for Python on the host(s) where you&#x2019;ll be running the hook. If this
is not available as a binary package for your system, you can download it from&#x00A0;<span class="cite">[<span 
class="ptmb7t-">?</span>]</span>.
</p><!--l. 666--><p class="indent">   Configuration information for this hook lives in the <a 
 id="dx7-96009"></a><span 
class="pcrr7tn-">[bugzilla] </span>section of your <a 
 id="dx7-96010"></a><a 
 id="dx7-96011"></a><span 
class="pcrr7tn-">hgrc</span>. </p>
     <ul><li><span class="dt">
<a 
 id="dx7-96012"></a><span 
class="pcrr7tn-">version</span> </span><span class="dd">The version of Bugzilla installed on the server. The database schema that Bugzilla uses changes occasionally,
     so this hook has to know exactly which schema to use. At the moment, the only version supported is <span 
class="pcrr7tn-">2.16</span>.
     </span><li><span class="dt">
<a 
 id="dx7-96013"></a><span 
class="pcrr7tn-">host</span> </span><span class="dd">The hostname of the MySQL server that stores your Bugzilla data. The database must be configured to allow
     connections from whatever host you are running the <a 
 id="dx7-96014"></a><a 
 id="dx7-96015"></a><span 
class="pcrr7tn-">bugzilla </span>hook on.
                                                                                         
                                                                                         
     </span><li><span class="dt">
<a 
 id="dx7-96016"></a><span 
class="pcrr7tn-">user</span> </span><span class="dd">The username with which to connect to the MySQL server. The database must be configured to allow this user
     to connect from whatever host you are running the <a 
 id="dx7-96017"></a><a 
 id="dx7-96018"></a><span 
class="pcrr7tn-">bugzilla </span>hook on. This user must be able to access and
     modify Bugzilla tables. The default value of this item is <span 
class="pcrr7tn-">bugs</span>, which is the standard name of the Bugzilla user
     in a MySQL database.
     </span><li><span class="dt">
<a 
 id="dx7-96019"></a><span 
class="pcrr7tn-">password</span> </span><span class="dd">The MySQL password for the user you configured above. This is stored as plain text, so you should make sure
     that unauthorised users cannot read the <a 
 id="dx7-96020"></a><a 
 id="dx7-96021"></a><span 
class="pcrr7tn-">hgrc</span>&#x00A0;file where you store this information.
     </span><li><span class="dt">
  <a 
 id="dx7-96022"></a><span 
class="pcrr7tn-">db</span> </span><span class="dd">The name of the Bugzilla database on the MySQL server. The default value of this item is <span 
class="pcrr7tn-">bugs</span>, which is the
     standard name of the MySQL database where Bugzilla stores its data.
     </span><li><span class="dt">
<a 
 id="dx7-96023"></a><span 
class="pcrr7tn-">notify</span> </span><span class="dd">If you want Bugzilla to send out a notification email to subscribers after this hook has added a comment to a bug, you
     will need this hook to run a command whenever it updates the database. The command to run depends on where you
     have installed Bugzilla, but it will typically look something like this, if you have Bugzilla installed in
     <span 
class="pcrr7tn-">/var/www/html/bugzilla</span>:
     <div class="fancyvrb" id="fancyvrb">
<a 
 id="x7-96025r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;cd</span><span 
class="pcrr7tn-">&#x00A0;/var/www/html/bugzilla</span><span 
class="pcrr7tn-">&#x00A0;&&</span><span 
class="pcrr7tn-">&#x00A0;./processmail</span><span 
class="pcrr7tn-">&#x00A0;%s</span><span 
class="pcrr7tn-">&#x00A0;nobody@nowhere.com</span>
</div>
     <!--l. 702--><p class="noindent">The Bugzilla <span 
class="pcrr7tn-">processmail </span>program expects to be given a bug&#x00A0;ID (the hook replaces &#x201C;<span 
class="pcrr7tn-">%s</span>&#x201D; with the bug&#x00A0;ID) and an
     email address. It also expects to be able to write to some files in the directory that it runs in. If Bugzilla and this hook are
     not installed on the same machine, you will need to find a way to run <span 
class="pcrr7tn-">processmail </span>on the server where Bugzilla is
     installed.</p></li></ul>
<!--l. 710--><p class="noindent">
</p>
   <h5 class="subsubsectionHead"><a 
 id="x7-970003.7.2"></a>Mapping committer names to Bugzilla user names</h5>
<!--l. 712--><p class="noindent">By default, the <a 
 id="dx7-97001"></a><span 
class="pcrr7tn-">bugzilla </span>hook tries to use the email address of a changeset&#x2019;s committer as the Bugzilla user name with which
to update a bug. If this does not suit your needs, you can map committer email addresses to Bugzilla user names using a
<a 
 id="dx7-97002"></a><span 
class="pcrr7tn-">[usermap] </span>section.
</p><!--l. 718--><p class="indent">   Each item in the <a 
 id="dx7-97003"></a><span 
class="pcrr7tn-">[usermap] </span>section contains an email address on the left, and a Bugzilla user name on the
right.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x7-97005r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;[usermap]</span>
<br class="fancyvrb" /><a 
 id="x7-97007r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;jane.user@example.com</span><span 
class="pcrr7tn-">&#x00A0;=</span><span 
class="pcrr7tn-">&#x00A0;jane</span>
   </div>
<!--l. 724--><p class="noindent">You can either keep the <a 
 id="dx7-97008"></a><span 
class="pcrr7tn-">[usermap] </span>data in a normal <a 
 id="dx7-97009"></a><a 
 id="dx7-97010"></a><span 
class="pcrr7tn-">hgrc</span>, or tell the <a 
 id="dx7-97011"></a><span 
class="pcrr7tn-">bugzilla </span>hook to read the information from an external
<span 
class="pcrr7tn-">usermap </span>file. In the latter case, you can store <span 
class="pcrr7tn-">usermap </span>data by itself in (for example) a user-modifiable repository. This
makes it possible to let your users maintain their own <a 
 id="dx7-97012"></a><span 
class="pcrr7tn-">usermap </span>entries. The main <a 
 id="dx7-97013"></a><a 
 id="dx7-97014"></a><span 
class="pcrr7tn-">hgrc</span>&#x00A0;file might look like
this:
</p>
   <div class="fancyvrb" id="fancyvrb">
                                                                                         
                                                                                         
<a 
 id="x7-97016r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;#</span><span 
class="pcrr7tn-">&#x00A0;regular</span><span 
class="pcrr7tn-">&#x00A0;hgrc</span><span 
class="pcrr7tn-">&#x00A0;file</span><span 
class="pcrr7tn-">&#x00A0;refers</span><span 
class="pcrr7tn-">&#x00A0;to</span><span 
class="pcrr7tn-">&#x00A0;external</span><span 
class="pcrr7tn-">&#x00A0;usermap</span><span 
class="pcrr7tn-">&#x00A0;file</span>
<br class="fancyvrb" /><a 
 id="x7-97018r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;[bugzilla]</span>
<br class="fancyvrb" /><a 
 id="x7-97020r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;usermap</span><span 
class="pcrr7tn-">&#x00A0;=</span><span 
class="pcrr7tn-">&#x00A0;/home/hg/repos/userdata/bugzilla-usermap.conf</span>
   </div>
<!--l. 736--><p class="noindent">While the <span 
class="pcrr7tn-">usermap </span>file that it refers to might look like this:
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x7-97022r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;#</span><span 
class="pcrr7tn-">&#x00A0;bugzilla-usermap.conf</span><span 
class="pcrr7tn-">&#x00A0;-</span><span 
class="pcrr7tn-">&#x00A0;inside</span><span 
class="pcrr7tn-">&#x00A0;a</span><span 
class="pcrr7tn-">&#x00A0;hg</span><span 
class="pcrr7tn-">&#x00A0;repository</span>
<br class="fancyvrb" /><a 
 id="x7-97024r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;[usermap]</span>
<br class="fancyvrb" /><a 
 id="x7-97026r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;stephanie@example.com</span><span 
class="pcrr7tn-">&#x00A0;=</span><span 
class="pcrr7tn-">&#x00A0;steph</span>
   </div>
<!--l. 744--><p class="noindent">
</p>
   <h5 class="subsubsectionHead"><a 
 id="x7-980003.7.2"></a>Configuring the text that gets added to a bug</h5>
<!--l. 746--><p class="noindent">You can configure the text that this hook adds as a comment; you specify it in the form of a Mercurial template. Several
<a 
 id="dx7-98001"></a><a 
 id="dx7-98002"></a><span 
class="pcrr7tn-">hgrc</span>&#x00A0;entries (still in the <a 
 id="dx7-98003"></a><span 
class="pcrr7tn-">[bugzilla] </span>section) control this behaviour. </p>
     <ul><li><span class="dt">
<span 
class="pcrr7tn-">strip</span> </span><span class="dd">The number of leading path elements to strip from a repository&#x2019;s path name to construct a partial path for a
     URL. For example, if the repositories on your server live under <span 
class="pcrr7tn-">/home/hg/repos</span>, and you have a repository
     whose path is <span 
class="pcrr7tn-">/home/hg/repos/app/tests</span>, then setting <span 
class="pcrr7tn-">strip </span>to <span 
class="pcrr7tn-">4 </span>will give a partial path of <span 
class="pcrr7tn-">app/tests</span>. The
     hook will make this partial path available when expanding a template, as <span 
class="pcrr7tn-">webroot</span>.
     </span><li><span class="dt">
<span 
class="pcrr7tn-">template</span> </span><span class="dd">The text of the template to use. In addition to the usual changeset-related variables, this template can use <span 
class="pcrr7tn-">hgweb</span>
     (the value of the <span 
class="pcrr7tn-">hgweb </span>configuration item above) and <span 
class="pcrr7tn-">webroot </span>(the path constructed using <span 
class="pcrr7tn-">strip </span>above).</li></ul>
<!--l. 766--><p class="indent">   In addition, you can add a <a 
 id="dx7-98004"></a><span 
class="pcrr7tn-">baseurl </span>item to the <a 
 id="dx7-98005"></a><span 
class="pcrr7tn-">[web] </span>section of your <a 
 id="dx7-98006"></a><a 
 id="dx7-98007"></a><span 
class="pcrr7tn-">hgrc</span>. The <a 
 id="dx7-98008"></a><span 
class="pcrr7tn-">bugzilla </span>hook will make this available
when expanding a template, as the base string to use when constructing a URL that will let users browse from a Bugzilla
comment to view a changeset. Example:
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x7-98010r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;[web]</span>
<br class="fancyvrb" /><a 
 id="x7-98012r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;baseurl</span><span 
class="pcrr7tn-">&#x00A0;=</span><span 
class="pcrr7tn-">&#x00A0;http://hg.domain.com/</span>
   </div>
<!--l. 776--><p class="indent">   Here is an example set of <a 
 id="dx7-98013"></a><span 
class="pcrr7tn-">bugzilla </span>hook config information.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x7-98015r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;[bugzilla]</span>
<br class="fancyvrb" /><a 
 id="x7-98017r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;host</span><span 
class="pcrr7tn-">&#x00A0;=</span><span 
class="pcrr7tn-">&#x00A0;bugzilla.example.com</span>
<br class="fancyvrb" /><a 
 id="x7-98019r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;password</span><span 
class="pcrr7tn-">&#x00A0;=</span><span 
class="pcrr7tn-">&#x00A0;mypassword</span>
<br class="fancyvrb" /><a 
 id="x7-98021r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;version</span><span 
class="pcrr7tn-">&#x00A0;=</span><span 
class="pcrr7tn-">&#x00A0;2.16</span>
<br class="fancyvrb" /><a 
 id="x7-98023r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;#</span><span 
class="pcrr7tn-">&#x00A0;server-side</span><span 
class="pcrr7tn-">&#x00A0;repos</span><span 
class="pcrr7tn-">&#x00A0;live</span><span 
class="pcrr7tn-">&#x00A0;in</span><span 
class="pcrr7tn-">&#x00A0;/home/hg/repos,</span><span 
class="pcrr7tn-">&#x00A0;so</span><span 
class="pcrr7tn-">&#x00A0;strip</span><span 
class="pcrr7tn-">&#x00A0;4</span><span 
class="pcrr7tn-">&#x00A0;leading</span>
<br class="fancyvrb" /><a 
 id="x7-98025r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;#</span><span 
class="pcrr7tn-">&#x00A0;separators</span>
<br class="fancyvrb" /><a 
 id="x7-98027r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;strip</span><span 
class="pcrr7tn-">&#x00A0;=</span><span 
class="pcrr7tn-">&#x00A0;4</span>
<br class="fancyvrb" /><a 
 id="x7-98029r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;hgweb</span><span 
class="pcrr7tn-">&#x00A0;=</span><span 
class="pcrr7tn-">&#x00A0;http://hg.example.com/</span>
<br class="fancyvrb" /><a 
 id="x7-98031r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;usermap</span><span 
class="pcrr7tn-">&#x00A0;=</span><span 
class="pcrr7tn-">&#x00A0;/home/hg/repos/notify/bugzilla.conf</span>
                                                                                         
                                                                                         
<br class="fancyvrb" /><a 
 id="x7-98033r10"></a><span 
class="ptmr7t-x-x-50">10</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;template</span><span 
class="pcrr7tn-">&#x00A0;=</span><span 
class="pcrr7tn-">&#x00A0;Changeset</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="cmsy-10">{</span><span 
class="pcrr7tn-">node|short</span><span 
class="cmsy-10">}</span><span 
class="pcrr7tn-">,</span><span 
class="pcrr7tn-">&#x00A0;made</span><span 
class="pcrr7tn-">&#x00A0;by</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="cmsy-10">{</span><span 
class="pcrr7tn-">author</span><span 
class="cmsy-10">}</span><span 
class="pcrr7tn-">&#x00A0;in</span><span 
class="pcrr7tn-">&#x00A0;the</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="cmsy-10">{</span><span 
class="pcrr7tn-">webroot</span><span 
class="cmsy-10">}</span>
<br class="fancyvrb" /><a 
 id="x7-98035r11"></a><span 
class="ptmr7t-x-x-50">11</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;repo,</span><span 
class="pcrr7tn-">&#x00A0;refers</span><span 
class="pcrr7tn-">&#x00A0;to</span><span 
class="pcrr7tn-">&#x00A0;this</span><span 
class="pcrr7tn-">&#x00A0;bug.</span><br class="newline" /><span 
class="pcrr7tn-">nFor</span><span 
class="pcrr7tn-">&#x00A0;complete</span><span 
class="pcrr7tn-">&#x00A0;details,</span><span 
class="pcrr7tn-">&#x00A0;see</span>
<br class="fancyvrb" /><a 
 id="x7-98037r12"></a><span 
class="ptmr7t-x-x-50">12</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="cmsy-10">{</span><span 
class="pcrr7tn-">hgweb</span><span 
class="cmsy-10">}{</span><span 
class="pcrr7tn-">webroot</span><span 
class="cmsy-10">}</span><span 
class="pcrr7tn-">?cmd=changeset;node=</span><span 
class="cmsy-10">{</span><span 
class="pcrr7tn-">node|short</span><span 
class="cmsy-10">}</span><br class="newline" /><span 
class="pcrr7tn-">nChangeset</span>
<br class="fancyvrb" /><a 
 id="x7-98039r13"></a><span 
class="ptmr7t-x-x-50">13</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;description:</span><br class="newline" /><span 
class="pcrr7tn-">n</span><br class="newline" /><span 
class="pcrr7tn-">t</span><span 
class="cmsy-10">{</span><span 
class="pcrr7tn-">desc|tabindent</span><span 
class="cmsy-10">}</span>
   </div>
<!--l. 793--><p class="noindent">
</p>
   <h5 class="subsubsectionHead"><a 
 id="x7-990003.7.2"></a>Testing and troubleshooting</h5>
<!--l. 795--><p class="noindent">The most common problems with configuring the <a 
 id="dx7-99001"></a><span 
class="pcrr7tn-">bugzilla </span>hook relate to running Bugzilla&#x2019;s <span 
class="pcrr7tn-">processmail </span>script and
mapping committer names to user names.
</p><!--l. 799--><p class="indent">   Recall from section&#x00A0;<a 
href="#x7-960003.7.2">3.7.2<!--tex4ht:ref: sec:hook:bugzilla:config --></a> above that the user that runs the Mercurial process on the server is also the one that
will run the <span 
class="pcrr7tn-">processmail </span>script. The <span 
class="pcrr7tn-">processmail </span>script sometimes causes Bugzilla to write to files in its
configuration directory, and Bugzilla&#x2019;s configuration files are usually owned by the user that your web server runs
under.
</p><!--l. 806--><p class="indent">   You can cause <span 
class="pcrr7tn-">processmail </span>to be run with the suitable user&#x2019;s identity using the <a 
 id="dx7-99002"></a><span 
class="pcrr7tn-">sudo </span>command. Here is an example entry
for a <span 
class="pcrr7tn-">sudoers </span>file.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x7-99004r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;hg_user</span><span 
class="pcrr7tn-">&#x00A0;=</span><span 
class="pcrr7tn-">&#x00A0;(httpd_user)</span><span 
class="pcrr7tn-">&#x00A0;NOPASSWD:</span><span 
class="pcrr7tn-">&#x00A0;/var/www/html/bugzilla/processmail-wrapper</span><span 
class="pcrr7tn-">&#x00A0;%s</span>
   </div>
<!--l. 812--><p class="noindent">This allows the <span 
class="pcrr7tn-">hg</span><span 
class="pcrr7tn-">_user </span>user to run a <span 
class="pcrr7tn-">processmail-wrapper </span>program under the identity of <span 
class="pcrr7tn-">httpd</span><span 
class="pcrr7tn-">_user</span>.
</p><!--l. 816--><p class="indent">   This indirection through a wrapper script is necessary, because <span 
class="pcrr7tn-">processmail </span>expects to be run with its current directory set
to wherever you installed Bugzilla; you can&#x2019;t specify that kind of constraint in a <span 
class="pcrr7tn-">sudoers </span>file. The contents of the wrapper
script are simple:
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x7-99006r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;#!/bin/sh</span>
<br class="fancyvrb" /><a 
 id="x7-99008r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;cd</span><span 
class="pcrr7tn-">&#x00A0;&#x2018;dirname</span><span 
class="pcrr7tn-">&#x00A0;$0&#x2018;</span><span 
class="pcrr7tn-">&#x00A0;&&</span><span 
class="pcrr7tn-">&#x00A0;./processmail</span><span 
class="pcrr7tn-">&#x00A0;"$1"</span><span 
class="pcrr7tn-">&#x00A0;nobody@example.com</span>
   </div>
<!--l. 825--><p class="noindent">It doesn&#x2019;t seem to matter what email address you pass to <span 
class="pcrr7tn-">processmail</span>.
</p><!--l. 828--><p class="indent">   If your <a 
 id="dx7-99009"></a><span 
class="pcrr7tn-">[usermap] </span>is not set up correctly, users will see an error message from the <a 
 id="dx7-99010"></a><span 
class="pcrr7tn-">bugzilla </span>hook when they push changes
to the server. The error message will look like this:
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x7-99012r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;cannot</span><span 
class="pcrr7tn-">&#x00A0;find</span><span 
class="pcrr7tn-">&#x00A0;bugzilla</span><span 
class="pcrr7tn-">&#x00A0;user</span><span 
class="pcrr7tn-">&#x00A0;id</span><span 
class="pcrr7tn-">&#x00A0;for</span><span 
class="pcrr7tn-">&#x00A0;john.q.public@example.com</span>
   </div>
<!--l. 834--><p class="noindent">What this means is that the committer&#x2019;s address, <span 
class="pcrr7tn-">john.q.public@example.com</span>, is not a valid Bugzilla user name, nor does it
have an entry in your <a 
 id="dx7-99013"></a><span 
class="pcrr7tn-">[usermap] </span>that maps it to a valid Bugzilla user name.
</p><!--l. 839--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.7.3    </span> <a 
 id="x7-1000003.7.3"></a><span 
class="pcrr7tn-">notify</span>&#x2014;send email notifications</h4>
<!--l. 841--><p class="noindent">Although Mercurial&#x2019;s built-in web server provides RSS feeds of changes in every repository, many people prefer to receive
change notifications via email. The <a 
 id="dx7-100001"></a><span 
class="pcrr7tn-">notify </span>hook lets you send out notifications to a set of email addresses whenever changesets
arrive that those subscribers are interested in.
                                                                                         
                                                                                         
</p><!--l. 847--><p class="indent">   As with the <a 
 id="dx7-100002"></a><span 
class="pcrr7tn-">bugzilla </span>hook, the <a 
 id="dx7-100003"></a><span 
class="pcrr7tn-">notify </span>hook is template-driven, so you can customise the contents of the notification
messages that it sends.
</p><!--l. 851--><p class="indent">   By default, the <a 
 id="dx7-100004"></a><span 
class="pcrr7tn-">notify </span>hook includes a diff of every changeset that it sends out; you can limit the size of the diff, or turn
this feature off entirely. It is useful for letting subscribers review changes immediately, rather than clicking to follow a
URL.
</p><!--l. 856--><p class="noindent">
</p>
   <h5 class="subsubsectionHead"><a 
 id="x7-1010003.7.3"></a>Configuring the <span 
class="pcrr7tn-">notify </span>hook</h5>
<!--l. 858--><p class="noindent">You can set up the <a 
 id="dx7-101001"></a><span 
class="pcrr7tn-">notify </span>hook to send one email message per incoming changeset, or one per incoming group of changesets
(all those that arrived in a single pull or push).
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x7-101003r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;[hooks]</span>
<br class="fancyvrb" /><a 
 id="x7-101005r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;#</span><span 
class="pcrr7tn-">&#x00A0;send</span><span 
class="pcrr7tn-">&#x00A0;one</span><span 
class="pcrr7tn-">&#x00A0;email</span><span 
class="pcrr7tn-">&#x00A0;per</span><span 
class="pcrr7tn-">&#x00A0;group</span><span 
class="pcrr7tn-">&#x00A0;of</span><span 
class="pcrr7tn-">&#x00A0;changes</span>
<br class="fancyvrb" /><a 
 id="x7-101007r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;changegroup.notify</span><span 
class="pcrr7tn-">&#x00A0;=</span><span 
class="pcrr7tn-">&#x00A0;python:hgext.notify.hook</span>
<br class="fancyvrb" /><a 
 id="x7-101009r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;#</span><span 
class="pcrr7tn-">&#x00A0;send</span><span 
class="pcrr7tn-">&#x00A0;one</span><span 
class="pcrr7tn-">&#x00A0;email</span><span 
class="pcrr7tn-">&#x00A0;per</span><span 
class="pcrr7tn-">&#x00A0;change</span>
<br class="fancyvrb" /><a 
 id="x7-101011r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;incoming.notify</span><span 
class="pcrr7tn-">&#x00A0;=</span><span 
class="pcrr7tn-">&#x00A0;python:hgext.notify.hook</span>
   </div>
<!--l. 869--><p class="indent">   Configuration information for this hook lives in the <a 
 id="dx7-101012"></a><span 
class="pcrr7tn-">[notify] </span>section of a <a 
 id="dx7-101013"></a><a 
 id="dx7-101014"></a><span 
class="pcrr7tn-">hgrc</span>&#x00A0;file. </p>
     <ul><li><span class="dt">
<a 
 id="dx7-101015"></a><span 
class="pcrr7tn-">test</span> </span><span class="dd">By default, this hook does not send out email at all; instead, it prints the message that it <span 
class="ptmri7t-">would </span>send. Set this
     item to <span 
class="pcrr7tn-">false </span>to allow email to be sent. The reason that sending of email is turned off by default is that it takes
     several tries to configure this extension exactly as you would like, and it would be bad form to spam subscribers
     with a number of &#x201C;broken&#x201D; notifications while you debug your configuration.
     </span><li><span class="dt">
<a 
 id="dx7-101016"></a><span 
class="pcrr7tn-">config</span> </span><span class="dd">The  path  to  a  configuration  file  that  contains  subscription  information.  This  is  kept  separate  from  the  main
     <a 
 id="dx7-101017"></a><a 
 id="dx7-101018"></a><span 
class="pcrr7tn-">hgrc</span>&#x00A0;so that you can maintain it in a repository of its own. People can then clone that repository, update their
     subscriptions, and push the changes back to your server.
     </span><li><span class="dt">
<a 
 id="dx7-101019"></a><span 
class="pcrr7tn-">strip</span> </span><span class="dd">The number of leading path separator characters to strip from a repository&#x2019;s path, when deciding whether a
     repository has subscribers. For example, if the repositories on your server live in <span 
class="pcrr7tn-">/home/hg/repos</span>, and <a 
 id="dx7-101020"></a><span 
class="pcrr7tn-">notify</span>
     is considering a repository named <span 
class="pcrr7tn-">/home/hg/repos/shared/test</span>, setting <a 
 id="dx7-101021"></a><span 
class="pcrr7tn-">strip </span>to <span 
class="pcrr7tn-">4 </span>will cause <a 
 id="dx7-101022"></a><span 
class="pcrr7tn-">notify </span>to
     trim the path it considers down to <span 
class="pcrr7tn-">shared/test</span>, and it will match subscribers against that.
     </span><li><span class="dt">
<a 
 id="dx7-101023"></a><span 
class="pcrr7tn-">template</span> </span><span class="dd">The template text to use when sending messages. This specifies both the contents of the message header and its
     body.
     </span><li><span class="dt">
<a 
 id="dx7-101024"></a><span 
class="pcrr7tn-">maxdiff</span> </span><span class="dd">The maximum number of lines of diff data to append to the end of a message. If a diff is longer than this, it is
     truncated. By default, this is set to 300. Set this to <span 
class="pcrr7tn-">0 </span>to omit diffs from notification emails.
     </span><li><span class="dt">
<a 
 id="dx7-101025"></a><span 
class="pcrr7tn-">sources</span> </span><span class="dd">A list of sources of changesets to consider. This lets you limit <a 
 id="dx7-101026"></a><span 
class="pcrr7tn-">notify </span>to only sending out email about changes
     that remote users pushed into this repository via a server, for example. See section&#x00A0;<a 
href="#x7-1070003.8.3">3.8.3<!--tex4ht:ref: sec:hook:sources --></a> for the sources you can
     specify here.</li></ul>
<!--l. 906--><p class="indent">   If you set the <a 
 id="dx7-101027"></a><span 
class="pcrr7tn-">baseurl </span>item in the <a 
 id="dx7-101028"></a><span 
class="pcrr7tn-">[web] </span>section, you can use it in a template; it will be available as <span 
class="pcrr7tn-">webroot</span>.
</p><!--l. 910--><p class="indent">   Here is an example set of <a 
 id="dx7-101029"></a><span 
class="pcrr7tn-">notify </span>configuration information.
                                                                                         
                                                                                         
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x7-101031r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;[notify]</span>
<br class="fancyvrb" /><a 
 id="x7-101033r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;#</span><span 
class="pcrr7tn-">&#x00A0;really</span><span 
class="pcrr7tn-">&#x00A0;send</span><span 
class="pcrr7tn-">&#x00A0;email</span>
<br class="fancyvrb" /><a 
 id="x7-101035r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;test</span><span 
class="pcrr7tn-">&#x00A0;=</span><span 
class="pcrr7tn-">&#x00A0;false</span>
<br class="fancyvrb" /><a 
 id="x7-101037r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;#</span><span 
class="pcrr7tn-">&#x00A0;subscriber</span><span 
class="pcrr7tn-">&#x00A0;data</span><span 
class="pcrr7tn-">&#x00A0;lives</span><span 
class="pcrr7tn-">&#x00A0;in</span><span 
class="pcrr7tn-">&#x00A0;the</span><span 
class="pcrr7tn-">&#x00A0;notify</span><span 
class="pcrr7tn-">&#x00A0;repo</span>
<br class="fancyvrb" /><a 
 id="x7-101039r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;config</span><span 
class="pcrr7tn-">&#x00A0;=</span><span 
class="pcrr7tn-">&#x00A0;/home/hg/repos/notify/notify.conf</span>
<br class="fancyvrb" /><a 
 id="x7-101041r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;#</span><span 
class="pcrr7tn-">&#x00A0;repos</span><span 
class="pcrr7tn-">&#x00A0;live</span><span 
class="pcrr7tn-">&#x00A0;in</span><span 
class="pcrr7tn-">&#x00A0;/home/hg/repos</span><span 
class="pcrr7tn-">&#x00A0;on</span><span 
class="pcrr7tn-">&#x00A0;server,</span><span 
class="pcrr7tn-">&#x00A0;so</span><span 
class="pcrr7tn-">&#x00A0;strip</span><span 
class="pcrr7tn-">&#x00A0;4</span><span 
class="pcrr7tn-">&#x00A0;"/"</span><span 
class="pcrr7tn-">&#x00A0;chars</span>
<br class="fancyvrb" /><a 
 id="x7-101043r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;strip</span><span 
class="pcrr7tn-">&#x00A0;=</span><span 
class="pcrr7tn-">&#x00A0;4</span>
<br class="fancyvrb" /><a 
 id="x7-101045r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;template</span><span 
class="pcrr7tn-">&#x00A0;=</span><span 
class="pcrr7tn-">&#x00A0;X-Hg-Repo:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="cmsy-10">{</span><span 
class="pcrr7tn-">webroot</span><span 
class="cmsy-10">}</span>
<br class="fancyvrb" /><a 
 id="x7-101047r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Subject:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="cmsy-10">{</span><span 
class="pcrr7tn-">webroot</span><span 
class="cmsy-10">}</span><span 
class="pcrr7tn-">:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="cmsy-10">{</span><span 
class="pcrr7tn-">desc|firstline|strip</span><span 
class="cmsy-10">}</span>
<br class="fancyvrb" /><a 
 id="x7-101049r10"></a><span 
class="ptmr7t-x-x-50">10</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;From:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="cmsy-10">{</span><span 
class="pcrr7tn-">author</span><span 
class="cmsy-10">}</span>
<br class="fancyvrb" /><a 
 id="x7-101051r11"></a><span 
class="ptmr7t-x-x-50">11</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x7-101053r12"></a><span 
class="ptmr7t-x-x-50">12</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;changeset</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="cmsy-10">{</span><span 
class="pcrr7tn-">node|short</span><span 
class="cmsy-10">}</span><span 
class="pcrr7tn-">&#x00A0;in</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="cmsy-10">{</span><span 
class="pcrr7tn-">root</span><span 
class="cmsy-10">}</span>
<br class="fancyvrb" /><a 
 id="x7-101055r13"></a><span 
class="ptmr7t-x-x-50">13</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;details:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="cmsy-10">{</span><span 
class="pcrr7tn-">baseurl</span><span 
class="cmsy-10">}{</span><span 
class="pcrr7tn-">webroot</span><span 
class="cmsy-10">}</span><span 
class="pcrr7tn-">?cmd=changeset;node=</span><span 
class="cmsy-10">{</span><span 
class="pcrr7tn-">node|short</span><span 
class="cmsy-10">}</span>
<br class="fancyvrb" /><a 
 id="x7-101057r14"></a><span 
class="ptmr7t-x-x-50">14</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;description:</span>
<br class="fancyvrb" /><a 
 id="x7-101059r15"></a><span 
class="ptmr7t-x-x-50">15</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="cmsy-10">{</span><span 
class="pcrr7tn-">desc|tabindent|strip</span><span 
class="cmsy-10">}</span>
<br class="fancyvrb" /><a 
 id="x7-101061r16"></a><span 
class="ptmr7t-x-x-50">16</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x7-101063r17"></a><span 
class="ptmr7t-x-x-50">17</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;[web]</span>
<br class="fancyvrb" /><a 
 id="x7-101065r18"></a><span 
class="ptmr7t-x-x-50">18</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;baseurl</span><span 
class="pcrr7tn-">&#x00A0;=</span><span 
class="pcrr7tn-">&#x00A0;http://hg.example.com/</span>
   </div>
<!--l. 932--><p class="indent">   This will produce a message that looks like the following:
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x7-101067r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;X-Hg-Repo:</span><span 
class="pcrr7tn-">&#x00A0;tests/slave</span>
<br class="fancyvrb" /><a 
 id="x7-101069r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Subject:</span><span 
class="pcrr7tn-">&#x00A0;tests/slave:</span><span 
class="pcrr7tn-">&#x00A0;Handle</span><span 
class="pcrr7tn-">&#x00A0;error</span><span 
class="pcrr7tn-">&#x00A0;case</span><span 
class="pcrr7tn-">&#x00A0;when</span><span 
class="pcrr7tn-">&#x00A0;slave</span><span 
class="pcrr7tn-">&#x00A0;has</span><span 
class="pcrr7tn-">&#x00A0;no</span><span 
class="pcrr7tn-">&#x00A0;buffers</span>
<br class="fancyvrb" /><a 
 id="x7-101071r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Date:</span><span 
class="pcrr7tn-">&#x00A0;Wed,</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;2</span><span 
class="pcrr7tn-">&#x00A0;Aug</span><span 
class="pcrr7tn-">&#x00A0;2006</span><span 
class="pcrr7tn-">&#x00A0;15:25:46</span><span 
class="pcrr7tn-">&#x00A0;-0700</span><span 
class="pcrr7tn-">&#x00A0;(PDT)</span>
<br class="fancyvrb" /><a 
 id="x7-101073r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x7-101075r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;changeset</span><span 
class="pcrr7tn-">&#x00A0;3cba9bfe74b5</span><span 
class="pcrr7tn-">&#x00A0;in</span><span 
class="pcrr7tn-">&#x00A0;/home/hg/repos/tests/slave</span>
<br class="fancyvrb" /><a 
 id="x7-101077r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;details:</span><span 
class="pcrr7tn-">&#x00A0;http://hg.example.com/tests/slave?cmd=changeset;node=3cba9bfe74b5</span>
<br class="fancyvrb" /><a 
 id="x7-101079r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;description:</span>
<br class="fancyvrb" /><a 
 id="x7-101081r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Handle</span><span 
class="pcrr7tn-">&#x00A0;error</span><span 
class="pcrr7tn-">&#x00A0;case</span><span 
class="pcrr7tn-">&#x00A0;when</span><span 
class="pcrr7tn-">&#x00A0;slave</span><span 
class="pcrr7tn-">&#x00A0;has</span><span 
class="pcrr7tn-">&#x00A0;no</span><span 
class="pcrr7tn-">&#x00A0;buffers</span>
<br class="fancyvrb" /><a 
 id="x7-101083r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;diffs</span><span 
class="pcrr7tn-">&#x00A0;(54</span><span 
class="pcrr7tn-">&#x00A0;lines):</span>
<br class="fancyvrb" /><a 
 id="x7-101085r10"></a><span 
class="ptmr7t-x-x-50">10</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x7-101087r11"></a><span 
class="ptmr7t-x-x-50">11</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;diff</span><span 
class="pcrr7tn-">&#x00A0;-r</span><span 
class="pcrr7tn-">&#x00A0;9d95df7cf2ad</span><span 
class="pcrr7tn-">&#x00A0;-r</span><span 
class="pcrr7tn-">&#x00A0;3cba9bfe74b5</span><span 
class="pcrr7tn-">&#x00A0;include/tests.h</span>
<br class="fancyvrb" /><a 
 id="x7-101089r12"></a><span 
class="ptmr7t-x-x-50">12</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;---</span><span 
class="pcrr7tn-">&#x00A0;a/include/tests.h</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Wed</span><span 
class="pcrr7tn-">&#x00A0;Aug</span><span 
class="pcrr7tn-">&#x00A0;02</span><span 
class="pcrr7tn-">&#x00A0;15:19:52</span><span 
class="pcrr7tn-">&#x00A0;2006</span><span 
class="pcrr7tn-">&#x00A0;-0700</span>
<br class="fancyvrb" /><a 
 id="x7-101091r13"></a><span 
class="ptmr7t-x-x-50">13</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;+++</span><span 
class="pcrr7tn-">&#x00A0;b/include/tests.h</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Wed</span><span 
class="pcrr7tn-">&#x00A0;Aug</span><span 
class="pcrr7tn-">&#x00A0;02</span><span 
class="pcrr7tn-">&#x00A0;15:25:26</span><span 
class="pcrr7tn-">&#x00A0;2006</span><span 
class="pcrr7tn-">&#x00A0;-0700</span>
<br class="fancyvrb" /><a 
 id="x7-101093r14"></a><span 
class="ptmr7t-x-x-50">14</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;@@</span><span 
class="pcrr7tn-">&#x00A0;-212,6</span><span 
class="pcrr7tn-">&#x00A0;+212,15</span><span 
class="pcrr7tn-">&#x00A0;@@</span><span 
class="pcrr7tn-">&#x00A0;static</span><span 
class="pcrr7tn-">&#x00A0;__inline__</span><span 
class="pcrr7tn-">&#x00A0;void</span><span 
class="pcrr7tn-">&#x00A0;test_headers(void</span><span 
class="pcrr7tn-">&#x00A0;&#x22C6;h)</span>
<br class="fancyvrb" /><a 
 id="x7-101095r15"></a><span 
class="ptmr7t-x-x-50">15</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;[...snip...]</span>
   </div>
<!--l. 951--><p class="noindent">
</p>
   <h5 class="subsubsectionHead"><a 
 id="x7-1020003.7.3"></a>Testing and troubleshooting</h5>
<!--l. 953--><p class="noindent">Do not forget that by default, the <a 
 id="dx7-102001"></a><span 
class="pcrr7tn-">notify </span>extension <span 
class="ptmri7t-">will not send any mail </span>until you explicitly configure it to do so, by setting
<a 
 id="dx7-102002"></a><span 
class="pcrr7tn-">test </span>to <span 
class="pcrr7tn-">false</span>. Until you do that, it simply prints the message it <span 
class="ptmri7t-">would </span>send.
                                                                                         
                                                                                         
</p><!--l. 958--><p class="noindent">
</p>
   <h3 class="sectionHead"><span class="titlemark">3.8    </span> <a 
 id="x7-1030003.8"></a>Information for writers of hooks</h3>
<!--l. 961--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.8.1    </span> <a 
 id="x7-1040003.8.1"></a>In-process hook execution</h4>
<!--l. 963--><p class="noindent">An in-process hook is called with arguments of the following form:
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x7-104002r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;def</span><span 
class="pcrr7tn-">&#x00A0;myhook(ui,</span><span 
class="pcrr7tn-">&#x00A0;repo,</span><span 
class="pcrr7tn-">&#x00A0;&#x22C6;&#x22C6;kwargs):</span>
<br class="fancyvrb" /><a 
 id="x7-104004r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;pass</span>
   </div>
<!--l. 968--><p class="noindent">The <span 
class="pcrr7tn-">ui </span>parameter is a <a 
 id="dx7-104005"></a><span 
class="pcrr7tn-">mercurial.ui.ui </span>object. The <span 
class="pcrr7tn-">repo </span>parameter is a <a 
 id="dx7-104006"></a><span 
class="pcrr7tn-">mercurial.localrepo.localrepository </span>object. The
names and values of the <span 
class="pcrr7tn-">&#x22C6;&#x22C6;kwargs </span>parameters depend on the hook being invoked, with the following common features:
</p>
     <ul><li><span class="dt">
     </span><span class="dd">If a parameter is named <span 
class="pcrr7tn-">node </span>or <span 
class="pcrr7tn-">parent</span><span 
class="pcrro7t-">N</span>, it will contain a hexadecimal changeset ID. The empty string is used
     to represent &#x201C;null changeset ID&#x201D; instead of a string of zeroes.
     </span><li><span class="dt">
     </span><span class="dd">If a parameter is named <span 
class="pcrr7tn-">url</span>, it will contain the URL of a remote repository, if that can be determined.
     </span><li><span class="dt">
     </span><span class="dd">Boolean-valued parameters are represented as Python <span 
class="pcrr7tn-">bool </span>objects.</li></ul>
<!--l. 984--><p class="indent">   An in-process hook is called without a change to the process&#x2019;s working directory (unlike external hooks, which are run in
the root of the repository). It must not change the process&#x2019;s working directory, or it will cause any calls it makes into the
Mercurial API to fail.
</p><!--l. 989--><p class="indent">   If a hook returns a boolean &#x201C;false&#x201D; value, it is considered to have succeeded. If it returns a boolean &#x201C;true&#x201D; value or raises
an exception, it is considered to have failed. A useful way to think of the calling convention is &#x201C;tell me if you
fail&#x201D;.
</p><!--l. 994--><p class="indent">   Note that changeset IDs are passed into Python hooks as hexadecimal strings, not the binary hashes that Mercurial&#x2019;s APIs
normally use. To convert a hash from hex to binary, use the <a 
 id="dx7-104007"></a><span 
class="pcrr7tn-">mercurial.node.bin </span>function.
</p><!--l. 999--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.8.2    </span> <a 
 id="x7-1050003.8.2"></a>External hook execution</h4>
<!--l. 1001--><p class="noindent">An external hook is passed to the shell of the user running Mercurial. Features of that shell, such as variable substitution and
command redirection, are available. The hook is run in the root directory of the repository (unlike in-process hooks, which are
run in the same directory that Mercurial was run in).
</p><!--l. 1007--><p class="indent">   Hook parameters are passed to the hook as environment variables. Each environment variable&#x2019;s name is converted in upper
case and prefixed with the string &#x201C;<span 
class="pcrr7tn-">HG</span><span 
class="pcrr7tn-">_</span>&#x201D;. For example, if the name of a parameter is &#x201C;<span 
class="pcrr7tn-">node</span>&#x201D;, the name of the environment
variable representing that parameter will be &#x201C;<span 
class="pcrr7tn-">HG</span><span 
class="pcrr7tn-">_NODE</span>&#x201D;.
</p><!--l. 1013--><p class="indent">   A boolean parameter is represented as the string &#x201C;<span 
class="pcrr7tn-">1</span>&#x201D; for &#x201C;true&#x201D;, &#x201C;<span 
class="pcrr7tn-">0</span>&#x201D; for &#x201C;false&#x201D;. If an environment variable is named
<a 
 id="dx7-105001"></a><a 
 id="dx7-105002"></a><span 
class="pcrr7tn-">HG</span><span 
class="pcrr7tn-">_NODE</span>, <a 
 id="dx7-105003"></a><a 
 id="dx7-105004"></a><span 
class="pcrr7tn-">HG</span><span 
class="pcrr7tn-">_PARENT1 </span>or <a 
 id="dx7-105005"></a><a 
 id="dx7-105006"></a><span 
class="pcrr7tn-">HG</span><span 
class="pcrr7tn-">_PARENT2</span>, it contains a changeset ID represented as a hexadecimal string. The empty string is
used to represent &#x201C;null changeset ID&#x201D; instead of a string of zeroes. If an environment variable is named <a 
 id="dx7-105007"></a><a 
 id="dx7-105008"></a><span 
class="pcrr7tn-">HG</span><span 
class="pcrr7tn-">_URL</span>, it will contain
the URL of a remote repository, if that can be determined.
                                                                                         
                                                                                         
</p><!--l. 1022--><p class="indent">   If a hook exits with a status of zero, it is considered to have succeeded. If it exits with a non-zero status, it is considered to
have failed.
</p><!--l. 1026--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.8.3    </span> <a 
 id="x7-1060003.8.3"></a>Finding out where changesets come from</h4>
<!--l. 1028--><p class="noindent">A hook that involves the transfer of changesets between a local repository and another may be able to find out information
about the &#x201C;far side&#x201D;. Mercurial knows <span 
class="ptmri7t-">how </span>changes are being transferred, and in many cases <span 
class="ptmri7t-">where </span>they are being transferred to
or from.
</p><!--l. 1034--><p class="noindent">
</p>
   <h5 class="subsubsectionHead"><a 
 id="x7-1070003.8.3"></a>Sources of changesets</h5>
<!--l. 1037--><p class="noindent">Mercurial will tell a hook what means are, or were, used to transfer changesets between repositories. This is provided by
Mercurial in a Python parameter named <span 
class="pcrr7tn-">source</span>, or an environment variable named <a 
 id="dx7-107001"></a><a 
 id="dx7-107002"></a><span 
class="pcrr7tn-">HG</span><span 
class="pcrr7tn-">_SOURCE</span>.
</p>
     <ul><li><span class="dt">
<span 
class="pcrr7tn-">serve</span> </span><span class="dd">Changesets are transferred to or from a remote repository over http or ssh.
     </span><li><span class="dt">
<span 
class="pcrr7tn-">pull</span> </span><span class="dd">Changesets are being transferred via a pull from one repository into another.
     </span><li><span class="dt">
<span 
class="pcrr7tn-">push</span> </span><span class="dd">Changesets are being transferred via a push from one repository into another.
     </span><li><span class="dt">
<span 
class="pcrr7tn-">bundle</span> </span><span class="dd">Changesets are being transferred to or from a bundle.</li></ul>
<!--l. 1053--><p class="noindent">
</p>
   <h5 class="subsubsectionHead"><a 
 id="x7-1080003.8.3"></a>Where changes are going&#x2014;remote repository URLs</h5>
<!--l. 1056--><p class="noindent">When possible, Mercurial will tell a hook the location of the &#x201C;far side&#x201D; of an activity that transfers changeset data between
repositories. This is provided by Mercurial in a Python parameter named <span 
class="pcrr7tn-">url</span>, or an environment variable named
<a 
 id="dx7-108001"></a><a 
 id="dx7-108002"></a><span 
class="pcrr7tn-">HG</span><span 
class="pcrr7tn-">_URL</span>.
</p><!--l. 1061--><p class="indent">   This information is not always known. If a hook is invoked in a repository that is being served via http or ssh, Mercurial
cannot tell where the remote repository is, but it may know where the client is connecting from. In such cases, the URL will
take one of the following forms: </p>
     <ul><li><span class="dt">
     </span><span class="dd"><span 
class="pcrr7tn-">remote:ssh:</span><span 
class="pcrro7t-">ip-address</span>&#x2014;remote ssh client, at the given IP address.
     </span><li><span class="dt">
     </span><span class="dd"><span 
class="pcrr7tn-">remote:http:</span><span 
class="pcrro7t-">ip-address</span>&#x2014;remote http client, at the given IP address. If the client is using SSL, this will
     be of the form <span 
class="pcrr7tn-">remote:https:</span><span 
class="pcrro7t-">ip-address</span>.
     </span><li><span class="dt">
     </span><span class="dd">Empty&#x2014;no information could be discovered about the remote client.</li></ul>
                                                                                         
                                                                                         
<!--l. 1076--><p class="noindent">
</p>
   <h3 class="sectionHead"><span class="titlemark">3.9    </span> <a 
 id="x7-1090003.9"></a>Hook reference</h3>
<!--l. 1078--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.9.1    </span> <a 
 id="x7-1100003.9.1"></a><span 
class="pcrr7tn-">changegroup</span>&#x2014;after remote changesets added</h4>
<!--l. 1081--><p class="noindent">This hook is run after a group of pre-existing changesets has been added to the repository, for example via a <a 
 id="dx7-110001"></a>&#x201C;<span 
class="pcrr7tn-">hg</span>
<span 
class="pcrr7tn-">pull</span>&#x201D; or <a 
 id="dx7-110002"></a>&#x201C;<span 
class="pcrr7tn-">hg unbundle</span>&#x201D;. This hook is run once per operation that added one or more changesets. This is in
contrast to the <a 
 id="dx7-110003"></a><a 
 id="dx7-110004"></a><span 
class="pcrr7tn-">incoming </span>hook, which is run once per changeset, regardless of whether the changesets arrive in a
group.
</p><!--l. 1088--><p class="indent">   Some possible uses for this hook include kicking off an automated build or test of the added changesets, updating a bug
database, or notifying subscribers that a repository contains new changes.
</p><!--l. 1092--><p class="indent">   Parameters to this hook: </p>
     <ul><li><span class="dt">
<span 
class="pcrr7tn-">node</span> </span><span class="dd">A changeset ID. The changeset ID of the first changeset in the group that was added. All changesets between
     this and <a 
 id="dx7-110005"></a><span 
class="pcrr7tn-">tip</span>, inclusive, were added by a single <a 
 id="dx7-110006"></a>&#x201C;<span 
class="pcrr7tn-">hg pull</span>&#x201D;, <a 
 id="dx7-110007"></a>&#x201C;<span 
class="pcrr7tn-">hg push</span>&#x201D; or <a 
 id="dx7-110008"></a>&#x201C;<span 
class="pcrr7tn-">hg unbundle</span>&#x201D;.
     </span><li><span class="dt">
<span 
class="pcrr7tn-">source</span> </span><span class="dd">A string. The source of these changes. See section&#x00A0;<a 
href="#x7-1070003.8.3">3.8.3<!--tex4ht:ref: sec:hook:sources --></a> for details.
     </span><li><span class="dt">
 <span 
class="pcrr7tn-">url</span> </span><span class="dd">A URL. The location of the remote repository, if known. See section&#x00A0;<a 
href="#x7-1080003.8.3">3.8.3<!--tex4ht:ref: sec:hook:url --></a> for more information.</li></ul>
<!--l. 1104--><p class="indent">   See also: <a 
 id="dx7-110009"></a><a 
 id="dx7-110010"></a><span 
class="pcrr7tn-">incoming </span>(section&#x00A0;<a 
href="#x7-1120003.9.3">3.9.3<!--tex4ht:ref: sec:hook:incoming --></a>), <a 
 id="dx7-110011"></a><a 
 id="dx7-110012"></a><span 
class="pcrr7tn-">prechangegroup </span>(section&#x00A0;<a 
href="#x7-1140003.9.5">3.9.5<!--tex4ht:ref: sec:hook:prechangegroup --></a>), <a 
 id="dx7-110013"></a><a 
 id="dx7-110014"></a><span 
class="pcrr7tn-">pretxnchangegroup </span>(section&#x00A0;<a 
href="#x7-1180003.9.9">3.9.9<!--tex4ht:ref: sec:hook:pretxnchangegroup --></a>)
</p><!--l. 1108--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.9.2    </span> <a 
 id="x7-1110003.9.2"></a><span 
class="pcrr7tn-">commit</span>&#x2014;after a new changeset is created</h4>
<!--l. 1111--><p class="noindent">This hook is run after a new changeset has been created.
</p><!--l. 1113--><p class="indent">   Parameters to this hook: </p>
     <ul><li><span class="dt">
<span 
class="pcrr7tn-">node</span> </span><span class="dd">A changeset ID. The changeset ID of the newly committed changeset.
     </span><li><span class="dt">
<span 
class="pcrr7tn-">parent1</span> </span><span class="dd">A changeset ID. The changeset ID of the first parent of the newly committed changeset.
     </span><li><span class="dt">
<span 
class="pcrr7tn-">parent2</span> </span><span class="dd">A changeset ID. The changeset ID of the second parent of the newly committed changeset.</li></ul>
<!--l. 1123--><p class="indent">   See also: <a 
 id="dx7-111001"></a><a 
 id="dx7-111002"></a><span 
class="pcrr7tn-">precommit </span>(section&#x00A0;<a 
href="#x7-1150003.9.6">3.9.6<!--tex4ht:ref: sec:hook:precommit --></a>), <a 
 id="dx7-111003"></a><a 
 id="dx7-111004"></a><span 
class="pcrr7tn-">pretxncommit </span>(section&#x00A0;<a 
href="#x7-1190003.9.10">3.9.10<!--tex4ht:ref: sec:hook:pretxncommit --></a>)
</p><!--l. 1126--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.9.3    </span> <a 
 id="x7-1120003.9.3"></a><span 
class="pcrr7tn-">incoming</span>&#x2014;after one remote changeset is added</h4>
<!--l. 1129--><p class="noindent">This hook is run after a pre-existing changeset has been added to the repository, for example via a <a 
 id="dx7-112001"></a>&#x201C;<span 
class="pcrr7tn-">hg push</span>&#x201D;. If a group of
changesets was added in a single operation, this hook is called once for each added changeset.
</p><!--l. 1134--><p class="indent">   You can use this hook for the same purposes as the <a 
 id="dx7-112002"></a><a 
 id="dx7-112003"></a><span 
class="pcrr7tn-">changegroup </span>hook (section&#x00A0;<a 
href="#x7-1100003.9.1">3.9.1<!--tex4ht:ref: sec:hook:changegroup --></a>); it&#x2019;s simply more convenient
sometimes to run a hook once per group of changesets, while other times it&#x2019;s handier once per changeset.
</p><!--l. 1139--><p class="indent">   Parameters to this hook: </p>
                                                                                         
                                                                                         
     <ul><li><span class="dt">
<span 
class="pcrr7tn-">node</span> </span><span class="dd">A changeset ID. The ID of the newly added changeset.
     </span><li><span class="dt">
<span 
class="pcrr7tn-">source</span> </span><span class="dd">A string. The source of these changes. See section&#x00A0;<a 
href="#x7-1070003.8.3">3.8.3<!--tex4ht:ref: sec:hook:sources --></a> for details.
     </span><li><span class="dt">
 <span 
class="pcrr7tn-">url</span> </span><span class="dd">A URL. The location of the remote repository, if known. See section&#x00A0;<a 
href="#x7-1080003.8.3">3.8.3<!--tex4ht:ref: sec:hook:url --></a> for more information.</li></ul>
<!--l. 1149--><p class="indent">   See also: <a 
 id="dx7-112004"></a><a 
 id="dx7-112005"></a><span 
class="pcrr7tn-">changegroup </span>(section&#x00A0;<a 
href="#x7-1100003.9.1">3.9.1<!--tex4ht:ref: sec:hook:changegroup --></a>) <a 
 id="dx7-112006"></a><a 
 id="dx7-112007"></a><span 
class="pcrr7tn-">prechangegroup </span>(section&#x00A0;<a 
href="#x7-1140003.9.5">3.9.5<!--tex4ht:ref: sec:hook:prechangegroup --></a>), <a 
 id="dx7-112008"></a><a 
 id="dx7-112009"></a><span 
class="pcrr7tn-">pretxnchangegroup </span>(section&#x00A0;<a 
href="#x7-1180003.9.9">3.9.9<!--tex4ht:ref: sec:hook:pretxnchangegroup --></a>)
</p><!--l. 1151--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.9.4    </span> <a 
 id="x7-1130003.9.4"></a><span 
class="pcrr7tn-">outgoing</span>&#x2014;after changesets are propagated</h4>
<!--l. 1154--><p class="noindent">This hook is run after a group of changesets has been propagated out of this repository, for example by a <a 
 id="dx7-113001"></a>&#x201C;<span 
class="pcrr7tn-">hg push</span>&#x201D; or <a 
 id="dx7-113002"></a>&#x201C;<span 
class="pcrr7tn-">hg</span>
<span 
class="pcrr7tn-">bundle</span>&#x201D; command.
</p><!--l. 1158--><p class="indent">   One possible use for this hook is to notify administrators that changes have been pulled.
</p><!--l. 1161--><p class="indent">   Parameters to this hook: </p>
     <ul><li><span class="dt">
<span 
class="pcrr7tn-">node</span> </span><span class="dd">A changeset ID. The changeset ID of the first changeset of the group that was sent.
     </span><li><span class="dt">
<span 
class="pcrr7tn-">source</span> </span><span class="dd">A string. The source of the of the operation (see section&#x00A0;<a 
href="#x7-1070003.8.3">3.8.3<!--tex4ht:ref: sec:hook:sources --></a>). If a remote client pulled changes from this
     repository, <span 
class="pcrr7tn-">source </span>will be <span 
class="pcrr7tn-">serve</span>. If the client that obtained changes from this repository was local, <span 
class="pcrr7tn-">source </span>will
     be <span 
class="pcrr7tn-">bundle</span>, <span 
class="pcrr7tn-">pull</span>, or <span 
class="pcrr7tn-">push</span>, depending on the operation the client performed.
     </span><li><span class="dt">
 <span 
class="pcrr7tn-">url</span> </span><span class="dd">A URL. The location of the remote repository, if known. See section&#x00A0;<a 
href="#x7-1080003.8.3">3.8.3<!--tex4ht:ref: sec:hook:url --></a> for more information.</li></ul>
<!--l. 1176--><p class="indent">   See also: <a 
 id="dx7-113003"></a><a 
 id="dx7-113004"></a><span 
class="pcrr7tn-">preoutgoing </span>(section&#x00A0;<a 
href="#x7-1160003.9.7">3.9.7<!--tex4ht:ref: sec:hook:preoutgoing --></a>)
</p><!--l. 1178--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.9.5    </span> <a 
 id="x7-1140003.9.5"></a><span 
class="pcrr7tn-">prechangegroup</span>&#x2014;before starting to add remote changesets</h4>
<!--l. 1181--><p class="noindent">This controlling hook is run before Mercurial begins to add a group of changesets from another repository.
</p><!--l. 1184--><p class="indent">   This hook does not have any information about the changesets to be added, because it is run before transmission of those
changesets is allowed to begin. If this hook fails, the changesets will not be transmitted.
</p><!--l. 1189--><p class="indent">   One use for this hook is to prevent external changes from being added to a repository. For example, you could use this to
&#x201C;freeze&#x201D; a server-hosted branch temporarily or permanently so that users cannot push to it, while still allowing a local
administrator to modify the repository.
</p><!--l. 1195--><p class="indent">   Parameters to this hook: </p>
     <ul><li><span class="dt">
<span 
class="pcrr7tn-">source</span> </span><span class="dd">A string. The source of these changes. See section&#x00A0;<a 
href="#x7-1070003.8.3">3.8.3<!--tex4ht:ref: sec:hook:sources --></a> for details.
     </span><li><span class="dt">
 <span 
class="pcrr7tn-">url</span> </span><span class="dd">A URL. The location of the remote repository, if known. See section&#x00A0;<a 
href="#x7-1080003.8.3">3.8.3<!--tex4ht:ref: sec:hook:url --></a> for more information.</li></ul>
<!--l. 1203--><p class="indent">   See also: <a 
 id="dx7-114001"></a><a 
 id="dx7-114002"></a><span 
class="pcrr7tn-">changegroup </span>(section&#x00A0;<a 
href="#x7-1100003.9.1">3.9.1<!--tex4ht:ref: sec:hook:changegroup --></a>), <a 
 id="dx7-114003"></a><a 
 id="dx7-114004"></a><span 
class="pcrr7tn-">incoming </span>(section&#x00A0;<a 
href="#x7-1120003.9.3">3.9.3<!--tex4ht:ref: sec:hook:incoming --></a>), , <a 
 id="dx7-114005"></a><a 
 id="dx7-114006"></a><span 
class="pcrr7tn-">pretxnchangegroup </span>(section&#x00A0;<a 
href="#x7-1180003.9.9">3.9.9<!--tex4ht:ref: sec:hook:pretxnchangegroup --></a>)
                                                                                         
                                                                                         
</p><!--l. 1207--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.9.6    </span> <a 
 id="x7-1150003.9.6"></a><span 
class="pcrr7tn-">precommit</span>&#x2014;before starting to commit a changeset</h4>
<!--l. 1210--><p class="noindent">This hook is run before Mercurial begins to commit a new changeset. It is run before Mercurial has any of the metadata for the
commit, such as the files to be committed, the commit message, or the commit date.
</p><!--l. 1215--><p class="indent">   One use for this hook is to disable the ability to commit new changesets, while still allowing incoming changesets. Another
is to run a build or test, and only allow the commit to begin if the build or test succeeds.
</p><!--l. 1220--><p class="indent">   Parameters to this hook: </p>
     <ul><li><span class="dt">
<span 
class="pcrr7tn-">parent1</span> </span><span class="dd">A changeset ID. The changeset ID of the first parent of the working directory.
     </span><li><span class="dt">
<span 
class="pcrr7tn-">parent2</span> </span><span class="dd">A changeset ID. The changeset ID of the second parent of the working directory.</li></ul>
<!--l. 1227--><p class="noindent">If the commit proceeds, the parents of the working directory will become the parents of the new changeset.
</p><!--l. 1230--><p class="indent">   See also: <a 
 id="dx7-115001"></a><a 
 id="dx7-115002"></a><span 
class="pcrr7tn-">commit </span>(section&#x00A0;<a 
href="#x7-1110003.9.2">3.9.2<!--tex4ht:ref: sec:hook:commit --></a>), <a 
 id="dx7-115003"></a><a 
 id="dx7-115004"></a><span 
class="pcrr7tn-">pretxncommit </span>(section&#x00A0;<a 
href="#x7-1190003.9.10">3.9.10<!--tex4ht:ref: sec:hook:pretxncommit --></a>)
</p><!--l. 1233--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.9.7    </span> <a 
 id="x7-1160003.9.7"></a><span 
class="pcrr7tn-">preoutgoing</span>&#x2014;before starting to propagate changesets</h4>
<!--l. 1236--><p class="noindent">This hook is invoked before Mercurial knows the identities of the changesets to be transmitted.
</p><!--l. 1239--><p class="indent">   One use for this hook is to prevent changes from being transmitted to another repository.
</p><!--l. 1242--><p class="indent">   Parameters to this hook: </p>
     <ul><li><span class="dt">
<span 
class="pcrr7tn-">source</span> </span><span class="dd">A string. The source of the operation that is attempting to obtain changes from this repository (see section&#x00A0;<a 
href="#x7-1070003.8.3">3.8.3<!--tex4ht:ref: sec:hook:sources --></a>).
     See the documentation for the <span 
class="pcrr7tn-">source </span>parameter to the <a 
 id="dx7-116001"></a><a 
 id="dx7-116002"></a><span 
class="pcrr7tn-">outgoing </span>hook, in section&#x00A0;<a 
href="#x7-1130003.9.4">3.9.4<!--tex4ht:ref: sec:hook:outgoing --></a>, for possible values of
     this parameter.
     </span><li><span class="dt">
 <span 
class="pcrr7tn-">url</span> </span><span class="dd">A URL. The location of the remote repository, if known. See section&#x00A0;<a 
href="#x7-1080003.8.3">3.8.3<!--tex4ht:ref: sec:hook:url --></a> for more information.</li></ul>
<!--l. 1254--><p class="indent">   See also: <a 
 id="dx7-116003"></a><a 
 id="dx7-116004"></a><span 
class="pcrr7tn-">outgoing </span>(section&#x00A0;<a 
href="#x7-1130003.9.4">3.9.4<!--tex4ht:ref: sec:hook:outgoing --></a>)
</p><!--l. 1256--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.9.8    </span> <a 
 id="x7-1170003.9.8"></a><span 
class="pcrr7tn-">pretag</span>&#x2014;before tagging a changeset</h4>
<!--l. 1259--><p class="noindent">This controlling hook is run before a tag is created. If the hook succeeds, creation of the tag proceeds. If the hook fails, the tag
is not created.
</p><!--l. 1263--><p class="indent">   Parameters to this hook: </p>
     <ul><li><span class="dt">
<span 
class="pcrr7tn-">local</span> </span><span class="dd">A boolean. Whether the tag is local to this repository instance (i.e.&#x00A0;stored in <a 
 id="dx7-117001"></a><span 
class="pcrr7tn-">.hg/localtags</span>) or managed by
     Mercurial (stored in <a 
 id="dx7-117002"></a><span 
class="pcrr7tn-">.hgtags</span>).
     </span><li><span class="dt">
<span 
class="pcrr7tn-">node</span> </span><span class="dd">A changeset ID. The ID of the changeset to be tagged.
     </span><li><span class="dt">
 <span 
class="pcrr7tn-">tag</span> </span><span class="dd">A string. The name of the tag to be created.</li></ul>
                                                                                         
                                                                                         
<!--l. 1272--><p class="indent">   If the tag to be created is revision-controlled, the <a 
 id="dx7-117003"></a><a 
 id="dx7-117004"></a><span 
class="pcrr7tn-">precommit </span>and <a 
 id="dx7-117005"></a><a 
 id="dx7-117006"></a><span 
class="pcrr7tn-">pretxncommit </span>hooks (sections&#x00A0;<a 
href="#x7-1110003.9.2">3.9.2<!--tex4ht:ref: sec:hook:commit --></a> and&#x00A0;<a 
href="#x7-1190003.9.10">3.9.10<!--tex4ht:ref: sec:hook:pretxncommit --></a>) will
also be run.
</p><!--l. 1276--><p class="indent">   See also: <a 
 id="dx7-117007"></a><a 
 id="dx7-117008"></a><span 
class="pcrr7tn-">tag </span>(section&#x00A0;<a 
href="#x7-1210003.9.12">3.9.12<!--tex4ht:ref: sec:hook:tag --></a>)
</p><!--l. 1279--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.9.9    </span> <a 
 id="x7-1180003.9.9"></a><span 
class="pcrr7tn-">pretxnchangegroup</span>&#x2014;before completing addition of remote changesets</h4>
<!--l. 1282--><p class="noindent">This controlling hook is run before a transaction&#x2014;that manages the addition of a group of new changesets from outside
the repository&#x2014;completes. If the hook succeeds, the transaction completes, and all of the changesets become
permanent within this repository. If the hook fails, the transaction is rolled back, and the data for the changesets is
erased.
</p><!--l. 1289--><p class="indent">   This hook can access the metadata associated with the almost-added changesets, but it should not do anything permanent
with this data. It must also not modify the working directory.
</p><!--l. 1293--><p class="indent">   While this hook is running, if other Mercurial processes access this repository, they will be able to see the
almost-added changesets as if they are permanent. This may lead to race conditions if you do not take steps to avoid
them.
</p><!--l. 1298--><p class="indent">   This hook can be used to automatically vet a group of changesets. If the hook fails, all of the changesets are &#x201C;rejected&#x201D;
when the transaction rolls back.
</p><!--l. 1302--><p class="indent">   Parameters to this hook: </p>
     <ul><li><span class="dt">
<span 
class="pcrr7tn-">node</span> </span><span class="dd">A changeset ID. The changeset ID of the first changeset in the group that was added. All changesets between
     this and <a 
 id="dx7-118001"></a><span 
class="pcrr7tn-">tip</span>, inclusive, were added by a single <a 
 id="dx7-118002"></a>&#x201C;<span 
class="pcrr7tn-">hg pull</span>&#x201D;, <a 
 id="dx7-118003"></a>&#x201C;<span 
class="pcrr7tn-">hg push</span>&#x201D; or <a 
 id="dx7-118004"></a>&#x201C;<span 
class="pcrr7tn-">hg unbundle</span>&#x201D;.
     </span><li><span class="dt">
<span 
class="pcrr7tn-">source</span> </span><span class="dd">A string. The source of these changes. See section&#x00A0;<a 
href="#x7-1070003.8.3">3.8.3<!--tex4ht:ref: sec:hook:sources --></a> for details.
     </span><li><span class="dt">
 <span 
class="pcrr7tn-">url</span> </span><span class="dd">A URL. The location of the remote repository, if known. See section&#x00A0;<a 
href="#x7-1080003.8.3">3.8.3<!--tex4ht:ref: sec:hook:url --></a> for more information.</li></ul>
<!--l. 1314--><p class="indent">   See also: <a 
 id="dx7-118005"></a><a 
 id="dx7-118006"></a><span 
class="pcrr7tn-">changegroup </span>(section&#x00A0;<a 
href="#x7-1100003.9.1">3.9.1<!--tex4ht:ref: sec:hook:changegroup --></a>), <a 
 id="dx7-118007"></a><a 
 id="dx7-118008"></a><span 
class="pcrr7tn-">incoming </span>(section&#x00A0;<a 
href="#x7-1120003.9.3">3.9.3<!--tex4ht:ref: sec:hook:incoming --></a>), <a 
 id="dx7-118009"></a><a 
 id="dx7-118010"></a><span 
class="pcrr7tn-">prechangegroup </span>(section&#x00A0;<a 
href="#x7-1140003.9.5">3.9.5<!--tex4ht:ref: sec:hook:prechangegroup --></a>)
</p><!--l. 1318--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.9.10    </span> <a 
 id="x7-1190003.9.10"></a><span 
class="pcrr7tn-">pretxncommit</span>&#x2014;before completing commit of new changeset</h4>
<!--l. 1321--><p class="noindent">This controlling hook is run before a transaction&#x2014;that manages a new commit&#x2014;completes. If the hook succeeds, the
transaction completes and the changeset becomes permanent within this repository. If the hook fails, the transaction is rolled
back, and the commit data is erased.
</p><!--l. 1327--><p class="indent">   This hook can access the metadata associated with the almost-new changeset, but it should not do anything permanent with
this data. It must also not modify the working directory.
</p><!--l. 1331--><p class="indent">   While this hook is running, if other Mercurial processes access this repository, they will be able to see the
almost-new changeset as if it is permanent. This may lead to race conditions if you do not take steps to avoid
them.
</p><!--l. 1336--><p class="indent">   Parameters to this hook: </p>
     <ul><li><span class="dt">
<span 
class="pcrr7tn-">node</span> </span><span class="dd">A changeset ID. The changeset ID of the newly committed changeset.
     </span><li><span class="dt">
<span 
class="pcrr7tn-">parent1</span> </span><span class="dd">A changeset ID. The changeset ID of the first parent of the newly committed changeset.
                                                                                         
                                                                                         
     </span><li><span class="dt">
<span 
class="pcrr7tn-">parent2</span> </span><span class="dd">A changeset ID. The changeset ID of the second parent of the newly committed changeset.</li></ul>
<!--l. 1346--><p class="indent">   See also: <a 
 id="dx7-119001"></a><a 
 id="dx7-119002"></a><span 
class="pcrr7tn-">precommit </span>(section&#x00A0;<a 
href="#x7-1150003.9.6">3.9.6<!--tex4ht:ref: sec:hook:precommit --></a>)
</p><!--l. 1348--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.9.11    </span> <a 
 id="x7-1200003.9.11"></a><span 
class="pcrr7tn-">preupdate</span>&#x2014;before updating or merging working directory</h4>
<!--l. 1351--><p class="noindent">This controlling hook is run before an update or merge of the working directory begins. It is run only if Mercurial&#x2019;s normal
pre-update checks determine that the update or merge can proceed. If the hook succeeds, the update or merge may proceed; if it
fails, the update or merge does not start.
</p><!--l. 1357--><p class="indent">   Parameters to this hook: </p>
     <ul><li><span class="dt">
<span 
class="pcrr7tn-">parent1</span> </span><span class="dd">A changeset ID. The ID of the parent that the working directory is to be updated to. If the working directory is
     being merged, it will not change this parent.
     </span><li><span class="dt">
<span 
class="pcrr7tn-">parent2</span> </span><span class="dd">A changeset ID. Only set if the working directory is being merged. The ID of the revision that the working
     directory is being merged with.</li></ul>
<!--l. 1367--><p class="indent">   See also: <a 
 id="dx7-120001"></a><a 
 id="dx7-120002"></a><span 
class="pcrr7tn-">update </span>(section&#x00A0;<a 
href="#x7-1220003.9.13">3.9.13<!--tex4ht:ref: sec:hook:update --></a>)
</p><!--l. 1369--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.9.12    </span> <a 
 id="x7-1210003.9.12"></a><span 
class="pcrr7tn-">tag</span>&#x2014;after tagging a changeset</h4>
<!--l. 1372--><p class="noindent">This hook is run after a tag has been created.
</p><!--l. 1374--><p class="indent">   Parameters to this hook: </p>
     <ul><li><span class="dt">
<span 
class="pcrr7tn-">local</span> </span><span class="dd">A boolean. Whether the new tag is local to this repository instance (i.e.&#x00A0;stored in <a 
 id="dx7-121001"></a><span 
class="pcrr7tn-">.hg/localtags</span>) or managed
     by Mercurial (stored in <a 
 id="dx7-121002"></a><span 
class="pcrr7tn-">.hgtags</span>).
     </span><li><span class="dt">
<span 
class="pcrr7tn-">node</span> </span><span class="dd">A changeset ID. The ID of the changeset that was tagged.
     </span><li><span class="dt">
 <span 
class="pcrr7tn-">tag</span> </span><span class="dd">A string. The name of the tag that was created.</li></ul>
<!--l. 1384--><p class="indent">   If the created tag is revision-controlled, the <a 
 id="dx7-121003"></a><a 
 id="dx7-121004"></a><span 
class="pcrr7tn-">commit </span>hook (section&#x00A0;<a 
href="#x7-1110003.9.2">3.9.2<!--tex4ht:ref: sec:hook:commit --></a>) is run before this hook.
</p><!--l. 1387--><p class="indent">   See also: <a 
 id="dx7-121005"></a><a 
 id="dx7-121006"></a><span 
class="pcrr7tn-">pretag </span>(section&#x00A0;<a 
href="#x7-1170003.9.8">3.9.8<!--tex4ht:ref: sec:hook:pretag --></a>)
</p><!--l. 1389--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.9.13    </span> <a 
 id="x7-1220003.9.13"></a><span 
class="pcrr7tn-">update</span>&#x2014;after updating or merging working directory</h4>
<!--l. 1392--><p class="noindent">This hook is run after an update or merge of the working directory completes. Since a merge can fail (if the external <a 
 id="dx7-122001"></a><span 
class="pcrr7tn-">hgmerge</span>
command fails to resolve conflicts in a file), this hook communicates whether the update or merge completed
cleanly.
</p>
                                                                                         
                                                                                         
     <ul><li><span class="dt">
<span 
class="pcrr7tn-">error</span> </span><span class="dd">A boolean. Indicates whether the update or merge completed successfully.
     </span><li><span class="dt">
<span 
class="pcrr7tn-">parent1</span> </span><span class="dd">A changeset ID. The ID of the parent that the working directory was updated to. If the working directory was
     merged, it will not have changed this parent.
     </span><li><span class="dt">
<span 
class="pcrr7tn-">parent2</span> </span><span class="dd">A changeset ID. Only set if the working directory was merged. The ID of the revision that the working directory
     was merged with.</li></ul>
<!--l. 1408--><p class="indent">   See also: <a 
 id="dx7-122002"></a><a 
 id="dx7-122003"></a><span 
class="pcrr7tn-">preupdate </span>(section&#x00A0;<a 
href="#x7-1200003.9.11">3.9.11<!--tex4ht:ref: sec:hook:preupdate --></a>)
                                                                                         
                                                                                         
                                                                                         
                                                                                         
                                                                                         
                                                                                         
</p>
   <!--l. 1--><div class="crosslinks"><p class="noindent">[<a 
href="hgbookch4.html" >next</a>] [<a 
href="hgbookch2.html" >prev</a>] [<a 
href="hgbookch2.html#tailhgbookch2.html" >prev-tail</a>] [<a 
href="hgbookch3.html" >front</a>] [<a 
href="hgbook.html#hgbookch3.html" >up</a>] </p></div>
<!--l. 1--><p class="indent">   <a 
 id="tailhgbookch3.html"></a>   </p> 
</body></html> 
