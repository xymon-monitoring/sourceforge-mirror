\chapter{Known issues in Hobbit}
\label{chap:Known issues in Hobbit}

\section{Known issues in Hobbit}


 This describes some known problems you may encounter when using Hobbit to monitor servers.
\begin{itemize}
\item How to report bugs
\item JavaScript errors when using enable/disable function
\item DNS error reported for network tests
\item Network tests fail sporadically
\item ``Failed to find enough entropy'' on Solaris
\item Hobbit fails on FreeBSD with ``Could not get sem: No space left on device''
\item Hobbit will not run inside a FreeBSD jail
\item Hobbit on Solaris compiles but aborts with some ``ld.so'' error
\item Hobbit on Solaris compiles but aborts with some ``ld.so'' error
\item Hobbit on Solaris 10 ``hobbitd status-board not available''

\end{itemize}

\subsubsection{How to report bugs}


 If you think you have found a bug in Hobbit, please report it to the
 Hobbit mailing list at hobbit@hswn.dk. You can do a lot to help
 getting bugs fixed by providing detailed information about the bug:

\begin{itemize}
\item Always include the version number of Hobbit you're using
\item If one of the Hobbit tools crashes and leaves a core-file
  (usually in the ~hobbit/server/tmp/ directory), please use the
  \textbf{gdb} tool to pinpoint where the crash occurred:\\ 
\begin{itemize}
\item Login as the Hobbit user
\item  \$ \textbf{cd ~/server}
\\ 
 \$ \textbf{gdb bin/PROGRAMFILE tmp/COREFILE}
\\ 
then at the gdb$>$ prompt, execute the command\\ 
 gdb$>$ \textbf{bt}
 

\end{itemize}


\end{itemize}
\subsubsection{Internet Explorer complains about Javascript errors in Enable/Disable}


 This happens for some, but works for most people. One workaround is
 to disable the Javascript validation code in the enable/disable
 function: Edit ~hobbit/cgi-bin/hobbit-enadis.sh script and add the
 option ``--no-jsvalidation'' to the hobbisvc.cgi command - this
 disables Javascript validation on the ``info'' page - and edit the
 file ~hobbit/server/web/maint\_form so you remove the text
 'onClick=''validateDisable(this.form)''' from the input-tag near the
 end of that file.

\subsubsection{DNS error reported for network tests}


 The bbtest-net network tester uses the built-in ARES library for DNS
 lookups. There have been reports that this library fails on some
 systems; one confirmed case is on ``OSF1 V5.1''. So if you suddenly
 get a lot of failed network tests that report ``DNS error'', try
 running bbtest-net with the ``--no-ares'' option to use the standard
 DNS lookups instead.

\subsubsection{Network tests fail sporadically, or report long reponsetimes}


 The bbtest-net network tester runs many tests in parallel; by default
 it will typically run up to 256 tests concurrently. This may be more
 than your network test server or network infrastructure can handle;
 if you see sporadic timeouts of network tests or the graphs show
 increased responsetimes, you can lower the number of concurrent tests
 by adding the ``--concurrency=N'' option to bbtest-net in the
 ~/server/etc/hobbitlaunch.cfg file. This has been especially
 important for sites doing many http checks, since these typically
 have much more traffic going on while testing than simple TCP
 services such as smtp.

\subsubsection{Network tests fail on Solaris with ``Failed to find enough entropy''}


 OpenSSL uses random data to initialise a key that is negotiated when
 a new SSL-encrypted connection is being setup. Solaris 8 and earlier
 doesn't have a standard way of getting random data, so OpenSSL cannot
 get all of the randomness it needs. Solaris \textbf{patch 112438}

 solves this by adding a /dev/random device that provides random data
 to applications.\\ 

 Thanks to Scott Kelley for the pointer to the Solaris patch.


 Asif Iqbal notes: Patch 112438 only works for Solaris 8. For Solaris
 6 and 7 you need to either install SUNWski pkg or ANDIrand pkg. See
 \url{http://www.cosy.sbg.ac.at/~andi/SUNrand/}. I have been using
 ANDIrand since that did not require a reboot and easily available. 

\subsubsection{Hobbit fails on FreeBSD with ``Could not get sem: No space left on device''}


 Hobbit uses some kernel ressources - semaphores and shared memory. If
 you get the following error message in hobbitlaunch.log when trying
 to start Hobbit:

\begin{verbatim}

2005-05-29 20:25:14 Setting up hobbitd channels
2005-05-29 20:25:14 Could not get sem: No space left on device
2005-05-29 20:25:14 Cannot setup status channel
2005-05-29 20:25:14 Task hobbitd terminated, status 1

\end{verbatim}


 then you need to increase the number of semaphore sets and individual semaphores available to applications.


 The current settings for your kernel can be found with ``sysctl
 kern.ipc.semmni`` (semaphore sets) and ``sysctl kern.ipc.semmns``
 (total number of semaphores). Hobbit uses 6 semaphore sets, with a
 total of 18 semaphores.



 To increase this, put these two lines in /boot/loader.conf on your system:

\begin{verbatim}

kern.ipc.semmni="40"
kern.ipc.semmns="100"

\end{verbatim}


 Adjust the values to something reasonable for your system -
 considering the current settings (from the sysctl output), and
 Hobbit's needs (6 sets with 18 semaphores).



 More information about tuning the FreeBSD kernel parameters is
 available in  the FreeBSD Handbook

\subsubsection{Hobbit will not run inside a FreeBSD jail}


 FreeBSD jails have System V IPC support disabled by default. See the
 FreeBSD architecture Handbook section on jail
 restrictions. Essentially, there is a
 \textbf{security.jail.jail\_sysvipc\_allowed}

 sysctl that must be enabled. If it isn't then Hobbit will refuse to
 start with the error Could not get shm of size 262144: Function not
 implemented.


\subsubsection{Hobbit on Solaris compiles but aborts with some ``ld.so'' error}
 This info was contributed by sladewig, with a few modifications:

\begin{center}


\begin{tabular}{|c|}
\hline 


 The system loader/linker can't find your lib.


 Assuming you have the .so lib in /usr/local/lib, You can add -R to the Makefile


      PCRELIBS = -L/usr/local/lib -R/usr/local/lib -lpcre 


 The -R ``hard code'' the path to the library into the executable so env variable (LD\_LIBRARY\_PATH, ed.) will not be needed. The -L told it where to find it while compiling.


 Or use crle to add /usr/local/lib to system wide runtime linking environment. See man crle. Be VERY CAREFUL with this or you will end up booting from cdrom to repair. Be sure to include the existing library paths!


 Command line:


      crle -c /var/ld/ld.config -l /usr/lib:/usr/lib/secure:/usr/local/lib 


 I usally use the latter as nowadays gcc uses a .so for all its generated programs and then dragging around the LD\_LIBRARY\_PATH isn't needed.
 \\
 \hline 

\end{tabular}


\end{center}


 Note: This information only applies if you are using the Solaris
 linker. The GNU linker uses the ``-rpath'' option which is defined
 differently: Add


      RPATH = -Wl,--rpath= 


 at the bottom of the top-level Makefile.
\subsubsection{Hobbit on Solaris 10 ``hobbitd status-board not available''}


 It seems that Hobbit triggers a bug in the \index{Solaris 10} ``TCP fusion''
 loopback interface, resulting in no data being returned from hobbitd
 when queried for the current status of all monitored systems. The
 recommended solution is to disable the use of \index{TCP fusion}. \index{Colin Spargo} writes:

\begin{verbatim}

If you disable TCP fusion be adding the following kernel parameter to
/etc/system and reboot, hopefully you will find that the problem goes
away.

set ip:do_tcp_fusion = 0

Apparently this can be done on a live system as well (without rebooting),
but will require hobbit to be restarted. To do this:

echo do_tcp_fusion/W0 | mdb -kw

\end{verbatim}

